<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Inferno Drift (BETA)</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root {
    --bg:#0b1220; --fg:#e9f2ff; --muted:#a6b5c8; --line:#1f2a44; --accent:#7bd88f; --accent2:#2af5a4;
    --btn:#13253f; --btnLine:#2b3f64; --shadow:0 20px 60px rgba(0,0,0,.35);
  }
  * { box-sizing:border-box; }
  html,body { height:100%; }
  body {
    margin:0; font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;
    background: radial-gradient(1200px 800px at 70% -20%, #18263f 0%, #0b1220 60%) no-repeat, #0b1220;
    color:var(--fg);
  }
  a { color: inherit; }
  .home {
    position:fixed; inset:0; display:grid; place-items:center; padding:28px;
  }
  .card {
    width:min(980px, 96vw); border:1px solid var(--line); border-radius:18px; background:rgba(10,16,28,.82);
    box-shadow:var(--shadow); padding:26px;
  }
  .hdr { display:flex; align-items:center; justify-content:space-between; gap:16px; }
  .title { font-weight:900; font-size: clamp(22px, 4vw, 38px); letter-spacing:.2px; }
  .beta { font-weight:900; font-size:12px; padding:6px 10px; background:#28201a; color:#ffd166; border:1px solid #5b4632; border-radius:999px; }
  .sub  { color:var(--muted); margin-top:6px; }
  .grid { display:grid; grid-template-columns: repeat(3, 1fr); gap:14px; margin-top:20px; }
  .btn {
    display:flex; flex-direction:column; gap:8px; align-items:center; justify-content:center; text-align:center;
    padding:16px; border-radius:14px; cursor:pointer; background:var(--btn); border:1px solid var(--btnLine); font-weight:900;
  }
  .btn:hover { filter:brightness(1.08); }
  .btn span { font-size:14px; color:var(--muted); font-weight:700; }
  .hint { margin-top:16px; color:var(--muted); font-weight:700; font-size:13px; }
  .foot { display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:18px; }
  .tiny { font-size:12px; color:var(--muted); }
  .heart { color:var(--accent2); font-weight:900; }
  .go { background:#13253f; border:1px solid #2b3f64; padding:8px 12px; border-radius:10px; font-weight:900; cursor:pointer; }
  #stage { position:fixed; inset:0; display:none; }
  #game { position:absolute; inset:0; width:100%; height:100%; border:0; }
  #homeBtn { position:absolute; left:50%; top:10px; transform:translateX(-50%); z-index:10; }
  .pill { background:#0e1a2c; border:1px solid #2a3d63; color:#cfe3ff; border-radius:999px; padding:8px 14px; font-weight:900; cursor:pointer; }
  .pill:active { transform: translateY(1px); }
  @media (max-width: 900px) { .grid { grid-template-columns:1fr; } }
</style>
</head>
<body>
  <section id="home" class="home">
    <div class="card">
      <div class="hdr">
        <div class="title">Inferno Drift</div>
        <div class="beta">BETA</div>
      </div>
      <div class="sub">Choose your device version. This launcher keeps your three originals exactly intact and runs them in-page.</div>
      <div class="grid">
        <button class="btn" id="launchDesktop">
          <div style="font-size:22px;font-weight:900">Desktop</div>
          <span>Keyboard + full HUD</span>
        </button>
        <button class="btn" id="launchIPad">
          <div style="font-size:22px;font-weight:900">iPad</div>
          <span>Touch controls • tablet layout</span>
        </button>
        <button class="btn" id="launchPhone">
          <div style="font-size:22px;font-weight:900">Phone</div>
          <span>Smaller on‑screen controls</span>
        </button>
      </div>
      <div class="foot">
        <div class="tiny">Tip: on Desktop, click once inside the game to capture keyboard focus.</div>
        <button id="goFull" class="go">Toggle Fullscreen</button>
      </div>
    </div>
  </section>

  <section id="stage">
    <button id="homeBtn" class="pill" title="Return to home">Home</button>
    <iframe id="game" allow="autoplay; fullscreen" tabindex="-1"></iframe>
  </section>

<script>
(() => {
  // The three game documents, embedded as data URLs (Desktop, iPad, Phone—phone with smaller overlays).
  const DESK = "data:text/html;base64,PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLGluaXRpYWwtc2NhbGU9MSIgLz4KPHRpdGxlPkluZmVybm8gRHJpZnQ8L3RpdGxlPgo8bWV0YSBuYW1lPSJkZXNjcmlwdGlvbiIgY29udGVudD0iSW5mZXJubyBEcmlmdCDigJQgM0Qgc3R1bnQgYXJlbmEgd2l0aCBzbWFydGVyIHB1cnN1aXQgQUksIG11bHRpcGxlIG1hcHMsIGhlYXQgc2NhbGluZywgc3RyYXRlZ2ljIGJvb3N0IHBhZHMsIGFuZCBjbGVhbiBkZXNrdG9wIEhVRC4iIC8+CjxzdHlsZT4KICA6cm9vdHsKICAgIC0taW5rOiNlOWYyZmY7IC0tbXV0ZWQ6I2E2YjVjODsgLS1iZzojMGIxMjIwOyAtLWh1ZDojMGYxYTJhOyAtLWxpbmU6IzFmMmE0NDsKICAgIC0tZ29vZDojN2JkODhmOyAtLXdhcm46I2VmNDc2ZjsgLS1uaXRybzojMmFmNWE0OyAtLXNoaWVsZDojYjk4N2ZmOwogICAgLS1wUmFtcDojN2FhN2ZmOyAtLXBQbGF0OiNiMGJhZmY7IC0tcEJhbms6IzdlZDFhMjsKICB9CiAgKntib3gtc2l6aW5nOmJvcmRlci1ib3h9IGh0bWwsYm9keXtoZWlnaHQ6MTAwJX0KICBib2R5e21hcmdpbjowO2JhY2tncm91bmQ6IzBiMTIyMDtjb2xvcjp2YXIoLS1pbmspO2ZvbnQtZmFtaWx5OkludGVyLHN5c3RlbS11aSxTZWdvZSBVSSxSb2JvdG8sQXJpYWx9CiAgY2FudmFze2Rpc3BsYXk6YmxvY2t9CgogIC8qID09PSBIVUQgY2FyZHMgPT09ICovCiAgLmh1ZHtwb3NpdGlvbjpmaXhlZDsgaW5zZXQ6MTBweCAxMHB4IGF1dG8gMTBweDsgZGlzcGxheTpmbGV4OyBnYXA6MTBweDsgZmxleC13cmFwOndyYXA7IHotaW5kZXg6MTF9CiAgLmNhcmR7YmFja2dyb3VuZDpsaW5lYXItZ3JhZGllbnQoMTgwZGVnLHZhcigtLWh1ZCksIzBiMTQyMik7IGJvcmRlcjoxcHggc29saWQgdmFyKC0tbGluZSk7IGJvcmRlci1yYWRpdXM6MTJweDsgcGFkZGluZzoxMHB4IDEycHg7IG1pbi13aWR0aDoxNDBweH0KICAuY2FyZCBoM3ttYXJnaW46MCAwIDZweDsgZm9udDo2MDAgMTJweC8xIEludGVyLHN5c3RlbS11aTsgY29sb3I6dmFyKC0tbXV0ZWQpOyB0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7IGxldHRlci1zcGFjaW5nOi4zcHh9CiAgLmJpZ3tmb250LXdlaWdodDo4MDA7IGZvbnQtc2l6ZToyNHB4fQogIC5jbGlja2FibGV7Y3Vyc29yOnBvaW50ZXJ9CiAgI3Njb3JlOmhvdmVye2ZpbHRlcjpicmlnaHRuZXNzKDEuMTUpfQoKICAuYmFye2hlaWdodDoxMnB4OyBiYWNrZ3JvdW5kOiMwYTE0MjA7IGJvcmRlcjoxcHggc29saWQgdmFyKC0tbGluZSk7IGJvcmRlci1yYWRpdXM6OTk5cHg7IG92ZXJmbG93OmhpZGRlbn0KICAuZmlsbHtoZWlnaHQ6MTAwJTsgYmFja2dyb3VuZDpsaW5lYXItZ3JhZGllbnQoOTBkZWcsI2ZmZDE2NiwjZjVhZDNhKTsgd2lkdGg6MCV9CiAgLmJhZGdle2Rpc3BsYXk6aW5saW5lLWJsb2NrOyBwYWRkaW5nOjJweCA4cHg7IGJvcmRlci1yYWRpdXM6OTk5cHg7IGJhY2tncm91bmQ6IzExMjEzYTsgYm9yZGVyOjFweCBzb2xpZCAjMjEzNTVkOyBmb250LXdlaWdodDo3MDA7IGZvbnQtc2l6ZToxMnB4fQogIC5oZWF0U3RhcnN7bGV0dGVyLXNwYWNpbmc6MXB4OyBjb2xvcjojZmZkMTY2fQogIC5jb29sdHh0e2ZvbnQtd2VpZ2h0OjcwMDsgY29sb3I6I2E2YjVjODsgZm9udC1zaXplOjEycHh9CgogIC8qID09PSBUb3AtcmlnaHQgY29udHJvbHMgPT09ICovCiAgLmNvbnRyb2xzQmFye3Bvc2l0aW9uOmZpeGVkOyB0b3A6MTBweDsgcmlnaHQ6MTBweDsgZGlzcGxheTpmbGV4OyBnYXA6MTBweDsgei1pbmRleDoxMn0KICAuYnRue2JhY2tncm91bmQ6IzEwMjAzNzsgY29sb3I6I2NmZTNmZjsgYm9yZGVyOjFweCBzb2xpZCAjMmEzZDYzOyBib3JkZXItcmFkaXVzOjEwcHg7IHBhZGRpbmc6OHB4IDEycHg7IGZvbnQtd2VpZ2h0OjgwMDsgY3Vyc29yOnBvaW50ZXJ9CiAgLmJ0bjpob3ZlcntmaWx0ZXI6YnJpZ2h0bmVzcygxLjEpfQogIC5idG46YWN0aXZle3RyYW5zZm9ybTp0cmFuc2xhdGVZKDFweCl9CgogIC8qID09PSBNaW5p4oCRbWFwID09PSAqLwogICNtaW5pbWFwe3Bvc2l0aW9uOmZpeGVkOyB0b3A6MTBweDsgcmlnaHQ6MTBweDsgd2lkdGg6MjIwcHg7IGhlaWdodDoyMjBweDsgYm9yZGVyOjFweCBzb2xpZCB2YXIoLS1saW5lKTsKICAgICAgICAgICBiYWNrZ3JvdW5kOiMwYjE0MjJjYzsgYm9yZGVyLXJhZGl1czoxMnB4OyB6LWluZGV4Ojk7IGltYWdlLXJlbmRlcmluZzpwaXhlbGF0ZWQ7IHBvaW50ZXItZXZlbnRzOm5vbmV9CiAgI21hcGxhYmVse3Bvc2l0aW9uOmZpeGVkOyB0b3A6MTJweDsgcmlnaHQ6MTZweDsgei1pbmRleDoxMDsgZm9udDo3MDAgMTJweC8xIEludGVyOyBjb2xvcjojYTZiNWM4OyBsZXR0ZXItc3BhY2luZzouM3B4OyBwb2ludGVyLWV2ZW50czpub25lfQoKICAvKiA9PT0gU2NvcmUgZmVlZCA9PT0gKi8KICAjZmVlZHtwb3NpdGlvbjpmaXhlZDsgcmlnaHQ6MTBweDsgYm90dG9tOjEwcHg7IHdpZHRoOjMwMHB4OyBtYXgtaGVpZ2h0OjQ0dmg7IG92ZXJmbG93OmhpZGRlbjsKICAgICAgICBkaXNwbGF5OmZsZXg7IGZsZXgtZGlyZWN0aW9uOmNvbHVtbi1yZXZlcnNlOyBnYXA6NnB4OyB6LWluZGV4OjExfQogIC5mZWVkSXRlbXtiYWNrZ3JvdW5kOiMwYzE1MjZjYzsgYm9yZGVyOjFweCBzb2xpZCB2YXIoLS1saW5lKTsgYm9yZGVyLXJhZGl1czoxMHB4OyBwYWRkaW5nOjZweCA4cHg7IGZvbnQtd2VpZ2h0OjcwMDsKICAgICAgICAgICAgZGlzcGxheTpmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjsgdHJhbnNmb3JtOnRyYW5zbGF0ZVgoMCk7IG9wYWNpdHk6MTsgdHJhbnNpdGlvbjpvcGFjaXR5IC42cywgdHJhbnNmb3JtIC42c30KICAuZmVlZEl0ZW0uZmFkZXtvcGFjaXR5OjA7IHRyYW5zZm9ybTp0cmFuc2xhdGVYKDEwcHgpfQogIC5mZWVkUHRze2NvbG9yOiNmZmQxNjZ9CgogIC8qID09PSBUb2FzdCAmIG92ZXJsYXlzID09PSAqLwogIC50b2FzdHtwb3NpdGlvbjpmaXhlZDsgbGVmdDo1MCU7IHRyYW5zZm9ybTp0cmFuc2xhdGVYKC01MCUpOyB0b3A6MjBweDsgYmFja2dyb3VuZDojMGUxYTJjOyBib3JkZXI6MXB4IHNvbGlkIHZhcigtLWxpbmUpOyBib3JkZXItcmFkaXVzOjEwcHg7IHBhZGRpbmc6OHB4IDEycHg7IGRpc3BsYXk6bm9uZTsgei1pbmRleDoxMn0KICAuZXJyb3JiYXJ7cG9zaXRpb246Zml4ZWQ7IGxlZnQ6MDsgdG9wOjA7IHBhZGRpbmc6OHB4IDEycHg7IGJhY2tncm91bmQ6IzZiMWExYTsgY29sb3I6I2ZmZjsgZm9udC13ZWlnaHQ6ODAwOyBkaXNwbGF5Om5vbmU7IHotaW5kZXg6MTAwfQoKICAvKiA9PT0gSGVhdCB0aW50IGdyYWRlID09PSAqLwogICNncmFkZXtwb3NpdGlvbjpmaXhlZDsgaW5zZXQ6MDsgcG9pbnRlci1ldmVudHM6bm9uZTsgei1pbmRleDo1OwogICAgICAgICBiYWNrZ3JvdW5kOnJhZGlhbC1ncmFkaWVudChlbGxpcHNlIDgwJSA2MCUgYXQgNTAlIDYwJSwgcmdiYSgyNTUsMTIwLDQwLDAuMTYpLCByZ2JhKDAsMCwwLDApIDYwJSk7CiAgICAgICAgIG9wYWNpdHk6LjEwOyB0cmFuc2l0aW9uOm9wYWNpdHkgLjI1cyBlYXNlfQoKICAvKiA9PT0gSGludCA9PT0gKi8KICAuaGludHtwb3NpdGlvbjpmaXhlZDsgbGVmdDoxMHB4OyBib3R0b206MTBweDsgcGFkZGluZzoxMHB4IDEycHg7IGJvcmRlcjoxcHggc29saWQgdmFyKC0tbGluZSk7IGJvcmRlci1yYWRpdXM6MTBweDsgY29sb3I6I2E2YjVjODsgYmFja2dyb3VuZDojMGMxNTI2Y2M7IHotaW5kZXg6OH0KICAua2Jke2Rpc3BsYXk6aW5saW5lLWJsb2NrOyBwYWRkaW5nOjJweCA2cHg7IGJvcmRlcjoxcHggc29saWQgIzJhMzk1NzsgYm9yZGVyLXJhZGl1czo2cHg7IGJhY2tncm91bmQ6IzBjMTQyMjsgZm9udC13ZWlnaHQ6NzAwfQo8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5Pgo8IS0tIHRvcC1yaWdodCBjb250cm9scyAtLT4KPGRpdiBjbGFzcz0iY29udHJvbHNCYXIiPgogIDxidXR0b24gaWQ9ImJ0bkJvdHMiIGNsYXNzPSJidG4iPkJvdHM6IE9OPC9idXR0b24+CiAgPGJ1dHRvbiBpZD0iYnRuRGlmZiIgY2xhc3M9ImJ0biI+RGlmZmljdWx0eTogTm9ybWFsPC9idXR0b24+CiAgPGJ1dHRvbiBpZD0iYnRuTWFwIiAgY2xhc3M9ImJ0biI+TWFwOiBBcmVuYTwvYnV0dG9uPgogIDxidXR0b24gaWQ9ImJ0bkhlbHAiIGNsYXNzPSJidG4iPkhvdyB0byBQbGF5PC9idXR0b24+CjwvZGl2PgoKPGRpdiBjbGFzcz0iaHVkIj4KICA8ZGl2IGNsYXNzPSJjYXJkIj48aDM+U2NvcmUgKGNsaWNrIHRvIHNoYXJlKTwvaDM+PGRpdiBjbGFzcz0iYmlnIGNsaWNrYWJsZSIgaWQ9InNjb3JlIj4wPC9kaXY+PGRpdiBpZD0iY29tYm8iIHN0eWxlPSJmb250LXdlaWdodDo3MDA7Zm9udC1zaXplOjEycHg7Y29sb3I6I2NmZTNmZiI+Q29tYm8geDEuMDwvZGl2PjwvZGl2PgogIDxkaXYgY2xhc3M9ImNhcmQiPjxoMz5TcGVlZDwvaDM+PGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4OyBnYXA6OHB4OyBhbGlnbi1pdGVtczpiYXNlbGluZSI+PHNwYW4gY2xhc3M9ImJpZyIgaWQ9InNwZWVkIj4wPC9zcGFuPjxzcGFuIHN0eWxlPSJjb2xvcjojYTZiNWM4O2ZvbnQtc2l6ZToxMnB4Ij5tcGg8L3NwYW4+PC9kaXY+PC9kaXY+CiAgPGRpdiBjbGFzcz0iY2FyZCI+PGgzPk5pdHJvPC9oMz48ZGl2IGNsYXNzPSJiYXIiIHN0eWxlPSJ3aWR0aDoxODBweCI+PGRpdiBpZD0ibml0cm9GaWxsIiBjbGFzcz0iZmlsbCI+PC9kaXY+PC9kaXY+PC9kaXY+CiAgPGRpdiBjbGFzcz0iY2FyZCI+PGgzPkFpcnRpbWU8L2gzPjxkaXYgY2xhc3M9ImJpZyIgaWQ9ImFpciI+MC4wczwvZGl2PjwvZGl2PgogIDxkaXYgY2xhc3M9ImNhcmQiPjxoMz5IZWF0PC9oMz4KICAgIDxkaXYgY2xhc3M9ImJpZyI+PHNwYW4gaWQ9ImhlYXRTdGFycyIgY2xhc3M9ImhlYXRTdGFycyI+4piG4piG4piG4piG4piGPC9zcGFuPjwvZGl2PgogICAgPGRpdiBjbGFzcz0iYmFkZ2UiIGlkPSJoZWF0QmFkZ2UiPkNhbG08L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImNvb2x0eHQiIGlkPSJjb29sVHh0Ij48L2Rpdj4KICA8L2Rpdj4KICA8ZGl2IGNsYXNzPSJjYXJkIj48aDM+UG93ZXI8L2gzPjxkaXYgaWQ9InBvd2VyQmFkZ2UiIGNsYXNzPSJiYWRnZSI+4oCUPC9kaXY+PC9kaXY+CjwvZGl2PgoKPGNhbnZhcyBpZD0ibWluaW1hcCIgd2lkdGg9IjIyMCIgaGVpZ2h0PSIyMjAiPjwvY2FudmFzPgo8ZGl2IGlkPSJtYXBsYWJlbCI+TUFQPC9kaXY+Cgo8ZGl2IGlkPSJmZWVkIj48L2Rpdj4KCjxkaXYgY2xhc3M9ImhpbnQiPgogIENsaWNrIG9uY2UgdG8gZm9jdXMuIDxiPkNvbnRyb2xzOjwvYj4gPHNwYW4gY2xhc3M9ImtiZCI+Vy9TPC9zcGFuPiBnYXMvYnJha2UgwrcgPHNwYW4gY2xhc3M9ImtiZCI+QS9EPC9zcGFuPiBzdGVlciDCtwogIDxzcGFuIGNsYXNzPSJrYmQiPlNwYWNlPC9zcGFuPiBoYW5kYnJha2UgKGRyaWZ0KSDCtyA8c3BhbiBjbGFzcz0ia2JkIj5TaGlmdDwvc3Bhbj4gbml0cm8gwrcKICA8c3BhbiBjbGFzcz0ia2JkIj7ihpAv4oaSPC9zcGFuPiBiYXJyZWwgcm9sbCBpbiBhaXIgwrcgPHNwYW4gY2xhc3M9ImtiZCI+Qzwvc3Bhbj4gY2FtZXJhIMK3IDxzcGFuIGNsYXNzPSJrYmQiPlI8L3NwYW4+IHJlc2V0IChoZWF0IGtlcHQpIMK3CiAgPHNwYW4gY2xhc3M9ImtiZCI+Qjwvc3Bhbj4gYm90cyDCtyA8c3BhbiBjbGFzcz0ia2JkIj5UPC9zcGFuPiBzaGFyZSBzY29yZSDCtyA8c3BhbiBjbGFzcz0ia2JkIj5IPC9zcGFuPiBoZWxwIMK3IDxzcGFuIGNsYXNzPSJrYmQiPk08L3NwYW4+IG11dGUKPC9kaXY+Cgo8ZGl2IGlkPSJncmFkZSI+PC9kaXY+CjxkaXYgaWQ9InRvYXN0IiBjbGFzcz0idG9hc3QiPk5pY2UhPC9kaXY+CjxkaXYgaWQ9ImVyciIgY2xhc3M9ImVycm9yYmFyIj48L2Rpdj4KCjwhLS0gTWFudWFsIC0tPgo8ZGl2IGlkPSJtYW51YWwiIHN0eWxlPSJwb3NpdGlvbjpmaXhlZDsgaW5zZXQ6MDsgei1pbmRleDo1MDsgZGlzcGxheTpub25lOyBhbGlnbi1pdGVtczpjZW50ZXI7IGp1c3RpZnktY29udGVudDpjZW50ZXI7IGJhY2tncm91bmQ6cmdiYSg3LDEwLDE4LDAuNzgpOyBiYWNrZHJvcC1maWx0ZXI6c2F0dXJhdGUoMTEwJSkgYmx1cig2cHgpIj4KICA8ZGl2IGNsYXNzPSJtYW51YWxCb3giIHN0eWxlPSJ3aWR0aDptaW4oOTgwcHgsOTJ2dyk7IG1heC1oZWlnaHQ6ODJ2aDsgb3ZlcmZsb3c6YXV0bzsgYmFja2dyb3VuZDojMGUxNzMwOyBib3JkZXI6MXB4IHNvbGlkICMyYTNiNWE7IGJvcmRlci1yYWRpdXM6MTRweDsgcGFkZGluZzoxOHB4IDIwcHg7IGNvbG9yOiNlOWYyZmYiPgogICAgPGRpdiBjbGFzcz0ibWFudWFsQ2xvc2UiIHN0eWxlPSJwb3NpdGlvbjpzdGlja3k7IHRvcDowOyBkaXNwbGF5OmZsZXg7IGp1c3RpZnktY29udGVudDpmbGV4LWVuZDsgbWFyZ2luOi0xMHB4IC0xMHB4IDEwcHggMCI+PGJ1dHRvbiBpZD0ibWFudWFsQ2xvc2UiIGNsYXNzPSJ4YnRuIiBzdHlsZT0iYmFja2dyb3VuZDojMTUyNDQ0OyBjb2xvcjojY2ZlM2ZmOyBib3JkZXI6MXB4IHNvbGlkICMyOTQwNmI7IGJvcmRlci1yYWRpdXM6OHB4OyBwYWRkaW5nOjZweCAxMHB4OyBjdXJzb3I6cG9pbnRlcjsgZm9udC13ZWlnaHQ6ODAwIj5DbG9zZSDinJU8L2J1dHRvbj48L2Rpdj4KICAgIDxoMiBzdHlsZT0ibWFyZ2luOjAgMCAxMHB4OyBmb250OjkwMCAyMnB4LzEuMiBJbnRlciI+SW5mZXJubyBEcmlmdCDigJQgQ29tcGxldGUgR3VpZGU8L2gyPgogICAgPGRpdiBjbGFzcz0ibWFudWFsR3JpZCIgc3R5bGU9ImRpc3BsYXk6Z3JpZDsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjFmciAxZnI7IGdhcDoxMHB4Ij4KICAgICAgPGRpdj4KICAgICAgICA8aDMgc3R5bGU9Im1hcmdpbjoxNnB4IDAgNnB4OyBmb250OjgwMCAxNHB4LzEuMSBJbnRlcjsgY29sb3I6I2E2YjVjODsgdGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlOyBsZXR0ZXItc3BhY2luZzouNHB4Ij5XaGF0IGlzIHRoaXM/PC9oMz4KICAgICAgICA8cD5BcmNhZGXigJFzdHlsZSBkcml2aW5nIHBsYXlncm91bmQuIFNjb3JlIGJ5IDxiPmRyaWZ0aW5nPC9iPiwgPGI+YWlydGltZTwvYj4sIGFuZCA8Yj5mbGlwczwvYj4uIFRoZSBtb3JlIHlvdSBzY29yZSwgdGhlIGhpZ2hlciB5b3VyIDxiPkhlYXQ8L2I+LiBIaWdoZXIgSGVhdCBzcGF3bnMgPGI+c21hcnRlciwgZmFzdGVyIGJvdHM8L2I+IHRoYXQgY2hhc2UgeW91LjwvcD4KICAgICAgICA8aDMgc3R5bGU9Im1hcmdpbjoxNnB4IDAgNnB4OyBmb250OjgwMCAxNHB4LzEuMSBJbnRlcjsgY29sb3I6I2E2YjVjODsgdGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlOyBsZXR0ZXItc3BhY2luZzouNHB4Ij5Hb2FsPC9oMz4KICAgICAgICA8dWwgc3R5bGU9Im1hcmdpbjo2cHggMCAxMHB4IDE4cHgiPjxsaT5LZWVwIHlvdXIgPGI+Q29tYm88L2I+IGFsaXZlLCBjbGltYiA8Yj5IZWF0PC9iPiwgZG9u4oCZdCBnZXQgdGFnZ2VkLjwvbGk+PGxpPlJlc2V0IGtlZXBzIEhlYXQuPC9saT48L3VsPgogICAgICAgIDxoMyBzdHlsZT0ibWFyZ2luOjE2cHggMCA2cHg7IGZvbnQ6ODAwIDE0cHgvMS4xIEludGVyOyBjb2xvcjojYTZiNWM4OyB0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7IGxldHRlci1zcGFjaW5nOi40cHgiPkNvcmUgQ29udHJvbHM8L2gzPgogICAgICAgIDx1bCBzdHlsZT0ibWFyZ2luOjZweCAwIDEwcHggMThweCI+PGxpPjxiPlcvUzwvYj4gdGhyb3R0bGUvYnJha2Ug4oCiIDxiPkEvRDwvYj4gc3RlZXIg4oCiIDxiPlNwYWNlPC9iPiBoYW5kYnJha2Ug4oCiIDxiPlNoaWZ0PC9iPiBuaXRybyDigKIgPGI+4oaQL+KGkjwvYj4gcm9sbHMgaW4gYWlyPC9saT4KICAgICAgICAgICAgPGxpPjxiPlI8L2I+IHJlc2V0IOKAoiA8Yj5CPC9iPiBib3RzIOKAoiA8Yj5DPC9iPiBjYW1lcmEg4oCiIDxiPkg8L2I+IGhlbHAg4oCiIDxiPlQ8L2I+IHNoYXJlPC9saT48L3VsPgogICAgICAgIDxoMyBzdHlsZT0ibWFyZ2luOjE2cHggMCA2cHg7IGZvbnQ6ODAwIDE0cHgvMS4xIEludGVyOyBjb2xvcjojYTZiNWM4OyB0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7IGxldHRlci1zcGFjaW5nOi40cHgiPk1hcHM8L2gzPgogICAgICAgIDx1bCBzdHlsZT0ibWFyZ2luOjZweCAwIDEwcHggMThweCI+PGxpPjxiPkFyZW5hPC9iPiDigJQgYmFsYW5jZWQgcmFtcHMgJiBiYW5rcyAob3JpZ2luYWwpLjwvbGk+PGxpPjxiPkFsbOKAkVRlcnJhaW48L2I+IOKAlCByb2xsaW5nIGhpbGxzLCBnZW50bGUga2lja2Vycywgb2Zm4oCRY2FtYmVyIGJhbmtzLjwvbGk+PGxpPjxiPlNwZWVkd2F5PC9iPiDigJQgd2lkZSBvdmFsLCBib29zdCBleGl0cywgY2hhc2XigJFmcmllbmRseSBzaWdodGxpbmVzLjwvbGk+PC91bD4KICAgICAgPC9kaXY+CiAgICAgIDxkaXY+CiAgICAgICAgPGgzIHN0eWxlPSJtYXJnaW46MTZweCAwIDZweDsgZm9udDo4MDAgMTRweC8xLjEgSW50ZXI7IGNvbG9yOiNhNmI1Yzg7IHRleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTsgbGV0dGVyLXNwYWNpbmc6LjRweCI+U2NvcmluZyAmIFBhZHM8L2gzPgogICAgICAgIDx1bCBzdHlsZT0ibWFyZ2luOjZweCAwIDEwcHggMThweCI+PGxpPjxiPkRyaWZ0PC9iPiBsb25nZXIvY2xlYW5lciA9IG1vcmUgcG9pbnRzLjwvbGk+PGxpPjxiPkFpcnRpbWU8L2I+IHBlciBzZWNvbmQgKyA8Yj5GbGlwczwvYj4gPSBiaWcgY2h1bmtzLjwvbGk+PGxpPjxiPkJvb3N0IFBhZHM8L2I+OiBmb3J3YXJkIGtpY2sgKyBuaXRybyArIGJyaWVmIDxiPlR1cmJvPC9iPi4gUGxhY2VkIG9uIHJhbXAgcnVu4oCRdXBzLCBsYW5kaW5ncywgYW5kIGNvcm5lciBleGl0cy48L2xpPjwvdWw+CiAgICAgICAgPGgzIHN0eWxlPSJtYXJnaW46MTZweCAwIDZweDsgZm9udDo4MDAgMTRweC8xLjEgSW50ZXI7IGNvbG9yOiNhNmI1Yzg7IHRleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTsgbGV0dGVyLXNwYWNpbmc6LjRweCI+SGVhdDwvaDM+CiAgICAgICAgPHVsIHN0eWxlPSJtYXJnaW46NnB4IDAgMTBweCAxOHB4Ij48bGk+RWFybiDihpIgc3RhcnMgcmlzZTsgaWRsZSDihpIgc3RhcnMgY29vbCBkb3duIG9uZSBieSBvbmUuPC9saT48bGk+PGI+SW5mZXJubzwvYj4gZ2l2ZXMgdGhlIGJpZ2dlc3QgbXVsdGlwbGllciBhbmQgdGhlIHNoYXJwZXN0IEFJLjwvbGk+PC91bD4KICAgICAgICA8aDMgc3R5bGU9Im1hcmdpbjoxNnB4IDAgNnB4OyBmb250OjgwMCAxNHB4LzEuMSBJbnRlcjsgY29sb3I6I2E2YjVjODsgdGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlOyBsZXR0ZXItc3BhY2luZzouNHB4Ij5TaGFyZTwvaDM+CiAgICAgICAgPHVsIHN0eWxlPSJtYXJnaW46NnB4IDAgMTBweCAxOHB4Ij48bGk+Q2xpY2sgeW91ciA8Yj5TY29yZTwvYj4gdG8gc2hhcmUgKG5hdGl2ZSBzaGFyZSBpZiBhdmFpbGFibGU7IG90aGVyd2lzZSBjb3BpZWQgdGV4dCkuPC9saT48L3VsPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2Pgo8L2Rpdj4KCjwhLS0gTGlicmFyaWVzIC0tPgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly91bnBrZy5jb20vdGhyZWVAMC4xNTkuMC9idWlsZC90aHJlZS5taW4uanMiPjwvc2NyaXB0Pgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9jYW5ub25AMC42LjIvYnVpbGQvY2Fubm9uLm1pbi5qcyI+PC9zY3JpcHQ+Cgo8c2NyaXB0PgooZnVuY3Rpb24oKXsKICAvKiA9PT09PT09IEVycm9ycyA9PT09PT09ICovCiAgY29uc3QgZXJyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VycicpOwogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGUgPT4geyBlcnIudGV4dENvbnRlbnQgPSAnU2NyaXB0IGVycm9yOiAnICsgZS5tZXNzYWdlOyBlcnIuc3R5bGUuZGlzcGxheT0nYmxvY2snOyB9KTsKICBjb25zdCAkID0gcyA9PiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHMpOwoKICAvKiA9PT09PT09IENvbGxpc2lvbiBncm91cHMgPT09PT09PSAqLwogIGNvbnN0IEdST1VQX0dST1VORCA9IDEsIEdST1VQX1NUVU5UID0gMiwgR1JPVVBfUExBWUVSID0gNCwgR1JPVVBfQUkgPSA4OwoKICAvKiA9PT09PT09IEdsb2JhbHMgPT09PT09PSAqLwogIGNvbnN0IEFSRU5BX0hBTEYgPSAzODAsIENBVENIX1JBRElVUyA9IDUuMjsgLy8gc2xpZ2h0bHkgbGFyZ2VyIHNvIHRhZ3MgZG9uJ3Qgd2hpZmYKICBsZXQgc2NlbmUsIGNhbWVyYSwgcmVuZGVyZXIsIGNsb2NrOwogIGxldCB3b3JsZCwgcGxheWVyVmVoaWNsZSwgY2hhc3Npc0JvZHksIGNoYXNzaXNNZXNoLCBwbGF5ZXJXaGVlbE1lc2hlcz1bXTsKICBsZXQga2V5cyA9IHt9OwogIGxldCBjYW1lcmFNb2RlID0gImNoYXNlIjsKICBsZXQgbml0cm8gPSAxLjAsIG11dGVkID0gZmFsc2UsIGdyb3VuZGVkUHJldiA9IHRydWU7CiAgbGV0IGNhbVNoYWtlID0gMDsKICBsZXQgYm90c0VuYWJsZWQgPSB0cnVlOwoKICAvKiDigJTigJQgVUkg4oCU4oCUICovCiAgY29uc3QgdWkgPSB7CiAgICBzY29yZTogJCgiI3Njb3JlIiksIGNvbWJvOiAkKCIjY29tYm8iKSwgc3BlZWQ6ICQoIiNzcGVlZCIpLCBuaXRyb0ZpbGw6ICQoIiNuaXRyb0ZpbGwiKSwKICAgIGFpcjogJCgiI2FpciIpLCB0b2FzdDogJCgiI3RvYXN0IiksIGhlYXRTdGFyczogJCgiI2hlYXRTdGFycyIpLCBoZWF0QmFkZ2U6ICQoIiNoZWF0QmFkZ2UiKSwKICAgIGNvb2xUeHQ6ICQoIiNjb29sVHh0IiksIHBvd2VyQmFkZ2U6ICQoIiNwb3dlckJhZGdlIiksIGdyYWRlOiAkKCIjZ3JhZGUiKSwKICAgIGJ0bkJvdHM6ICQoIiNidG5Cb3RzIiksIGJ0bkhlbHA6ICQoIiNidG5IZWxwIiksIGJ0bkRpZmY6ICQoIiNidG5EaWZmIiksIGJ0bk1hcDogJCgiI2J0bk1hcCIpLAogICAgbWFudWFsOiAkKCIjbWFudWFsIiksIG1hbnVhbENsb3NlOiAkKCIjbWFudWFsQ2xvc2UiKQogIH07CgogIC8qID09PT09PT0gU2NvcmluZyA9PT09PT09ICovCiAgbGV0IHNjb3JlPTAsIGNvbWJvPTEuMDsKICBsZXQgYWlyYm9ybmU9ZmFsc2UsIGFpclRpbWU9MCwgcm90QWNjdW09MCwgbGFzdFF1YXQ9bnVsbCwgZHJpZnRUaW1lcj0wOwoKICAvKiA9PT09PT09IEhlYXQgLyBEaWZmaWN1bHR5IC8gQUkgc2NhbGluZyA9PT09PT09ICovCiAgY29uc3QgQkFTRV9BSSA9IDMsIE1BWF9IRUFUID0gNTsKICBsZXQgaGVhdCA9IDAsIGhlYXRDaGFyZ2UgPSAwOwogIGxldCBzaW5jZVNjb3JlVCA9IDAsIGNvb2xUaW1lciA9IDA7CiAgY29uc3QgSEVBVF9DT09MRE9XTl9CQVNFID0gNy4wOwogIGNvbnN0IEhFQVRfQ09PTERPV05fUEVSX1NUQVIgPSAzLjA7CgogIGNvbnN0IERJRkYgPSBbCiAgICB7IG5hbWU6IkVhc3kiLCAgIGJvdHM6KzAsIGJvdENvdW50RGVsdGE6LTEsIHNwZWVkOjAuOTIsIGVuZ2luZTowLjkyLCBzdGVlckJvb3N0Oi0wLjA0LCBncmlwOjAuOTYsIHJlcGxhbk11bDoxLjE1LCBhdm9pZE11bDowLjkgfSwKICAgIHsgbmFtZToiTm9ybWFsIiwgYm90czorMCwgYm90Q291bnREZWx0YTogMCwgc3BlZWQ6MS4wMCwgZW5naW5lOjEuMDAsIHN0ZWVyQm9vc3Q6IDAuMDAsIGdyaXA6MS4wMCwgcmVwbGFuTXVsOjEuMDAsIGF2b2lkTXVsOjEuMCB9LAogICAgeyBuYW1lOiJIYXJkIiwgICBib3RzOiswLCBib3RDb3VudERlbHRhOisxLCBzcGVlZDoxLjIwLCBlbmdpbmU6MS4yMiwgc3RlZXJCb29zdDorMC4wOSwgZ3JpcDoxLjEwLCByZXBsYW5NdWw6MC43OCwgYXZvaWRNdWw6MS4xNSB9CiAgXTsKICBsZXQgZGlmZiA9IDE7CgogIGZ1bmN0aW9uIGhlYXRTY29yZU11bHQoKXsgbGV0IG0gPSAxICsgMC4yNSpoZWF0OyBpZiAoaGVhdCA9PT0gTUFYX0hFQVQpIG0gKz0gMC43NTsgcmV0dXJuIG07IH0KICBmdW5jdGlvbiBoZWF0TmFtZShoKXsgcmV0dXJuIFsiQ2FsbSIsIk5vdGljZWQiLCJDaGFzZWQiLCJIb3QiLCJCbGF6aW5nIiwiSW5mZXJubyJdW2hdIHx8ICJDYWxtIjsgfQogIGZ1bmN0aW9uIHRhcmdldEFJQ291bnQoKXsgY29uc3QgZCA9IERJRkZbZGlmZl07IHJldHVybiBNYXRoLm1heCgwLCBNYXRoLm1pbihCQVNFX0FJICsgaGVhdCArIGQuYm90Q291bnREZWx0YSwgYWlTcGF3bnMubGVuZ3RoKSk7IH0KCiAgLyogPT09PT09PSBXb3JsZCBjb250ZW50ID09PT09PT0gKi8KICBsZXQgZmxvb3JNZXNoLCBmbG9vclRleDsKICBsZXQgYm9vc3RzPVtdLCBob29wcz1bXSwgbWFwU2hhcGVzPVtdOwogIGxldCBwaWNrdXBzPVtdLCBvcmJzPVtdOwogIGNvbnN0IHBhcnRpY2xlcyA9IHsgc21va2U6bnVsbCwgZmxhbWU6bnVsbCwgcmluZzpudWxsIH07CgogIGNvbnN0IGZlZWRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZWVkJyk7CgogIC8vIHRyYWNrIHN0dW50IGJvZGllcyBmb3IgbWFwIHJlYnVpbGRzCiAgbGV0IHN0dW50Qm9kaWVzPVtdLCBzdHVudE1lc2hlcz1bXTsKCiAgLyogPT09PT09PSBOYXZpZ2F0aW9uID09PT09PT0gKi8KICBjb25zdCBuYXYgPSB7IG5vZGVzOiBbXSwgZWRnZXM6IFtdIH07CiAgZnVuY3Rpb24gYnVpbGROYXZHcmFwaCgpewogICAgbmF2Lm5vZGVzLmxlbmd0aCA9IDA7IG5hdi5lZGdlcy5sZW5ndGggPSAwOwogICAgY29uc3Qgb3V0ZXJSID0gQVJFTkFfSEFMRiAtIDYwOwogICAgZm9yIChsZXQgaT0wO2k8MTA7aSsrKXsgY29uc3QgYSA9IGkqTWF0aC5QSS81OyBuYXYubm9kZXMucHVzaCh7eDpNYXRoLmNvcyhhKSpvdXRlclIsIHo6TWF0aC5zaW4oYSkqb3V0ZXJSfSk7IH0KICAgIGNvbnN0IG1pZD0yMzAsIGlubmVyPTE1MDsKICAgIFsgWyBtaWQsMF0sWyAwLG1pZF0sWy1taWQsMF0sWzAsLW1pZF0sIFttaWQsbWlkXSxbLW1pZCxtaWRdLFstbWlkLC1taWRdLFttaWQsLW1pZF0gXS5mb3JFYWNoKHA9Pm5hdi5ub2Rlcy5wdXNoKHt4OnBbMF0sIHo6cFsxXX0pKTsKICAgIGZvcihsZXQgaT0wO2k8ODtpKyspeyBjb25zdCBhPWkqTWF0aC5QSS80OyBuYXYubm9kZXMucHVzaCh7eDpNYXRoLmNvcyhhKSppbm5lciwgejpNYXRoLnNpbihhKSppbm5lcn0pOyB9CgogICAgZm9yIChsZXQgaT0wO2k8bmF2Lm5vZGVzLmxlbmd0aDtpKyspewogICAgICBmb3IgKGxldCBqPWkrMTtqPG5hdi5ub2Rlcy5sZW5ndGg7aisrKXsKICAgICAgICBjb25zdCBhPW5hdi5ub2Rlc1tpXSwgYj1uYXYubm9kZXNbal07CiAgICAgICAgY29uc3QgZHg9YS54LWIueCwgZHo9YS56LWIueiwgZGlzdD1NYXRoLmh5cG90KGR4LGR6KTsKICAgICAgICBpZiAoZGlzdDwyNzApeyBuYXYuZWRnZXMucHVzaCh7YTppLGI6aix3OmRpc3R9KTsgbmF2LmVkZ2VzLnB1c2goe2E6aixiOmksdzpkaXN0fSk7IH0KICAgICAgfQogICAgfQogIH0KICBmdW5jdGlvbiBuZWFyZXN0Tm9kZSh4LHopewogICAgbGV0IGJlc3Q9LTEsIGJkPTFlOTsKICAgIGZvciAobGV0IGk9MDtpPG5hdi5ub2Rlcy5sZW5ndGg7aSsrKXsgY29uc3Qgbj1uYXYubm9kZXNbaV07IGNvbnN0IGQ9KG4ueC14KSoobi54LXgpKyhuLnoteikqKG4uei16KTsgaWYoZDxiZCl7YmQ9ZDtiZXN0PWk7fSB9CiAgICByZXR1cm4gYmVzdDsKICB9CiAgZnVuY3Rpb24gYVN0YXIoc3RhcnQsIGdvYWwpewogICAgaWYgKHN0YXJ0PT09LTEgfHwgZ29hbD09PS0xKSByZXR1cm4gW107CiAgICBjb25zdCBvcGVuPVtzdGFydF0sIGNhbWU9bmV3IE1hcCgpLCBnPW5ldyBNYXAoW1tzdGFydCwwXV0pOwogICAgY29uc3QgaD0oaSk9PnsgY29uc3Qgbj1uYXYubm9kZXNbaV0sIGdOPW5hdi5ub2Rlc1tnb2FsXTsgcmV0dXJuIE1hdGguaHlwb3Qobi54LWdOLngsIG4uei1nTi56KTsgfTsKICAgIGNvbnN0IGY9KGkpPT4gKGcuZ2V0KGkpfHwxZTkpK2goaSk7CiAgICB3aGlsZShvcGVuLmxlbmd0aCl7CiAgICAgIG9wZW4uc29ydCgoaSxqKT0+ZihpKS1mKGopKTsKICAgICAgY29uc3QgY3VyPW9wZW4uc2hpZnQoKTsKICAgICAgaWYgKGN1cj09PWdvYWwpeyBjb25zdCBwYXRoPVtjdXJdOyBsZXQgaz1jdXI7IHdoaWxlKGNhbWUuaGFzKGspKXsgaz1jYW1lLmdldChrKTsgcGF0aC5wdXNoKGspOyB9IHJldHVybiBwYXRoLnJldmVyc2UoKTsgfQogICAgICBmb3IgKGNvbnN0IGUgb2YgbmF2LmVkZ2VzLmZpbHRlcihlPT5lLmE9PT1jdXIpKXsKICAgICAgICBjb25zdCBhbHQ9KGcuZ2V0KGN1cil8fDFlOSkrZS53OwogICAgICAgIGlmIChhbHQgPCAoZy5nZXQoZS5iKXx8MWU5KSl7IGNhbWUuc2V0KGUuYiwgY3VyKTsgZy5zZXQoZS5iLCBhbHQpOyBpZiAoIW9wZW4uaW5jbHVkZXMoZS5iKSkgb3Blbi5wdXNoKGUuYik7IH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIFtdOwogIH0KCiAgLyogPT09PT09PSBNaW5pbWFwID09PT09PT0gKi8KICBjb25zdCBtYXAgPSB7CiAgICBlbDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1pbmltYXAiKSwKICAgIGN0eDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1pbmltYXAiKS5nZXRDb250ZXh0KCIyZCIpLAogICAgdzogMjIwLCBoOiAyMjAsCiAgICB0b1goeCl7IHJldHVybiAoICh4ICsgQVJFTkFfSEFMRikgLyAoQVJFTkFfSEFMRioyKSApICogdGhpcy53OyB9LAogICAgdG9ZKHopeyByZXR1cm4gdGhpcy5oIC0gKCAoeiArIEFSRU5BX0hBTEYpIC8gKEFSRU5BX0hBTEYqMikgKSAqIHRoaXMuaDsgfSwKICAgIGRyYXdDYXJJY29uKHgseix5YXcsY29sb3IsaGk9ZmFsc2UpewogICAgICBjb25zdCBjdHg9dGhpcy5jdHgsIHB4PXRoaXMudG9YKHgpLCBweT10aGlzLnRvWSh6KTsKICAgICAgY29uc3QgTD0xNCxXPTg7IGN0eC5zYXZlKCk7IGN0eC50cmFuc2xhdGUocHgscHkpOyBjdHgucm90YXRlKC15YXcpOwogICAgICBjdHguZmlsbFN0eWxlPWNvbG9yOyBjdHguZ2xvYmFsQWxwaGE9Ljk1OyBjdHguZmlsbFJlY3QoLUwvMiwtVy8yLEwsVyk7CiAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4Lm1vdmVUbyhMLzIsMCk7IGN0eC5saW5lVG8oTC8yLTUsLVcvMik7IGN0eC5saW5lVG8oTC8yLTUsVy8yKTsgY3R4LmNsb3NlUGF0aCgpOyBjdHguZmlsbCgpOwogICAgICBjdHguc3Ryb2tlU3R5bGU9IiNmZmYiOyBjdHguZ2xvYmFsQWxwaGE9Ljg7IGN0eC5saW5lV2lkdGg9MTsgY3R4LmJlZ2luUGF0aCgpOyBjdHgubW92ZVRvKEwvMisxLDApOyBjdHgubGluZVRvKEwvMis1LDApOyBjdHguc3Ryb2tlKCk7CiAgICAgIGlmKGhpKXsgY3R4Lmdsb2JhbEFscGhhPS42OyBjdHguc3Ryb2tlU3R5bGU9IiM3YmQ4OGYiOyBjdHgubGluZVdpZHRoPTI7IGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYygwLDAsKEwrNCkvMiwwLE1hdGguUEkqMik7IGN0eC5zdHJva2UoKTsgfQogICAgICBjdHgucmVzdG9yZSgpOwogICAgfSwKICAgIGRyYXcoKXsKICAgICAgY29uc3QgY3R4PXRoaXMuY3R4LCB3PXRoaXMudywgaD10aGlzLmg7CiAgICAgIGN0eC5jbGVhclJlY3QoMCwwLHcsaCk7CiAgICAgIGN0eC5maWxsU3R5bGU9IiMwYzE1MjYiOyBjdHguZmlsbFJlY3QoMCwwLHcsaCk7CiAgICAgIGN0eC5zdHJva2VTdHlsZT0iIzJhM2I1YSI7IGN0eC5saW5lV2lkdGg9MjsgY3R4LnN0cm9rZVJlY3QoMiwyLHctNCxoLTQpOwogICAgICBjb25zdCBzID0gdy8oQVJFTkFfSEFMRioyKTsKICAgICAgZm9yKGNvbnN0IHIgb2YgbWFwU2hhcGVzKXsKICAgICAgICBjdHguc2F2ZSgpOyBjdHgudHJhbnNsYXRlKHRoaXMudG9YKHIueCksIHRoaXMudG9ZKHIueikpOyBjdHgucm90YXRlKC1yLnlhdyk7CiAgICAgICAgY3R4Lmdsb2JhbEFscGhhPXIuYWxwaGE/PzAuMzU7IGN0eC5maWxsU3R5bGU9ci5jb2xvcnx8IiM2YTgyYzIiOwogICAgICAgIGN0eC5maWxsUmVjdCgtKHIudypzKS8yLCAtKHIuZCpzKS8yLCByLncqcywgci5kKnMpOyBjdHgucmVzdG9yZSgpOwogICAgICB9CiAgICAgIGN0eC5maWxsU3R5bGUgPSAiIzJhZjVhNCI7IGZvciAoY29uc3QgYiBvZiBib29zdHMpeyBjb25zdCB4PXRoaXMudG9YKGIucG9zLngpLCB5PXRoaXMudG9ZKGIucG9zLnopOyBjdHguZmlsbFJlY3QoeC0zLHktMyw2LDYpOyB9CiAgICAgIGN0eC5maWxsU3R5bGUgPSAiI2Y1YWQzYSI7IGZvciAoY29uc3QgaDIgb2YgaG9vcHMpeyBjb25zdCB4PXRoaXMudG9YKGgyLnBvcy54KSwgeT10aGlzLnRvWShoMi5wb3Mueik7IGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyh4LHksMywwLE1hdGguUEkqMik7IGN0eC5maWxsKCk7IH0KICAgICAgZm9yIChjb25zdCBwIG9mIHBpY2t1cHMpewogICAgICAgIGNvbnN0IHg9dGhpcy50b1gocC5tZXNoLnBvc2l0aW9uLngpLCB5PXRoaXMudG9ZKHAubWVzaC5wb3NpdGlvbi56KTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gKHAudHlwZT09PSduaXRybycpID8gIiMyYWY1YTQiIDogIiNiOTg3ZmYiOwogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IHAubWVzaC52aXNpYmxlID8gMC45IDogMC4zOyBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMoeCx5LDMsMCxNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICB9CiAgICAgIGN0eC5maWxsU3R5bGU9IiNhZDc2ZmYiOyBmb3IgKGNvbnN0IG8gb2Ygb3Jicyl7IGNvbnN0IHg9dGhpcy50b1goby5wb3NpdGlvbi54KSwgeT10aGlzLnRvWShvLnBvc2l0aW9uLnopOyBjdHguZmlsbFJlY3QoeC0yLHktMiw0LDQpOyB9CiAgICAgIGNvbnN0IHBmID0gZm9yd2FyZFZlY3RvcihjaGFzc2lzQm9keSk7CiAgICAgIHRoaXMuZHJhd0Nhckljb24oY2hhc3Npc0JvZHkucG9zaXRpb24ueCwgY2hhc3Npc0JvZHkucG9zaXRpb24ueiwgTWF0aC5hdGFuMihwZi54LHBmLnopLCAiIzdiZDg4ZiIsIHRydWUpOwogICAgICBmb3IgKGNvbnN0IGFpIG9mIGFpQ2Fycyl7IGNvbnN0IGY9Zm9yd2FyZFZlY3RvcihhaS5ib2R5KTsgdGhpcy5kcmF3Q2FySWNvbihhaS5ib2R5LnBvc2l0aW9uLngsIGFpLmJvZHkucG9zaXRpb24ueiwgTWF0aC5hdGFuMihmLngsZi56KSwgIiNlZjQ3NmYiLCBmYWxzZSk7IH0KICAgICAgY3R4Lmdsb2JhbEFscGhhPTE7CiAgICB9CiAgfTsKCiAgLyogPT09PT09PSBGZWVkID09PT09PT0gKi8KICBmdW5jdGlvbiBwdXNoRmVlZChsYWJlbCwgcHRzKXsKICAgIGNvbnN0IGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGl0ZW0uY2xhc3NOYW1lPSdmZWVkSXRlbSc7CiAgICBpdGVtLmlubmVySFRNTCA9IGA8c3Bhbj4ke2xhYmVsfTwvc3Bhbj48c3BhbiBjbGFzcz0iZmVlZFB0cyI+KyR7TWF0aC5yb3VuZChwdHMpfTwvc3Bhbj5gOwogICAgZmVlZEVsLmFwcGVuZENoaWxkKGl0ZW0pOwogICAgc2V0VGltZW91dCgoKT0+IGl0ZW0uY2xhc3NMaXN0LmFkZCgnZmFkZScpLCAxNDAwKTsKICAgIHNldFRpbWVvdXQoKCk9PiBpdGVtLnJlbW92ZSgpLCAyMjAwKTsKICB9CgogIC8qID09PT09PT0gUGFydGljbGVzID09PT09PT0gKi8KICBmdW5jdGlvbiBtYWtlQ2lyY2xlVGV4dHVyZShpbm5lciwgb3V0ZXIpewogICAgY29uc3QgYz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsgYy53aWR0aD1jLmhlaWdodD02NDsKICAgIGNvbnN0IGc9Yy5nZXRDb250ZXh0KCcyZCcpOyBjb25zdCBncmQ9Zy5jcmVhdGVSYWRpYWxHcmFkaWVudCgzMiwzMiwxLDMyLDMyLDMyKTsKICAgIGdyZC5hZGRDb2xvclN0b3AoMCwgaW5uZXIpOyBncmQuYWRkQ29sb3JTdG9wKDEsIG91dGVyKTsgZy5maWxsU3R5bGU9Z3JkOyBnLmJlZ2luUGF0aCgpOyBnLmFyYygzMiwzMiwzMiwwLE1hdGguUEkqMik7IGcuZmlsbCgpOwogICAgY29uc3QgdCA9IG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOyB0Lm5lZWRzVXBkYXRlPXRydWU7IHJldHVybiB0OwogIH0KICBmdW5jdGlvbiBjcmVhdGVTcHJpdGVQb29sKHRleCwgbWF4LCBibGVuZGluZyl7CiAgICBjb25zdCBncm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOyBzY2VuZSAmJiBzY2VuZS5hZGQoZ3JvdXApOwogICAgY29uc3QgcG9vbCA9IFtdOyBjb25zdCBhY3RpdmU9W107CiAgICBmb3IobGV0IGk9MDtpPG1heDtpKyspewogICAgICBjb25zdCBtID0gbmV3IFRIUkVFLlNwcml0ZU1hdGVyaWFsKHsgbWFwOnRleCwgdHJhbnNwYXJlbnQ6dHJ1ZSwgZGVwdGhXcml0ZTpmYWxzZSwgYmxlbmRpbmcgfSk7CiAgICAgIGNvbnN0IHMgPSBuZXcgVEhSRUUuU3ByaXRlKG0pOyBzLnZpc2libGU9ZmFsc2U7IHMudXNlckRhdGE9e2xpZmU6MCxtYXhMaWZlOjEsdmVsOm5ldyBUSFJFRS5WZWN0b3IzKCksc2l6ZTA6MX07CiAgICAgIGdyb3VwLmFkZChzKTsgcG9vbC5wdXNoKHMpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgcG9vbCwgYWN0aXZlLCBncm91cCwKICAgICAgc3Bhd24ocG9zLCB2ZWwsIGxpZmUsIHNpemUsIG9wYWNpdHk9MSl7CiAgICAgICAgY29uc3QgcyA9IHBvb2wucG9wKCk7IGlmKCFzKSByZXR1cm47CiAgICAgICAgcy5wb3NpdGlvbi5jb3B5KHBvcyk7IHMudXNlckRhdGEudmVsLmNvcHkodmVsKTsgcy51c2VyRGF0YS5saWZlPWxpZmU7IHMudXNlckRhdGEubWF4TGlmZT1saWZlOyBzLnVzZXJEYXRhLnNpemUwPXNpemU7CiAgICAgICAgcy5zY2FsZS5zZXQoc2l6ZSxzaXplLDEpOyBzLm1hdGVyaWFsLm9wYWNpdHk9b3BhY2l0eTsgcy52aXNpYmxlPXRydWU7IGFjdGl2ZS5wdXNoKHMpOwogICAgICB9LAogICAgICB1cGRhdGUoZHQpewogICAgICAgIGZvciAobGV0IGk9YWN0aXZlLmxlbmd0aC0xO2k+PTA7aS0tKXsKICAgICAgICAgIGNvbnN0IHM9YWN0aXZlW2ldOyBzLnVzZXJEYXRhLmxpZmUgLT0gZHQ7CiAgICAgICAgICBpZiAocy51c2VyRGF0YS5saWZlPD0wKXsgcy52aXNpYmxlPWZhbHNlOyBhY3RpdmUuc3BsaWNlKGksMSk7IHBvb2wucHVzaChzKTsgY29udGludWU7IH0KICAgICAgICAgIHMucG9zaXRpb24uYWRkU2NhbGVkVmVjdG9yKHMudXNlckRhdGEudmVsLCBkdCk7CiAgICAgICAgICBzLnVzZXJEYXRhLnZlbC5tdWx0aXBseVNjYWxhcigwLjk4KTsKICAgICAgICAgIGNvbnN0IGEgPSBzLnVzZXJEYXRhLmxpZmUgLyBzLnVzZXJEYXRhLm1heExpZmU7CiAgICAgICAgICBzLm1hdGVyaWFsLm9wYWNpdHkgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCBhKSk7CiAgICAgICAgICBjb25zdCBzYyA9IHMudXNlckRhdGEuc2l6ZTAgKiAoMSArICgxLWEpKjAuNik7IHMuc2NhbGUuc2V0KHNjLHNjLDEpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICB9CgogIC8qID09PT09PT0gQXVkaW8gPT09PT09PSAqLwogIGNvbnN0IGF1ZGlvID0gKCgpID0+IHsKICAgIGxldCBjdHg9bnVsbCwgb3NjPW51bGwsIGdhaW49bnVsbDsKICAgIGNvbnN0IG1rID0gKCkgPT4geyBpZighY3R4KSBjdHg9bmV3ICh3aW5kb3cuQXVkaW9Db250ZXh0fHx3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0KSgpOyB9OwogICAgY29uc3QgZW5naW5lID0gKHA9MCx2PTApPT57IGlmIChtdXRlZCkgcmV0dXJuOyBtaygpOyBpZighb3NjKXtvc2M9Y3R4LmNyZWF0ZU9zY2lsbGF0b3IoKTsgZ2Fpbj1jdHguY3JlYXRlR2FpbigpOyBvc2MudHlwZT0ic2F3dG9vdGgiOyBnYWluLmdhaW4udmFsdWU9MDsgb3NjLmNvbm5lY3QoZ2FpbikuY29ubmVjdChjdHguZGVzdGluYXRpb24pOyBvc2Muc3RhcnQoKTt9IG9zYy5mcmVxdWVuY3kudmFsdWU9ODArMzAwKnA7IGdhaW4uZ2Fpbi52YWx1ZT1NYXRoLm1pbigwLjIsdik7IH07CiAgICBjb25zdCBibGlwPShmPTIyMCx0PTAuMDgsdj0wLjIpPT57IGlmIChtdXRlZCkgcmV0dXJuOyBtaygpOyBjb25zdCBvPWN0eC5jcmVhdGVPc2NpbGxhdG9yKCksIGc9Y3R4LmNyZWF0ZUdhaW4oKTsgby50eXBlPSJ0cmlhbmdsZSI7IG8uZnJlcXVlbmN5LnZhbHVlPWY7IGcuZ2Fpbi52YWx1ZT12OyBvLmNvbm5lY3QoZykuY29ubmVjdChjdHguZGVzdGluYXRpb24pOyBvLnN0YXJ0KCk7IG8uc3RvcChjdHguY3VycmVudFRpbWUgKyB0KTsgfTsKICAgIHJldHVybiB7IGVuZ2luZSwgYmxpcCB9OwogIH0pKCk7CgogIC8qID09PT09PT0gVGhyZWUgPT09PT09PSAqLwogIGZ1bmN0aW9uIGluaXRUaHJlZSgpewogICAgc2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTsKICAgIHNjZW5lLmJhY2tncm91bmQgPSBuZXcgVEhSRUUuQ29sb3IoMHgwYjEyMjApOwogICAgc2NlbmUuZm9nID0gbmV3IFRIUkVFLkZvZygweDBiMTIyMCwgMTIwLCA3MDApOwoKICAgIGNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYSg2NSwgaW5uZXJXaWR0aC9pbm5lckhlaWdodCwgMC4xLCAyMDAwKTsKICAgIGNhbWVyYS5wb3NpdGlvbi5zZXQoMCwgNSwgLTEwKTsKCiAgICByZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKHthbnRpYWxpYXM6dHJ1ZX0pOwogICAgcmVuZGVyZXIuc2V0U2l6ZShpbm5lcldpZHRoLCBpbm5lckhlaWdodCk7CiAgICByZW5kZXJlci5zZXRQaXhlbFJhdGlvKE1hdGgubWluKGRldmljZVBpeGVsUmF0aW8sMikpOwogICAgcmVuZGVyZXIuc2hhZG93TWFwLmVuYWJsZWQgPSB0cnVlOwogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChyZW5kZXJlci5kb21FbGVtZW50KTsKCiAgICBjb25zdCBoZW1pID0gbmV3IFRIUkVFLkhlbWlzcGhlcmVMaWdodCgweGNmZTZmZiwgMHgyMjMzNDQsIDAuNik7IHNjZW5lLmFkZChoZW1pKTsKICAgIGNvbnN0IHN1biA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KDB4ZmZmZmZmLCAwLjkpOyBzdW4ucG9zaXRpb24uc2V0KDgwLDEyMCwtNDApOwogICAgc3VuLmNhc3RTaGFkb3c9dHJ1ZTsgc3VuLnNoYWRvdy5tYXBTaXplLnNldCgyMDQ4LDIwNDgpOyBzdW4uc2hhZG93LmNhbWVyYS5uZWFyPTEwOyBzdW4uc2hhZG93LmNhbWVyYS5mYXI9NzAwOyBzY2VuZS5hZGQoc3VuKTsKCiAgICBjbG9jayA9IG5ldyBUSFJFRS5DbG9jaygpOwogICAgYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgKCk9PnsgY2FtZXJhLmFzcGVjdD1pbm5lcldpZHRoL2lubmVySGVpZ2h0OyBjYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOyByZW5kZXJlci5zZXRTaXplKGlubmVyV2lkdGgsaW5uZXJIZWlnaHQpOyB9KTsKICB9CgogIC8qID09PT09PT0gUGh5c2ljcyAmIFdvcmxkID09PT09PT0gKi8KICBmdW5jdGlvbiBpbml0UGh5c2ljcygpewogICAgd29ybGQgPSBuZXcgQ0FOTk9OLldvcmxkKCk7IHdvcmxkLmdyYXZpdHkuc2V0KDAsLTkuODIsMCk7CiAgICB3b3JsZC5icm9hZHBoYXNlID0gbmV3IENBTk5PTi5TQVBCcm9hZHBoYXNlKHdvcmxkKTsKICAgIHdvcmxkLmFsbG93U2xlZXAgPSBmYWxzZTsKICAgIHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwuZnJpY3Rpb24gPSAwLjU7CgogICAgY29uc3QgZ3JvdW5kTWF0ICA9IG5ldyBDQU5OT04uTWF0ZXJpYWwoImdyb3VuZCIpOwogICAgY29uc3Qgd2hlZWxNYXQgICA9IG5ldyBDQU5OT04uTWF0ZXJpYWwoIndoZWVsIik7CiAgICBjb25zdCBjaGFzc2lzTWF0ID0gbmV3IENBTk5PTi5NYXRlcmlhbCgiY2hhc3NpcyIpOwogICAgd29ybGQuYWRkQ29udGFjdE1hdGVyaWFsKG5ldyBDQU5OT04uQ29udGFjdE1hdGVyaWFsKGdyb3VuZE1hdCwgd2hlZWxNYXQsICB7IGZyaWN0aW9uOjAuOTUsIHJlc3RpdHV0aW9uOjAuMCB9KSk7CiAgICB3b3JsZC5hZGRDb250YWN0TWF0ZXJpYWwobmV3IENBTk5PTi5Db250YWN0TWF0ZXJpYWwoZ3JvdW5kTWF0LCBjaGFzc2lzTWF0LHsgZnJpY3Rpb246MC4zLCByZXN0aXR1dGlvbjowLjAgfSkpOwoKICAgIC8vIGdyb3VuZAogICAgY29uc3QgZ3JvdW5kID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczowLCBtYXRlcmlhbDogZ3JvdW5kTWF0IH0pOwogICAgZ3JvdW5kLmFkZFNoYXBlKG5ldyBDQU5OT04uUGxhbmUoKSk7CiAgICBncm91bmQucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkvMiwgMCwgMCk7CiAgICBncm91bmQuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBHUk9VUF9HUk9VTkQ7CiAgICBncm91bmQuY29sbGlzaW9uRmlsdGVyTWFzayAgPSBHUk9VUF9QTEFZRVIgfCBHUk9VUF9BSSB8IEdST1VQX1NUVU5UOwogICAgd29ybGQuYWRkQm9keShncm91bmQpOwoKICAgIC8vIHZpc3VhbCBmbG9vcgogICAgZmxvb3JUZXggPSBncmlkVGV4dHVyZSgpOyBmbG9vclRleC53cmFwUyA9IGZsb29yVGV4LndyYXBUID0gVEhSRUUuUmVwZWF0V3JhcHBpbmc7IGZsb29yVGV4LnJlcGVhdC5zZXQoODAsODApOwogICAgZmxvb3JNZXNoID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoQVJFTkFfSEFMRioyLjEsQVJFTkFfSEFMRioyLjEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHsgbWFwOmZsb29yVGV4LCBjb2xvcjoweDI1M2E1Nywgcm91Z2huZXNzOjEgfSkpOwogICAgZmxvb3JNZXNoLnJvdGF0aW9uLnggPSAtTWF0aC5QSS8yOyBmbG9vck1lc2gucmVjZWl2ZVNoYWRvdyA9IHRydWU7IHNjZW5lLmFkZChmbG9vck1lc2gpOwoKICAgIC8vIHdhbGxzIChBSSBjb2xsaWRlcykKICAgIGFkZEJveFN0YXRpYyhBUkVOQV9IQUxGKjItMjAsIDEyLCA1LCBbMCw2LC1BUkVOQV9IQUxGXSwgWzAsMCwwXSwgMHgyYjNmNWMsIHtjb2xsaWRlQUk6dHJ1ZX0pOwogICAgYWRkQm94U3RhdGljKEFSRU5BX0hBTEYqMi0yMCwgMTIsIDUsIFswLDYsIEFSRU5BX0hBTEZdLCBbMCwwLDBdLCAweDJiM2Y1Yywge2NvbGxpZGVBSTp0cnVlfSk7CiAgICBhZGRCb3hTdGF0aWMoNSwgMTIsIEFSRU5BX0hBTEYqMi0yMCwgWy1BUkVOQV9IQUxGLDYsMF0sIFswLDAsMF0sIDB4MmIzZjVjLCB7Y29sbGlkZUFJOnRydWV9KTsKICAgIGFkZEJveFN0YXRpYyg1LCAxMiwgQVJFTkFfSEFMRioyLTIwLCBbIEFSRU5BX0hBTEYsNiwwXSwgWzAsMCwwXSwgMHgyYjNmNWMsIHtjb2xsaWRlQUk6dHJ1ZX0pOwoKICAgIC8vIGluaXRpYWwgbWFwCiAgICByZWJ1aWxkTWFwKCk7CiAgICAvLyBuYXYgZ3JhcGgKICAgIGJ1aWxkTmF2R3JhcGgoKTsKCiAgICAvLyBwaWNrdXBzICsgb3JicwogICAgc3Bhd25QaWNrdXBzKCk7CiAgICBzcGF3bk9yYnMoMTYpOwogIH0KCiAgZnVuY3Rpb24gZ3JpZFRleHR1cmUoKXsKICAgIGNvbnN0IGM9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7IGMud2lkdGg9Yy5oZWlnaHQ9MjU2OyBjb25zdCB4PWMuZ2V0Q29udGV4dCgiMmQiKTsKICAgIHguZmlsbFN0eWxlPSIjMGMxNjI2IjsgeC5maWxsUmVjdCgwLDAsMjU2LDI1Nik7CiAgICB4LnN0cm9rZVN0eWxlPSIjMjIzMjRkIjsgeC5saW5lV2lkdGg9MjsKICAgIGZvcihsZXQgaT0wO2k8PTE2O2krKyl7IGNvbnN0IHA9KGkvMTYpKjI1NjsgeC5iZWdpblBhdGgoKTsgeC5tb3ZlVG8ocCwwKTsgeC5saW5lVG8ocCwyNTYpOyB4LnN0cm9rZSgpOyB4LmJlZ2luUGF0aCgpOyB4Lm1vdmVUbygwLHApOyB4LmxpbmVUbygyNTYscCk7IHguc3Ryb2tlKCk7IH0KICAgIHguc3Ryb2tlU3R5bGU9IiMyZTQ0NmIiOyB4LmxpbmVXaWR0aD0zOwogICAgZm9yKGxldCBpPTA7aTw9NDtpKyspeyBjb25zdCBwPShpLzQpKjI1NjsgeC5iZWdpblBhdGgoKTsgeC5tb3ZlVG8ocCwwKTsgeC5saW5lVG8ocCwyNTYpOyB4LnN0cm9rZSgpOyB4LmJlZ2luUGF0aCgpOyB4Lm1vdmVUbygwLHApOyB4LmxpbmVUbygyNTYscCk7IHguc3Ryb2tlKCk7IH0KICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICB9CgogIGZ1bmN0aW9uIGFkZEJveFN0YXRpYyh3LGgsZCxwb3Mscm90PVswLDAsMF0sY29sb3I9MHgyYjNmNWMsb3B0cz17Y29sbGlkZUFJOmZhbHNlfSl7CiAgICBjb25zdCBib2R5PW5ldyBDQU5OT04uQm9keSh7bWFzczowfSk7IGJvZHkuYWRkU2hhcGUobmV3IENBTk5PTi5Cb3gobmV3IENBTk5PTi5WZWMzKHcvMixoLzIsZC8yKSkpOwogICAgYm9keS5wb3NpdGlvbi5zZXQoLi4ucG9zKTsgYm9keS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlciguLi5yb3QsIlhZWiIpOwogICAgYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IEdST1VQX1NUVU5UOwogICAgYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrICA9IEdST1VQX1BMQVlFUiB8IChvcHRzLmNvbGxpZGVBSSA/IEdST1VQX0FJIDogMCkgfCBHUk9VUF9HUk9VTkQ7CiAgICB3b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgY29uc3QgbWVzaD1uZXcgVEhSRUUuTWVzaChuZXcgVEhSRUUuQm94R2VvbWV0cnkodyxoLGQpLCBuZXcgVEhSRUUuTWVzaFN0YW5kYXJkTWF0ZXJpYWwoeyBjb2xvciwgcm91Z2huZXNzOjAuOSB9KSk7CiAgICBtZXNoLnBvc2l0aW9uLnNldCguLi5wb3MpOyBtZXNoLnJvdGF0aW9uLnNldCguLi5yb3QpOyBtZXNoLnJlY2VpdmVTaGFkb3c9dHJ1ZTsKICAgIGNvbnN0IGVkZ2VzID0gbmV3IFRIUkVFLkVkZ2VzR2VvbWV0cnkobWVzaC5nZW9tZXRyeSk7CiAgICBjb25zdCBsaW5lID0gbmV3IFRIUkVFLkxpbmVTZWdtZW50cyhlZGdlcywgbmV3IFRIUkVFLkxpbmVCYXNpY01hdGVyaWFsKHsgY29sb3I6MHg2YWM2ZmYsIHRyYW5zcGFyZW50OnRydWUsIG9wYWNpdHk6MC4yOCB9KSk7CiAgICBtZXNoLmFkZChsaW5lKTsKICAgIHNjZW5lLmFkZChtZXNoKTsKICAgIHN0dW50Qm9kaWVzLnB1c2goYm9keSk7CiAgICBzdHVudE1lc2hlcy5wdXNoKG1lc2gpOwogICAgcmV0dXJuIHtib2R5LCBtZXNofTsKICB9CgogIGZ1bmN0aW9uIGFkZEJvb3N0UGFkKHNpemVYLHNpemVaLHBvcyxyb3Q9WzAsMCwwXSl7CiAgICBjb25zdCBtPW5ldyBUSFJFRS5NZXNoKG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KHNpemVYLHNpemVaKSwgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgY29sb3I6MHgyYWY1YTQsIHRyYW5zcGFyZW50OnRydWUsIG9wYWNpdHk6MC44OCB9KSk7CiAgICBtLnJvdGF0aW9uLnNldCgtTWF0aC5QSS8yK3JvdFswXSwgcm90WzFdLCByb3RbMl0pOyBtLnBvc2l0aW9uLnNldCguLi5wb3MpOyBtLnJlbmRlck9yZGVyPTI7IHNjZW5lLmFkZChtKTsKICAgIGNvbnN0IHBhZD17IHBvczpuZXcgVEhSRUUuVmVjdG9yMyguLi5wb3MpLCBzaXplOm5ldyBUSFJFRS5WZWN0b3IyKHNpemVYLHNpemVaKSwgcm90WTpyb3RbMV18fDAsIGNvb2w6MCwgbWVzaDptIH07CiAgICBib29zdHMucHVzaChwYWQpOwogIH0KICBmdW5jdGlvbiBhZGRIb29wKHJhZGl1cywgdGhpY2tuZXNzLCBwb3MpewogICAgY29uc3QgZ2VvPW5ldyBUSFJFRS5Ub3J1c0dlb21ldHJ5KHJhZGl1cywgdGhpY2tuZXNzLCAxNiwgNjQpOwogICAgY29uc3QgbWVzaD1uZXcgVEhSRUUuTWVzaChnZW8sIG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCh7IGNvbG9yOjB4ZmZiMzY2LCBlbWlzc2l2ZToweDU1MzMwMCwgcm91Z2huZXNzOjAuNCwgbWV0YWxuZXNzOjAuMyB9KSk7CiAgICBtZXNoLnBvc2l0aW9uLnNldCguLi5wb3MpOyBtZXNoLnJvdGF0aW9uLng9TWF0aC5QSS8yOyBtZXNoLmNhc3RTaGFkb3c9dHJ1ZTsgc2NlbmUuYWRkKG1lc2gpOwogICAgaG9vcHMucHVzaCh7IHBvczpuZXcgVEhSRUUuVmVjdG9yMyguLi5wb3MpLCByYWRpdXMsIHRoaWNrbmVzcywgbWVzaCwgc2NvcmVkOmZhbHNlIH0pOwogIH0KCiAgLyogPT09PT09PSBNQVBTID09PT09PT0gKi8KICBjb25zdCBNQVBTID0gWwogICAgeyBuYW1lOiJBcmVuYSIsICAgICAgIGJ1aWxkOiBidWlsZEFyZW5hIH0sCiAgICB7IG5hbWU6IkFsbC1UZXJyYWluIiwgYnVpbGQ6IGJ1aWxkQWxsVGVycmFpbiB9LAogICAgeyBuYW1lOiJTcGVlZHdheSIsICAgIGJ1aWxkOiBidWlsZFNwZWVkd2F5IH0KICBdOwogIGxldCBtYXBJbmRleCA9IDA7CgogIGZ1bmN0aW9uIHJlYnVpbGRNYXAoKXsKICAgIC8vIGNsZWFyIHByZXZpb3VzIHN0dW50cywgcGFkcywgaG9vcHMsIHBpY2t1cHMsIG9yYnMsIHNoYXBlcwogICAgZm9yIChjb25zdCBoIG9mIGhvb3BzKXsgc2NlbmUucmVtb3ZlKGgubWVzaCk7IH0gaG9vcHMubGVuZ3RoPTA7CiAgICBmb3IgKGNvbnN0IHAgb2YgYm9vc3RzKXsgc2NlbmUucmVtb3ZlKHAubWVzaCk7IH0gYm9vc3RzLmxlbmd0aD0wOwogICAgZm9yIChjb25zdCBtIG9mIHN0dW50TWVzaGVzKXsgc2NlbmUucmVtb3ZlKG0pOyB9IHN0dW50TWVzaGVzLmxlbmd0aD0wOwogICAgZm9yIChjb25zdCBiIG9mIHN0dW50Qm9kaWVzKXsgd29ybGQucmVtb3ZlQm9keShiKTsgfSBzdHVudEJvZGllcy5sZW5ndGg9MDsKICAgIGZvciAoY29uc3QgcGsgb2YgcGlja3Vwcyl7IHNjZW5lLnJlbW92ZShway5tZXNoKTsgfSBwaWNrdXBzLmxlbmd0aD0wOwogICAgZm9yIChjb25zdCBvIG9mIG9yYnMpeyBzY2VuZS5yZW1vdmUobyk7IH0gb3Jicy5sZW5ndGg9MDsKICAgIG1hcFNoYXBlcy5sZW5ndGg9MDsKCiAgICAvLyBidWlsZCBzZWxlY3RlZAogICAgTUFQU1ttYXBJbmRleF0uYnVpbGQoKTsKCiAgICAvLyBpdGVtcwogICAgc3Bhd25QaWNrdXBzKCk7CiAgICBzcGF3bk9yYnMoMTYpOwoKICAgIC8vIFVJCiAgICB1aS5idG5NYXAudGV4dENvbnRlbnQgPSAnTWFwOiAnICsgTUFQU1ttYXBJbmRleF0ubmFtZTsKICB9CgogIGZ1bmN0aW9uIHB1c2hNYXBSZWN0KHcsZCxwb3Mscm90LGNvbG9yLGFscGhhPTAuMzUsdHlwZT0icmFtcCIpewogICAgY29uc3QgeWF3PShyb3QmJnJvdFsxXSk/cm90WzFdOjA7IG1hcFNoYXBlcy5wdXNoKHt4OnBvc1swXSx6OnBvc1syXSx3LGQseWF3LGNvbG9yLGFscGhhLHR5cGV9KTsKICB9CiAgZnVuY3Rpb24gdmFyR2V0KG5hbWUpeyByZXR1cm4gZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLmdldFByb3BlcnR5VmFsdWUobmFtZSkudHJpbSgpOyB9CgogIGZ1bmN0aW9uIGJ1aWxkQXJlbmEoKXsKICAgIC8vIEZMT1cgTElORSBBIChjZW50ZXIgbm9ydGgtc291dGgpCiAgICBhZGRTdHVudFJlY3QoNDgsMi4wLDkyLFswLDEsLTQwXSxbTWF0aC5QSS8xNiwwLDBdLDB4MzY1YTgzLCJyYW1wIik7CiAgICBhZGRTdHVudFJlY3QoMjgsMi4wLDM2LFswLDMsLTJdLFswLDAsMF0sMHgzMTQ4NjEsInBsYXQiKTsKICAgIGFkZFN0dW50UmVjdCg0OCwyLjAsOTIsWzAsMSwzNF0sWy1NYXRoLlBJLzE4LDAsMF0sMHgzNjVhODMsInJhbXAiKTsKICAgIGFkZEhvb3AoMTAsMS4yLFswLDE0LDE4XSk7CgogICAgLy8gRkxPVyBMSU5FIEIgKGVhc3QpCiAgICBhZGRTdHVudFJlY3QoNDIsMS44LDcwLFsxNjAsMSwzMF0sW01hdGguUEkvMTYsMCwwXSwweDNiNWE4NCwicmFtcCIpOwogICAgYWRkSG9vcCg5LDEuMSxbMTYwLDEzLDc4XSk7CgogICAgLy8gRkxPVyBMSU5FIEMgKHdlc3Qgd2F2ZXMpCiAgICBmb3IgKGxldCBpPTA7aTw0O2krKyl7IGFkZFN0dW50UmVjdCgyNCwxLjUsMTgsWy0xODAgKyBpKjQwLDAuOCw4MF0sW01hdGguUEkvMTQsMCwwXSwweDNhNGY3ZCwicmFtcCIpOyB9CgogICAgLy8gQmFua2VkIGNvcm5lcnMKICAgIGFkZFN0dW50UmVjdCg5MCwzLjAsNDAsWy0yNjAsMiwtMjYwXSxbMCwgTWF0aC5QSS80LCAgTWF0aC5QSS84XSwweDMwNWI1MiwiYmFuayIpOwogICAgYWRkU3R1bnRSZWN0KDkwLDMuMCw0MCxbIDI2MCwyLCAyNjBdLFswLC0zKk1hdGguUEkvNCwtTWF0aC5QSS84XSwweDMwNWI1MiwiYmFuayIpOwoKICAgIC8vIFRhYmxldG9wcyAvIGJyaWRnZSAobm9ydGgpCiAgICBhZGRTdHVudFJlY3QoMTQsMS40LDIwLFsgNzAsMC43LDE2MF0sW01hdGguUEkvMTQsMCwwXSwweDNiNWE4NCwicmFtcCIpOwogICAgYWRkU3R1bnRSZWN0KCA2LDEuMCw2MCxbICAwLDQuNSwxNjBdLFswLDAsMF0sMHg1YzZmZTAsInBsYXQiKTsKICAgIGFkZFN0dW50UmVjdCgxNCwxLjQsMjAsWy03MCwwLjcsMTYwXSxbLU1hdGguUEkvMTQsMCwwXSwweDNiNWE4NCwicmFtcCIpOwoKICAgIC8vIEV4dHJhIGhvb3BzCiAgICBhZGRIb29wKDgsMS4wLFsxMjAsMTMsNDBdKTsgYWRkSG9vcCg4LDEuMCxbLTEyMCwxMywtNDBdKTsKCiAgICAvLyBTdHJhdGVnaWMgYm9vc3QgcGFkcwogICAgYWRkQm9vc3RQYWQoMTYsMjIsWyAgMCwwLjA2LCAtNjRdLFswLDAsMF0pOwogICAgYWRkQm9vc3RQYWQoMTYsMjIsWyAgMCwwLjA2LCAgMTBdLFswLDAsMF0pOwogICAgYWRkQm9vc3RQYWQoMTYsMjIsWyAgMCwwLjA2LCAgNzJdLFswLDAsMF0pOwogICAgYWRkQm9vc3RQYWQoMTYsMjIsWzE0MCwwLjA2LC00MF0sWzAsMCwwXSk7CiAgICBhZGRCb29zdFBhZCgxNiwyMixbMTUyLDAuMDYsICAgOF0sWzAsMCwwXSk7CiAgICBhZGRCb29zdFBhZCgxNiwyMixbMTYwLDAuMDYsICA5Nl0sWzAsMCwwXSk7CiAgICBhZGRCb29zdFBhZCgxNiwyMCxbLTIwMCwwLjA2LCA1MF0sWzAsMCwwXSk7CiAgICBhZGRCb29zdFBhZCgxNiwyMCxbLTE2MCwwLjA2LCA5MF0sWzAsMCwwXSk7CiAgICBhZGRCb29zdFBhZCgxMiwxOCxbICAgMCwwLjA2LDE0MF0sWzAsMCwwXSk7CiAgICBhZGRCb29zdFBhZCgxOCwxOCxbLTIzMCwwLjA2LC0yMTBdLFswLCBNYXRoLlBJLzQsIDBdKTsKICAgIGFkZEJvb3N0UGFkKDE4LDE4LFsgMjMwLDAuMDYsIDIxMF0sWzAsLTMqTWF0aC5QSS80LDBdKTsKICAgIGFkZEJvb3N0UGFkKDE4LDE4LFstMTIwLDAuMDYsICAwXSxbMCwwLDBdKTsKICAgIGFkZEJvb3N0UGFkKDE4LDE4LFsgMTIwLDAuMDYsICAwXSxbMCwwLDBdKTsKICB9CgogIGZ1bmN0aW9uIGJ1aWxkQWxsVGVycmFpbigpewogICAgLy8gcm9sbGluZyBmaWVsZCBvZiBnZW50bGUgbW91bmRzIGFuZCBiYW5rcwogICAgZm9yKGxldCB4PS0yMjA7eDw9MjIwO3grPTExMCl7CiAgICAgIGZvcihsZXQgej0tMjIwO3o8PTIyMDt6Kz0xMTApewogICAgICAgIGFkZFN0dW50UmVjdCgzNiwyLjIsNTQsW3gsMS4yLHpdLFtNYXRoLlBJLzE4ICogKE1hdGgucmFuZG9tKCkqMC42KzAuNyksIDAsIDBdLDB4MzI1NDZmLCJyYW1wIik7CiAgICAgIH0KICAgIH0KICAgIC8vIGxvbmcgbG93IHJpZGdlcwogICAgYWRkU3R1bnRSZWN0KDE2MCwyLjAsMjQsWzAsMS4wLC0xMjBdLFtNYXRoLlBJLzI2LDAsMF0sMHgyZTRhNmEsInJhbXAiKTsKICAgIGFkZFN0dW50UmVjdCgxNjAsMi4wLDI0LFswLDEuMCwgMTIwXSxbLU1hdGguUEkvMjYsMCwwXSwweDJlNGE2YSwicmFtcCIpOwogICAgLy8gb2ZmLWNhbWJlciBiYW5rcwogICAgYWRkU3R1bnRSZWN0KDcwLDMuMCwzNCxbLTI0MCwyLCAgNDBdLFswLCBNYXRoLlBJLzYsICBNYXRoLlBJLzEwXSwweDMwNWI1MiwiYmFuayIpOwogICAgYWRkU3R1bnRSZWN0KDcwLDMuMCwzNCxbIDI0MCwyLCAtNDBdLFswLC1NYXRoLlBJLzYsIC1NYXRoLlBJLzEwXSwweDMwNWI1MiwiYmFuayIpOwoKICAgIC8vIGhvb3BzIHNwYWNlZCBmb3IgZmxvd2luZyBydW5zCiAgICBhZGRIb29wKDksMS4xLFstMTQwLDEyLDEwXSk7CiAgICBhZGRIb29wKDksMS4xLFsgMTQwLDEyLC0xMF0pOwoKICAgIC8vIHBhZHMgb24gcmlkZ2UgZW50cmllcy9leGl0cwogICAgYWRkQm9vc3RQYWQoMTgsMjAsWy04MCwwLjA2LC0xNTBdLFswLDAsMF0pOwogICAgYWRkQm9vc3RQYWQoMTgsMjAsWyA4MCwwLjA2LCAxNTBdLFswLDAsMF0pOwogICAgYWRkQm9vc3RQYWQoMTgsMjAsWyAgMCwwLjA2LCAgIDBdLFswLDAsMF0pOwogICAgYWRkQm9vc3RQYWQoMTgsMTgsWy0yMDAsMC4wNiwgIDgwXSxbMCwwLDBdKTsKICAgIGFkZEJvb3N0UGFkKDE4LDE4LFsgMjAwLDAuMDYsIC04MF0sWzAsMCwwXSk7CiAgfQoKICBmdW5jdGlvbiBidWlsZFNwZWVkd2F5KCl7CiAgICAvLyBpbm5lciBvdmFsOiB0d28gYmlnIGdlbnRsZSBiYW5rcyBhbmQgc3RyYWlnaHRzCiAgICBhZGRTdHVudFJlY3QoMjIwLDIuNCwyNCxbMCwxLjMsLTE2MF0sW01hdGguUEkvMjgsMCwwXSwweDJmNGI3MiwicmFtcCIpOwogICAgYWRkU3R1bnRSZWN0KDIyMCwyLjQsMjQsWzAsMS4zLCAxNjBdLFstTWF0aC5QSS8yOCwwLDBdLDB4MmY0YjcyLCJyYW1wIik7CiAgICBhZGRTdHVudFJlY3QoNjAsMy4yLDM0LFstMjIwLDIsMF0sWzAsIE1hdGguUEkvMywgIE1hdGguUEkvMTBdLDB4MzA1YjUyLCJiYW5rIik7CiAgICBhZGRTdHVudFJlY3QoNjAsMy4yLDM0LFsgMjIwLDIsMF0sWzAsLU1hdGguUEkvMywgLU1hdGguUEkvMTBdLDB4MzA1YjUyLCJiYW5rIik7CgogICAgLy8gY2VudHJhbCBzaG93cGllY2UgaG9vcAogICAgYWRkSG9vcCgxMSwxLjIsWzAsMTQsMF0pOwoKICAgIC8vIHBhZHMgb24gc3RyYWlnaHQgZXhpdHMgKyBtaWQtb3ZhbAogICAgYWRkQm9vc3RQYWQoMjIsMjIsWy0xMjAsMC4wNiwtMTYwXSxbMCwwLDBdKTsKICAgIGFkZEJvb3N0UGFkKDIyLDIyLFsgMTIwLDAuMDYsLTE2MF0sWzAsMCwwXSk7CiAgICBhZGRCb29zdFBhZCgyMiwyMixbLTEyMCwwLjA2LCAxNjBdLFswLDAsMF0pOwogICAgYWRkQm9vc3RQYWQoMjIsMjIsWyAxMjAsMC4wNiwgMTYwXSxbMCwwLDBdKTsKICAgIGFkZEJvb3N0UGFkKDE4LDE4LFsgIDAsMC4wNiwgICAwXSxbMCwwLDBdKTsKICB9CgogIGZ1bmN0aW9uIGFkZFN0dW50UmVjdCh3LGgsZCxwb3Mscm90LGNvbG9yLHR5cGUpewogICAgYWRkQm94U3RhdGljKHcsaCxkLHBvcyxyb3QsY29sb3Ise2NvbGxpZGVBSTpmYWxzZX0pOwogICAgY29uc3QgbWFwQ29sb3IgPSB0eXBlPT09InJhbXAiP3ZhckdldCgnLS1wUmFtcCcpOnR5cGU9PT0icGxhdCI/dmFyR2V0KCctLXBQbGF0Jyk6dHlwZT09PSJiYW5rIj92YXJHZXQoJy0tcEJhbmsnKToiIzZhODJjMiI7CiAgICBwdXNoTWFwUmVjdCh3LGQscG9zLHJvdCxtYXBDb2xvcix0eXBlPT09InBsYXQiPzAuMjU6MC4zNSx0eXBlKTsKICB9CgogIC8qID09PT09PT0gUGxheWVyID09PT09PT0gKi8KICBsZXQgc2hpZWxkVCA9IDAsIHNoaWVsZE1lc2g7CiAgbGV0IHR1cmJvVCA9IDA7IC8vIGJyaWVmIHR1cmJvIGFmdGVyIGJvb3N0IHBhZAogIGZ1bmN0aW9uIGJ1aWxkUGxheWVyKCl7CiAgICBjaGFzc2lzQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6NTUwLCBtYXRlcmlhbDogbmV3IENBTk5PTi5NYXRlcmlhbCgiY2hhc3NpcyIpIH0pOwogICAgY2hhc3Npc0JvZHkuYWRkU2hhcGUobmV3IENBTk5PTi5Cb3gobmV3IENBTk5PTi5WZWMzKDEuMCwwLjM1LDIuMSkpLCBuZXcgQ0FOTk9OLlZlYzMoMCwtMC4yNSwwKSk7IC8vIGxvd2VyIENPTQogICAgY2hhc3Npc0JvZHkucG9zaXRpb24uc2V0KDAsMywtMTQwKTsKICAgIGNoYXNzaXNCb2R5LmFuZ3VsYXJEYW1waW5nPTAuNTsgY2hhc3Npc0JvZHkuYWxsb3dTbGVlcCA9IGZhbHNlOwogICAgY2hhc3Npc0JvZHkuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBHUk9VUF9QTEFZRVI7CiAgICBjaGFzc2lzQm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrICA9IEdST1VQX0dST1VORCB8IEdST1VQX1NUVU5UIHwgR1JPVVBfQUk7CiAgICB3b3JsZC5hZGRCb2R5KGNoYXNzaXNCb2R5KTsKCiAgICBjaGFzc2lzTWVzaCA9IG5ldyBUSFJFRS5NZXNoKG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSgyLjAsMC43LDQuMiksCiAgICAgICAgICAgICAgICAgIG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCh7IGNvbG9yOjB4NjZiM2ZmLCBtZXRhbG5lc3M6MC4zNSwgcm91Z2huZXNzOjAuNSB9KSk7CiAgICBjaGFzc2lzTWVzaC5jYXN0U2hhZG93ID0gdHJ1ZTsgc2NlbmUuYWRkKGNoYXNzaXNNZXNoKTsKICAgIGNvbnN0IHJvb2YgPSBuZXcgVEhSRUUuTWVzaChuZXcgVEhSRUUuQm94R2VvbWV0cnkoMS40LDAuNSwxLjYpLAogICAgICAgICAgICAgICAgICBuZXcgVEhSRUUuTWVzaFN0YW5kYXJkTWF0ZXJpYWwoeyBjb2xvcjoweDk5ZDFmZiwgbWV0YWxuZXNzOjAuMiwgcm91Z2huZXNzOjAuNiB9KSk7CiAgICByb29mLnBvc2l0aW9uLnNldCgwLDAuNiwtMC4zKTsgY2hhc3Npc01lc2guYWRkKHJvb2YpOwoKICAgIC8vIFNoaWVsZCB2aXN1YWwgKG9ubHkgd2hlbiBwaWNrdXAgYWN0aXZlKQogICAgc2hpZWxkTWVzaCA9IG5ldyBUSFJFRS5NZXNoKG5ldyBUSFJFRS5Ub3J1c0dlb21ldHJ5KDEuNiwwLjA2LDE2LDY0KSwKICAgICAgICAgICAgICAgICAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOjB4Yjk4N2ZmLCB0cmFuc3BhcmVudDp0cnVlLCBvcGFjaXR5OjAuNiB9KSk7CiAgICBzaGllbGRNZXNoLnJvdGF0aW9uLnggPSBNYXRoLlBJLzI7IHNoaWVsZE1lc2gudmlzaWJsZT1mYWxzZTsgY2hhc3Npc01lc2guYWRkKHNoaWVsZE1lc2gpOwoKICAgIHBsYXllclZlaGljbGUgPSBuZXcgQ0FOTk9OLlJheWNhc3RWZWhpY2xlKHsgY2hhc3Npc0JvZHksIGluZGV4UmlnaHRBeGlzOjAsIGluZGV4VXBBeGlzOjEsIGluZGV4Rm9yd2FyZEF4aXM6MiB9KTsKCiAgICBjb25zdCB3aGVlbE9wdGlvbnMgPSB7CiAgICAgIHJhZGl1czogMC40NSwgZGlyZWN0aW9uTG9jYWw6bmV3IENBTk5PTi5WZWMzKDAsLTEsMCksCiAgICAgIHN1c3BlbnNpb25TdGlmZm5lc3M6IDQwLCBzdXNwZW5zaW9uUmVzdExlbmd0aDogMC4zMiwKICAgICAgZnJpY3Rpb25TbGlwOiA5LjUsIGRhbXBpbmdSZWxheGF0aW9uOiAyLjcsIGRhbXBpbmdDb21wcmVzc2lvbjogNC40LAogICAgICBtYXhTdXNwZW5zaW9uRm9yY2U6IDFlNSwgcm9sbEluZmx1ZW5jZTogMC4wMiwKICAgICAgYXhsZUxvY2FsOiBuZXcgQ0FOTk9OLlZlYzMoLTEsMCwwKSwgbWF4U3VzcGVuc2lvblRyYXZlbDogMC4zMywKICAgICAgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDogLTMwLCB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiB0cnVlCiAgICB9OwogICAgY29uc3QgYXhsZVc9MS4yLCB3aGVlbEJhc2U9MS44OwogICAgW25ldyBDQU5OT04uVmVjMygtYXhsZVcsLTAuMjUsIHdoZWVsQmFzZSksCiAgICAgbmV3IENBTk5PTi5WZWMzKCBheGxlVywtMC4yNSwgd2hlZWxCYXNlKSwKICAgICBuZXcgQ0FOTk9OLlZlYzMoLWF4bGVXLC0wLjI1LC13aGVlbEJhc2UpLAogICAgIG5ldyBDQU5OT04uVmVjMyggYXhsZVcsLTAuMjUsLXdoZWVsQmFzZSldCiAgICAgIC5mb3JFYWNoKChwLGlkeCkgPT4gcGxheWVyVmVoaWNsZS5hZGRXaGVlbCh7IC4uLndoZWVsT3B0aW9ucywgcm9sbEluZmx1ZW5jZTogaWR4PDI/MC4wMTU6MC4wMiwgY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsOiBwIH0pKTsKICAgIHBsYXllclZlaGljbGUuYWRkVG9Xb3JsZCh3b3JsZCk7CgogICAgY29uc3Qgd0dlbz1uZXcgVEhSRUUuQ3lsaW5kZXJHZW9tZXRyeSh3aGVlbE9wdGlvbnMucmFkaXVzLHdoZWVsT3B0aW9ucy5yYWRpdXMsMC4yOCwyMCk7IHdHZW8ucm90YXRlWihNYXRoLlBJLzIpOwogICAgY29uc3Qgd01hdD1uZXcgVEhSRUUuTWVzaFN0YW5kYXJkTWF0ZXJpYWwoeyBjb2xvcjoweDIyMzI0Mywgcm91Z2huZXNzOjAuOCB9KTsKICAgIGZvcihsZXQgaT0wO2k8NDtpKyspeyBjb25zdCB3PW5ldyBUSFJFRS5NZXNoKHdHZW8sd01hdCk7IHcuY2FzdFNoYWRvdz10cnVlOyBzY2VuZS5hZGQodyk7IHBsYXllcldoZWVsTWVzaGVzLnB1c2godyk7IH0KICB9CgogIC8qID09PT09PT0gQUkgPT09PT09PSAqLwogIGNvbnN0IGFpQ2FycyA9IFtdOwogIGNvbnN0IGFpU3Bhd25zID0gWwogICAge3g6ICA5MCwgejogIDkwLCBjb2xvcjoweGZmNzc3N30sIHt4OiAtMTMwLCB6OiA4MCwgY29sb3I6MHhmZjc3Nzd9LCB7eDogIDE0MCwgejotMTAwLCBjb2xvcjoweGZmNzc3N30sCiAgICB7eDogIDI2MCwgejogIDIwLCBjb2xvcjoweGZmNzc3N30sIHt4Oi0yNDAsIHo6LTYwLCBjb2xvcjoweGZmNzc3N30sIHt4OiAgIDQwLCB6OiAyNjAsIGNvbG9yOjB4ZmY3Nzc3fSwKICAgIHt4OiAtNjAsIHo6LTI0MCwgY29sb3I6MHhmZjc3Nzd9LCB7eDogIDI0MCwgejotMjIwLCBjb2xvcjoweGZmNzc3N30KICBdOwogIGZ1bmN0aW9uIGJ1aWxkQUlDYXIoc3Bhd24sIHJvbGU9InB1cnN1ZSIpewogICAgY29uc3QgYm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6NTQwIH0pOwogICAgYm9keS5hZGRTaGFwZShuZXcgQ0FOTk9OLkJveChuZXcgQ0FOTk9OLlZlYzMoMS4wLDAuMzUsMi4xKSksIG5ldyBDQU5OT04uVmVjMygwLC0wLjI1LDApKTsKICAgIGJvZHkucG9zaXRpb24uc2V0KHNwYXduLngsIDMsIHNwYXduLnopOwogICAgYm9keS5hbmd1bGFyRGFtcGluZyA9IDAuNTU7IGJvZHkuYWxsb3dTbGVlcCA9IGZhbHNlOwogICAgYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IEdST1VQX0FJOwogICAgYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrICA9IEdST1VQX0dST1VORCB8IEdST1VQX1BMQVlFUiB8IEdST1VQX1NUVU5UOwogICAgd29ybGQuYWRkQm9keShib2R5KTsKCiAgICBjb25zdCBtZXNoID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLkJveEdlb21ldHJ5KDIuMCwwLjcsNC4yKSwKICAgICAgICAgICAgICAgICAgbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHsgY29sb3I6IHNwYXduLmNvbG9yfHwweGZmNzc3NywgbWV0YWxuZXNzOjAuMiwgcm91Z2huZXNzOjAuNiB9KSk7CiAgICBtZXNoLmNhc3RTaGFkb3cgPSB0cnVlOyBzY2VuZS5hZGQobWVzaCk7CgogICAgY29uc3QgdmVoID0gbmV3IENBTk5PTi5SYXljYXN0VmVoaWNsZSh7IGNoYXNzaXNCb2R5OiBib2R5LCBpbmRleFJpZ2h0QXhpczowLCBpbmRleFVwQXhpczoxLCBpbmRleEZvcndhcmRBeGlzOjIgfSk7CiAgICBjb25zdCB3aGVlbE9wdGlvbnMgPSB7IHJhZGl1czowLjQ1LCBkaXJlY3Rpb25Mb2NhbDpuZXcgQ0FOTk9OLlZlYzMoMCwtMSwwKSwgc3VzcGVuc2lvblN0aWZmbmVzczozOCwgc3VzcGVuc2lvblJlc3RMZW5ndGg6MC4zMiwgZnJpY3Rpb25TbGlwOjEwLjIsIGRhbXBpbmdSZWxheGF0aW9uOiAyLjYsIGRhbXBpbmdDb21wcmVzc2lvbjogNC40LCBtYXhTdXNwZW5zaW9uRm9yY2U6MWU1LCByb2xsSW5mbHVlbmNlOjAuMDIsIGF4bGVMb2NhbDpuZXcgQ0FOTk9OLlZlYzMoLTEsMCwwKSwgbWF4U3VzcGVuc2lvblRyYXZlbDowLjMzLCBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOi0zMCwgdXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDp0cnVlIH07CiAgICBjb25zdCBheGxlVz0xLjIsIHdoZWVsQmFzZT0xLjg7CiAgICBbbmV3IENBTk5PTi5WZWMzKC1heGxlVywtMC4yNSwgd2hlZWxCYXNlKSwgbmV3IENBTk5PTi5WZWMzKCBheGxlVywtMC4yNSwgd2hlZWxCYXNlKSwKICAgICBuZXcgQ0FOTk9OLlZlYzMoLWF4bGVXLC0wLjI1LC13aGVlbEJhc2UpLG5ldyBDQU5OT04uVmVjMyggYXhsZVcsLTAuMjUsLXdoZWVsQmFzZSldCiAgICAgIC5mb3JFYWNoKChwLGlkeCkgPT4gdmVoLmFkZFdoZWVsKHsgLi4ud2hlZWxPcHRpb25zLCByb2xsSW5mbHVlbmNlOiBpZHg8Mj8wLjAxNTowLjAyLCBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHAgfSkpOwogICAgdmVoLmFkZFRvV29ybGQod29ybGQpOwoKICAgIGNvbnN0IHdHZW89bmV3IFRIUkVFLkN5bGluZGVyR2VvbWV0cnkod2hlZWxPcHRpb25zLnJhZGl1cyx3aGVlbE9wdGlvbnMucmFkaXVzLDAuMjgsMjApOyB3R2VvLnJvdGF0ZVooTWF0aC5QSS8yKTsKICAgIGNvbnN0IHdNYXQ9bmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHsgY29sb3I6MHg1NTIyMjIsIHJvdWdobmVzczowLjggfSk7CiAgICBjb25zdCB3aGVlbHM9W107IGZvcihsZXQgaT0wO2k8NDtpKyspeyBjb25zdCB3PW5ldyBUSFJFRS5NZXNoKHdHZW8sd01hdCk7IHcuY2FzdFNoYWRvdz10cnVlOyBzY2VuZS5hZGQodyk7IHdoZWVscy5wdXNoKHcpOyB9CgogICAgcmV0dXJuIHsgYm9keSwgbWVzaCwgdmVoLCB3aGVlbHMsIHNwYXduLCBzdHVja1Q6MCwgcm9sZSwgc3RlZXJMUDowLCByZXBhdGhUOjAsIHBhdGg6W10sIHBhdGhJZHg6MCB9OwogIH0KICBmdW5jdGlvbiBzcGF3bkFJKCl7CiAgICBpZiAoIWJvdHNFbmFibGVkKSByZXR1cm47CiAgICBjb25zdCByb2xlcyA9IFsicHVyc3VlIiwiZmxhbmtMIiwiZmxhbmtSIiwicHVyc3VlIl07CiAgICBjb25zdCBzcCA9IGFpU3Bhd25zW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSphaVNwYXducy5sZW5ndGgpXTsKICAgIGNvbnN0IHJvbGUgPSByb2xlc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqcm9sZXMubGVuZ3RoKV07CiAgICBhaUNhcnMucHVzaChidWlsZEFJQ2FyKHNwLCByb2xlKSk7CiAgfQogIGZ1bmN0aW9uIGRlc3Bhd25BSSgpewogICAgaWYgKCFhaUNhcnMubGVuZ3RoKSByZXR1cm47CiAgICBjb25zdCBhaSA9IGFpQ2Fycy5wb3AoKTsKICAgIGFpLnZlaC5yZW1vdmVGcm9tV29ybGQod29ybGQpOyB3b3JsZC5yZW1vdmVCb2R5KGFpLmJvZHkpOwogICAgc2NlbmUucmVtb3ZlKGFpLm1lc2gpOyBmb3IgKGNvbnN0IHcgb2YgYWkud2hlZWxzKSBzY2VuZS5yZW1vdmUodyk7CiAgfQogIGZ1bmN0aW9uIHJlY29uY2lsZUJvdHNUb0hlYXQoKXsgY29uc3Qgd2FudCA9IHRhcmdldEFJQ291bnQoKTsgd2hpbGUgKGFpQ2Fycy5sZW5ndGggPCB3YW50KSBzcGF3bkFJKCk7IHdoaWxlIChhaUNhcnMubGVuZ3RoID4gd2FudCkgZGVzcGF3bkFJKCk7IH0KCiAgLyogPT09PT09PSBVdGlsaXRpZXMgPT09PT09PSAqLwogIGZ1bmN0aW9uIGZvcndhcmRWZWN0b3IoYm9keSl7CiAgICBjb25zdCBxPW5ldyBUSFJFRS5RdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbi54LGJvZHkucXVhdGVybmlvbi55LGJvZHkucXVhdGVybmlvbi56LGJvZHkucXVhdGVybmlvbi53KTsKICAgIGNvbnN0IGY9bmV3IFRIUkVFLlZlY3RvcjMoMCwwLDEpLmFwcGx5UXVhdGVybmlvbihxKTsgcmV0dXJuIHt4OmYueCx5OmYueSx6OmYuen07CiAgfQogIGZ1bmN0aW9uIHJpZ2h0VmVjdG9yKGJvZHkpewogICAgY29uc3QgcT1uZXcgVEhSRUUuUXVhdGVybmlvbihib2R5LnF1YXRlcm5pb24ueCxib2R5LnF1YXRlcm5pb24ueSxib2R5LnF1YXRlcm5pb24ueixib2R5LnF1YXRlcm5pb24udyk7CiAgICBjb25zdCByPW5ldyBUSFJFRS5WZWN0b3IzKDEsMCwwKS5hcHBseVF1YXRlcm5pb24ocSk7IHJldHVybiB7eDpyLngseTpyLnksejpyLnp9OwogIH0KICBmdW5jdGlvbiBmbGFzaCh0ZXh0KXsgY29uc3QgZWw9dWkudG9hc3Q7IGVsLnRleHRDb250ZW50PXRleHQ7IGVsLnN0eWxlLmRpc3BsYXk9ImJsb2NrIjsgY2xlYXJUaW1lb3V0KGZsYXNoLl90KTsgZmxhc2guX3Q9c2V0VGltZW91dCgoKT0+ZWwuc3R5bGUuZGlzcGxheT0ibm9uZSIsIDEwMDApOyB9CiAgZnVuY3Rpb24gcHVzaFJpbmcocG9zLCBzaXplKXsgcGFydGljbGVzLnJpbmcuc3Bhd24obmV3IFRIUkVFLlZlY3RvcjMocG9zLngscG9zLnkrMC4zLHBvcy56KSwgbmV3IFRIUkVFLlZlY3RvcjMoMCwwLDApLCAwLjYsIHNpemUsIDAuOSk7IH0KCiAgZnVuY3Rpb24gYWRkU2NvcmUocHRzLCBsYWJlbCl7CiAgICBjb25zdCBnYWluID0gTWF0aC5yb3VuZChwdHMgKiBjb21ibyAqIGhlYXRTY29yZU11bHQoKSk7CiAgICBzY29yZSArPSBnYWluOyB1aS5zY29yZS50ZXh0Q29udGVudCA9IHNjb3JlLnRvTG9jYWxlU3RyaW5nKCk7CiAgICBpZiAobGFiZWwpeyBmbGFzaChgJHtsYWJlbH0gKyR7Z2Fpbn1gKTsgcHVzaEZlZWQobGFiZWwsIGdhaW4pOyB9CiAgICBoZWF0Q2hhcmdlID0gTWF0aC5taW4oMSwgaGVhdENoYXJnZSArIGdhaW4gKiAwLjAwMDQ1KTsKICAgIHNpbmNlU2NvcmVUID0gMDsKICB9CgogIC8qID09PT09PT0gQUkgb2JzdGFjbGUgYXdhcmVuZXNzID09PT09PT0gKi8KICBmdW5jdGlvbiBhaUF2b2lkU3RlZXIoYWkpewogICAgbGV0IHN0ZWVyQmlhcyA9IDA7CiAgICBjb25zdCBweCA9IGFpLmJvZHkucG9zaXRpb24ueCwgcHogPSBhaS5ib2R5LnBvc2l0aW9uLno7CiAgICBmb3IgKGNvbnN0IHIgb2YgbWFwU2hhcGVzKXsKICAgICAgY29uc3QgYyA9IE1hdGguY29zKC1yLnlhdyksIHMgPSBNYXRoLnNpbigtci55YXcpOwogICAgICBjb25zdCBkeCA9IHB4IC0gci54LCBkeiA9IHB6IC0gci56OwogICAgICBjb25zdCBseCA9IGR4KmMgLSBkeipzLCBseiA9IGR4KnMgKyBkeipjOwogICAgICBjb25zdCBodyA9IHIudy8yICsgOCwgaGQgPSByLmQvMiArIDg7CiAgICAgIGNvbnN0IGNseCA9IE1hdGgubWF4KC1odywgTWF0aC5taW4oaHcsIGx4KSk7CiAgICAgIGNvbnN0IGNseiA9IE1hdGgubWF4KC1oZCwgTWF0aC5taW4oaGQsIGx6KSk7CiAgICAgIGNvbnN0IG9mZnggPSBseCAtIGNseCwgb2ZmeiA9IGx6IC0gY2x6OwogICAgICBjb25zdCB3eCA9IG9mZngqYyArIG9mZnoqcywgd3ogPSAtb2ZmeCpzICsgb2ZmeipjOwogICAgICBjb25zdCBtYWcgPSBNYXRoLmh5cG90KHd4LCB3eik7CiAgICAgIGlmIChtYWcgPiAwKXsKICAgICAgICBjb25zdCBmID0gZm9yd2FyZFZlY3RvcihhaS5ib2R5KTsKICAgICAgICBjb25zdCBkb3QgPSBmLngqd3ggKyBmLnoqd3osIGNyb3NzID0gZi54Knd6IC0gZi56Knd4OwogICAgICAgIGNvbnN0IGFuZyA9IE1hdGguYXRhbjIoY3Jvc3MsIGRvdCk7CiAgICAgICAgY29uc3QgdHlwZVdlaWdodCA9IChyLnR5cGU9PT0ncmFtcCc/MS4wOihyLnR5cGU9PT0nYmFuayc/MC44OjAuNSkpOwogICAgICAgIGNvbnN0IG5lYXIgPSAxLygxK21hZyowLjA4KTsKICAgICAgICBjb25zdCBoZWF0SyA9IDAuNiArIDAuMDgqaGVhdDsKICAgICAgICBjb25zdCBkaWZmTXVsID0gRElGRltkaWZmXS5hdm9pZE11bDsKICAgICAgICBzdGVlckJpYXMgKz0gTWF0aC5tYXgoLTEsIE1hdGgubWluKDEsIGFuZykpICogbmVhciAqIDAuNSAqIHR5cGVXZWlnaHQgKiBoZWF0SyAqIGRpZmZNdWw7IC8vIHNsaWdodGx5IGdlbnRsZXIgdGhhbiBiZWZvcmUgc28gdGhleSBkb24ndCBvdmVyLWF2b2lkCiAgICAgIH0KICAgIH0KICAgIC8vIGJvcmRlciBndWFyZAogICAgY29uc3QgbWFyZ2luPTI4OwogICAgaWYgKEFSRU5BX0hBTEYgLSBNYXRoLmFicyhweCkgPCBtYXJnaW4gfHwgQVJFTkFfSEFMRiAtIE1hdGguYWJzKHB6KSA8IG1hcmdpbil7CiAgICAgIGNvbnN0IHZ4ID0gLXB4LCB2eiA9IC1wejsKICAgICAgY29uc3QgZiA9IGZvcndhcmRWZWN0b3IoYWkuYm9keSk7CiAgICAgIGNvbnN0IGRvdCA9IGYueCp2eCArIGYueip2eiwgY3Jvc3MgPSBmLngqdnogLSBmLnoqdng7CiAgICAgIGNvbnN0IGFuZyA9IE1hdGguYXRhbjIoY3Jvc3MsIGRvdCk7CiAgICAgIHN0ZWVyQmlhcyArPSBNYXRoLm1heCgtMC43LCBNYXRoLm1pbigwLjcsIGFuZykpICogMC43OwogICAgfQogICAgcmV0dXJuIHsgc3RlZXI6IHN0ZWVyQmlhcyB9OwogIH0KCiAgLyogPT09PT09PSBIZWF0IFVJICYgc2NhbGluZyA9PT09PT09ICovCiAgZnVuY3Rpb24gdXBkYXRlSGVhdChkdCl7CiAgICBzaW5jZVNjb3JlVCArPSBkdDsKICAgIGNvbnN0IGNvb2xEZWxheSA9IEhFQVRfQ09PTERPV05fQkFTRSArIEhFQVRfQ09PTERPV05fUEVSX1NUQVIgKiBoZWF0OwogICAgaWYgKHNpbmNlU2NvcmVUID49IDEgJiYgaGVhdCA+IDApIHsKICAgICAgaWYgKGNvb2xUaW1lciA8PSAwKSBjb29sVGltZXIgPSBjb29sRGVsYXk7IGVsc2UgY29vbFRpbWVyID0gTWF0aC5tYXgoMCwgY29vbFRpbWVyIC0gZHQpOwogICAgICB1aS5jb29sVHh0LnRleHRDb250ZW50ID0gYENvb2xpbmcgaW46ICR7Y29vbFRpbWVyLnRvRml4ZWQoMSl9c2A7CiAgICAgIGlmIChjb29sVGltZXIgPD0gMCl7IGhlYXQgPSBNYXRoLm1heCgwLCBoZWF0IC0gMSk7IG9uSGVhdENoYW5nZSgpOyBjb29sVGltZXIgPSBoZWF0PjAgPyAoSEVBVF9DT09MRE9XTl9CQVNFICsgSEVBVF9DT09MRE9XTl9QRVJfU1RBUiAqIGhlYXQpIDogMDsgfQogICAgfSBlbHNlIHsgdWkuY29vbFR4dC50ZXh0Q29udGVudCA9ICIiOyBjb29sVGltZXIgPSAwOyB9CgogICAgaWYgKHNpbmNlU2NvcmVUID4gMC4zKSBoZWF0Q2hhcmdlID0gTWF0aC5tYXgoMCwgaGVhdENoYXJnZSAtIGR0KjAuMTIpOwogICAgaWYgKGhlYXQgPCBNQVhfSEVBVCAmJiBoZWF0Q2hhcmdlID49IDEpeyBoZWF0Kys7IGhlYXRDaGFyZ2UgLT0gMTsgb25IZWF0Q2hhbmdlKCk7IH0KCiAgICB1aS5oZWF0U3RhcnMudGV4dENvbnRlbnQgPSAi4piFIi5yZXBlYXQoaGVhdCkgKyAi4piGIi5yZXBlYXQoTUFYX0hFQVQtaGVhdCk7CiAgICB1aS5oZWF0QmFkZ2UudGV4dENvbnRlbnQgPSBoZWF0TmFtZShoZWF0KTsKICB9CiAgZnVuY3Rpb24gb25IZWF0Q2hhbmdlKCl7IHB1c2hSaW5nKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCA0ICsgaGVhdCowLjgpOyByZWNvbmNpbGVCb3RzVG9IZWF0KCk7IGlmIChoZWF0ID09PSBNQVhfSEVBVCl7IGZsYXNoKCJJbmZlcm5vISBTY29yZSBNdWx0aXBsaWVyIOKGkSIpOyBhdWRpby5ibGlwKDc2MCwuMTgsLjI1KTt9IH0KCiAgZnVuY3Rpb24gaW5mZXJub1NwaWtlKCl7IHJldHVybiBoZWF0PT09TUFYX0hFQVQgPyAxLjIyIDogMS4wOyB9CiAgZnVuY3Rpb24gYWlUYXJnZXRTcGVlZCgpeyByZXR1cm4gKDMwICsgaGVhdCo5KSAqIERJRkZbZGlmZl0uc3BlZWQgKiBpbmZlcm5vU3Bpa2UoKTsgfQogIGZ1bmN0aW9uIGFpU3RlZXJDbGFtcCgpeyByZXR1cm4gKDAuNjIgKyBoZWF0KjAuMDkgKyBESUZGW2RpZmZdLnN0ZWVyQm9vc3QpOyB9CiAgZnVuY3Rpb24gYWlFbmdpbmVCYXNlKCl7IHJldHVybiAtICg0MjAwICsgaGVhdCo3MDApICogRElGRltkaWZmXS5lbmdpbmUgKiBpbmZlcm5vU3Bpa2UoKTsgfQogIGZ1bmN0aW9uIGFpUmVwYXRoQmFzZSgpeyByZXR1cm4gTWF0aC5tYXgoMC4xMiwgKDAuNjAgLSBoZWF0KjAuMTApICogRElGRltkaWZmXS5yZXBsYW5NdWwpOyB9CiAgZnVuY3Rpb24gYWlMZWFkRmFjdG9yKGRpc3QsIHYpeyByZXR1cm4gTWF0aC5taW4oMS44LCBkaXN0IC8gKHYgKyAxKSkgKiAoMSArIDAuMjUqaGVhdCk7IH0KCiAgLyogPT09PT09PSBQaWNrdXBzIC8gT3JicyA9PT09PT09ICovCiAgZnVuY3Rpb24gc3Bhd25QaWNrdXBzKCl7CiAgICBmb3IgKGxldCBpPTA7aTwzO2krKykgcGlja3Vwcy5wdXNoKG1ha2VQaWNrdXAoJ25pdHJvJywgcmFuZG9tRWRnZVBvcygpKSk7CiAgICBwaWNrdXBzLnB1c2gobWFrZVBpY2t1cCgnc2hpZWxkJywgcmFuZG9tRWRnZVBvcygpKSk7CiAgfQogIGZ1bmN0aW9uIG1ha2VQaWNrdXAodHlwZSwgcG9zKXsKICAgIGNvbnN0IGdlbyA9IHR5cGU9PT0nbml0cm8nID8gbmV3IFRIUkVFLkN5bGluZGVyR2VvbWV0cnkoMC42LDAuNiwxLjIsMTQpIDogbmV3IFRIUkVFLlRvcnVzR2VvbWV0cnkoMS4wLDAuMTUsMTIsMzIpOwogICAgY29uc3QgbWF0ID0gbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHsgY29sb3I6IHR5cGU9PT0nbml0cm8nID8gMHgyYWY1YTQgOiAweGI5ODdmZiwgZW1pc3NpdmU6IHR5cGU9PT0nbml0cm8nID8gMHgwZDUgOiAweDMyMTA1NSwgcm91Z2huZXNzOjAuMiwgbWV0YWxuZXNzOjAuMSB9KTsKICAgIGNvbnN0IG0gPSBuZXcgVEhSRUUuTWVzaChnZW8sIG1hdCk7IG0ucG9zaXRpb24uc2V0KHBvcy54LCB0eXBlPT09J25pdHJvJz8wLjk6MS4yLCBwb3Mueik7IG0uY2FzdFNoYWRvdz10cnVlOyBzY2VuZS5hZGQobSk7CiAgICByZXR1cm4geyBtZXNoOiBtLCB0eXBlLCByZXNwYXduVDogMCB9OwogIH0KICBmdW5jdGlvbiByYW5kb21FZGdlUG9zKCl7IGNvbnN0IHIgPSBBUkVOQV9IQUxGLTQwOyBjb25zdCBhID0gTWF0aC5yYW5kb20oKSpNYXRoLlBJKjI7IGNvbnN0IHJhZCA9IHIgLSA0MCpNYXRoLnJhbmRvbSgpOyByZXR1cm4gbmV3IFRIUkVFLlZlY3RvcjMoTWF0aC5jb3MoYSkqcmFkLCAwLCBNYXRoLnNpbihhKSpyYWQpOyB9CiAgZnVuY3Rpb24gc3Bhd25PcmJzKG4pewogICAgZm9yIChsZXQgaT0wO2k8bjtpKyspewogICAgICBjb25zdCBtID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLlNwaGVyZUdlb21ldHJ5KDAuNSwxMiwxMiksIG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCh7IGNvbG9yOjB4YWQ3NmZmLCBlbWlzc2l2ZToweDIyMDAzMywgcm91Z2huZXNzOjAuNCB9KSk7CiAgICAgIGNvbnN0IHAgPSByYW5kb21FZGdlUG9zKCk7IG0ucG9zaXRpb24uc2V0KHAueCwwLjUscC56KTsgc2NlbmUuYWRkKG0pOyBvcmJzLnB1c2gobSk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHNwaW5QaWNrdXBzKGR0KXsgZm9yIChjb25zdCBwIG9mIHBpY2t1cHMpeyBwLm1lc2gucm90YXRpb24ueSArPSBkdCoxLjY7IHAubWVzaC52aXNpYmxlID0gcC5yZXNwYXduVDw9MDsgaWYgKHAucmVzcGF3blQ+MCkgcC5yZXNwYXduVCAtPSBkdDsgfSB9CiAgZnVuY3Rpb24gY2hlY2tQaWNrdXBzKCl7CiAgICBmb3IgKGNvbnN0IHAgb2YgcGlja3Vwcyl7CiAgICAgIGlmICghcC5tZXNoLnZpc2libGUpIGNvbnRpbnVlOwogICAgICBjb25zdCBkeCA9IHAubWVzaC5wb3NpdGlvbi54IC0gY2hhc3Npc0JvZHkucG9zaXRpb24ueCwgZHogPSBwLm1lc2gucG9zaXRpb24ueiAtIGNoYXNzaXNCb2R5LnBvc2l0aW9uLno7CiAgICAgIGlmIChNYXRoLmh5cG90KGR4LGR6KSA8IDIuNCl7CiAgICAgICAgaWYgKHAudHlwZT09PSduaXRybycpeyBuaXRybyA9IE1hdGgubWluKDEsIG5pdHJvICsgMC42KTsgYWRkU2NvcmUoMjAwLCAiTml0cm8gY2FuIik7IGF1ZGlvLmJsaXAoNjYwLC4xLC4yNSk7IH0KICAgICAgICBpZiAocC50eXBlPT09J3NoaWVsZCcpeyBzaGllbGRUID0gNi4wOyBhZGRTY29yZSgzMDAsICJTaGllbGQiKTsgYXVkaW8uYmxpcCg0ODAsLjE1LC4yNSk7IH0KICAgICAgICBwLnJlc3Bhd25UID0gOCArIE1hdGgucmFuZG9tKCkqNjsgcC5tZXNoLnBvc2l0aW9uLmNvcHkocmFuZG9tRWRnZVBvcygpKTsgcC5tZXNoLnZpc2libGU9ZmFsc2U7CiAgICAgIH0KICAgIH0KICB9CiAgZnVuY3Rpb24gY2hlY2tPcmJzKCl7CiAgICBmb3IgKGxldCBpPW9yYnMubGVuZ3RoLTE7aT49MDtpLS0pewogICAgICBjb25zdCBvID0gb3Jic1tpXTsgY29uc3QgZHg9by5wb3NpdGlvbi54IC0gY2hhc3Npc0JvZHkucG9zaXRpb24ueCwgZHo9by5wb3NpdGlvbi56IC0gY2hhc3Npc0JvZHkucG9zaXRpb24uejsKICAgICAgaWYgKE1hdGguaHlwb3QoZHgsZHopIDwgMi4wKXsKICAgICAgICBhZGRTY29yZSgxMjAsICJPcmIiKTsgYXVkaW8uYmxpcCg1NjAsLjA3LC4yKTsKICAgICAgICBwYXJ0aWNsZXMucmluZy5zcGF3bihuZXcgVEhSRUUuVmVjdG9yMyhvLnBvc2l0aW9uLngsMS4wLG8ucG9zaXRpb24ueiksIG5ldyBUSFJFRS5WZWN0b3IzKDAsMCwwKSwgMC4zNSwgMS4yLCAwLjkpOwogICAgICAgIHNjZW5lLnJlbW92ZShvKTsgb3Jicy5zcGxpY2UoaSwxKTsKICAgICAgfQogICAgfQogICAgaWYgKG9yYnMubGVuZ3RoIDwgMTIpeyBzcGF3bk9yYnMoMyk7IH0KICB9CgogIC8qID09PT09PT0gSW5wdXQgPT09PT09PSAqLwogIGFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBlID0+IHsKICAgIGNvbnN0IGs9ZS5rZXkudG9Mb3dlckNhc2UoKTsga2V5c1trXT10cnVlOwogICAgaWYoWyIgIiwiYXJyb3d1cCIsImFycm93ZG93biIsImFycm93bGVmdCIsImFycm93cmlnaHQiXS5pbmNsdWRlcyhrKSkgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgaWYoaz09PSJ3Inx8az09PSJzInx8az09PSJhcnJvd3VwInx8az09PSJhcnJvd2Rvd24iKXsgY2hhc3Npc0JvZHkud2FrZVVwKCk7IH0KICAgIGlmKGs9PT0iYyIpeyBjYW1lcmFNb2RlID0gKGNhbWVyYU1vZGU9PT0iY2hhc2UiKSA/ICJvcmJpdCIgOiAiY2hhc2UiOyB9CiAgICBpZihrPT09Im0iKXsgbXV0ZWQgPSAhbXV0ZWQ7IH0KICAgIGlmKGs9PT0iciIpeyByZXNldFJvdW5kKCJSZXNldCIpOyB9CiAgICBpZihrPT09ImgiKXsgdWkubWFudWFsLnN0eWxlLmRpc3BsYXkgPSAodWkubWFudWFsLnN0eWxlLmRpc3BsYXk9PT0iZmxleCIgPyAibm9uZSIgOiAiZmxleCIpOyB9CiAgICBpZihrPT09ImIiKXsgdG9nZ2xlQm90cygpOyB9CiAgICBpZihrPT09InQiKXsgc2hhcmVTY29yZSgpOyB9CiAgfSk7CiAgYWRkRXZlbnRMaXN0ZW5lcigia2V5dXAiLCBlID0+IHsga2V5c1tlLmtleS50b0xvd2VyQ2FzZSgpXSA9IGZhbHNlOyB9KTsKICB1aS5idG5IZWxwLm9uY2xpY2sgPSAoKT0+eyB1aS5tYW51YWwuc3R5bGUuZGlzcGxheT0iZmxleCI7IH07CiAgdWkubWFudWFsQ2xvc2Uub25jbGljayA9ICgpPT57IHVpLm1hbnVhbC5zdHlsZS5kaXNwbGF5PSJub25lIjsgfTsKICB1aS5idG5Cb3RzLm9uY2xpY2sgPSAoKT0+IHRvZ2dsZUJvdHMoKTsKICB1aS5idG5EaWZmLm9uY2xpY2sgPSAoKT0+IGN5Y2xlRGlmZigpOwogIHVpLmJ0bk1hcC5vbmNsaWNrICA9ICgpPT4geyBtYXBJbmRleCA9IChtYXBJbmRleCsxKSAlIE1BUFMubGVuZ3RoOyByZWJ1aWxkTWFwKCk7IHJlc2V0Um91bmQoIk1hcDogIiArIE1BUFNbbWFwSW5kZXhdLm5hbWUpOyB9OwogIHVpLnNjb3JlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2hhcmVTY29yZSk7CgogIGZ1bmN0aW9uIHRvZ2dsZUJvdHMoKXsKICAgIGJvdHNFbmFibGVkID0gIWJvdHNFbmFibGVkOwogICAgdWkuYnRuQm90cy50ZXh0Q29udGVudCA9ICdCb3RzOiAnICsgKGJvdHNFbmFibGVkID8gJ09OJyA6ICdPRkYnKTsKICAgIGlmICghYm90c0VuYWJsZWQpeyB3aGlsZSAoYWlDYXJzLmxlbmd0aCkgZGVzcGF3bkFJKCk7IH0KICAgIGVsc2UgeyByZWNvbmNpbGVCb3RzVG9IZWF0KCk7IH0KICB9CiAgZnVuY3Rpb24gY3ljbGVEaWZmKCl7CiAgICBkaWZmID0gKGRpZmYgKyAxKSAlIERJRkYubGVuZ3RoOwogICAgdWkuYnRuRGlmZi50ZXh0Q29udGVudCA9ICdEaWZmaWN1bHR5OiAnICsgRElGRltkaWZmXS5uYW1lOwogICAgcmVjb25jaWxlQm90c1RvSGVhdCgpOwogIH0KCiAgZnVuY3Rpb24gc2hhcmVTY29yZSgpewogICAgY29uc3QgbXNnID0gYEkgc2NvcmVkICR7c2NvcmUudG9Mb2NhbGVTdHJpbmcoKX0gaW4gSW5mZXJubyBEcmlmdCBhdCAke2hlYXROYW1lKGhlYXQpfSBoZWF0IG9uICR7RElGRltkaWZmXS5uYW1lfSFgOwogICAgY29uc3Qgc2hhcmVEYXRhID0geyB0aXRsZTogIkluZmVybm8gRHJpZnQiLCB0ZXh0OiBtc2csIHVybDogbG9jYXRpb24uaHJlZiB9OwogICAgaWYgKG5hdmlnYXRvci5zaGFyZSl7CiAgICAgIG5hdmlnYXRvci5zaGFyZShzaGFyZURhdGEpLmNhdGNoKCgpPT57IC8qIGlnbm9yZSAqLyB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHRhPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJyk7IHRhLnZhbHVlID0gbXNnICsgIiDigJQgIiArIGxvY2F0aW9uLmhyZWY7CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGEpOyB0YS5zZWxlY3QoKTsgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2NvcHknKTsgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0YSk7CiAgICAgIGZsYXNoKCJTY29yZSBjb3BpZWQhIFBhc3RlIHRvIHNoYXJlLiIpOwogICAgfQogIH0KCiAgLyogPT09PT09PSBNYWluIGxvb3AgPT09PT09PSAqLwogIGxldCByZWFyV2hlZWxQb3MgPSBbbmV3IFRIUkVFLlZlY3RvcjMoKSwgbmV3IFRIUkVFLlZlY3RvcjMoKV07CiAgZnVuY3Rpb24gYW5pbWF0ZSgpeyBjb25zdCBkdD1NYXRoLm1pbigwLjAzMywgY2xvY2suZ2V0RGVsdGEoKSk7IHN0ZXAoZHQpOyByZW5kZXJlci5yZW5kZXIoc2NlbmUsIGNhbWVyYSk7IG1hcC5kcmF3KCk7IHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsgfQoKICBmdW5jdGlvbiBzdGVwKGR0UmVhbCl7CiAgICBjb25zdCBkdCA9IGR0UmVhbDsgLy8gbm8gc2xvdy1tbwoKICAgIC8vIOKAlOKAlCBJTlBVVCDigJTigJQKICAgIGNvbnN0IGFjY2VsSyAgPSAoa2V5c1sidyJdfHxrZXlzWyJhcnJvd3VwIl0pID8gMSA6IChrZXlzWyJzIl18fGtleXNbImFycm93ZG93biJdKSA/IC0wLjcgOiAwOwogICAgY29uc3Qgc3RlZXJLICA9IChrZXlzWyJhIl18fGtleXNbImFycm93bGVmdCJdKSA/IDEgOiAoa2V5c1siZCJdfHxrZXlzWyJhcnJvd3JpZ2h0Il0pID8gLTEgOiAwOwogICAgY29uc3QgaGFuZGJyYWtlID0ga2V5c1siICJdOwogICAgY29uc3QgYm9vc3RLZXkgID0ga2V5c1sic2hpZnQiXTsKICAgIGNvbnN0IGFjY2VsID0gYWNjZWxLOwogICAgY29uc3Qgc3RlZXIgPSBzdGVlcks7CgogICAgLy8gU3RlZXJpbmcgJiBicmFrZXMKICAgIHBsYXllclZlaGljbGUuc2V0U3RlZXJpbmdWYWx1ZShzdGVlciAqIDAuNSwgMCk7CiAgICBwbGF5ZXJWZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUoc3RlZXIgKiAwLjUsIDEpOwogICAgZm9yKGxldCBpPTA7aTw0O2krKykgcGxheWVyVmVoaWNsZS5zZXRCcmFrZShoYW5kYnJha2UgPyA1NSA6IDAsIGkpOwoKICAgIC8vIE5pdHJvIChtYW51YWwpCiAgICBjb25zdCB2ID0gY2hhc3Npc0JvZHkudmVsb2NpdHk7IGNvbnN0IGhvcml6U3BlZWQgPSBNYXRoLnNxcnQodi54KnYueCArIHYueip2LnopOwogICAgaWYgKGJvb3N0S2V5ICYmIG5pdHJvPjApewogICAgICBuaXRybyA9IE1hdGgubWF4KDAsIG5pdHJvIC0gMC4zNSpkdFJlYWwpOwogICAgICBjb25zdCBkaXIgPSBmb3J3YXJkVmVjdG9yKGNoYXNzaXNCb2R5KTsKICAgICAgY2hhc3Npc0JvZHkuYXBwbHlGb3JjZShuZXcgQ0FOTk9OLlZlYzMoZGlyLngqMjUwMCwgMCwgZGlyLnoqMjUwMCksIGNoYXNzaXNCb2R5LnBvc2l0aW9uKTsKICAgICAgY29uc3QgYmFjayA9IG5ldyBUSFJFRS5WZWN0b3IzKC1kaXIueCwgLWRpci55LCAtZGlyLnopOwogICAgICBjb25zdCBwID0gbmV3IFRIUkVFLlZlY3RvcjMoY2hhc3Npc0JvZHkucG9zaXRpb24ueCArIGJhY2sueCoyLjIsIGNoYXNzaXNCb2R5LnBvc2l0aW9uLnkrMC41LCBjaGFzc2lzQm9keS5wb3NpdGlvbi56ICsgYmFjay56KjIuMik7CiAgICAgIHBhcnRpY2xlcy5mbGFtZS5zcGF3bihwLCBiYWNrLm11bHRpcGx5U2NhbGFyKDgpLCAwLjEyLCAwLjkpOwogICAgICBjYW1TaGFrZSA9IE1hdGgubWluKDAuNCwgY2FtU2hha2UgKyAwLjAyKTsKICAgIH0gZWxzZSBuaXRybyA9IE1hdGgubWluKDEsIG5pdHJvICsgMC4xMipkdFJlYWwpOwogICAgdWkubml0cm9GaWxsLnN0eWxlLndpZHRoID0gKG5pdHJvKjEwMCkudG9GaXhlZCgxKSArICIlIjsKCiAgICAvLyBBbmltYXRlZCBmbG9vciB0ZXh0dXJlIG9mZnNldAogICAgZmxvb3JUZXgub2Zmc2V0LnkgKz0gKGhvcml6U3BlZWQgKiAwLjAwMDM1KSAqIGR0UmVhbDsKCiAgICAvLyBFbmdpbmUgZm9yY2UgKHBsYXllcikg4oCUIHR1cmJvIGJvb3N0cyBwb3dlciBicmllZmx5CiAgICBjb25zdCB0cmFjdGlvbiA9IGdyb3VuZGVkUHJldiA/IDEuMCA6IDAuMjU7CiAgICBjb25zdCB0dXJib011bCA9IHR1cmJvVD4wID8gMS44IDogMS4wOwogICAgY29uc3QgZW5naW5lID0gLWFjY2VsICogMzIwMCAqIHRyYWN0aW9uICogdHVyYm9NdWw7CiAgICBwbGF5ZXJWZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UoZW5naW5lLCAyKTsKICAgIHBsYXllclZlaGljbGUuYXBwbHlFbmdpbmVGb3JjZShlbmdpbmUsIDMpOwoKICAgIC8vIEFudGnigJF3aGVlbGllICYgYWVybwogICAgaWYgKGdyb3VuZGVkUHJldiAmJiAoYWNjZWwgPiAwLjQgfHwgdHVyYm9UPjApKXsKICAgICAgY29uc3Qgc3AgPSBNYXRoLnNxcnQodi54KnYueCt2Lnoqdi56KTsKICAgICAgc3RhYmlsaXplUGl0Y2goY2hhc3Npc0JvZHksIDE4MDApOwogICAgICBhcHBseUFlcm8oY2hhc3Npc0JvZHksIHNwLCAwLjI4KTsKICAgIH0KCiAgICBpZiAodHVyYm9UPjApewogICAgICBjb25zdCBkaXIgPSBmb3J3YXJkVmVjdG9yKGNoYXNzaXNCb2R5KTsKICAgICAgY2hhc3Npc0JvZHkuYXBwbHlGb3JjZShuZXcgQ0FOTk9OLlZlYzMoZGlyLngqNDUwLCAwLCBkaXIueio0NTApLCBjaGFzc2lzQm9keS5wb3NpdGlvbik7CiAgICAgIGNvbnN0IHNwID0gTWF0aC5zcXJ0KHYueCp2Lngrdi56KnYueik7CiAgICAgIGFwcGx5QWVybyhjaGFzc2lzQm9keSwgc3AsIDAuNTUpOwogICAgICB0dXJib1QgPSBNYXRoLm1heCgwLCB0dXJib1QgLSBkdFJlYWwpOwogICAgfQoKICAgIC8vIElu4oCRYWlyIGJhcnJlbCByb2xsCiAgICBpZiAoIWdyb3VuZGVkUHJldiAmJiAoa2V5c1siYXJyb3dsZWZ0Il0gfHwga2V5c1siYXJyb3dyaWdodCJdKSl7CiAgICAgIGNvbnN0IGZ3ZCA9IGZvcndhcmRWZWN0b3IoY2hhc3Npc0JvZHkpOwogICAgICBjb25zdCByb2xsVG9ycXVlID0gKGtleXNbImFycm93bGVmdCJdID8gLTEgOiAxKSAqIDE4MDA7CiAgICAgIGNoYXNzaXNCb2R5LnRvcnF1ZS54ICs9IGZ3ZC54ICogcm9sbFRvcnF1ZTsKICAgICAgY2hhc3Npc0JvZHkudG9ycXVlLnkgKz0gZndkLnkgKiByb2xsVG9ycXVlOwogICAgICBjaGFzc2lzQm9keS50b3JxdWUueiArPSBmd2QueiAqIHJvbGxUb3JxdWU7CiAgICB9CgogICAgLy8g4oCU4oCUIEFJIHB1cnN1aXQg4oCU4oCUIC8vCiAgICBpZiAoYm90c0VuYWJsZWQpewogICAgICBjb25zdCBwdiA9IHt4OmNoYXNzaXNCb2R5LnZlbG9jaXR5LngsIHo6Y2hhc3Npc0JvZHkudmVsb2NpdHkuen07CiAgICAgIGNvbnN0IHB2TGVuID0gTWF0aC5oeXBvdChwdi54LHB2LnopIHx8IDEsIG54ID0gcHYueC9wdkxlbiwgbnogPSBwdi56L3B2TGVuOwogICAgICBmb3IgKGxldCBpPTA7aTxhaUNhcnMubGVuZ3RoO2krKyl7CiAgICAgICAgY29uc3QgYWkgPSBhaUNhcnNbaV07CiAgICAgICAgYWkucmVwYXRoVCAtPSBkdFJlYWw7CiAgICAgICAgaWYgKGFpLnJlcGF0aFQ8PTApewogICAgICAgICAgYWkucmVwYXRoVCA9IGFpUmVwYXRoQmFzZSgpICsgTWF0aC5yYW5kb20oKSowLjI7CiAgICAgICAgICBjb25zdCBweD1jaGFzc2lzQm9keS5wb3NpdGlvbi54LCBwej1jaGFzc2lzQm9keS5wb3NpdGlvbi56OwogICAgICAgICAgY29uc3QgcyA9IG5lYXJlc3ROb2RlKGFpLmJvZHkucG9zaXRpb24ueCwgYWkuYm9keS5wb3NpdGlvbi56KSwgZyA9IG5lYXJlc3ROb2RlKHB4ICsgcHYueCowLjksIHB6ICsgcHYueiowLjkpOwogICAgICAgICAgY29uc3QgcGF0aElkeHMgPSBhU3RhcihzLGcpOwogICAgICAgICAgYWkucGF0aCA9IHBhdGhJZHhzLm1hcChrID0+ICh7eDpuYXYubm9kZXNba10ueCwgejpuYXYubm9kZXNba10uen0pKTsKICAgICAgICAgIGFpLnBhdGhJZHggPSAwOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgYXg9YWkuYm9keS5wb3NpdGlvbi54LCBhej1haS5ib2R5LnBvc2l0aW9uLno7CiAgICAgICAgY29uc3QgZHhwID0gY2hhc3Npc0JvZHkucG9zaXRpb24ueCAtIGF4LCBkenAgPSBjaGFzc2lzQm9keS5wb3NpdGlvbi56IC0gYXosIGRpc3RQID0gTWF0aC5oeXBvdChkeHAsZHpwKTsKICAgICAgICBjb25zdCBhaU1heCA9IGFpVGFyZ2V0U3BlZWQoKTsKCiAgICAgICAgLy8gUHJlZGljdGl2ZSBpbnRlcmNlcHQgd2l0aCByb2xlLWJhc2VkIGZsYW5rLCBwbHVzIGNsb3NlLXJhbmdlIGRpcmVjdCBwdXJzdWUKICAgICAgICBsZXQgbGVhZCA9IGFpTGVhZEZhY3RvcihkaXN0UCwgYWlNYXgpOwogICAgICAgIGNvbnN0IGxlZnR4ID0gLW56LCBsZWZ0eiA9IG54OwogICAgICAgIGNvbnN0IGZsYW5rT2ZmID0gKDYgKyBNYXRoLm1pbigxNiwgZGlzdFAqMC4xMikpICogKDEgKyBoZWF0KjAuMDgpOwogICAgICAgIGxldCB0YXJnZXQgPSB7IHg6IGNoYXNzaXNCb2R5LnBvc2l0aW9uLnggKyBwdi54ICogbGVhZCwKICAgICAgICAgICAgICAgICAgICAgICB6OiBjaGFzc2lzQm9keS5wb3NpdGlvbi56ICsgcHYueiAqIGxlYWQgfTsKICAgICAgICBpZiAoZGlzdFAgPCA2MCl7IC8vIGNsb3NlOiBiaWFzIHRvIGRpcmVjdCBwdXJzdWl0IHRvIHByZXZlbnQgY2lyY2xpbmcKICAgICAgICAgIHRhcmdldC54ID0gY2hhc3Npc0JvZHkucG9zaXRpb24ueCArIG54ICogTWF0aC5taW4oMTgsIGRpc3RQKjAuNCk7CiAgICAgICAgICB0YXJnZXQueiA9IGNoYXNzaXNCb2R5LnBvc2l0aW9uLnogKyBueiAqIE1hdGgubWluKDE4LCBkaXN0UCowLjQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoYWkucm9sZT09PSJmbGFua0wiKXsgdGFyZ2V0LnggKz0gbGVmdHgqZmxhbmtPZmY7IHRhcmdldC56ICs9IGxlZnR6KmZsYW5rT2ZmOyB9CiAgICAgICAgICBpZiAoYWkucm9sZT09PSJmbGFua1IiKXsgdGFyZ2V0LnggLT0gbGVmdHgqZmxhbmtPZmY7IHRhcmdldC56IC09IGxlZnR6KmZsYW5rT2ZmOyB9CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBmYXIsIG1peCBpbiBwYXRoIHdheXBvaW50IGZvciBmaWVsZCBhd2FyZW5lc3MKICAgICAgICBpZiAoZGlzdFAgPiAxNDAgJiYgYWkucGF0aC5sZW5ndGgpewogICAgICAgICAgY29uc3Qgd3AgPSBhaS5wYXRoW01hdGgubWluKGFpLnBhdGhJZHgsIGFpLnBhdGgubGVuZ3RoLTEpXTsKICAgICAgICAgIGNvbnN0IGR3cCA9IE1hdGguaHlwb3Qod3AueC1heCwgd3Auei1heik7CiAgICAgICAgICBpZiAoZHdwIDwgMTAgJiYgYWkucGF0aElkeCA8IGFpLnBhdGgubGVuZ3RoLTEpIGFpLnBhdGhJZHgrKzsKICAgICAgICAgIHRhcmdldC54ID0gdGFyZ2V0LngqMC43ICsgd3AueCowLjM7IHRhcmdldC56ID0gdGFyZ2V0LnoqMC43ICsgd3AueiowLjM7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBmID0gZm9yd2FyZFZlY3RvcihhaS5ib2R5KTsKICAgICAgICBjb25zdCB0byA9IHsgeDogdGFyZ2V0LnggLSBheCwgejogdGFyZ2V0LnogLSBheiB9OwogICAgICAgIGNvbnN0IGRvdCA9IChmLngqdG8ueCArIGYueip0by56KSAvIChNYXRoLmh5cG90KHRvLngsdG8ueikrMWUtNCk7CiAgICAgICAgY29uc3QgY3Jvc3MgPSBmLngqdG8ueiAtIGYueip0by54OwogICAgICAgIGxldCBkZXNpcmVkID0gLU1hdGguYXRhbjIoY3Jvc3MsIGRvdCk7CiAgICAgICAgY29uc3QgYXZvaWQgPSBhaUF2b2lkU3RlZXIoYWkpOwogICAgICAgIGRlc2lyZWQgKz0gYXZvaWQuc3RlZXI7CgogICAgICAgIGFpLnN0ZWVyTFAgPSBhaS5zdGVlckxQKjAuNTUgKyBkZXNpcmVkKjAuNDU7CiAgICAgICAgbGV0IHN0ZWVyQUkgPSBNYXRoLm1heCgtYWlTdGVlckNsYW1wKCksIE1hdGgubWluKGFpU3RlZXJDbGFtcCgpLCBhaS5zdGVlckxQKSk7CiAgICAgICAgYWkudmVoLnNldFN0ZWVyaW5nVmFsdWUoc3RlZXJBSSwgMCk7CiAgICAgICAgYWkudmVoLnNldFN0ZWVyaW5nVmFsdWUoc3RlZXJBSSwgMSk7CiAgICAgICAgZm9yKGxldCB3PTA7dzw0O3crKykgYWkudmVoLnNldEJyYWtlKDAsIHcpOwoKICAgICAgICBjb25zdCB2QSA9IGFpLmJvZHkudmVsb2NpdHk7IGNvbnN0IHNwZCA9IE1hdGguaHlwb3QodkEueCwgdkEueik7CgogICAgICAgIC8vIHRocm90dGxlIG1vZGVsOiBwdXNoIGhhcmQgd2hlbiBiZWhpbmQgYW5kIGFsaWduZWQ7IHRyaW0gd2hlbiBvdmVyIHRhcmdldCBzcGVlZCBvciB0dXJuaW5nIGhhcmQKICAgICAgICBsZXQgZW5naW5lQUkgPSBhaUVuZ2luZUJhc2UoKTsKICAgICAgICBjb25zdCB0YXJnZXRTcGQgPSBhaU1heCAqIChkaXN0UDw1NSA/IDEuMTggOiAxLjApOwogICAgICAgIGlmIChNYXRoLmFicyhzdGVlckFJKT4wLjQ1KSBlbmdpbmVBSSAqPSAwLjYwOyBlbHNlIGlmIChNYXRoLmFicyhzdGVlckFJKT4wLjI1KSBlbmdpbmVBSSAqPSAwLjgwOwogICAgICAgIGlmIChzcGQgPiB0YXJnZXRTcGQpIGVuZ2luZUFJICo9IDAuNTU7CiAgICAgICAgaWYgKGRvdCA8IDAuMiAmJiBkaXN0UCA8IDM1KSBlbmdpbmVBSSAqPSAwLjc7IC8vIGlmIHBvaW50ZWQgcG9vcmx5IHZlcnkgY2xvc2UsIGRvbid0IHJvY2tldCBwYXN0CiAgICAgICAgY29uc3QgZndkWSA9IGYueTsgaWYgKGZ3ZFkgPiAwLjEyKSBlbmdpbmVBSSAqPSAwLjU1OwoKICAgICAgICBhaS52ZWguYXBwbHlFbmdpbmVGb3JjZShlbmdpbmVBSSwgMik7CiAgICAgICAgYWkudmVoLmFwcGx5RW5naW5lRm9yY2UoZW5naW5lQUksIDMpOwoKICAgICAgICBhcHBseUFlcm8oYWkuYm9keSwgc3BkLCAwLjUwICogRElGRltkaWZmXS5ncmlwKTsKICAgICAgICBzdGFiaWxpemVQaXRjaChhaS5ib2R5LCAyNDAwKTsKCiAgICAgICAgLy8gYW50aS1zdGFsbCAmIHJlc2V0CiAgICAgICAgaWYgKHNwZCA8IDAuOSkgYWkuc3R1Y2tUICs9IGR0UmVhbDsgZWxzZSBhaS5zdHVja1QgPSBNYXRoLm1heCgwLCBhaS5zdHVja1QgLSBkdFJlYWwqMC43KTsKICAgICAgICBpZiAoYWkuc3R1Y2tUPjEuMCAmJiBhaS5zdHVja1Q8MS42KXsgYWkudmVoLmFwcGx5RW5naW5lRm9yY2UoMTIwMCwgMik7IGFpLnZlaC5hcHBseUVuZ2luZUZvcmNlKDEyMDAsIDMpOyB9CiAgICAgICAgaWYgKGFpLnN0dWNrVCA+IDMuMCl7IHJlc2V0QUkoYWkpOyBhaS5yZXBhdGhUPTAuMjsgfQogICAgICB9CiAgICB9CgogICAgLy8gUGh5c2ljcwogICAgd29ybGQuc3RlcCgxLzYwLCBkdCwgMyk7CgogICAgLy8gU3luYyB2aXN1YWxzCiAgICBjaGFzc2lzTWVzaC5wb3NpdGlvbi5jb3B5KGNoYXNzaXNCb2R5LnBvc2l0aW9uKTsKICAgIGNoYXNzaXNNZXNoLnF1YXRlcm5pb24uY29weShjaGFzc2lzQm9keS5xdWF0ZXJuaW9uKTsKICAgIGZvciAobGV0IGk9MDsgaTxwbGF5ZXJWZWhpY2xlLndoZWVsSW5mb3MubGVuZ3RoOyBpKyspewogICAgICBwbGF5ZXJWZWhpY2xlLnVwZGF0ZVdoZWVsVHJhbnNmb3JtKGkpOwogICAgICBjb25zdCB0ID0gcGxheWVyVmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICBwbGF5ZXJXaGVlbE1lc2hlc1tpXS5wb3NpdGlvbi5zZXQodC5wb3NpdGlvbi54LHQucG9zaXRpb24ueSx0LnBvc2l0aW9uLnopOwogICAgICBwbGF5ZXJXaGVlbE1lc2hlc1tpXS5xdWF0ZXJuaW9uLnNldCh0LnF1YXRlcm5pb24ueCx0LnF1YXRlcm5pb24ueSx0LnF1YXRlcm5pb24ueix0LnF1YXRlcm5pb24udyk7CiAgICAgIGlmIChpPj0yKSByZWFyV2hlZWxQb3NbaS0yXS5zZXQodC5wb3NpdGlvbi54LHQucG9zaXRpb24ueSx0LnBvc2l0aW9uLnopOwogICAgfQogICAgZm9yIChjb25zdCBhaSBvZiBhaUNhcnMpewogICAgICBhaS5tZXNoLnBvc2l0aW9uLmNvcHkoYWkuYm9keS5wb3NpdGlvbik7CiAgICAgIGFpLm1lc2gucXVhdGVybmlvbi5jb3B5KGFpLmJvZHkucXVhdGVybmlvbik7CiAgICAgIGZvciAobGV0IGk9MDtpPGFpLnZlaC53aGVlbEluZm9zLmxlbmd0aDtpKyspewogICAgICAgIGFpLnZlaC51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gYWkudmVoLndoZWVsSW5mb3NbaV0ud29ybGRUcmFuc2Zvcm07CiAgICAgICAgYWkud2hlZWxzW2ldLnBvc2l0aW9uLnNldCh0LnBvc2l0aW9uLngsdC5wb3NpdGlvbi55LHQucG9zaXRpb24ueik7CiAgICAgICAgYWkud2hlZWxzW2ldLnF1YXRlcm5pb24uc2V0KHQucXVhdGVybmlvbi54LHQucXVhdGVybmlvbi55LHQucXVhdGVybmlvbi56LHQucXVhdGVybmlvbi53KTsKICAgICAgfQogICAgfQoKICAgIC8vIEdyb3VuZCBjb250YWN0CiAgICBjb25zdCBvbkdyb3VuZFBsYXllciA9IHBsYXllclZlaGljbGUud2hlZWxJbmZvcy5zb21lKHcgPT4gdy5yYXljYXN0UmVzdWx0ICYmIHcucmF5Y2FzdFJlc3VsdC5oYXNIaXQpOwogICAgZ3JvdW5kZWRQcmV2ID0gb25Hcm91bmRQbGF5ZXI7CgogICAgLy8g4oCU4oCUIFNDT1JJTkcg4oCU4oCUIC8vCiAgICAvLyBEcmlmdCArIHNtb2tlCiAgICB7CiAgICAgIGNvbnN0IGZ3ZCA9IGZvcndhcmRWZWN0b3IoY2hhc3Npc0JvZHkpOyBjb25zdCBzID0gTWF0aC5zcXJ0KHYueCp2Lngrdi56KnYueik7CiAgICAgIGNvbnN0IGRvdFYgPSAodi54KmZ3ZC54ICsgdi56KmZ3ZC56KSAvIChNYXRoLm1heCgwLjAwMSxzKSpNYXRoLnNxcnQoZndkLngqZndkLngrZndkLnoqZndkLnopKTsKICAgICAgY29uc3Qgc2xpcCA9IE1hdGguYWNvcyhNYXRoLm1heCgtMSwgTWF0aC5taW4oMSwgZG90VikpKSAqIDE4MC9NYXRoLlBJOwogICAgICBpZiAob25Hcm91bmRQbGF5ZXIgJiYgcz40ICYmIHNsaXA+MTgpewogICAgICAgIGRyaWZ0VGltZXIgKz0gZHQ7CiAgICAgICAgY29uc3QgZHJpZnRQdHMgPSAoc2xpcC8yMCkgKiAocy82KSAqIDIwICogZHQ7IGFkZFNjb3JlKGRyaWZ0UHRzLCAiRHJpZnQiKTsKICAgICAgICBjb21ibyA9IE1hdGgubWluKDMuMCwgY29tYm8gKyAwLjAxNSk7IHVpLmNvbWJvLnRleHRDb250ZW50ID0gYENvbWJvIHgke2NvbWJvLnRvRml4ZWQoMSl9YDsKICAgICAgICBmb3IgKGNvbnN0IHJwIG9mIHJlYXJXaGVlbFBvcyl7CiAgICAgICAgICBwYXJ0aWNsZXMuc21va2Uuc3Bhd24obmV3IFRIUkVFLlZlY3RvcjMocnAueCxycC55KzAuMDUscnAueiksIG5ldyBUSFJFRS5WZWN0b3IzKChNYXRoLnJhbmRvbSgpLTAuNSkqMC43LDAuNSwoTWF0aC5yYW5kb20oKS0wLjUpKjAuNyksIDAuNDUsIDAuNyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgeyBkcmlmdFRpbWVyID0gMDsgfQogICAgfQoKICAgIC8vIEFpcnRpbWUsIGZsaXBzIChubyBzbG93LW1vKQogICAgaWYgKCFvbkdyb3VuZFBsYXllcil7CiAgICAgIGlmICghYWlyYm9ybmUpeyBhaXJib3JuZT10cnVlOyBhaXJUaW1lPTA7IHJvdEFjY3VtPTA7IGxhc3RRdWF0PWNoYXNzaXNNZXNoLnF1YXRlcm5pb24uY2xvbmUoKTsgfQogICAgICBhaXJUaW1lICs9IGR0OwogICAgICBjb25zdCBkcT1sYXN0UXVhdC5jbG9uZSgpLmludmVydCgpLm11bHRpcGx5KGNoYXNzaXNNZXNoLnF1YXRlcm5pb24uY2xvbmUoKSk7CiAgICAgIGNvbnN0IGFuZ2xlPTIqTWF0aC5hY29zKE1hdGgubWF4KC0xLE1hdGgubWluKDEsZHEudykpKTsKICAgICAgcm90QWNjdW0gKz0gYW5nbGU7IGxhc3RRdWF0LmNvcHkoY2hhc3Npc01lc2gucXVhdGVybmlvbik7CiAgICAgIHVpLmFpci50ZXh0Q29udGVudCA9IGFpclRpbWUudG9GaXhlZCgxKSsicyI7CiAgICB9IGVsc2UgaWYgKGFpcmJvcm5lKXsKICAgICAgY29uc3QgZmxpcHMgPSBNYXRoLmZsb29yKHJvdEFjY3VtLygyKk1hdGguUEkpKTsKICAgICAgbGV0IHB0cyA9IE1hdGgucm91bmQoYWlyVGltZSAqIDI2MCk7CiAgICAgIGlmIChmbGlwcz4wKXsgcHRzICs9IGZsaXBzICogMTIwMDsgZmxhc2goYEZsaXAgeCR7ZmxpcHN9IWApOyBhdWRpby5ibGlwKDUyMCwuMTIsLjI1KTsgfQogICAgICBhZGRTY29yZShwdHMsICJBaXJ0aW1lIik7CiAgICAgIGlmIChhaXJUaW1lID4gMC42KSB7IGNvbWJvID0gTWF0aC5taW4oMy4wLCBjb21ibyArIDAuMiooMStmbGlwcykpOyB9CiAgICAgIHVpLmNvbWJvLnRleHRDb250ZW50ID0gYENvbWJvIHgke2NvbWJvLnRvRml4ZWQoMSl9YDsKICAgICAgYWlyYm9ybmU9ZmFsc2U7IGFpclRpbWU9MDsgdWkuYWlyLnRleHRDb250ZW50PSIwLjBzIjsKICAgIH0gZWxzZSB7CiAgICAgIGNvbWJvID0gTWF0aC5tYXgoMS4wLCBjb21ibyAtIDAuMTIqZHRSZWFsKTsKICAgICAgdWkuY29tYm8udGV4dENvbnRlbnQgPSBgQ29tYm8geCR7Y29tYm8udG9GaXhlZCgxKX1gOwogICAgfQoKICAgIC8vIOKAlOKAlCBCb29zdCBwYWRzIOKAlOKAlCAvLwogICAgdXBkYXRlQm9vc3RQYWRzKGR0UmVhbCk7CgogICAgLy8g4oCU4oCUIFBpY2t1cHMgLyBPcmJzICYgSGVhdCDigJTigJQgLy8KICAgIHNwaW5QaWNrdXBzKGR0UmVhbCk7IGNoZWNrUGlja3VwcygpOyBjaGVja09yYnMoKTsgdXBkYXRlSGVhdChkdFJlYWwpOwoKICAgIC8vIFBvd2VyIGJhZGdlCiAgICBzaGllbGRUID0gTWF0aC5tYXgoMCwgc2hpZWxkVCAtIGR0UmVhbCk7CiAgICBzaGllbGRNZXNoLnZpc2libGUgPSBzaGllbGRUID4gMDsKICAgIGNvbnN0IHB0eHQgPSBbXTsKICAgIGlmICh0dXJib1Q+MCkgcHR4dC5wdXNoKGBUdXJibyAke3R1cmJvVC50b0ZpeGVkKDEpfXNgKTsKICAgIGlmIChzaGllbGRUPjApIHB0eHQucHVzaChgU2hpZWxkICR7c2hpZWxkVC50b0ZpeGVkKDEpfXNgKTsKICAgIHVpLnBvd2VyQmFkZ2UudGV4dENvbnRlbnQgPSBwdHh0Lmxlbmd0aCA/IHB0eHQuam9pbigiIOKAoiAiKSA6ICLigJQiOwoKICAgIC8vIFBhcnRpY2xlcyB1cGRhdGUKICAgIHBhcnRpY2xlcy5zbW9rZS51cGRhdGUoZHRSZWFsKTsKICAgIHBhcnRpY2xlcy5mbGFtZS51cGRhdGUoZHRSZWFsKTsKICAgIHBhcnRpY2xlcy5yaW5nLnVwZGF0ZShkdFJlYWwpOwoKICAgIC8vIEhVRCAmIGF1ZGlvCiAgICBjb25zdCBtcGggPSBNYXRoLnNxcnQodi54KnYueCt2Lnoqdi56KSAqIDIuMjM3OyB1aS5zcGVlZC50ZXh0Q29udGVudCA9IE1hdGgucm91bmQobXBoKTsKICAgIHVpLmdyYWRlLnN0eWxlLm9wYWNpdHkgPSBNYXRoLm1pbigwLjQ1LCAwLjEwICsgaGVhdCowLjA2ICsgbXBoKjAuMDAxMik7CiAgICBhdWRpby5lbmdpbmUobXBoLzE0MCwgMC4xMCArIChrZXlzWyJ3Il18fGtleXNbImFycm93dXAiXSA/IDAuMTIgOiAwKSk7CgogICAgLy8gVGFnIC8gc2hpZWxkIGtub2NrYmFjawogICAgaWYgKGJvdHNFbmFibGVkKXsKICAgICAgZm9yIChjb25zdCBhaSBvZiBhaUNhcnMpewogICAgICAgIGNvbnN0IGR4ID0gYWkuYm9keS5wb3NpdGlvbi54IC0gY2hhc3Npc0JvZHkucG9zaXRpb24ueDsKICAgICAgICBjb25zdCBkeiA9IGFpLmJvZHkucG9zaXRpb24ueiAtIGNoYXNzaXNCb2R5LnBvc2l0aW9uLno7CiAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguaHlwb3QoZHgsZHopOwogICAgICAgIGlmIChkaXN0IDwgQ0FUQ0hfUkFESVVTKXsKICAgICAgICAgIGlmIChzaGllbGRUPjApewogICAgICAgICAgICBjb25zdCBkaXIgPSBuZXcgQ0FOTk9OLlZlYzMoZHgvZGlzdCwgMCwgZHovZGlzdCk7CiAgICAgICAgICAgIGFpLmJvZHkuYXBwbHlJbXB1bHNlKG5ldyBDQU5OT04uVmVjMyhkaXIueCogLTEyLCA0LCBkaXIueiogLTEyKSwgYWkuYm9keS5wb3NpdGlvbik7CiAgICAgICAgICAgIGFkZFNjb3JlKDEyMCwgIlNoaWVsZCBidW1wIik7IGNhbVNoYWtlID0gTWF0aC5taW4oMC41LCBjYW1TaGFrZSswLjIpOwogICAgICAgICAgfSBlbHNlIHsgcmVzZXRSb3VuZCgiVGFnZ2VkISIpOyBicmVhazsgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIC8vIENhbWVyYQogICAgdXBkYXRlQ2FtZXJhKGR0UmVhbCwgbXBoKTsKCiAgICBjYW1TaGFrZSA9IE1hdGgubWF4KDAsIGNhbVNoYWtlIC0gZHRSZWFsKjAuOCk7CiAgfQoKICAvKiA9PT09PT09IEJvb3N0IHBhZHMgbG9naWMgPT09PT09PSAqLwogIGZ1bmN0aW9uIHVwZGF0ZUJvb3N0UGFkcyhkdCl7CiAgICBmb3IgKGNvbnN0IHBhZCBvZiBib29zdHMpeyBwYWQuY29vbCA9IE1hdGgubWF4KDAsIHBhZC5jb29sIC0gZHQpOyB9CiAgICBmb3IgKGNvbnN0IHBhZCBvZiBib29zdHMpewogICAgICBpZiAocGFkLmNvb2w+MCkgY29udGludWU7CiAgICAgIGNvbnN0IGR4ID0gY2hhc3Npc0JvZHkucG9zaXRpb24ueCAtIHBhZC5wb3MueDsKICAgICAgY29uc3QgZHogPSBjaGFzc2lzQm9keS5wb3NpdGlvbi56IC0gcGFkLnBvcy56OwogICAgICBjb25zdCBjID0gTWF0aC5jb3MoLXBhZC5yb3RZKSwgcyA9IE1hdGguc2luKC1wYWQucm90WSk7CiAgICAgIGNvbnN0IGx4ID0gZHgqYyAtIGR6KnMsIGx6ID0gZHgqcyArIGR6KmM7CiAgICAgIGlmIChNYXRoLmFicyhseCkgPD0gcGFkLnNpemUueC8yICYmIE1hdGguYWJzKGx6KSA8PSBwYWQuc2l6ZS55LzIpewogICAgICAgIC8vIEJsZW5kIHBsYXllcidzIGZhY2luZyB3aXRoIHBhZCdzIGZhY2luZwogICAgICAgIGNvbnN0IHBsYXllckYgPSBmb3J3YXJkVmVjdG9yKGNoYXNzaXNCb2R5KTsKICAgICAgICBjb25zdCBwYWRGID0geyB4OiBNYXRoLnNpbihwYWQucm90WSksIHo6IE1hdGguY29zKHBhZC5yb3RZKSB9OwogICAgICAgIGNvbnN0IGJ4ID0gcGxheWVyRi54KjAuNiArIHBhZEYueCowLjQsIGJ6ID0gcGxheWVyRi56KjAuNiArIHBhZEYueiowLjQ7CiAgICAgICAgY29uc3QgbGVuID0gTWF0aC5oeXBvdChieCxieil8fDE7CiAgICAgICAgY29uc3QgZGlyID0geyB4OiBieC9sZW4sIHo6IGJ6L2xlbiB9OwoKICAgICAgICAvLyBTdHJvbmcgZm9yd2FyZCBraWNrLCBnZW50bGUgbGlmdCAobm8gd2hlZWxpZXMpCiAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKG5ldyBDQU5OT04uVmVjMyhkaXIueCoyMiwgMS4yLCBkaXIueioyMiksIGNoYXNzaXNCb2R5LnBvc2l0aW9uKTsKICAgICAgICBuaXRybyA9IE1hdGgubWluKDEsIG5pdHJvICsgMC43NSk7CiAgICAgICAgdHVyYm9UID0gTWF0aC5tYXgodHVyYm9ULCAxLjgpOwogICAgICAgIHB1c2hSaW5nKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCAyLjgpOwogICAgICAgIHBhcnRpY2xlcy5mbGFtZS5zcGF3bihuZXcgVEhSRUUuVmVjdG9yMyhjaGFzc2lzQm9keS5wb3NpdGlvbi54IC0gZGlyLngqMiwgMS4wLCBjaGFzc2lzQm9keS5wb3NpdGlvbi56IC0gZGlyLnoqMiksIG5ldyBUSFJFRS5WZWN0b3IzKC1kaXIueCo2LDAsLWRpci56KjYpLCAwLjE0LCAxLjApOwogICAgICAgIGFkZFNjb3JlKDQ1MCwgIkJvb3N0IHBhZCIpOwogICAgICAgIGF1ZGlvLmJsaXAoODIwLC4xNCwuMjgpOwogICAgICAgIGNhbVNoYWtlID0gTWF0aC5taW4oMC42LCBjYW1TaGFrZSArIDAuMDgpOwoKICAgICAgICBwYWQuY29vbCA9IDEuMjsKICAgICAgfQogICAgfQogIH0KCiAgLyogPT09PT09PSBBZXJvIC8gU3RhYmlsaXplcnMgPT09PT09PSAqLwogIGZ1bmN0aW9uIGFwcGx5QWVybyhib2R5LCBzcGVlZCwgaz0wLjQpewogICAgY29uc3QgZGYgPSBrICogc3BlZWQqc3BlZWQ7CiAgICBjb25zdCBmd2QgPSBmb3J3YXJkVmVjdG9yKGJvZHkpOwogICAgY29uc3QgcEZyb250ID0gbmV3IENBTk5PTi5WZWMzKGJvZHkucG9zaXRpb24ueCArIGZ3ZC54KjEuNiwgYm9keS5wb3NpdGlvbi55KzAuNCwgYm9keS5wb3NpdGlvbi56ICsgZndkLnoqMS42KTsKICAgIGNvbnN0IHBSZWFyICA9IG5ldyBDQU5OT04uVmVjMyhib2R5LnBvc2l0aW9uLnggLSBmd2QueCoxLjYsIGJvZHkucG9zaXRpb24ueSswLjQsIGJvZHkucG9zaXRpb24ueiAtIGZ3ZC56KjEuNik7CiAgICBjb25zdCBGID0gbmV3IENBTk5PTi5WZWMzKDAsIC1kZiwgMCk7CiAgICBib2R5LmFwcGx5Rm9yY2UoRiwgcEZyb250KTsKICAgIGJvZHkuYXBwbHlGb3JjZShGLCBwUmVhcik7CiAgfQogIGZ1bmN0aW9uIHN0YWJpbGl6ZVBpdGNoKGJvZHksIGs9MjAwMCl7CiAgICBjb25zdCBmd2QgPSBmb3J3YXJkVmVjdG9yKGJvZHkpOwogICAgY29uc3QgcmlnaHQgPSByaWdodFZlY3Rvcihib2R5KTsKICAgIGNvbnN0IHBpdGNoID0gZndkLnk7CiAgICBib2R5LnRvcnF1ZS54ICs9IHJpZ2h0LnggKiAtcGl0Y2ggKiBrOwogICAgYm9keS50b3JxdWUueSArPSByaWdodC55ICogLXBpdGNoICogazsKICAgIGJvZHkudG9ycXVlLnogKz0gcmlnaHQueiAqIC1waXRjaCAqIGs7CiAgICBib2R5LmFuZ3VsYXJWZWxvY2l0eS54ICo9IDAuOTk1OwogICAgYm9keS5hbmd1bGFyVmVsb2NpdHkueSAqPSAwLjk5NzsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnogKj0gMC45OTU7CiAgfQoKICAvKiA9PT09PT09IENhbWVyYSA9PT09PT09ICovCiAgZnVuY3Rpb24gdXBkYXRlQ2FtZXJhKGR0LCBtcGgpewogICAgaWYgKGNhbWVyYU1vZGU9PT0iY2hhc2UiKXsKICAgICAgY29uc3QgbG9va0FoZWFkID0gMC4wMiAqIE1hdGgubWluKDYwLCBtcGgpOwogICAgICBjb25zdCBmb3J3YXJkID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwwLDEpLmFwcGx5UXVhdGVybmlvbihjaGFzc2lzTWVzaC5xdWF0ZXJuaW9uKTsKICAgICAgY29uc3QgdXAgPSBuZXcgVEhSRUUuVmVjdG9yMygwLDEsMCk7CiAgICAgIGNvbnN0IHRhcmdldCA9IGNoYXNzaXNNZXNoLnBvc2l0aW9uLmNsb25lKCkuYWRkKGZvcndhcmQuY2xvbmUoKS5tdWx0aXBseVNjYWxhcihsb29rQWhlYWQpKTsKICAgICAgbGV0IGRlc2lyZWQgPSBjaGFzc2lzTWVzaC5wb3NpdGlvbi5jbG9uZSgpCiAgICAgICAgLmFkZCh1cC5tdWx0aXBseVNjYWxhcigxLjYgKyBNYXRoLm1pbigyLjIsIG1waC82MCkpKQogICAgICAgIC5hZGQoZm9yd2FyZC5tdWx0aXBseVNjYWxhcigtNy4wIC0gTWF0aC5taW4oMy4wLCBtcGgvNDApKSk7CiAgICAgIGlmIChjYW1TaGFrZT4wKXsKICAgICAgICBkZXNpcmVkLmFkZChuZXcgVEhSRUUuVmVjdG9yMygoTWF0aC5yYW5kb20oKS0wLjUpKmNhbVNoYWtlLChNYXRoLnJhbmRvbSgpLTAuNSkqY2FtU2hha2UqMC41LChNYXRoLnJhbmRvbSgpLTAuNSkqY2FtU2hha2UpKTsKICAgICAgfQogICAgICBjb25zdCBsZXJwID0gMSAtIE1hdGgucG93KDAuMDAxLCBkdCk7CiAgICAgIGNhbWVyYS5wb3NpdGlvbi5sZXJwKGRlc2lyZWQsIGxlcnApOyBjYW1lcmEubG9va0F0KHRhcmdldCk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBmd2QgPSBuZXcgVEhSRUUuVmVjdG9yMygwLDAsMSkuYXBwbHlRdWF0ZXJuaW9uKGNoYXNzaXNNZXNoLnF1YXRlcm5pb24pOwogICAgICBjb25zdCByaWdodCA9IG5ldyBUSFJFRS5WZWN0b3IzKCkuY3Jvc3NWZWN0b3JzKG5ldyBUSFJFRS5WZWN0b3IzKDAsMSwwKSwgZndkKS5ub3JtYWxpemUoKTsKICAgICAgY29uc3QgcG9zID0gY2hhc3Npc01lc2gucG9zaXRpb24uY2xvbmUoKS5hZGQocmlnaHQubXVsdGlwbHlTY2FsYXIoMTApKS5hZGQobmV3IFRIUkVFLlZlY3RvcjMoMCw2LDApKS5hZGQoZndkLmNsb25lKCkubXVsdGlwbHlTY2FsYXIoMTApKTsKICAgICAgY2FtZXJhLnBvc2l0aW9uLmxlcnAocG9zLCAwLjE1KTsgY2FtZXJhLmxvb2tBdChjaGFzc2lzTWVzaC5wb3NpdGlvbik7CiAgICB9CiAgfQoKICAvKiA9PT09PT09IFJlc2V0IChIZWF0IGtlcHQpID09PT09PT0gKi8KICBmdW5jdGlvbiByZXNldEFJKGFpKXsKICAgIGFpLmJvZHkucG9zaXRpb24uc2V0KGFpLnNwYXduLngsIDMsIGFpLnNwYXduLnopOwogICAgYWkuYm9keS52ZWxvY2l0eS5zZXQoMCwwLDApOwogICAgYWkuYm9keS5hbmd1bGFyVmVsb2NpdHkuc2V0KDAsMCwwKTsKICAgIGFpLmJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoMCwwLDApOwogICAgYWkuc3R1Y2tUID0gMDsgYWkucGF0aC5sZW5ndGg9MDsgYWkucGF0aElkeD0wOyBhaS5yZXBhdGhUPTAuMjsKICB9CiAgZnVuY3Rpb24gcmVzZXRQbGF5ZXIoKXsKICAgIGNoYXNzaXNCb2R5LnBvc2l0aW9uLnNldCgwLDMsLTE0MCk7CiAgICBjaGFzc2lzQm9keS52ZWxvY2l0eS5zZXQoMCwwLDApOwogICAgY2hhc3Npc0JvZHkuYW5ndWxhclZlbG9jaXR5LnNldCgwLDAsMCk7CiAgICBjaGFzc2lzQm9keS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcigwLDAsMCk7CiAgICBjaGFzc2lzQm9keS53YWtlVXAoKTsKICAgIGNvbWJvID0gTWF0aC5tYXgoMS4wLCBjb21ibyAqIDAuOCk7IHVpLmNvbWJvLnRleHRDb250ZW50ID0gYENvbWJvIHgke2NvbWJvLnRvRml4ZWQoMSl9YDsKICAgIHJlY29uY2lsZUJvdHNUb0hlYXQoKTsKICB9CiAgZnVuY3Rpb24gcmVzZXRSb3VuZChyZWFzb24peyBpZihyZWFzb24peyBmbGFzaChyZWFzb24pOyB9IHJlc2V0UGxheWVyKCk7IGZvciAoY29uc3QgYWkgb2YgYWlDYXJzKSByZXNldEFJKGFpKTsgfQoKICAvKiA9PT09PT09IEJvb3QgPT09PT09PSAqLwogIGluaXRUaHJlZSgpOwogIGluaXRQaHlzaWNzKCk7CiAgYnVpbGRQbGF5ZXIoKTsKICBwYXJ0aWNsZXMuc21va2UgPSBjcmVhdGVTcHJpdGVQb29sKG1ha2VDaXJjbGVUZXh0dXJlKCdyZ2JhKDE2MCwxNzAsMTkwLDAuOSknLCdyZ2JhKDIwLDMwLDUwLDAuMCknKSwgMTUwLCBUSFJFRS5Ob3JtYWxCbGVuZGluZyk7CiAgcGFydGljbGVzLmZsYW1lID0gY3JlYXRlU3ByaXRlUG9vbChtYWtlQ2lyY2xlVGV4dHVyZSgncmdiYSgyNTUsMjAwLDkwLDAuOTUpJywncmdiYSgyNTUsODAsMCwwLjApJyksIDcwLCBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nKTsKICBwYXJ0aWNsZXMucmluZyAgPSBjcmVhdGVTcHJpdGVQb29sKG1ha2VDaXJjbGVUZXh0dXJlKCdyZ2JhKDI1NSwxNjAsNjAsMC45KScsJ3JnYmEoMjU1LDgwLDAsMC4wKScpLCAxNiwgVEhSRUUuQWRkaXRpdmVCbGVuZGluZyk7CiAgcmVjb25jaWxlQm90c1RvSGVhdCgpOwogIHVpLmJ0bkRpZmYudGV4dENvbnRlbnQgPSAnRGlmZmljdWx0eTogJyArIERJRkZbZGlmZl0ubmFtZTsKICBjbG9jayA9IG5ldyBUSFJFRS5DbG9jaygpOwogIGFuaW1hdGUoKTsKCn0pKCk7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4K";
  const IPAD = "data:text/html;base64,PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLGluaXRpYWwtc2NhbGU9MSxtYXhpbXVtLXNjYWxlPTEsdXNlci1zY2FsYWJsZT1ubyIgLz4KPHRpdGxlPkluZmVybm8gRHJpZnQ8L3RpdGxlPgo8bWV0YSBuYW1lPSJkZXNjcmlwdGlvbiIgY29udGVudD0iSW5mZXJubyBEcmlmdCDigJQgaVBhZC1vcHRpbWl6ZWQgM0Qgc3R1bnQgYXJlbmEgd2l0aCBoZWF0LWJhc2VkIEFJLCBzY29yaW5nLCBmbGlwcywgYm9vc3QgcGFkcywgYW5kIHRvdWNoIGNvbnRyb2xzLiIgLz4KPHN0eWxlPgogIDpyb290ewogICAgLS1pbms6I2U5ZjJmZjsgLS1tdXRlZDojYTZiNWM4OyAtLWJnOiMwYjEyMjA7IC0taHVkOiMwZjFhMmE7IC0tbGluZTojMWYyYTQ0OwogICAgLS1nb29kOiM3YmQ4OGY7IC0td2FybjojZWY0NzZmOyAtLW5pdHJvOiMyYWY1YTQ7IC0tc2hpZWxkOiNiOTg3ZmY7CiAgICAtLXBSYW1wOiM3YWE3ZmY7IC0tcFBsYXQ6I2IwYmFmZjsgLS1wQmFuazojN2VkMWEyOwogIH0KICAqe2JveC1zaXppbmc6Ym9yZGVyLWJveH0KICBodG1sLGJvZHl7aGVpZ2h0OjEwMCV9CiAgYm9keXsKICAgIG1hcmdpbjowOyBiYWNrZ3JvdW5kOiMwYjEyMjA7IGNvbG9yOnZhcigtLWluayk7IGZvbnQtZmFtaWx5OkludGVyLHN5c3RlbS11aSxTZWdvZSBVSSxSb2JvdG8sQXJpYWw7CiAgICAtd2Via2l0LXVzZXItc2VsZWN0Om5vbmU7IHVzZXItc2VsZWN0Om5vbmU7IHRvdWNoLWFjdGlvbjpub25lOyBvdmVyc2Nyb2xsLWJlaGF2aW9yOm5vbmU7CiAgfQogIGNhbnZhc3tkaXNwbGF5OmJsb2NrfQoKICAvKiA9PT0gSFVEIGNhcmRzID09PSAqLwogIC5odWR7cG9zaXRpb246Zml4ZWQ7IGluc2V0OjEwcHggMTBweCBhdXRvIDEwcHg7IGRpc3BsYXk6ZmxleDsgZ2FwOjEwcHg7IGZsZXgtd3JhcDp3cmFwOyB6LWluZGV4OjExOyBtYXgtd2lkdGg6NjJ2d30KICAuY2FyZHtiYWNrZ3JvdW5kOmxpbmVhci1ncmFkaWVudCgxODBkZWcsdmFyKC0taHVkKSwjMGIxNDIyKTsgYm9yZGVyOjFweCBzb2xpZCB2YXIoLS1saW5lKTsgYm9yZGVyLXJhZGl1czoxNHB4OyBwYWRkaW5nOjEwcHggMTJweDsgbWluLXdpZHRoOjEzMHB4fQogIC5jYXJkIGgze21hcmdpbjowIDAgNnB4OyBmb250OjcwMCAxMnB4LzEgSW50ZXIsc3lzdGVtLXVpOyBjb2xvcjp2YXIoLS1tdXRlZCk7IHRleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTsgbGV0dGVyLXNwYWNpbmc6LjNweH0KICAuYmlne2ZvbnQtd2VpZ2h0OjkwMDsgZm9udC1zaXplOjIycHh9CiAgLmNsaWNrYWJsZXtjdXJzb3I6cG9pbnRlcn0KICAuYmFye2hlaWdodDoxMnB4OyBiYWNrZ3JvdW5kOiMwYTE0MjA7IGJvcmRlcjoxcHggc29saWQgdmFyKC0tbGluZSk7IGJvcmRlci1yYWRpdXM6OTk5cHg7IG92ZXJmbG93OmhpZGRlbn0KICAuZmlsbHtoZWlnaHQ6MTAwJTsgYmFja2dyb3VuZDpsaW5lYXItZ3JhZGllbnQoOTBkZWcsI2ZmZDE2NiwjZjVhZDNhKTsgd2lkdGg6MCV9CiAgLmJhZGdle2Rpc3BsYXk6aW5saW5lLWJsb2NrOyBwYWRkaW5nOjNweCA5cHg7IGJvcmRlci1yYWRpdXM6OTk5cHg7IGJhY2tncm91bmQ6IzExMjEzYTsgYm9yZGVyOjFweCBzb2xpZCAjMjEzNTVkOyBmb250LXdlaWdodDo4MDA7IGZvbnQtc2l6ZToxMnB4fQogIC5oZWF0U3RhcnN7bGV0dGVyLXNwYWNpbmc6MXB4OyBjb2xvcjojZmZkMTY2fQogIC5jb29sdHh0e2ZvbnQtd2VpZ2h0OjcwMDsgY29sb3I6I2E2YjVjODsgZm9udC1zaXplOjEycHh9CgogIC8qID09PSBUb3AtcmlnaHQgY29udHJvbHMgPT09ICovCiAgLmNvbnRyb2xzQmFye3Bvc2l0aW9uOmZpeGVkOyB0b3A6MTBweDsgcmlnaHQ6MTBweDsgZGlzcGxheTpmbGV4OyBnYXA6MTBweDsgei1pbmRleDoxMjsgZmxleC13cmFwOndyYXA7IGp1c3RpZnktY29udGVudDpmbGV4LWVuZDsgbWF4LXdpZHRoOjM0dnd9CiAgLmJ0bntiYWNrZ3JvdW5kOiMxMDIwMzc7IGNvbG9yOiNjZmUzZmY7IGJvcmRlcjoxcHggc29saWQgIzJhM2Q2MzsgYm9yZGVyLXJhZGl1czoxMnB4OyBwYWRkaW5nOjlweCAxMnB4OyBmb250LXdlaWdodDo5MDA7IGZvbnQtc2l6ZToxM3B4OyBjdXJzb3I6cG9pbnRlcn0KICAuYnRuOmFjdGl2ZXt0cmFuc2Zvcm06dHJhbnNsYXRlWSgxcHgpfQoKICAvKiA9PT0gTWluaS1tYXAgPT09ICovCiAgI21pbmltYXB7cG9zaXRpb246Zml4ZWQ7IHRvcDoxMHB4OyByaWdodDoxMHB4OyB3aWR0aDoxOTBweDsgaGVpZ2h0OjE5MHB4OyBib3JkZXI6MXB4IHNvbGlkIHZhcigtLWxpbmUpOwogICAgICAgICAgIGJhY2tncm91bmQ6IzBiMTQyMmNjOyBib3JkZXItcmFkaXVzOjEycHg7IHotaW5kZXg6OTsgaW1hZ2UtcmVuZGVyaW5nOnBpeGVsYXRlZDsgcG9pbnRlci1ldmVudHM6bm9uZX0KICAjbWFwbGFiZWx7cG9zaXRpb246Zml4ZWQ7IHRvcDoxNHB4OyByaWdodDoxNnB4OyB6LWluZGV4OjEwOyBmb250OjgwMCAxMnB4LzEgSW50ZXI7IGNvbG9yOiNhNmI1Yzg7IGxldHRlci1zcGFjaW5nOi4zcHg7IHBvaW50ZXItZXZlbnRzOm5vbmV9CgogIC8qID09PSBTY29yZSBmZWVkID09PSAqLwogICNmZWVke3Bvc2l0aW9uOmZpeGVkOyByaWdodDoxMHB4OyBib3R0b206MTBweDsgd2lkdGg6MzAwcHg7IG1heC1oZWlnaHQ6NDR2aDsgb3ZlcmZsb3c6aGlkZGVuOwogICAgICAgIGRpc3BsYXk6ZmxleDsgZmxleC1kaXJlY3Rpb246Y29sdW1uLXJldmVyc2U7IGdhcDo2cHg7IHotaW5kZXg6MTF9CiAgLmZlZWRJdGVte2JhY2tncm91bmQ6IzBjMTUyNmNjOyBib3JkZXI6MXB4IHNvbGlkIHZhcigtLWxpbmUpOyBib3JkZXItcmFkaXVzOjEycHg7IHBhZGRpbmc6OHB4IDEwcHg7IGZvbnQtd2VpZ2h0OjgwMDsKICAgICAgICAgICAgZGlzcGxheTpmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjsgdHJhbnNmb3JtOnRyYW5zbGF0ZVgoMCk7IG9wYWNpdHk6MTsgdHJhbnNpdGlvbjpvcGFjaXR5IC42cywgdHJhbnNmb3JtIC42c30KICAuZmVlZEl0ZW0uZmFkZXtvcGFjaXR5OjA7IHRyYW5zZm9ybTp0cmFuc2xhdGVYKDEwcHgpfQogIC5mZWVkUHRze2NvbG9yOiNmZmQxNjZ9CgogIC8qID09PSBUb2FzdCAmIG92ZXJsYXlzID09PSAqLwogIC50b2FzdHtwb3NpdGlvbjpmaXhlZDsgbGVmdDo1MCU7IHRyYW5zZm9ybTp0cmFuc2xhdGVYKC01MCUpOyB0b3A6MThweDsgYmFja2dyb3VuZDojMGUxYTJjOyBib3JkZXI6MXB4IHNvbGlkIHZhcigtLWxpbmUpOyBib3JkZXItcmFkaXVzOjEycHg7IHBhZGRpbmc6OHB4IDEycHg7IGRpc3BsYXk6bm9uZTsgei1pbmRleDoxMn0KICAuZXJyb3JiYXJ7cG9zaXRpb246Zml4ZWQ7IGxlZnQ6MDsgdG9wOjA7IHBhZGRpbmc6OHB4IDEycHg7IGJhY2tncm91bmQ6IzZiMWExYTsgY29sb3I6I2ZmZjsgZm9udC13ZWlnaHQ6ODAwOyBkaXNwbGF5Om5vbmU7IHotaW5kZXg6MTAwfQogICNzbG93bW97cG9zaXRpb246Zml4ZWQ7IGxlZnQ6NTAlOyB0b3A6NTAlOyB0cmFuc2Zvcm06dHJhbnNsYXRlKC01MCUsLTUwJSk7IGZvbnQ6OTAwIDI2cHgvMSBJbnRlcjsgbGV0dGVyLXNwYWNpbmc6MXB4OwogICAgICAgICAgY29sb3I6I2ZmZDE2NjsgdGV4dC1zaGFkb3c6MCAycHggMTRweCAjMDAwOyBkaXNwbGF5Om5vbmU7IHotaW5kZXg6MjB9CgogIC8qID09PSBIZWF0IHRpbnQgZ3JhZGUgPT09ICovCiAgI2dyYWRle3Bvc2l0aW9uOmZpeGVkOyBpbnNldDowOyBwb2ludGVyLWV2ZW50czpub25lOyB6LWluZGV4OjU7CiAgICAgICAgIGJhY2tncm91bmQ6cmFkaWFsLWdyYWRpZW50KGVsbGlwc2UgODAlIDYwJSBhdCA1MCUgNjAlLCByZ2JhKDI1NSwxMjAsNDAsMC4xNiksIHJnYmEoMCwwLDAsMCkgNjAlKTsKICAgICAgICAgb3BhY2l0eTouMTA7IHRyYW5zaXRpb246b3BhY2l0eSAuMjVzIGVhc2V9CgogIC8qID09PSBNb2JpbGUgY29udHJvbHMgKEFMV0FZUyBvbjsgaVBhZC1zaXplZCkgPT09ICovCiAgLm1vYmlsZUN0cmxze3Bvc2l0aW9uOmZpeGVkOyBpbnNldDphdXRvIDAgMCAwOyB6LWluZGV4OjE0OyBwb2ludGVyLWV2ZW50czpub25lfQogIC5zdGVlclBhZHsKICAgIHBvc2l0aW9uOmFic29sdXRlOyBsZWZ0OjEycHg7IGJvdHRvbToxMnB4OyB3aWR0aDoxOTZweDsgaGVpZ2h0OjE5NnB4OyBib3JkZXItcmFkaXVzOjUwJTsKICAgIGJhY2tncm91bmQ6IzBlMWEyY2NjOyBib3JkZXI6MXB4IHNvbGlkICMyYTNiNWE7IGJveC1zaGFkb3c6MCAxMHB4IDIycHggcmdiYSgwLDAsMCwuNCk7CiAgICBwb2ludGVyLWV2ZW50czphdXRvOyB0b3VjaC1hY3Rpb246bm9uZTsKICB9CiAgI3N0ZWVyS25vYnsKICAgIHBvc2l0aW9uOmFic29sdXRlOyBsZWZ0OjUwJTsgdG9wOjUwJTsgd2lkdGg6NjZweDsgaGVpZ2h0OjY2cHg7IHRyYW5zZm9ybTp0cmFuc2xhdGUoLTUwJSwtNTAlKTsKICAgIGJvcmRlci1yYWRpdXM6NTAlOyBiYWNrZ3JvdW5kOiMxNzI2NDI7IGJvcmRlcjozcHggc29saWQgIzNhNWQ5YjsgYm94LXNoYWRvdzowIDZweCAxNnB4IHJnYmEoMCwwLDAsLjQpOwogIH0KICAucmlnaHRCdG5zewogICAgcG9zaXRpb246YWJzb2x1dGU7IHJpZ2h0OjEycHg7IGJvdHRvbToxMnB4OyBkaXNwbGF5OmdyaWQ7IGdhcDoxMHB4OyBwb2ludGVyLWV2ZW50czphdXRvOwogICAgZ3JpZC10ZW1wbGF0ZS1hcmVhczoKICAgICAgIm5pdHJvIGJyYWtlIgogICAgICAiZ2FzICAgZHJpZnQiCiAgICAgICJyb2xsTCByb2xsUiI7CiAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6MTM4cHggMTM4cHg7IGdyaWQtdGVtcGxhdGUtcm93czo3OHB4IDc4cHggNjBweDsKICB9CiAgLm1CdG57CiAgICBiYWNrZ3JvdW5kOiMxMDIwMzc7IGNvbG9yOiNlOWYyZmY7IGJvcmRlcjoxcHggc29saWQgIzJhM2Q2MzsgYm9yZGVyLXJhZGl1czoxNHB4OyBmb250LXdlaWdodDo5MDA7IGZvbnQtc2l6ZToxOHB4OwogICAgYm94LXNoYWRvdzowIDEwcHggMjJweCByZ2JhKDAsMCwwLC40KTsgdG91Y2gtYWN0aW9uOm5vbmU7IHVzZXItc2VsZWN0Om5vbmU7CiAgfQogICNidG5HYXN7IGdyaWQtYXJlYTpnYXM7IGZvbnQtc2l6ZToyMnB4IH0KICAjYnRuRHJpZnR7IGdyaWQtYXJlYTpkcmlmdCB9CiAgI2J0bk5pdHJveyBncmlkLWFyZWE6bml0cm87IGZvbnQtc2l6ZToxOHB4IH0KICAjYnRuQnJha2V7IGdyaWQtYXJlYTpicmFrZTsgZm9udC1zaXplOjE4cHggfQogICNidG5Sb2xsTHsgZ3JpZC1hcmVhOnJvbGxMOyBmb250LXNpemU6MTZweCB9CiAgI2J0blJvbGxSeyBncmlkLWFyZWE6cm9sbFI7IGZvbnQtc2l6ZToxNnB4IH0KCiAgLyogPT09IE9yaWVudGF0aW9uIGhlbHBlciA9PT0gKi8KICAjb3JpZW50e3Bvc2l0aW9uOmZpeGVkOyBpbnNldDowOyBkaXNwbGF5Om5vbmU7IGFsaWduLWl0ZW1zOmNlbnRlcjsganVzdGlmeS1jb250ZW50OmNlbnRlcjsgei1pbmRleDo2MDsKICAgICAgICAgIGJhY2tncm91bmQ6cmdiYSg3LDEwLDE4LDAuODIpOyBjb2xvcjojZTlmMmZmOyB0ZXh0LWFsaWduOmNlbnRlcjsgcGFkZGluZzoyMHB4OyBmb250OjkwMCAxOHB4LzEuNCBJbnRlcn0KCiAgLyogPT09IE1hbnVhbCBvdmVybGF5ID09PSAqLwogICNtYW51YWx7cG9zaXRpb246Zml4ZWQ7IGluc2V0OjA7IHotaW5kZXg6NTA7IGRpc3BsYXk6bm9uZTsgYWxpZ24taXRlbXM6Y2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOyBiYWNrZ3JvdW5kOnJnYmEoNywxMCwxOCwwLjc4KTsgYmFja2Ryb3AtZmlsdGVyOnNhdHVyYXRlKDExMCUpIGJsdXIoNnB4KX0KICAubWFudWFsQm94e3dpZHRoOm1pbig5ODBweCw5MnZ3KTsgbWF4LWhlaWdodDo4MnZoOyBvdmVyZmxvdzphdXRvOyBiYWNrZ3JvdW5kOiMwZTE3MzA7IGJvcmRlcjoxcHggc29saWQgIzJhM2I1YTsgYm9yZGVyLXJhZGl1czoxNnB4OyBwYWRkaW5nOjE4cHggMjBweDsgY29sb3I6I2U5ZjJmZn0KICAubWFudWFsQm94IGgye21hcmdpbjowIDAgMTBweDsgZm9udDo5MDAgMjJweC8xLjIgSW50ZXJ9CiAgLm1hbnVhbEJveCBoM3ttYXJnaW46MTZweCAwIDZweDsgZm9udDo5MDAgMTRweC8xLjEgSW50ZXI7IGNvbG9yOiNhNmI1Yzg7IHRleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTsgbGV0dGVyLXNwYWNpbmc6LjRweH0KICAubWFudWFsQm94IHB7bWFyZ2luOjZweCAwIDhweH0KICAubWFudWFsR3JpZHtkaXNwbGF5OmdyaWQ7IGdyaWQtdGVtcGxhdGUtY29sdW1uczoxZnIgMWZyOyBnYXA6MTBweH0KICAubWFudWFsQm94IHVse21hcmdpbjo2cHggMCAxMHB4IDE4cHh9CiAgLm1hbnVhbEJveCBsaXttYXJnaW46NHB4IDB9CiAgLm1hbnVhbENsb3Nle3Bvc2l0aW9uOnN0aWNreTsgdG9wOjA7IGRpc3BsYXk6ZmxleDsganVzdGlmeS1jb250ZW50OmZsZXgtZW5kOyBtYXJnaW46LTEwcHggLTEwcHggMTBweCAwfQogIC54YnRue2JhY2tncm91bmQ6IzE1MjQ0NDsgY29sb3I6I2NmZTNmZjsgYm9yZGVyOjFweCBzb2xpZCAjMjk0MDZiOyBib3JkZXItcmFkaXVzOjEwcHg7IHBhZGRpbmc6NnB4IDEwcHg7IGN1cnNvcjpwb2ludGVyOyBmb250LXdlaWdodDo5MDB9CgogIC8qID09PSBOYXJyb3cgcGhvbmVzIChzdGlsbCB3b3JrcykgPT09ICovCiAgQG1lZGlhIChtYXgtd2lkdGg6IDcyMHB4KXsKICAgIC5odWR7bWF4LXdpZHRoOjU2dnd9CiAgICAjbWluaW1hcHt3aWR0aDoxNjBweDsgaGVpZ2h0OjE2MHB4fQogICAgLmNvbnRyb2xzQmFye21heC13aWR0aDozOHZ3fQogIH0KPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KPCEtLSB0b3AtcmlnaHQgY29udHJvbHMgLS0+CjxkaXYgY2xhc3M9ImNvbnRyb2xzQmFyIj4KICA8YnV0dG9uIGlkPSJidG5Cb3RzIiBjbGFzcz0iYnRuIj5Cb3RzOiBPTjwvYnV0dG9uPgogIDxidXR0b24gaWQ9ImJ0bkRpZmYiIGNsYXNzPSJidG4iPkRpZmZpY3VsdHk6IE5vcm1hbDwvYnV0dG9uPgogIDxidXR0b24gaWQ9ImJ0bk1hcCIgIGNsYXNzPSJidG4iPk1hcDogU3R1bnQgQXJlbmE8L2J1dHRvbj4KICA8YnV0dG9uIGlkPSJidG5IZWxwIiBjbGFzcz0iYnRuIj5Ib3cgdG8gUGxheTwvYnV0dG9uPgo8L2Rpdj4KCjxkaXYgY2xhc3M9Imh1ZCI+CiAgPGRpdiBjbGFzcz0iY2FyZCI+PGgzPlNjb3JlICh0YXAgdG8gc2hhcmUpPC9oMz48ZGl2IGNsYXNzPSJiaWcgY2xpY2thYmxlIiBpZD0ic2NvcmUiPjA8L2Rpdj48ZGl2IGlkPSJjb21ibyIgc3R5bGU9ImZvbnQtd2VpZ2h0OjgwMDtmb250LXNpemU6MTNweDtjb2xvcjojY2ZlM2ZmIj5Db21ibyB4MS4wPC9kaXY+PC9kaXY+CiAgPGRpdiBjbGFzcz0iY2FyZCI+PGgzPlNwZWVkPC9oMz48ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGdhcDo2cHg7IGFsaWduLWl0ZW1zOmJhc2VsaW5lIj48c3BhbiBjbGFzcz0iYmlnIiBpZD0ic3BlZWQiPjA8L3NwYW4+PHNwYW4gc3R5bGU9ImNvbG9yOiNhNmI1Yzg7Zm9udC1zaXplOjEycHgiPm1waDwvc3Bhbj48L2Rpdj48L2Rpdj4KICA8ZGl2IGNsYXNzPSJjYXJkIj48aDM+Tml0cm88L2gzPjxkaXYgY2xhc3M9ImJhciIgc3R5bGU9IndpZHRoOjE3MHB4Ij48ZGl2IGlkPSJuaXRyb0ZpbGwiIGNsYXNzPSJmaWxsIj48L2Rpdj48L2Rpdj48L2Rpdj4KICA8ZGl2IGNsYXNzPSJjYXJkIj48aDM+QWlydGltZTwvaDM+PGRpdiBjbGFzcz0iYmlnIiBpZD0iYWlyIj4wLjBzPC9kaXY+PC9kaXY+CiAgPGRpdiBjbGFzcz0iY2FyZCI+PGgzPkhlYXQ8L2gzPgogICAgPGRpdiBjbGFzcz0iYmlnIj48c3BhbiBpZD0iaGVhdFN0YXJzIiBjbGFzcz0iaGVhdFN0YXJzIj7imIbimIbimIbimIbimIY8L3NwYW4+PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJiYWRnZSIgaWQ9ImhlYXRCYWRnZSI+Q2FsbTwvZGl2PgogICAgPGRpdiBjbGFzcz0iY29vbHR4dCIgaWQ9ImNvb2xUeHQiPjwvZGl2PgogIDwvZGl2PgogIDxkaXYgY2xhc3M9ImNhcmQiPjxoMz5Qb3dlcjwvaDM+PGRpdiBpZD0icG93ZXJCYWRnZSIgY2xhc3M9ImJhZGdlIj7igJQ8L2Rpdj48L2Rpdj4KPC9kaXY+Cgo8Y2FudmFzIGlkPSJtaW5pbWFwIiB3aWR0aD0iMTkwIiBoZWlnaHQ9IjE5MCI+PC9jYW52YXM+CjxkaXYgaWQ9Im1hcGxhYmVsIj5NYXA6IFN0dW50IEFyZW5hPC9kaXY+Cgo8ZGl2IGlkPSJmZWVkIj48L2Rpdj4KCjwhLS0gTW9iaWxlIGNvbnRyb2xzIG92ZXJsYXkgKGFsd2F5cyB2aXNpYmxlKSAtLT4KPGRpdiBjbGFzcz0ibW9iaWxlQ3RybHMiIGlkPSJtb2JpbGVDdHJscyI+CiAgPGRpdiBjbGFzcz0ic3RlZXJQYWQiIGlkPSJzdGVlclBhZCI+PGRpdiBpZD0ic3RlZXJLbm9iIj48L2Rpdj48L2Rpdj4KICA8ZGl2IGNsYXNzPSJyaWdodEJ0bnMiPgogICAgPGJ1dHRvbiBpZD0iYnRuTml0cm8iIGNsYXNzPSJtQnRuIj5OaXRybzwvYnV0dG9uPgogICAgPGJ1dHRvbiBpZD0iYnRuQnJha2UiIGNsYXNzPSJtQnRuIj5CcmFrZTwvYnV0dG9uPgogICAgPGJ1dHRvbiBpZD0iYnRuR2FzIiBjbGFzcz0ibUJ0biI+R2FzPC9idXR0b24+CiAgICA8YnV0dG9uIGlkPSJidG5EcmlmdCIgY2xhc3M9Im1CdG4iPkRyaWZ0PC9idXR0b24+CiAgICA8YnV0dG9uIGlkPSJidG5Sb2xsTCIgY2xhc3M9Im1CdG4iPlJvbGwg4peAPC9idXR0b24+CiAgICA8YnV0dG9uIGlkPSJidG5Sb2xsUiIgY2xhc3M9Im1CdG4iPlJvbGwg4pa2PC9idXR0b24+CiAgPC9kaXY+CjwvZGl2PgoKPGRpdiBpZD0iZ3JhZGUiPjwvZGl2Pgo8ZGl2IGNsYXNzPSJ0b2FzdCIgaWQ9InRvYXN0Ij5OaWNlITwvZGl2Pgo8ZGl2IGlkPSJzbG93bW8iPlNMT1ctTU8hPC9kaXY+CjxkaXYgaWQ9ImVyciIgY2xhc3M9ImVycm9yYmFyIj48L2Rpdj4KPGRpdiBpZD0ib3JpZW50Ij5Sb3RhdGUgeW91ciBkZXZpY2UgdG8gPGI+bGFuZHNjYXBlPC9iPiBmb3IgdGhlIGJlc3QgZHJpdmluZyBleHBlcmllbmNlLjwvZGl2PgoKPCEtLSBNYW51YWwgKEV4cGFuZGVkIGZvciBpUGFkKSAtLT4KPGRpdiBpZD0ibWFudWFsIj4KICA8ZGl2IGNsYXNzPSJtYW51YWxCb3giPgogICAgPGRpdiBjbGFzcz0ibWFudWFsQ2xvc2UiPjxidXR0b24gaWQ9Im1hbnVhbENsb3NlIiBjbGFzcz0ieGJ0biI+Q2xvc2Ug4pyVPC9idXR0b24+PC9kaXY+CiAgICA8aDI+SW5mZXJubyBEcmlmdCDigJQgQ29tcGxldGUgSG934oCRVG88L2gyPgogICAgPGRpdiBjbGFzcz0ibWFudWFsR3JpZCI+CiAgICAgIDxkaXY+CiAgICAgICAgPGgzPlF1aWNrIFN0YXJ0PC9oMz4KICAgICAgICA8b2wgc3R5bGU9Im1hcmdpbjo2cHggMCAxMHB4IDE4cHgiPgogICAgICAgICAgPGxpPkhvbGQgPGI+R2FzPC9iPiwgc3RlZXIgd2l0aCB0aGUgYmlnIDxiPmxlZnQgY2lyY2xlPC9iPi48L2xpPgogICAgICAgICAgPGxpPkhvbGQgPGI+RHJpZnQ8L2I+IHdoaWxlIHN0ZWVyaW5nIHRvIHNsaWRlOyByZWxlYXNlIHRvIGdyaXAgdXAuPC9saT4KICAgICAgICAgIDxsaT5IaXQgPGI+Qm9vc3QgUGFkczwvYj4gKG5lb24gZ3JlZW4pIGZvciBhIGxhdW5jaCwgbml0cm8gcmVmaWxsLCBhbmQgdHVyYm8uPC9saT4KICAgICAgICAgIDxsaT5Vc2UgPGI+Tml0cm88L2I+IG9uIHN0cmFpZ2h0czsgbWlk4oCRYWlyIHRhcCA8Yj5Sb2xsIOKXgC/ilrY8L2I+IGZvciBmbGlwcy48L2xpPgogICAgICAgICAgPGxpPkRvbuKAmXQgZ2V0IHRhZ2dlZC4gSWYgdGFnZ2VkLCB5b3UgPGI+cmVzcGF3bjwvYj4gYnV0IDxiPkhlYXQgc3RheXM8L2I+LjwvbGk+CiAgICAgICAgPC9vbD4KCiAgICAgICAgPGgzPk9iamVjdGl2ZTwvaDM+CiAgICAgICAgPHA+U3RhY2sgcG9pbnRzIGJ5IGNoYWluaW5nIDxiPmRyaWZ0czwvYj4sIDxiPmFpcnRpbWU8L2I+LCA8Yj5mbGlwczwvYj4sIGFuZCA8Yj5ib29zdHM8L2I+LiBLZWVwIHRoZSA8Yj5jb21ibzwvYj4gYWxpdmUgYW5kIGJ1aWxkIDxiPkhlYXQ8L2I+IHRvIG11bHRpcGx5IGV2ZXJ5dGhpbmcuPC9wPgoKICAgICAgICA8aDM+Q29udHJvbHM8L2gzPgogICAgICAgIDx1bD4KICAgICAgICAgIDxsaT48Yj5TdGVlcjo8L2I+IGRyYWcgb24gdGhlIGxlZnQgcGFkIChsZWZ0PWxlZnQsIHJpZ2h0PXJpZ2h0KS48L2xpPgogICAgICAgICAgPGxpPjxiPkdhcyAvIEJyYWtlIC8gRHJpZnQgLyBOaXRybzo8L2I+IGJpZyBidXR0b25zIG9uIHRoZSByaWdodC48L2xpPgogICAgICAgICAgPGxpPjxiPkJhcnJlbCByb2xsOjwvYj4gaG9sZCBSb2xsIOKXgC/ilrYgd2hpbGUgYWlyYm9ybmUuPC9saT4KICAgICAgICAgIDxsaT48Yj5SZXNldDo8L2I+IHRocmVl4oCRZmluZ2VyIHRhcC4gPGI+Q2FtZXJhOjwvYj4gdHdv4oCRZmluZ2VyIHRhcCAoY2hhc2Uvb3JiaXQpLjwvbGk+CiAgICAgICAgPC91bD4KCiAgICAgICAgPGgzPk1hcHM8L2gzPgogICAgICAgIDx1bD4KICAgICAgICAgIDxsaT48Yj5TdHVudCBBcmVuYTwvYj46IHJhbXBzLCBicmlkZ2VzLCBob29wcywgYmFua3MuPC9saT4KICAgICAgICAgIDxsaT48Yj5BbGzigJFUZXJyYWluIER1bmVzPC9iPjogZmxvd2luZyBiYW5rcyBhbmQgbG9uZyBib29zdOKAkWxpbmVzLjwvbGk+CiAgICAgICAgICA8bGk+U3dpdGNoIHZpYSA8Yj5NYXA8L2I+IGJ1dHRvbiAodG9w4oCRcmlnaHQpLiBTd2l0Y2hpbmcgYWxzbyByZXNwYXducyB5b3UgYXQgdGhhdCBtYXDigJlzIHN0YXJ0LjwvbGk+CiAgICAgICAgPC91bD4KICAgICAgPC9kaXY+CiAgICAgIDxkaXY+CiAgICAgICAgPGgzPlNjb3JpbmcgJiBIZWF0PC9oMz4KICAgICAgICA8dWw+CiAgICAgICAgICA8bGk+PGI+RHJpZnQ6PC9iPiBwb2ludHMgcGVyIHNlY29uZCBncm93IHdpdGggc2xpZGUgYW5nbGUgKyBzcGVlZC48L2xpPgogICAgICAgICAgPGxpPjxiPkFpcnRpbWU6PC9iPiB+MjYwIHB0cy9zZWM7IGNsZWFuIGxhbmRpbmdzIGtlZXAgY29tYm8gYWxpdmUuPC9saT4KICAgICAgICAgIDxsaT48Yj5GbGlwczo8L2I+IGVhY2ggZnVsbCByb2xsIGFkZHMgYSBiaWcgYm9udXMuPC9saT4KICAgICAgICAgIDxsaT48Yj5Db21ibzo8L2I+IG11bHRpcGxpZXMgYWxsIHBvaW50czsgZGVjYXkgd2hlbiBjb2FzdGluZyB0b28gbG9uZy48L2xpPgogICAgICAgICAgPGxpPjxiPkhlYXQgKOKYheKYheKYheKYheKYhSA9IEluZmVybm8pOjwvYj4gcmFpc2VzIHNjb3JlIG11bHRpcGxpZXIgYW5kIG1ha2VzIGJvdHMgZmFzdGVyL3NtYXJ0ZXIuIEhlYXQgPGI+cGVyc2lzdHM8L2I+IGFmdGVyIHJlc2V0cy90YWdzLjwvbGk+CiAgICAgICAgPC91bD4KCiAgICAgICAgPGgzPkJvdHMgJiBEaWZmaWN1bHR5PC9oMz4KICAgICAgICA8dWw+CiAgICAgICAgICA8bGk+PGI+Qm90czo8L2I+IHRvZ2dsZSBPTi9PRkY7IHRoZXkgbm93IGJsZW5kIG5hduKAkWdyYXBoIHJvdXRpbmcgd2l0aCA8Yj5wcmVkaWN0aXZlIGludGVyY2VwdHM8L2I+IHRvIGN1dCB5b3Ugb2ZmLjwvbGk+CiAgICAgICAgICA8bGk+PGI+RGlmZmljdWx0eTo8L2I+IEVhc3kgLyBOb3JtYWwgLyBIYXJkIGFkanVzdHMgYm90IGNvdW50LCBhZ2dyZXNzaW9uLCBhbmQgcGFjZS48L2xpPgogICAgICAgIDwvdWw+CgogICAgICAgIDxoMz5TaGFyaW5nPC9oMz4KICAgICAgICA8dWw+CiAgICAgICAgICA8bGk+VGFwIHlvdXIgPGI+U2NvcmU8L2I+IHRvIHNoYXJlL2NvcHkgeW91ciBydW4gdGV4dC48L2xpPgogICAgICAgIDwvdWw+CgogICAgICAgIDxoMz5UaXBzPC9oMz4KICAgICAgICA8dWw+CiAgICAgICAgICA8bGk+Q2hhaW4gPGI+ZHJpZnQg4oaSIHBhZCDihpIganVtcCDihpIgZmxpcCDihpIgZHJpZnQ8L2I+IHRvIHB1bXAgSGVhdC48L2xpPgogICAgICAgICAgPGxpPlVzZSBEcmlmdCB0byBmaW5l4oCRYWltIG9uIHJhbXBzOyBsaW5lIHVwIHN0cmFpZ2h0IGZvciBjbGVhbiBsYXVuY2hlcy48L2xpPgogICAgICAgICAgPGxpPkJyZWFrIGJvdCBpbnRlcmNlcHRzIHdpdGggYSBxdWljayBkcmlmdOKAkWZlaW50IGFuZCBzbmFwIGJhY2suPC9saT4KICAgICAgICA8L3VsPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2Pgo8L2Rpdj4KCjwhLS0gTGlicmFyaWVzIC0tPgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly91bnBrZy5jb20vdGhyZWVAMC4xNTkuMC9idWlsZC90aHJlZS5taW4uanMiPjwvc2NyaXB0Pgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9jYW5ub25AMC42LjIvYnVpbGQvY2Fubm9uLm1pbi5qcyI+PC9zY3JpcHQ+Cgo8c2NyaXB0PgooZnVuY3Rpb24oKXsKICBjb25zdCBHQU1FX05BTUUgPSAiSW5mZXJubyBEcmlmdCI7CgogIC8qID09PT09PT0gRXJyb3JzID09PT09PT0gKi8KICBjb25zdCBlcnIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyJyk7CiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZSA9PiB7IGVyci50ZXh0Q29udGVudCA9ICdTY3JpcHQgZXJyb3I6ICcgKyBlLm1lc3NhZ2U7IGVyci5zdHlsZS5kaXNwbGF5PSdibG9jayc7IH0pOwogIGNvbnN0ICQgPSBzID0+IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iocyk7CgogIC8qID09PT09PT0gTW9iaWxlIChpUGFk4oCRZmlyc3QpID09PT09PT0gKi8KICBjb25zdCBpc01vYmlsZSA9IHRydWU7IC8vIGZvcmNlIG1vYmlsZS1vbmx5IGJlaGF2aW9yCiAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdtb2JpbGUnKTsKCiAgLyogPT09PT09PSBDb2xsaXNpb24gZ3JvdXBzID09PT09PT0gKi8KICBjb25zdCBHUk9VUF9HUk9VTkQgPSAxLCBHUk9VUF9TVFVOVCA9IDIsIEdST1VQX1BMQVlFUiA9IDQsIEdST1VQX0FJID0gODsKCiAgLyogPT09PT09PSBHbG9iYWxzID09PT09PT0gKi8KICBjb25zdCBBUkVOQV9IQUxGID0gMzgwLCBDQVRDSF9SQURJVVMgPSA0LjA7CiAgbGV0IHNjZW5lLCBjYW1lcmEsIHJlbmRlcmVyLCBjbG9jazsKICBsZXQgd29ybGQsIHBsYXllclZlaGljbGUsIGNoYXNzaXNCb2R5LCBjaGFzc2lzTWVzaCwgcGxheWVyV2hlZWxNZXNoZXM9W107CiAgbGV0IGNhbWVyYU1vZGUgPSAiY2hhc2UiOwogIGxldCBuaXRybyA9IDEuMCwgbXV0ZWQgPSBmYWxzZSwgZ3JvdW5kZWRQcmV2ID0gdHJ1ZTsKICBsZXQgdGltZVNjYWxlID0gMS4wLCBzbG93bW9UID0gMCwgY2FtU2hha2UgPSAwOwogIGxldCBib3RzRW5hYmxlZCA9IHRydWU7CgogIGNvbnN0IHVpID0gewogICAgc2NvcmU6ICQoIiNzY29yZSIpLCBjb21ibzogJCgiI2NvbWJvIiksIHNwZWVkOiAkKCIjc3BlZWQiKSwgbml0cm9GaWxsOiAkKCIjbml0cm9GaWxsIiksCiAgICBhaXI6ICQoIiNhaXIiKSwgdG9hc3Q6ICQoIiN0b2FzdCIpLCBoZWF0U3RhcnM6ICQoIiNoZWF0U3RhcnMiKSwgaGVhdEJhZGdlOiAkKCIjaGVhdEJhZGdlIiksCiAgICBjb29sVHh0OiAkKCIjY29vbFR4dCIpLCBwb3dlckJhZGdlOiAkKCIjcG93ZXJCYWRnZSIpLCBzbG93bW86ICQoIiNzbG93bW8iKSwgZ3JhZGU6ICQoIiNncmFkZSIpLAogICAgYnRuQm90czogJCgiI2J0bkJvdHMiKSwgYnRuSGVscDogJCgiI2J0bkhlbHAiKSwgYnRuRGlmZjogJCgiI2J0bkRpZmYiKSwgYnRuTWFwOiAkKCIjYnRuTWFwIiksCiAgICBtYW51YWw6ICQoIiNtYW51YWwiKSwgbWFudWFsQ2xvc2U6ICQoIiNtYW51YWxDbG9zZSIpLCBvcmllbnQ6ICQoIiNvcmllbnQiKSwgbWFwTGFiZWw6ICQoIiNtYXBsYWJlbCIpCiAgfTsKCiAgLyogPT09PT09PSBTY29yaW5nID09PT09PT0gKi8KICBsZXQgc2NvcmU9MCwgY29tYm89MS4wOwogIGxldCBhaXJib3JuZT1mYWxzZSwgYWlyVGltZT0wLCByb3RBY2N1bT0wLCBsYXN0UXVhdD1udWxsLCBkcmlmdFRpbWVyPTA7CgogIC8qID09PT09PT0gSGVhdCAvIERpZmZpY3VsdHkgLyBBSSBzY2FsaW5nID09PT09PT0gKi8KICBjb25zdCBCQVNFX0FJID0gMywgTUFYX0hFQVQgPSA1OwogIGxldCBoZWF0ID0gMCwgaGVhdENoYXJnZSA9IDA7CiAgbGV0IHNpbmNlU2NvcmVUID0gMDsgbGV0IGNvb2xUaW1lciA9IDA7CiAgY29uc3QgSEVBVF9DT09MRE9XTl9CQVNFID0gNy4wOwogIGNvbnN0IEhFQVRfQ09PTERPV05fUEVSX1NUQVIgPSAzLjA7CgogIGNvbnN0IERJRkYgPSBbCiAgICB7IG5hbWU6IkVhc3kiLCAgIGJvdHM6KzAsIGJvdENvdW50RGVsdGE6LTEsIHNwZWVkOjAuOSwgIGVuZ2luZTowLjkyLCBzdGVlckJvb3N0Oi0wLjA1LCBncmlwOjAuOTYsIHJlcGxhbk11bDoxLjE1LCBhdm9pZE11bDowLjkgfSwKICAgIHsgbmFtZToiTm9ybWFsIiwgYm90czorMCwgYm90Q291bnREZWx0YTogMCwgc3BlZWQ6MS4wLCAgZW5naW5lOjEuMDAsIHN0ZWVyQm9vc3Q6IDAuMDAsIGdyaXA6MS4wMCwgcmVwbGFuTXVsOjEuMDAsIGF2b2lkTXVsOjEuMCB9LAogICAgeyBuYW1lOiJIYXJkIiwgICBib3RzOiswLCBib3RDb3VudERlbHRhOisxLCBzcGVlZDoxLjE4LCBlbmdpbmU6MS4yMCwgc3RlZXJCb29zdDorMC4wNiwgZ3JpcDoxLjEwLCByZXBsYW5NdWw6MC44MiwgYXZvaWRNdWw6MS4yIH0KICBdOwogIGxldCBkaWZmID0gMTsgLy8gTm9ybWFsCgogIGZ1bmN0aW9uIGhlYXRTY29yZU11bHQoKXsgbGV0IG0gPSAxICsgMC4yNSpoZWF0OyBpZiAoaGVhdCA9PT0gTUFYX0hFQVQpIG0gKz0gMC43NTsgcmV0dXJuIG07IH0KICBmdW5jdGlvbiBoZWF0TmFtZShoKXsgcmV0dXJuIFsiQ2FsbSIsIk5vdGljZWQiLCJDaGFzZWQiLCJIb3QiLCJCbGF6aW5nIiwiSW5mZXJubyJdW2hdIHx8ICJDYWxtIjsgfQogIGZ1bmN0aW9uIHRhcmdldEFJQ291bnQoKXsgY29uc3QgZCA9IERJRkZbZGlmZl07IHJldHVybiBNYXRoLm1heCgwLCBNYXRoLm1pbihCQVNFX0FJICsgaGVhdCArIGQuYm90Q291bnREZWx0YSwgYWlTcGF3bnMubGVuZ3RoKSk7IH0KCiAgLyogPT09PT09PSBXb3JsZCBjb250ZW50ID09PT09PT0gKi8KICBsZXQgZmxvb3JNZXNoLCBmbG9vclRleDsKICBsZXQgYm9vc3RzPVtdLCBob29wcz1bXSwgbWFwU2hhcGVzPVtdOwogIGxldCBwaWNrdXBzPVtdLCBvcmJzPVtdLCBzdE9ianM9W107CiAgY29uc3QgcGFydGljbGVzID0geyBzbW9rZTpudWxsLCBmbGFtZTpudWxsLCByaW5nOm51bGwgfTsKCiAgY29uc3QgZmVlZEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZlZWQnKTsKCiAgLyogPT09PT09PSBOYXZpZ2F0aW9uIChjb2Fyc2Ugcm91dGluZykgPT09PT09PSAqLwogIGNvbnN0IG5hdiA9IHsgbm9kZXM6IFtdLCBlZGdlczogW10gfTsKICBmdW5jdGlvbiBidWlsZE5hdkdyYXBoKCl7CiAgICBuYXYubm9kZXMubGVuZ3RoID0gMDsgbmF2LmVkZ2VzLmxlbmd0aCA9IDA7CiAgICBjb25zdCBvdXRlclIgPSBBUkVOQV9IQUxGIC0gNjA7CiAgICBmb3IgKGxldCBpPTA7aTwxMDtpKyspeyBjb25zdCBhID0gaSpNYXRoLlBJLzU7IG5hdi5ub2Rlcy5wdXNoKHt4Ok1hdGguY29zKGEpKm91dGVyUiwgejpNYXRoLnNpbihhKSpvdXRlclJ9KTsgfQogICAgY29uc3QgbWlkPTIzMCwgaW5uZXI9MTUwOwogICAgWyBbIG1pZCwwXSxbIDAsbWlkXSxbLW1pZCwwXSxbMCwtbWlkXSwgW21pZCxtaWRdLFstbWlkLG1pZF0sWy1taWQsLW1pZF0sW21pZCwtbWlkXSBdLmZvckVhY2gocD0+bmF2Lm5vZGVzLnB1c2goe3g6cFswXSwgejpwWzFdfSkpOwogICAgZm9yKGxldCBpPTA7aTw4O2krKyl7IGNvbnN0IGE9aSpNYXRoLlBJLzQ7IG5hdi5ub2Rlcy5wdXNoKHt4Ok1hdGguY29zKGEpKmlubmVyLCB6Ok1hdGguc2luKGEpKmlubmVyfSk7IH0KCiAgICBmb3IgKGxldCBpPTA7aTxuYXYubm9kZXMubGVuZ3RoO2krKyl7CiAgICAgIGZvciAobGV0IGo9aSsxO2o8bmF2Lm5vZGVzLmxlbmd0aDtqKyspewogICAgICAgIGNvbnN0IGE9bmF2Lm5vZGVzW2ldLCBiPW5hdi5ub2Rlc1tqXTsKICAgICAgICBjb25zdCBkeD1hLngtYi54LCBkej1hLnotYi56LCBkaXN0PU1hdGguaHlwb3QoZHgsZHopOwogICAgICAgIGlmIChkaXN0PDI3MCl7IG5hdi5lZGdlcy5wdXNoKHthOmksYjpqLHc6ZGlzdH0pOyBuYXYuZWRnZXMucHVzaCh7YTpqLGI6aSx3OmRpc3R9KTsgfQogICAgICB9CiAgICB9CiAgfQogIGZ1bmN0aW9uIG5lYXJlc3ROb2RlKHgseil7CiAgICBsZXQgYmVzdD0tMSwgYmQ9MWU5OwogICAgZm9yIChsZXQgaT0wO2k8bmF2Lm5vZGVzLmxlbmd0aDtpKyspeyBjb25zdCBuPW5hdi5ub2Rlc1tpXTsgY29uc3QgZD0obi54LXgpKihuLngteCkrKG4uei16KSoobi56LXopOyBpZihkPGJkKXtiZD1kO2Jlc3Q9aTt9IH0KICAgIHJldHVybiBiZXN0OwogIH0KICBmdW5jdGlvbiBhU3RhcihzdGFydCwgZ29hbCl7CiAgICBpZiAoc3RhcnQ9PT0tMSB8fCBnb2FsPT09LTEpIHJldHVybiBbXTsKICAgIGNvbnN0IG9wZW49W3N0YXJ0XSwgY2FtZT1uZXcgTWFwKCksIGc9bmV3IE1hcChbW3N0YXJ0LDBdXSk7CiAgICBjb25zdCBoPShpKT0+eyBjb25zdCBuPW5hdi5ub2Rlc1tpXSwgZ049bmF2Lm5vZGVzW2dvYWxdOyByZXR1cm4gTWF0aC5oeXBvdChuLngtZ04ueCwgbi56LWdOLnopOyB9OwogICAgY29uc3QgZj0oaSk9PiAoZy5nZXQoaSl8fDFlOSkraChpKTsKICAgIHdoaWxlKG9wZW4ubGVuZ3RoKXsKICAgICAgb3Blbi5zb3J0KChpLGopPT5mKGkpLWYoaikpOwogICAgICBjb25zdCBjdXI9b3Blbi5zaGlmdCgpOwogICAgICBpZiAoY3VyPT09Z29hbCl7IGNvbnN0IHBhdGg9W2N1cl07IGxldCBrPWN1cjsgd2hpbGUoY2FtZS5oYXMoaykpeyBrPWNhbWUuZ2V0KGspOyBwYXRoLnB1c2goayk7IH0gcmV0dXJuIHBhdGgucmV2ZXJzZSgpOyB9CiAgICAgIGZvciAoY29uc3QgZSBvZiBuYXYuZWRnZXMuZmlsdGVyKGU9PmUuYT09PWN1cikpewogICAgICAgIGNvbnN0IGFsdD0oZy5nZXQoY3VyKXx8MWU5KStlLnc7CiAgICAgICAgaWYgKGFsdCA8IChnLmdldChlLmIpfHwxZTkpKXsgY2FtZS5zZXQoZS5iLCBjdXIpOyBnLnNldChlLmIsIGFsdCk7IGlmICghb3Blbi5pbmNsdWRlcyhlLmIpKSBvcGVuLnB1c2goZS5iKTsgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gW107CiAgfQoKICAvKiA9PT09PT09IE1pbmltYXAgPT09PT09PSAqLwogIGNvbnN0IG1hcCA9IHsKICAgIGVsOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibWluaW1hcCIpLAogICAgY3R4OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibWluaW1hcCIpLmdldENvbnRleHQoIjJkIiksCiAgICB3OiAxOTAsIGg6IDE5MCwKICAgIHRvWCh4KXsgcmV0dXJuICggKHggKyBBUkVOQV9IQUxGKSAvIChBUkVOQV9IQUxGKjIpICkgKiB0aGlzLnc7IH0sCiAgICB0b1koeil7IHJldHVybiB0aGlzLmggLSAoICh6ICsgQVJFTkFfSEFMRikgLyAoQVJFTkFfSEFMRioyKSApICogdGhpcy5oOyB9LAogICAgZHJhd0Nhckljb24oeCx6LHlhdyxjb2xvcixoaT1mYWxzZSl7CiAgICAgIGNvbnN0IGN0eD10aGlzLmN0eCwgcHg9dGhpcy50b1goeCksIHB5PXRoaXMudG9ZKHopOwogICAgICBjb25zdCBMPTE2LFc9OTsgY3R4LnNhdmUoKTsgY3R4LnRyYW5zbGF0ZShweCxweSk7IGN0eC5yb3RhdGUoLXlhdyk7CiAgICAgIGN0eC5maWxsU3R5bGU9Y29sb3I7IGN0eC5nbG9iYWxBbHBoYT0uOTU7IGN0eC5maWxsUmVjdCgtTC8yLC1XLzIsTCxXKTsKICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHgubW92ZVRvKEwvMiwwKTsgY3R4LmxpbmVUbyhMLzItNSwtVy8yKTsgY3R4LmxpbmVUbyhMLzItNSxXLzIpOyBjdHguY2xvc2VQYXRoKCk7IGN0eC5maWxsKCk7CiAgICAgIGN0eC5zdHJva2VTdHlsZT0iI2ZmZiI7IGN0eC5nbG9iYWxBbHBoYT0uODsgY3R4LmxpbmVXaWR0aD0xOyBjdHguYmVnaW5QYXRoKCk7IGN0eC5tb3ZlVG8oTC8yKzEsMCk7IGN0eC5saW5lVG8oTC8yKzUsMCk7IGN0eC5zdHJva2UoKTsKICAgICAgaWYoaGkpeyBjdHguZ2xvYmFsQWxwaGE9LjY7IGN0eC5zdHJva2VTdHlsZT0iIzdiZDg4ZiI7IGN0eC5saW5lV2lkdGg9MjsgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKDAsMCwoTCs0KS8yLDAsTWF0aC5QSSoyKTsgY3R4LnN0cm9rZSgpO30KICAgICAgY3R4LnJlc3RvcmUoKTsKICAgIH0sCiAgICBkcmF3KCl7CiAgICAgIGNvbnN0IGN0eD10aGlzLmN0eCwgdz10aGlzLncsIGg9dGhpcy5oOwogICAgICBjdHguY2xlYXJSZWN0KDAsMCx3LGgpOwogICAgICBjdHguZmlsbFN0eWxlPSIjMGMxNTI2IjsgY3R4LmZpbGxSZWN0KDAsMCx3LGgpOwogICAgICBjdHguc3Ryb2tlU3R5bGU9IiMyYTNiNWEiOyBjdHgubGluZVdpZHRoPTI7IGN0eC5zdHJva2VSZWN0KDIsMix3LTQsaC00KTsKICAgICAgY29uc3QgcyA9IHcvKEFSRU5BX0hBTEYqMik7CiAgICAgIGZvcihjb25zdCByIG9mIG1hcFNoYXBlcyl7CiAgICAgICAgY3R4LnNhdmUoKTsgY3R4LnRyYW5zbGF0ZSh0aGlzLnRvWChyLngpLCB0aGlzLnRvWShyLnopKTsgY3R4LnJvdGF0ZSgtci55YXcpOwogICAgICAgIGN0eC5nbG9iYWxBbHBoYT1yLmFscGhhPz8wLjM1OyBjdHguZmlsbFN0eWxlPXIuY29sb3J8fCIjNmE4MmMyIjsKICAgICAgICBjdHguZmlsbFJlY3QoLShyLncqcykvMiwgLShyLmQqcykvMiwgci53KnMsIHIuZCpzKTsgY3R4LnJlc3RvcmUoKTsKICAgICAgfQogICAgICBjdHguZmlsbFN0eWxlID0gIiMyYWY1YTQiOyBmb3IgKGNvbnN0IGIgb2YgYm9vc3RzKXsgY29uc3QgeD10aGlzLnRvWChiLnBvcy54KSwgeT10aGlzLnRvWShiLnBvcy56KTsgY3R4LmZpbGxSZWN0KHgtMyx5LTMsNiw2KTsgfQogICAgICBjdHguZmlsbFN0eWxlID0gIiNmNWFkM2EiOyBmb3IgKGNvbnN0IGgyIG9mIGhvb3BzKXsgY29uc3QgeD10aGlzLnRvWChoMi5wb3MueCksIHk9dGhpcy50b1koaDIucG9zLnopOyBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMoeCx5LDMsMCxNYXRoLlBJKjIpOyBjdHguZmlsbCgpOyB9CiAgICAgIGZvciAoY29uc3QgcCBvZiBwaWNrdXBzKXsKICAgICAgICBjb25zdCB4PXRoaXMudG9YKHAubWVzaC5wb3NpdGlvbi54KSwgeT10aGlzLnRvWShwLm1lc2gucG9zaXRpb24ueik7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IChwLnR5cGU9PT0nbml0cm8nKSA/ICIjMmFmNWE0IiA6ICIjYjk4N2ZmIjsKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBwLm1lc2gudmlzaWJsZSA/IDAuOSA6IDAuMzsgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKHgseSwzLDAsTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgfQogICAgICBjdHguZmlsbFN0eWxlPSIjYWQ3NmZmIjsKICAgICAgZm9yIChjb25zdCBvIG9mIG9yYnMpeyBjb25zdCB4PXRoaXMudG9YKG8ucG9zaXRpb24ueCksIHk9dGhpcy50b1koby5wb3NpdGlvbi56KTsgY3R4LmZpbGxSZWN0KHgtMix5LTIsNCw0KTsgfQogICAgICBjb25zdCBwZiA9IGZvcndhcmRWZWN0b3IoY2hhc3Npc0JvZHkpOwogICAgICB0aGlzLmRyYXdDYXJJY29uKGNoYXNzaXNCb2R5LnBvc2l0aW9uLngsIGNoYXNzaXNCb2R5LnBvc2l0aW9uLnosIE1hdGguYXRhbjIocGYueCxwZi56KSwgIiM3YmQ4OGYiLCB0cnVlKTsKICAgICAgZm9yIChjb25zdCBhaSBvZiBhaUNhcnMpeyBjb25zdCBmPWZvcndhcmRWZWN0b3IoYWkuYm9keSk7IHRoaXMuZHJhd0Nhckljb24oYWkuYm9keS5wb3NpdGlvbi54LCBhaS5ib2R5LnBvc2l0aW9uLnosIE1hdGguYXRhbjIoZi54LGYueiksICIjZWY0NzZmIiwgZmFsc2UpOyB9CiAgICAgIGN0eC5nbG9iYWxBbHBoYT0xOwogICAgfQogIH07CgogIC8qID09PT09PT0gRmVlZCA9PT09PT09ICovCiAgZnVuY3Rpb24gcHVzaEZlZWQobGFiZWwsIHB0cyl7CiAgICBjb25zdCBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBpdGVtLmNsYXNzTmFtZT0nZmVlZEl0ZW0nOwogICAgaXRlbS5pbm5lckhUTUwgPSBgPHNwYW4+JHtsYWJlbH08L3NwYW4+PHNwYW4gY2xhc3M9ImZlZWRQdHMiPiske01hdGgucm91bmQocHRzKX08L3NwYW4+YDsKICAgIGZlZWRFbC5hcHBlbmRDaGlsZChpdGVtKTsKICAgIHNldFRpbWVvdXQoKCk9PiBpdGVtLmNsYXNzTGlzdC5hZGQoJ2ZhZGUnKSwgMTQwMCk7CiAgICBzZXRUaW1lb3V0KCgpPT4gaXRlbS5yZW1vdmUoKSwgMjIwMCk7CiAgfQoKICAvKiA9PT09PT09IFBhcnRpY2xlcyA9PT09PT09ICovCiAgZnVuY3Rpb24gbWFrZUNpcmNsZVRleHR1cmUoaW5uZXIsIG91dGVyKXsKICAgIGNvbnN0IGM9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7IGMud2lkdGg9Yy5oZWlnaHQ9NjQ7CiAgICBjb25zdCBnPWMuZ2V0Q29udGV4dCgnMmQnKTsgY29uc3QgZ3JkPWcuY3JlYXRlUmFkaWFsR3JhZGllbnQoMzIsMzIsMSwzMiwzMiwzMik7CiAgICBncmQuYWRkQ29sb3JTdG9wKDAsIGlubmVyKTsgZ3JkLmFkZENvbG9yU3RvcCgxLCBvdXRlcik7IGcuZmlsbFN0eWxlPWdyZDsgZy5iZWdpblBhdGgoKTsgZy5hcmMoMzIsMzIsMzIsMCxNYXRoLlBJKjIpOyBnLmZpbGwoKTsKICAgIGNvbnN0IHQgPSBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsgdC5uZWVkc1VwZGF0ZT10cnVlOyByZXR1cm4gdDsKICB9CiAgZnVuY3Rpb24gY3JlYXRlU3ByaXRlUG9vbCh0ZXgsIG1heCwgYmxlbmRpbmcpewogICAgY29uc3QgZ3JvdXAgPSBuZXcgVEhSRUUuR3JvdXAoKTsgc2NlbmUgJiYgc2NlbmUuYWRkKGdyb3VwKTsKICAgIGNvbnN0IHBvb2wgPSBbXTsgY29uc3QgYWN0aXZlPVtdOwogICAgZm9yKGxldCBpPTA7aTxtYXg7aSsrKXsKICAgICAgY29uc3QgbSA9IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDp0ZXgsIHRyYW5zcGFyZW50OnRydWUsIGRlcHRoV3JpdGU6ZmFsc2UsIGJsZW5kaW5nIH0pOwogICAgICBjb25zdCBzID0gbmV3IFRIUkVFLlNwcml0ZShtKTsgcy52aXNpYmxlPWZhbHNlOyBzLnVzZXJEYXRhPXtsaWZlOjAsbWF4TGlmZToxLHZlbDpuZXcgVEhSRUUuVmVjdG9yMygpLHNpemUwOjF9OwogICAgICBncm91cC5hZGQocyk7IHBvb2wucHVzaChzKTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIHBvb2wsIGFjdGl2ZSwgZ3JvdXAsCiAgICAgIHNwYXduKHBvcywgdmVsLCBsaWZlLCBzaXplLCBvcGFjaXR5PTEpewogICAgICAgIGNvbnN0IHMgPSBwb29sLnBvcCgpOyBpZighcykgcmV0dXJuOwogICAgICAgIHMucG9zaXRpb24uY29weShwb3MpOyBzLnVzZXJEYXRhLnZlbC5jb3B5KHZlbCk7IHMudXNlckRhdGEubGlmZT1saWZlOyBzLnVzZXJEYXRhLm1heExpZmU9bGlmZTsgcy51c2VyRGF0YS5zaXplMD1zaXplOwogICAgICAgIHMuc2NhbGUuc2V0KHNpemUsc2l6ZSwxKTsgcy5tYXRlcmlhbC5vcGFjaXR5PW9wYWNpdHk7IHMudmlzaWJsZT10cnVlOyBhY3RpdmUucHVzaChzKTsKICAgICAgfSwKICAgICAgdXBkYXRlKGR0KXsKICAgICAgICBmb3IgKGxldCBpPWFjdGl2ZS5sZW5ndGgtMTtpPj0wO2ktLSl7CiAgICAgICAgICBjb25zdCBzPWFjdGl2ZVtpXTsgcy51c2VyRGF0YS5saWZlIC09IGR0OwogICAgICAgICAgaWYgKHMudXNlckRhdGEubGlmZTw9MCl7IHMudmlzaWJsZT1mYWxzZTsgYWN0aXZlLnNwbGljZShpLDEpOyBwb29sLnB1c2gocyk7IGNvbnRpbnVlOyB9CiAgICAgICAgICBzLnBvc2l0aW9uLmFkZFNjYWxlZFZlY3RvcihzLnVzZXJEYXRhLnZlbCwgZHQpOwogICAgICAgICAgcy51c2VyRGF0YS52ZWwubXVsdGlwbHlTY2FsYXIoMC45OCk7CiAgICAgICAgICBjb25zdCBhID0gcy51c2VyRGF0YS5saWZlIC8gcy51c2VyRGF0YS5tYXhMaWZlOwogICAgICAgICAgcy5tYXRlcmlhbC5vcGFjaXR5ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgYSkpOwogICAgICAgICAgY29uc3Qgc2MgPSBzLnVzZXJEYXRhLnNpemUwICogKDEgKyAoMS1hKSowLjYpOyBzLnNjYWxlLnNldChzYyxzYywxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfQoKICAvKiA9PT09PT09IEF1ZGlvID09PT09PT0gKi8KICBjb25zdCBhdWRpbyA9ICgoKSA9PiB7CiAgICBsZXQgY3R4PW51bGwsIG9zYz1udWxsLCBnYWluPW51bGw7CiAgICBjb25zdCBtayA9ICgpID0+IHsgaWYoIWN0eCkgY3R4PW5ldyAod2luZG93LkF1ZGlvQ29udGV4dHx8d2luZG93LndlYmtpdEF1ZGlvQ29udGV4dCkoKTsgfTsKICAgIGNvbnN0IGVuZ2luZSA9IChwPTAsdj0wKT0+eyBpZiAobXV0ZWQpIHJldHVybjsgbWsoKTsgaWYoIW9zYyl7b3NjPWN0eC5jcmVhdGVPc2NpbGxhdG9yKCk7IGdhaW49Y3R4LmNyZWF0ZUdhaW4oKTsgb3NjLnR5cGU9InNhd3Rvb3RoIjsgZ2Fpbi5nYWluLnZhbHVlPTA7IG9zYy5jb25uZWN0KGdhaW4pLmNvbm5lY3QoY3R4LmRlc3RpbmF0aW9uKTsgb3NjLnN0YXJ0KCk7fSBvc2MuZnJlcXVlbmN5LnZhbHVlPTgwKzMwMCpwOyBnYWluLmdhaW4udmFsdWU9TWF0aC5taW4oMC4xOCx2KTsgfTsKICAgIGNvbnN0IGJsaXA9KGY9MjIwLHQ9MC4wOCx2PTAuMik9PnsgaWYgKG11dGVkKSByZXR1cm47IG1rKCk7IGNvbnN0IG89Y3R4LmNyZWF0ZU9zY2lsbGF0b3IoKSwgZz1jdHguY3JlYXRlR2FpbigpOyBvLnR5cGU9InRyaWFuZ2xlIjsgby5mcmVxdWVuY3kudmFsdWU9ZjsgZy5nYWluLnZhbHVlPXY7IG8uY29ubmVjdChnKS5jb25uZWN0KGN0eC5kZXN0aW5hdGlvbik7IG8uc3RhcnQoKTsgby5zdG9wKGN0eC5jdXJyZW50VGltZSArIHQpOyB9OwogICAgcmV0dXJuIHsgZW5naW5lLCBibGlwIH07CiAgfSkoKTsKCiAgLyogPT09PT09PSBUaHJlZSA9PT09PT09ICovCiAgZnVuY3Rpb24gaW5pdFRocmVlKCl7CiAgICBzY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpOwogICAgc2NlbmUuYmFja2dyb3VuZCA9IG5ldyBUSFJFRS5Db2xvcigweDBiMTIyMCk7CiAgICBzY2VuZS5mb2cgPSBuZXcgVEhSRUUuRm9nKDB4MGIxMjIwLCAxMjAsIDYwMCk7CgogICAgY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKDY1LCBpbm5lcldpZHRoL2lubmVySGVpZ2h0LCAwLjEsIDIwMDApOwogICAgY2FtZXJhLnBvc2l0aW9uLnNldCgwLCA1LCAtMTApOwoKICAgIHJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoe2FudGlhbGlhczp0cnVlLCBwb3dlclByZWZlcmVuY2U6ImhpZ2gtcGVyZm9ybWFuY2UifSk7CiAgICByZW5kZXJlci5zZXRTaXplKGlubmVyV2lkdGgsIGlubmVySGVpZ2h0KTsKICAgIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8oTWF0aC5taW4oZGV2aWNlUGl4ZWxSYXRpbywgMS4yNSkpOyAvLyBjYXAgZm9yIG1vYmlsZSBwZXJmCiAgICByZW5kZXJlci5zaGFkb3dNYXAuZW5hYmxlZCA9IGZhbHNlOyAvLyBtb2JpbGU6IG9mZgogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChyZW5kZXJlci5kb21FbGVtZW50KTsKCiAgICBjb25zdCBoZW1pID0gbmV3IFRIUkVFLkhlbWlzcGhlcmVMaWdodCgweGNmZTZmZiwgMHgyMjMzNDQsIDAuOCk7IHNjZW5lLmFkZChoZW1pKTsKICAgIGNvbnN0IHN1biA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KDB4ZmZmZmZmLCAwLjg1KTsgc3VuLnBvc2l0aW9uLnNldCg4MCwxMjAsLTQwKTsKICAgIHN1bi5jYXN0U2hhZG93PWZhbHNlOyBzY2VuZS5hZGQoc3VuKTsKCiAgICBjbG9jayA9IG5ldyBUSFJFRS5DbG9jaygpOwogICAgYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgKCk9PnsgY2FtZXJhLmFzcGVjdD1pbm5lcldpZHRoL2lubmVySGVpZ2h0OyBjYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOyByZW5kZXJlci5zZXRTaXplKGlubmVyV2lkdGgsaW5uZXJIZWlnaHQpOyB1cGRhdGVPcmllbnQoKTsgfSk7CiAgfQoKICAvKiA9PT09PT09IFBoeXNpY3MgJiBXb3JsZCA9PT09PT09ICovCiAgZnVuY3Rpb24gaW5pdFBoeXNpY3MoKXsKICAgIHdvcmxkID0gbmV3IENBTk5PTi5Xb3JsZCgpOyB3b3JsZC5ncmF2aXR5LnNldCgwLC05LjgyLDApOwogICAgd29ybGQuYnJvYWRwaGFzZSA9IG5ldyBDQU5OT04uU0FQQnJvYWRwaGFzZSh3b3JsZCk7CiAgICB3b3JsZC5hbGxvd1NsZWVwID0gZmFsc2U7CiAgICB3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsLmZyaWN0aW9uID0gMC41OwoKICAgIGNvbnN0IGdyb3VuZE1hdCAgPSBuZXcgQ0FOTk9OLk1hdGVyaWFsKCJncm91bmQiKTsKICAgIGNvbnN0IHdoZWVsTWF0ICAgPSBuZXcgQ0FOTk9OLk1hdGVyaWFsKCJ3aGVlbCIpOwogICAgY29uc3QgY2hhc3Npc01hdCA9IG5ldyBDQU5OT04uTWF0ZXJpYWwoImNoYXNzaXMiKTsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChuZXcgQ0FOTk9OLkNvbnRhY3RNYXRlcmlhbChncm91bmRNYXQsIHdoZWVsTWF0LCAgeyBmcmljdGlvbjowLjk1LCByZXN0aXR1dGlvbjowLjAgfSkpOwogICAgd29ybGQuYWRkQ29udGFjdE1hdGVyaWFsKG5ldyBDQU5OT04uQ29udGFjdE1hdGVyaWFsKGdyb3VuZE1hdCwgY2hhc3Npc01hdCx7IGZyaWN0aW9uOjAuMywgcmVzdGl0dXRpb246MC4wIH0pKTsKCiAgICAvLyBncm91bmQKICAgIGNvbnN0IGdyb3VuZCA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6MCwgbWF0ZXJpYWw6IGdyb3VuZE1hdCB9KTsKICAgIGdyb3VuZC5hZGRTaGFwZShuZXcgQ0FOTk9OLlBsYW5lKCkpOwogICAgZ3JvdW5kLnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKC1NYXRoLlBJLzIsIDAsIDApOwogICAgZ3JvdW5kLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gR1JPVVBfR1JPVU5EOwogICAgZ3JvdW5kLmNvbGxpc2lvbkZpbHRlck1hc2sgID0gR1JPVVBfUExBWUVSIHwgR1JPVVBfQUkgfCBHUk9VUF9TVFVOVDsKICAgIHdvcmxkLmFkZEJvZHkoZ3JvdW5kKTsKCiAgICAvLyB2aXN1YWwgZmxvb3IKICAgIGZsb29yVGV4ID0gZ3JpZFRleHR1cmUoKTsgZmxvb3JUZXgud3JhcFMgPSBmbG9vclRleC53cmFwVCA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nOyBmbG9vclRleC5yZXBlYXQuc2V0KDgwLDgwKTsKICAgIGZsb29yTWVzaCA9IG5ldyBUSFJFRS5NZXNoKG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KEFSRU5BX0hBTEYqMi4xLEFSRU5BX0hBTEYqMi4xKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCh7IG1hcDpmbG9vclRleCwgY29sb3I6MHgyNTNhNTcsIHJvdWdobmVzczoxIH0pKTsKICAgIGZsb29yTWVzaC5yb3RhdGlvbi54ID0gLU1hdGguUEkvMjsgZmxvb3JNZXNoLnJlY2VpdmVTaGFkb3cgPSBmYWxzZTsgc2NlbmUuYWRkKGZsb29yTWVzaCk7CgogICAgLy8gd2FsbHMgKGtlcHQgYmV0d2VlbiBtYXBzKQogICAgYWRkQm94U3RhdGljKEFSRU5BX0hBTEYqMi0yMCwgMTIsIDUsIFswLDYsLUFSRU5BX0hBTEZdLCBbMCwwLDBdLCAweDJiM2Y1Yywge2NvbGxpZGVBSTp0cnVlLCBrZWVwOnRydWV9KTsKICAgIGFkZEJveFN0YXRpYyhBUkVOQV9IQUxGKjItMjAsIDEyLCA1LCBbMCw2LCBBUkVOQV9IQUxGXSwgWzAsMCwwXSwgMHgyYjNmNWMsIHtjb2xsaWRlQUk6dHJ1ZSwga2VlcDp0cnVlfSk7CiAgICBhZGRCb3hTdGF0aWMoNSwgMTIsIEFSRU5BX0hBTEYqMi0yMCwgWy1BUkVOQV9IQUxGLDYsMF0sIFswLDAsMF0sIDB4MmIzZjVjLCB7Y29sbGlkZUFJOnRydWUsIGtlZXA6dHJ1ZX0pOwogICAgYWRkQm94U3RhdGljKDUsIDEyLCBBUkVOQV9IQUxGKjItMjAsIFsgQVJFTkFfSEFMRiw2LDBdLCBbMCwwLDBdLCAweDJiM2Y1Yywge2NvbGxpZGVBSTp0cnVlLCBrZWVwOnRydWV9KTsKCiAgICAvLyBpbml0aWFsIG1hcAogICAgc2V0TWFwKDApOwogIH0KCiAgZnVuY3Rpb24gZ3JpZFRleHR1cmUoKXsKICAgIGNvbnN0IGM9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7IGMud2lkdGg9Yy5oZWlnaHQ9MjU2OyBjb25zdCB4PWMuZ2V0Q29udGV4dCgiMmQiKTsKICAgIHguZmlsbFN0eWxlPSIjMGMxNjI2IjsgeC5maWxsUmVjdCgwLDAsMjU2LDI1Nik7CiAgICB4LnN0cm9rZVN0eWxlPSIjMjIzMjRkIjsgeC5saW5lV2lkdGg9MjsKICAgIGZvcihsZXQgaT0wO2k8PTE2O2krKyl7IGNvbnN0IHA9KGkvMTYpKjI1NjsgeC5iZWdpblBhdGgoKTsgeC5tb3ZlVG8ocCwwKTsgeC5saW5lVG8ocCwyNTYpOyB4LnN0cm9rZSgpOyB4LmJlZ2luUGF0aCgpOyB4Lm1vdmVUbygwLHApOyB4LmxpbmVUbygyNTYscCk7IHguc3Ryb2tlKCk7IH0KICAgIHguc3Ryb2tlU3R5bGU9IiMyZTQ0NmIiOyB4LmxpbmVXaWR0aD0zOwogICAgZm9yKGxldCBpPTA7aTw9NDtpKyspeyBjb25zdCBwPShpLzQpKjI1NjsgeC5iZWdpblBhdGgoKTsgeC5tb3ZlVG8ocCwwKTsgeC5saW5lVG8ocCwyNTYpOyB4LnN0cm9rZSgpOyB4LmJlZ2luUGF0aCgpOyB4Lm1vdmVUbygwLHApOyB4LmxpbmVUbygyNTYscCk7IHguc3Ryb2tlKCk7IH0KICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICB9CgogIGZ1bmN0aW9uIGFkZEJveFN0YXRpYyh3LGgsZCxwb3Mscm90PVswLDAsMF0sY29sb3I9MHgyYjNmNWMsb3B0cz17Y29sbGlkZUFJOmZhbHNlLCBrZWVwOmZhbHNlfSl7CiAgICBjb25zdCBib2R5PW5ldyBDQU5OT04uQm9keSh7bWFzczowfSk7IGJvZHkuYWRkU2hhcGUobmV3IENBTk5PTi5Cb3gobmV3IENBTk5PTi5WZWMzKHcvMixoLzIsZC8yKSkpOwogICAgYm9keS5wb3NpdGlvbi5zZXQoLi4ucG9zKTsgYm9keS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlciguLi5yb3QsIlhZWiIpOwogICAgYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IEdST1VQX1NUVU5UOwogICAgYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrICA9IEdST1VQX1BMQVlFUiB8IChvcHRzLmNvbGxpZGVBSSA/IEdST1VQX0FJIDogMCkgfCBHUk9VUF9HUk9VTkQ7CiAgICB3b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgY29uc3QgbWVzaD1uZXcgVEhSRUUuTWVzaChuZXcgVEhSRUUuQm94R2VvbWV0cnkodyxoLGQpLCBuZXcgVEhSRUUuTWVzaFN0YW5kYXJkTWF0ZXJpYWwoeyBjb2xvciwgcm91Z2huZXNzOjAuOSB9KSk7CiAgICBtZXNoLnBvc2l0aW9uLnNldCguLi5wb3MpOyBtZXNoLnJvdGF0aW9uLnNldCguLi5yb3QpOyBtZXNoLnJlY2VpdmVTaGFkb3c9ZmFsc2U7CiAgICBjb25zdCBlZGdlcyA9IG5ldyBUSFJFRS5FZGdlc0dlb21ldHJ5KG1lc2guZ2VvbWV0cnkpOwogICAgY29uc3QgbGluZSA9IG5ldyBUSFJFRS5MaW5lU2VnbWVudHMoZWRnZXMsIG5ldyBUSFJFRS5MaW5lQmFzaWNNYXRlcmlhbCh7IGNvbG9yOjB4NmFjNmZmLCB0cmFuc3BhcmVudDp0cnVlLCBvcGFjaXR5OjAuMjggfSkpOwogICAgbWVzaC5hZGQobGluZSk7CiAgICBzY2VuZS5hZGQobWVzaCk7CiAgICBpZiAoIW9wdHMua2VlcCkgc3RPYmpzLnB1c2goe2JvZHksIG1lc2h9KTsKICAgIHJldHVybiB7Ym9keSwgbWVzaH07CiAgfQoKICBmdW5jdGlvbiBhZGRCb29zdFBhZChzaXplWCxzaXplWixwb3Mscm90PVswLDAsMF0pewogICAgY29uc3QgbT1uZXcgVEhSRUUuTWVzaChuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeShzaXplWCxzaXplWiksIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOjB4MmFmNWE0LCB0cmFuc3BhcmVudDp0cnVlLCBvcGFjaXR5OjAuODggfSkpOwogICAgbS5yb3RhdGlvbi5zZXQoLU1hdGguUEkvMityb3RbMF0sIHJvdFsxXSwgcm90WzJdKTsgbS5wb3NpdGlvbi5zZXQoLi4ucG9zKTsgbS5yZW5kZXJPcmRlcj0yOyBzY2VuZS5hZGQobSk7CiAgICBjb25zdCBwYWQ9eyBtZXNoOm0sIHBvczpuZXcgVEhSRUUuVmVjdG9yMyguLi5wb3MpLCBzaXplOm5ldyBUSFJFRS5WZWN0b3IyKHNpemVYLHNpemVaKSwgcm90WTpyb3RbMV18fDAsIGNvb2w6MCB9OwogICAgYm9vc3RzLnB1c2gocGFkKTsKICB9CiAgZnVuY3Rpb24gYWRkSG9vcChyYWRpdXMsIHRoaWNrbmVzcywgcG9zKXsKICAgIGNvbnN0IGdlbz1uZXcgVEhSRUUuVG9ydXNHZW9tZXRyeShyYWRpdXMsIHRoaWNrbmVzcywgMTYsIDY0KTsKICAgIGNvbnN0IG1lc2g9bmV3IFRIUkVFLk1lc2goZ2VvLCBuZXcgVEhSRUUuTWVzaFN0YW5kYXJkTWF0ZXJpYWwoeyBjb2xvcjoweGZmYjM2NiwgZW1pc3NpdmU6MHg1NTMzMDAsIHJvdWdobmVzczowLjQsIG1ldGFsbmVzczowLjMgfSkpOwogICAgbWVzaC5wb3NpdGlvbi5zZXQoLi4ucG9zKTsgbWVzaC5yb3RhdGlvbi54PU1hdGguUEkvMjsgbWVzaC5jYXN0U2hhZG93PWZhbHNlOyBzY2VuZS5hZGQobWVzaCk7CiAgICBob29wcy5wdXNoKHsgcG9zOm5ldyBUSFJFRS5WZWN0b3IzKC4uLnBvcyksIHJhZGl1cywgdGhpY2tuZXNzLCBtZXNoLCBzY29yZWQ6ZmFsc2UgfSk7CiAgfQoKICAvKiA9PT09PT09IE1hcHMgPT09PT09PSAqLwogIGxldCBjdXJyZW50TWFwID0gMDsKICBsZXQgYWlTcGF3bnMgPSBbXTsKICBjb25zdCBNQVBTID0gWwogICAgeyBpZDoiYXJlbmEiLCBuYW1lOiJTdHVudCBBcmVuYSIsIGJ1aWxkOiBidWlsZFN0dW50QXJlbmEsIHBsYXllclNwYXduOnt4OjAseTozLHo6LTE0MH0sCiAgICAgIGFpU3Bhd25zOlt7eDo5MCx6OjkwfSx7eDotMTMwLHo6ODB9LHt4OjE0MCx6Oi0xMDB9LHt4OjI2MCx6OjIwfSx7eDotMjQwLHo6LTYwfSx7eDo0MCx6OjI2MH0se3g6LTYwLHo6LTI0MH0se3g6MjQwLHo6LTIyMH1dIH0sCiAgICB7IGlkOiJkdW5lcyIsIG5hbWU6IkFsbOKAkVRlcnJhaW4gRHVuZXMiLCBidWlsZDogYnVpbGRBbGxUZXJyYWluLCBwbGF5ZXJTcGF3bjp7eDotNjAseTozLHo6LTE4MH0sCiAgICAgIGFpU3Bhd25zOlt7eDotMjIwLHo6LTIyMH0se3g6MjIwLHo6MjIwfSx7eDotMjIwLHo6MjIwfSx7eDoyMjAsejotMjIwfSx7eDowLHo6MjQwfSx7eDowLHo6LTI0MH1dIH0KICBdOwoKICBmdW5jdGlvbiBjbGVhck1hcCgpewogICAgZm9yIChjb25zdCBvIG9mIHN0T2Jqcyl7IHdvcmxkLnJlbW92ZUJvZHkoby5ib2R5KTsgc2NlbmUucmVtb3ZlKG8ubWVzaCk7IH0gc3RPYmpzLmxlbmd0aD0wOwogICAgZm9yIChjb25zdCBiIG9mIGJvb3N0cyl7IHNjZW5lLnJlbW92ZShiLm1lc2gpOyB9IGJvb3N0cy5sZW5ndGg9MDsKICAgIGZvciAoY29uc3QgaCBvZiBob29wcyl7IHNjZW5lLnJlbW92ZShoLm1lc2gpOyB9IGhvb3BzLmxlbmd0aD0wOwogICAgZm9yIChjb25zdCBwIG9mIHBpY2t1cHMpeyBzY2VuZS5yZW1vdmUocC5tZXNoKTsgfSBwaWNrdXBzLmxlbmd0aD0wOwogICAgZm9yIChjb25zdCBvIG9mIG9yYnMpeyBzY2VuZS5yZW1vdmUobyk7IH0gb3Jicy5sZW5ndGg9MDsKICAgIG1hcFNoYXBlcy5sZW5ndGg9MDsKICB9CgogIGZ1bmN0aW9uIHNldE1hcChpZHgpewogICAgY3VycmVudE1hcCA9IChpZHggKyBNQVBTLmxlbmd0aCkgJSBNQVBTLmxlbmd0aDsKICAgIGNsZWFyTWFwKCk7CiAgICBNQVBTW2N1cnJlbnRNYXBdLmJ1aWxkKCk7CiAgICBidWlsZE5hdkdyYXBoKCk7CiAgICBzcGF3blBpY2t1cHMoKTsKICAgIHNwYXduT3JicygxNik7CiAgICBhaVNwYXducyA9IE1BUFNbY3VycmVudE1hcF0uYWlTcGF3bnM7CiAgICB1aS5tYXBMYWJlbC50ZXh0Q29udGVudCA9ICdNYXA6ICcgKyBNQVBTW2N1cnJlbnRNYXBdLm5hbWU7CiAgICB1aS5idG5NYXAudGV4dENvbnRlbnQgPSAnTWFwOiAnICsgTUFQU1tjdXJyZW50TWFwXS5uYW1lOwogICAgaWYgKGNoYXNzaXNCb2R5KSByZXNldFBsYXllcigpOwogICAgd2hpbGUgKGFpQ2Fycy5sZW5ndGgpIGRlc3Bhd25BSSgpOwogICAgcmVjb25jaWxlQm90c1RvSGVhdCgpOwogICAgZmxhc2goTUFQU1tjdXJyZW50TWFwXS5uYW1lKTsKICB9CgogIGZ1bmN0aW9uIGJ1aWxkU3R1bnRBcmVuYSgpewogICAgLy8gRkxPVyBMSU5FIEEKICAgIGFkZFN0dW50UmVjdCg0OCwyLjAsOTIsWzAsMSwtNDBdLFtNYXRoLlBJLzE2LDAsMF0sMHgzNjVhODMsInJhbXAiKTsKICAgIGFkZFN0dW50UmVjdCgyOCwyLjAsMzYsWzAsMywtMl0sWzAsMCwwXSwweDMxNDg2MSwicGxhdCIpOwogICAgYWRkU3R1bnRSZWN0KDQ4LDIuMCw5MixbMCwxLDM0XSxbLU1hdGguUEkvMTgsMCwwXSwweDM2NWE4MywicmFtcCIpOwogICAgYWRkSG9vcCgxMCwxLjIsWzAsMTQsMThdKTsKCiAgICAvLyBGTE9XIExJTkUgQgogICAgYWRkU3R1bnRSZWN0KDQyLDEuOCw3MCxbMTYwLDEsMzBdLFtNYXRoLlBJLzE2LDAsMF0sMHgzYjVhODQsInJhbXAiKTsKICAgIGFkZEhvb3AoOSwxLjEsWzE2MCwxMyw3OF0pOwoKICAgIC8vIEZMT1cgTElORSBDICh3ZXN0IHdhdmVzKQogICAgZm9yIChsZXQgaT0wO2k8NDtpKyspeyBhZGRTdHVudFJlY3QoMjQsMS41LDE4LFstMTgwICsgaSo0MCwwLjgsODBdLFtNYXRoLlBJLzE0LDAsMF0sMHgzYTRmN2QsInJhbXAiKTsgfQoKICAgIC8vIEJhbmtlZCBjb3JuZXJzCiAgICBhZGRTdHVudFJlY3QoOTAsMy4wLDQwLFstMjYwLDIsLTI2MF0sWzAsIE1hdGguUEkvNCwgIE1hdGguUEkvOF0sMHgzMDViNTIsImJhbmsiKTsKICAgIGFkZFN0dW50UmVjdCg5MCwzLjAsNDAsWyAyNjAsMiwgMjYwXSxbMCwtMypNYXRoLlBJLzQsLU1hdGguUEkvOF0sMHgzMDViNTIsImJhbmsiKTsKCiAgICAvLyBOb3J0aCBicmlkZ2UKICAgIGFkZFN0dW50UmVjdCgxNCwxLjQsMjAsWyA3MCwwLjcsMTYwXSxbTWF0aC5QSS8xNCwwLDBdLDB4M2I1YTg0LCJyYW1wIik7CiAgICBhZGRTdHVudFJlY3QoIDYsMS4wLDYwLFsgIDAsNC41LDE2MF0sWzAsMCwwXSwweDVjNmZlMCwicGxhdCIpOwogICAgYWRkU3R1bnRSZWN0KDE0LDEuNCwyMCxbLTcwLDAuNywxNjBdLFstTWF0aC5QSS8xNCwwLDBdLDB4M2I1YTg0LCJyYW1wIik7CgogICAgLy8gRXh0cmEgaG9vcHMKICAgIGFkZEhvb3AoOCwxLjAsWzEyMCwxMyw0MF0pOyBhZGRIb29wKDgsMS4wLFstMTIwLDEzLC00MF0pOwoKICAgIC8vIFN0cmF0ZWdpYyBib29zdCBwYWRzCiAgICBbWzAsLTY0XSxbMCwxMF0sWzAsNzJdLFsxNDAsLTQwXSxbMTUyLDhdLFsxNjAsOTZdLFstMjAwLDUwXSxbLTE2MCw5MF0sWzAsMTQwXSxbLTIzMCwtMjEwXSxbMjMwLDIxMF0sWy0xMjAsMF0sWzEyMCwwXV0KICAgICAgLmZvckVhY2gocD0+IGFkZEJvb3N0UGFkKDE2LDIyLFtwWzBdLDAuMDYscFsxXV0sWzAsMCwwXSkpOwogIH0KCiAgZnVuY3Rpb24gYnVpbGRBbGxUZXJyYWluKCl7CiAgICBjb25zdCBkdW5lPSh4LHosdyxkLGgscngpPT4gYWRkU3R1bnRSZWN0KHcsaCxkLFt4LGgvMix6XSxbcnh8fE1hdGguUEkvMTQsMCwwXSwweDJmNGE2YiwiYmFuayIpOwogICAgZHVuZSgtMjAwLC0xMjAsMTQwLDkwLDE4LCBNYXRoLlBJLzEyKTsgZHVuZSg5MCw0MCwxNjAsMTEwLDE2LCBNYXRoLlBJLzE1KTsKICAgIGR1bmUoMTgwLC0xODAsMTIwLDEyMCwxNCwgTWF0aC5QSS8xOCk7IGR1bmUoLTE1MCwxODAsMTYwLDEwMCwxNCwgTWF0aC5QSS8xNik7IGR1bmUoMCw0MCwyMDAsMTEwLDE2LCBNYXRoLlBJLzIwKTsKICAgIGFkZFN0dW50UmVjdCg2MCwxLjQsOTAsWy02MCwwLjcsLTQwXSxbTWF0aC5QSS8xNiwwLDBdLDB4M2I1YTg0LCJyYW1wIik7CiAgICBhZGRTdHVudFJlY3QoNzAsMS42LDYwLFsxNDAsMC44LDEwMF0sW01hdGguUEkvMTgsMCwwXSwweDNiNWE4NCwicmFtcCIpOwogICAgW1stMTgwLC0xNjBdLFsxNjAsMTIwXSxbMjAsLTYwXSxbMCwxODBdXS5mb3JFYWNoKHA9PiBhZGRCb29zdFBhZCgxOCwyNixbcFswXSwwLjA2LHBbMV1dKSk7CiAgICBhZGRIb29wKDksMS4xLFsxMTAsMTIsMjBdKTsgYWRkSG9vcCg5LDEuMSxbLTEyMCwxMiwtMTAwXSk7CiAgfQoKICBmdW5jdGlvbiBhZGRTdHVudFJlY3QodyxoLGQscG9zLHJvdCxjb2xvcix0eXBlKXsKICAgIGFkZEJveFN0YXRpYyh3LGgsZCxwb3Mscm90LGNvbG9yLHtjb2xsaWRlQUk6ZmFsc2UsIGtlZXA6ZmFsc2V9KTsKICAgIGNvbnN0IHlhdz0ocm90JiZyb3RbMV0pP3JvdFsxXTowOyBjb25zdCBtYXBDb2xvciA9IHR5cGU9PT0icmFtcCI/dmFyR2V0KCctLXBSYW1wJyk6dHlwZT09PSJwbGF0Ij92YXJHZXQoJy0tcFBsYXQnKTp0eXBlPT09ImJhbmsiP3ZhckdldCgnLS1wQmFuaycpOiIjNmE4MmMyIjsKICAgIGNvbnN0IGFscGhhID0gdHlwZT09PSJwbGF0Ij8wLjI1OjAuMzU7CiAgICBtYXBTaGFwZXMucHVzaCh7eDpwb3NbMF0sejpwb3NbMl0sdyxkLHlhdyxjb2xvcjptYXBDb2xvcixhbHBoYSx0eXBlfSk7CiAgfQogIGZ1bmN0aW9uIHZhckdldChuYW1lKXsgcmV0dXJuIGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KS5nZXRQcm9wZXJ0eVZhbHVlKG5hbWUpLnRyaW0oKTsgfQoKICAvKiA9PT09PT09IFBsYXllciA9PT09PT09ICovCiAgbGV0IHNoaWVsZFQgPSAwLCBzaGllbGRNZXNoOwogIGxldCB0dXJib1QgPSAwOyAvLyBicmllZiB0dXJibyBhZnRlciBib29zdCBwYWQKICBmdW5jdGlvbiBidWlsZFBsYXllcigpewogICAgY2hhc3Npc0JvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOjU1MCwgbWF0ZXJpYWw6IG5ldyBDQU5OT04uTWF0ZXJpYWwoImNoYXNzaXMiKSB9KTsKICAgIGNoYXNzaXNCb2R5LmFkZFNoYXBlKG5ldyBDQU5OT04uQm94KG5ldyBDQU5OT04uVmVjMygxLjAsMC4zNSwyLjEpKSwgbmV3IENBTk5PTi5WZWMzKDAsLTAuMjUsMCkpOyAvLyBsb3dlciBDT00KICAgIGNoYXNzaXNCb2R5LnBvc2l0aW9uLnNldChNQVBTW2N1cnJlbnRNYXBdLnBsYXllclNwYXduLngsIE1BUFNbY3VycmVudE1hcF0ucGxheWVyU3Bhd24ueSwgTUFQU1tjdXJyZW50TWFwXS5wbGF5ZXJTcGF3bi56KTsKICAgIGNoYXNzaXNCb2R5LmFuZ3VsYXJEYW1waW5nPTAuNTsgY2hhc3Npc0JvZHkuYWxsb3dTbGVlcCA9IGZhbHNlOwogICAgY2hhc3Npc0JvZHkuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBHUk9VUF9QTEFZRVI7CiAgICBjaGFzc2lzQm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrICA9IEdST1VQX0dST1VORCB8IEdST1VQX1NUVU5UIHwgR1JPVVBfQUk7CiAgICB3b3JsZC5hZGRCb2R5KGNoYXNzaXNCb2R5KTsKCiAgICBjaGFzc2lzTWVzaCA9IG5ldyBUSFJFRS5NZXNoKG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSgyLjAsMC43LDQuMiksCiAgICAgICAgICAgICAgICAgIG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCh7IGNvbG9yOjB4NjZiM2ZmLCBtZXRhbG5lc3M6MC4zNSwgcm91Z2huZXNzOjAuNSB9KSk7CiAgICBjaGFzc2lzTWVzaC5jYXN0U2hhZG93ID0gZmFsc2U7IHNjZW5lLmFkZChjaGFzc2lzTWVzaCk7CiAgICBjb25zdCByb29mID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLkJveEdlb21ldHJ5KDEuNCwwLjUsMS42KSwKICAgICAgICAgICAgICAgICAgbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHsgY29sb3I6MHg5OWQxZmYsIG1ldGFsbmVzczowLjIsIHJvdWdobmVzczowLjYgfSkpOwogICAgcm9vZi5wb3NpdGlvbi5zZXQoMCwwLjYsLTAuMyk7IGNoYXNzaXNNZXNoLmFkZChyb29mKTsKCiAgICAvLyBTaGllbGQgdmlzdWFsCiAgICBzaGllbGRNZXNoID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLlRvcnVzR2VvbWV0cnkoMS42LDAuMDYsMTYsNjQpLAogICAgICAgICAgICAgICAgICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgY29sb3I6MHhiOTg3ZmYsIHRyYW5zcGFyZW50OnRydWUsIG9wYWNpdHk6MC42IH0pKTsKICAgIHNoaWVsZE1lc2gucm90YXRpb24ueCA9IE1hdGguUEkvMjsgc2hpZWxkTWVzaC52aXNpYmxlPWZhbHNlOyBjaGFzc2lzTWVzaC5hZGQoc2hpZWxkTWVzaCk7CgogICAgcGxheWVyVmVoaWNsZSA9IG5ldyBDQU5OT04uUmF5Y2FzdFZlaGljbGUoeyBjaGFzc2lzQm9keSwgaW5kZXhSaWdodEF4aXM6MCwgaW5kZXhVcEF4aXM6MSwgaW5kZXhGb3J3YXJkQXhpczoyIH0pOwoKICAgIGNvbnN0IHdoZWVsT3B0aW9ucyA9IHsKICAgICAgcmFkaXVzOiAwLjQ1LCBkaXJlY3Rpb25Mb2NhbDpuZXcgQ0FOTk9OLlZlYzMoMCwtMSwwKSwKICAgICAgc3VzcGVuc2lvblN0aWZmbmVzczogNDAsIHN1c3BlbnNpb25SZXN0TGVuZ3RoOiAwLjMyLAogICAgICBmcmljdGlvblNsaXA6IDkuNSwgZGFtcGluZ1JlbGF4YXRpb246IDIuNywgZGFtcGluZ0NvbXByZXNzaW9uOiA0LjQsCiAgICAgIG1heFN1c3BlbnNpb25Gb3JjZTogMWU1LCByb2xsSW5mbHVlbmNlOiAwLjAyLAogICAgICBheGxlTG9jYWw6IG5ldyBDQU5OT04uVmVjMygtMSwwLDApLCBtYXhTdXNwZW5zaW9uVHJhdmVsOiAwLjMzLAogICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMzAsIHVzZUN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQ6IHRydWUKICAgIH07CiAgICBjb25zdCBheGxlVz0xLjIsIHdoZWVsQmFzZT0xLjg7CiAgICBbbmV3IENBTk5PTi5WZWMzKC1heGxlVywtMC4yNSwgd2hlZWxCYXNlKSwKICAgICBuZXcgQ0FOTk9OLlZlYzMoIGF4bGVXLC0wLjI1LCB3aGVlbEJhc2UpLAogICAgIG5ldyBDQU5OT04uVmVjMygtYXhsZVcsLTAuMjUsLXdoZWVsQmFzZSksCiAgICAgbmV3IENBTk5PTi5WZWMzKCBheGxlVywtMC4yNSwtd2hlZWxCYXNlKV0KICAgICAgLmZvckVhY2goKHAsaWR4KSA9PiBwbGF5ZXJWZWhpY2xlLmFkZFdoZWVsKHsgLi4ud2hlZWxPcHRpb25zLCByb2xsSW5mbHVlbmNlOiBpZHg8Mj8wLjAxNTowLjAyLCBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHAgfSkpOwogICAgcGxheWVyVmVoaWNsZS5hZGRUb1dvcmxkKHdvcmxkKTsKCiAgICBjb25zdCB3R2VvPW5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KHdoZWVsT3B0aW9ucy5yYWRpdXMsd2hlZWxPcHRpb25zLnJhZGl1cywwLjI4LDIwKTsgd0dlby5yb3RhdGVaKE1hdGguUEkvMik7CiAgICBjb25zdCB3TWF0PW5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCh7IGNvbG9yOjB4MjIzMjQzLCByb3VnaG5lc3M6MC44IH0pOwogICAgZm9yKGxldCBpPTA7aTw0O2krKyl7IGNvbnN0IHc9bmV3IFRIUkVFLk1lc2god0dlbyx3TWF0KTsgdy5jYXN0U2hhZG93PWZhbHNlOyBzY2VuZS5hZGQodyk7IHBsYXllcldoZWVsTWVzaGVzLnB1c2godyk7IH0KICB9CgogIC8qID09PT09PT0gQUkgPT09PT09PSAqLwogIGNvbnN0IGFpQ2FycyA9IFtdOwogIGZ1bmN0aW9uIGJ1aWxkQUlDYXIoc3Bhd24sIHJvbGU9InB1cnN1ZSIpewogICAgY29uc3QgYm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6NTQwIH0pOwogICAgYm9keS5hZGRTaGFwZShuZXcgQ0FOTk9OLkJveChuZXcgQ0FOTk9OLlZlYzMoMS4wLDAuMzUsMi4xKSksIG5ldyBDQU5OT04uVmVjMygwLC0wLjI1LDApKTsKICAgIGJvZHkucG9zaXRpb24uc2V0KHNwYXduLngsIDMsIHNwYXduLnopOwogICAgYm9keS5hbmd1bGFyRGFtcGluZyA9IDAuNTU7IGJvZHkuYWxsb3dTbGVlcCA9IGZhbHNlOwogICAgYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IEdST1VQX0FJOwogICAgYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrICA9IEdST1VQX0dST1VORCB8IEdST1VQX1BMQVlFUiB8IEdST1VQX1NUVU5UOwogICAgd29ybGQuYWRkQm9keShib2R5KTsKCiAgICBjb25zdCBtZXNoID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLkJveEdlb21ldHJ5KDIuMCwwLjcsNC4yKSwKICAgICAgICAgICAgICAgICAgbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHsgY29sb3I6IDB4ZmY3Nzc3LCBtZXRhbG5lc3M6MC4yLCByb3VnaG5lc3M6MC42IH0pKTsKICAgIG1lc2guY2FzdFNoYWRvdyA9IGZhbHNlOyBzY2VuZS5hZGQobWVzaCk7CgogICAgY29uc3QgdmVoID0gbmV3IENBTk5PTi5SYXljYXN0VmVoaWNsZSh7IGNoYXNzaXNCb2R5OiBib2R5LCBpbmRleFJpZ2h0QXhpczowLCBpbmRleFVwQXhpczoxLCBpbmRleEZvcndhcmRBeGlzOjIgfSk7CiAgICBjb25zdCB3aGVlbE9wdGlvbnMgPSB7IHJhZGl1czowLjQ1LCBkaXJlY3Rpb25Mb2NhbDpuZXcgQ0FOTk9OLlZlYzMoMCwtMSwwKSwgc3VzcGVuc2lvblN0aWZmbmVzczozOCwgc3VzcGVuc2lvblJlc3RMZW5ndGg6MC4zMiwgZnJpY3Rpb25TbGlwOjEwLjIsIGRhbXBpbmdSZWxheGF0aW9uOiAyLjYsIGRhbXBpbmdDb21wcmVzc2lvbjogNC40LCBtYXhTdXNwZW5zaW9uRm9yY2U6MWU1LCByb2xsSW5mbHVlbmNlOjAuMDIsIGF4bGVMb2NhbDpuZXcgQ0FOTk9OLlZlYzMoLTEsMCwwKSwgbWF4U3VzcGVuc2lvblRyYXZlbDowLjMzLCBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOi0zMCwgdXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDp0cnVlIH07CiAgICBjb25zdCBheGxlVz0xLjIsIHdoZWVsQmFzZT0xLjg7CiAgICBbbmV3IENBTk5PTi5WZWMzKC1heGxlVywtMC4yNSwgd2hlZWxCYXNlKSwgbmV3IENBTk5PTi5WZWMzKCBheGxlVywtMC4yNSwgd2hlZWxCYXNlKSwKICAgICBuZXcgQ0FOTk9OLlZlYzMoLWF4bGVXLC0wLjI1LC13aGVlbEJhc2UpLG5ldyBDQU5OT04uVmVjMyggYXhsZVcsLTAuMjUsLXdoZWVsQmFzZSldCiAgICAgIC5mb3JFYWNoKChwLGlkeCkgPT4gdmVoLmFkZFdoZWVsKHsgLi4ud2hlZWxPcHRpb25zLCByb2xsSW5mbHVlbmNlOiBpZHg8Mj8wLjAxNTowLjAyLCBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHAgfSkpOwogICAgdmVoLmFkZFRvV29ybGQod29ybGQpOwoKICAgIGNvbnN0IHdHZW89bmV3IFRIUkVFLkN5bGluZGVyR2VvbWV0cnkod2hlZWxPcHRpb25zLnJhZGl1cyx3aGVlbE9wdGlvbnMucmFkaXVzLDAuMjgsMjApOyB3R2VvLnJvdGF0ZVooTWF0aC5QSS8yKTsKICAgIGNvbnN0IHdNYXQ9bmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHsgY29sb3I6MHg1NTIyMjIsIHJvdWdobmVzczowLjggfSk7CiAgICBjb25zdCB3aGVlbHM9W107IGZvcihsZXQgaT0wO2k8NDtpKyspeyBjb25zdCB3PW5ldyBUSFJFRS5NZXNoKHdHZW8sd01hdCk7IHcuY2FzdFNoYWRvdz1mYWxzZTsgc2NlbmUuYWRkKHcpOyB3aGVlbHMucHVzaCh3KTsgfQoKICAgIHJldHVybiB7IGJvZHksIG1lc2gsIHZlaCwgd2hlZWxzLCBzcGF3biwgc3R1Y2tUOjAsIHJvbGUsIHN0ZWVyTFA6MCwgcmVwYXRoVDowLCBwYXRoOltdLCBwYXRoSWR4OjAsIGx1bmdlVDowLCB1cHNpZGVUOjAgfTsKICB9CiAgZnVuY3Rpb24gc3Bhd25BSSgpewogICAgaWYgKCFib3RzRW5hYmxlZCB8fCAhYWlTcGF3bnMubGVuZ3RoKSByZXR1cm47CiAgICBjb25zdCByb2xlcyA9IFsicHVyc3VlIiwiZmxhbmtMIiwiZmxhbmtSIiwicHVyc3VlIl07CiAgICBjb25zdCBzcCA9IGFpU3Bhd25zW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSphaVNwYXducy5sZW5ndGgpXTsKICAgIGNvbnN0IHJvbGUgPSByb2xlc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqcm9sZXMubGVuZ3RoKV07CiAgICBhaUNhcnMucHVzaChidWlsZEFJQ2FyKHNwLCByb2xlKSk7CiAgfQogIGZ1bmN0aW9uIGRlc3Bhd25BSSgpewogICAgaWYgKCFhaUNhcnMubGVuZ3RoKSByZXR1cm47CiAgICBjb25zdCBhaSA9IGFpQ2Fycy5wb3AoKTsKICAgIGFpLnZlaC5yZW1vdmVGcm9tV29ybGQod29ybGQpOyB3b3JsZC5yZW1vdmVCb2R5KGFpLmJvZHkpOwogICAgc2NlbmUucmVtb3ZlKGFpLm1lc2gpOyBmb3IgKGNvbnN0IHcgb2YgYWkud2hlZWxzKSBzY2VuZS5yZW1vdmUodyk7CiAgfQogIGZ1bmN0aW9uIHJlY29uY2lsZUJvdHNUb0hlYXQoKXsgY29uc3Qgd2FudCA9IE1hdGgubWluKHRhcmdldEFJQ291bnQoKSwgOCk7IHdoaWxlIChhaUNhcnMubGVuZ3RoIDwgd2FudCkgc3Bhd25BSSgpOyB3aGlsZSAoYWlDYXJzLmxlbmd0aCA+IHdhbnQpIGRlc3Bhd25BSSgpOyB9CgogIC8qID09PT09PT0gVXRpbGl0aWVzID09PT09PT0gKi8KICBmdW5jdGlvbiBmb3J3YXJkVmVjdG9yKGJvZHkpewogICAgY29uc3QgcT1uZXcgVEhSRUUuUXVhdGVybmlvbihib2R5LnF1YXRlcm5pb24ueCxib2R5LnF1YXRlcm5pb24ueSxib2R5LnF1YXRlcm5pb24ueixib2R5LnF1YXRlcm5pb24udyk7CiAgICBjb25zdCBmPW5ldyBUSFJFRS5WZWN0b3IzKDAsMCwxKS5hcHBseVF1YXRlcm5pb24ocSk7IHJldHVybiB7eDpmLngseTpmLnksejpmLnp9OwogIH0KICBmdW5jdGlvbiByaWdodFZlY3Rvcihib2R5KXsKICAgIGNvbnN0IHE9bmV3IFRIUkVFLlF1YXRlcm5pb24oYm9keS5xdWF0ZXJuaW9uLngsYm9keS5xdWF0ZXJuaW9uLnksYm9keS5xdWF0ZXJuaW9uLnosYm9keS5xdWF0ZXJuaW9uLncpOwogICAgY29uc3Qgcj1uZXcgVEhSRUUuVmVjdG9yMygxLDAsMCkuYXBwbHlRdWF0ZXJuaW9uKHEpOyByZXR1cm4ge3g6ci54LHk6ci55LHo6ci56fTsKICB9CiAgZnVuY3Rpb24gZmxhc2godGV4dCl7IGNvbnN0IGVsPXVpLnRvYXN0OyBlbC50ZXh0Q29udGVudD10ZXh0OyBlbC5zdHlsZS5kaXNwbGF5PSJibG9jayI7IGNsZWFyVGltZW91dChmbGFzaC5fdCk7IGZsYXNoLl90PXNldFRpbWVvdXQoKCk9PmVsLnN0eWxlLmRpc3BsYXk9Im5vbmUiLCAxMDAwKTsgfQogIGZ1bmN0aW9uIHB1c2hSaW5nKHBvcywgc2l6ZSl7IHBhcnRpY2xlcy5yaW5nLnNwYXduKG5ldyBUSFJFRS5WZWN0b3IzKHBvcy54LHBvcy55KzAuMyxwb3MueiksIG5ldyBUSFJFRS5WZWN0b3IzKDAsMCwwKSwgMC42LCBzaXplLCAwLjkpOyB9CgogIGZ1bmN0aW9uIGFkZFNjb3JlKHB0cywgbGFiZWwpewogICAgY29uc3QgZ2FpbiA9IE1hdGgucm91bmQocHRzICogY29tYm8gKiBoZWF0U2NvcmVNdWx0KCkpOwogICAgc2NvcmUgKz0gZ2FpbjsgdWkuc2NvcmUudGV4dENvbnRlbnQgPSBzY29yZS50b0xvY2FsZVN0cmluZygpOwogICAgaWYgKGxhYmVsKXsgZmxhc2goYCR7bGFiZWx9ICske2dhaW59YCk7IHB1c2hGZWVkKGxhYmVsLCBnYWluKTsgfQogICAgaGVhdENoYXJnZSA9IE1hdGgubWluKDEsIGhlYXRDaGFyZ2UgKyBnYWluICogMC4wMDA0NSk7CiAgICBzaW5jZVNjb3JlVCA9IDA7CiAgfQoKICAvKiA9PT09PT09IEFJIG9ic3RhY2xlIGF3YXJlbmVzcyA9PT09PT09ICovCiAgZnVuY3Rpb24gYWlBdm9pZFN0ZWVyKGFpKXsKICAgIGxldCBzdGVlckJpYXMgPSAwOwogICAgY29uc3QgcHggPSBhaS5ib2R5LnBvc2l0aW9uLngsIHB6ID0gYWkuYm9keS5wb3NpdGlvbi56OwogICAgZm9yIChjb25zdCByIG9mIG1hcFNoYXBlcyl7CiAgICAgIGNvbnN0IGMgPSBNYXRoLmNvcygtci55YXcpLCBzID0gTWF0aC5zaW4oLXIueWF3KTsKICAgICAgY29uc3QgZHggPSBweCAtIHIueCwgZHogPSBweiAtIHIuejsKICAgICAgY29uc3QgbHggPSBkeCpjIC0gZHoqcywgbHogPSBkeCpzICsgZHoqYzsKICAgICAgY29uc3QgaHcgPSByLncvMiArIDgsIGhkID0gci5kLzIgKyA4OwogICAgICBjb25zdCBjbHggPSBNYXRoLm1heCgtaHcsIE1hdGgubWluKGh3LCBseCkpOwogICAgICBjb25zdCBjbHogPSBNYXRoLm1heCgtaGQsIE1hdGgubWluKGhkLCBseikpOwogICAgICBjb25zdCBvZmZ4ID0gbHggLSBjbHgsIG9mZnogPSBseiAtIGNsejsKICAgICAgY29uc3Qgd3ggPSBvZmZ4KmMgKyBvZmZ6KnMsIHd6ID0gLW9mZngqcyArIG9mZnoqYzsKICAgICAgY29uc3QgbWFnID0gTWF0aC5oeXBvdCh3eCwgd3opOwogICAgICBpZiAobWFnID4gMCl7CiAgICAgICAgY29uc3QgZiA9IGZvcndhcmRWZWN0b3IoYWkuYm9keSk7CiAgICAgICAgY29uc3QgZG90ID0gZi54Knd4ICsgZi56Knd6LCBjcm9zcyA9IGYueCp3eiAtIGYueip3eDsKICAgICAgICBjb25zdCBhbmcgPSBNYXRoLmF0YW4yKGNyb3NzLCBkb3QpOwogICAgICAgIGNvbnN0IHR5cGVXZWlnaHQgPSAoci50eXBlPT09J3JhbXAnPzEuMDooci50eXBlPT09J2JhbmsnPzAuODowLjUpKTsKICAgICAgICBjb25zdCBuZWFyID0gMS8oMSttYWcqMC4wOCk7CiAgICAgICAgY29uc3QgaGVhdEsgPSAwLjYgKyAwLjA4KmhlYXQ7CiAgICAgICAgY29uc3QgZGlmZk11bCA9IERJRkZbZGlmZl0uYXZvaWRNdWw7CiAgICAgICAgc3RlZXJCaWFzICs9IE1hdGgubWF4KC0xLCBNYXRoLm1pbigxLCBhbmcpKSAqIG5lYXIgKiAwLjcgKiB0eXBlV2VpZ2h0ICogaGVhdEsgKiBkaWZmTXVsOwogICAgICB9CiAgICB9CiAgICBjb25zdCBtYXJnaW49Mjg7CiAgICBpZiAoQVJFTkFfSEFMRiAtIE1hdGguYWJzKHB4KSA8IG1hcmdpbiB8fCBBUkVOQV9IQUxGIC0gTWF0aC5hYnMocHopIDwgbWFyZ2luKXsKICAgICAgY29uc3QgdnggPSAtcHgsIHZ6ID0gLXB6OwogICAgICBjb25zdCBmID0gZm9yd2FyZFZlY3RvcihhaS5ib2R5KTsKICAgICAgY29uc3QgZG90ID0gZi54KnZ4ICsgZi56KnZ6LCBjcm9zcyA9IGYueCp2eiAtIGYueip2eDsKICAgICAgY29uc3QgYW5nID0gTWF0aC5hdGFuMihjcm9zcywgZG90KTsKICAgICAgc3RlZXJCaWFzICs9IE1hdGgubWF4KC0wLjcsIE1hdGgubWluKDAuNywgYW5nKSkgKiAwLjc7CiAgICB9CiAgICByZXR1cm4geyBzdGVlcjogc3RlZXJCaWFzIH07CiAgfQoKICAvKiA9PT09PT09IEhlYXQgVUkgJiBzY2FsaW5nID09PT09PT0gKi8KICBmdW5jdGlvbiB1cGRhdGVIZWF0KGR0KXsKICAgIHNpbmNlU2NvcmVUICs9IGR0OwogICAgY29uc3QgY29vbERlbGF5ID0gSEVBVF9DT09MRE9XTl9CQVNFICsgSEVBVF9DT09MRE9XTl9QRVJfU1RBUiAqIGhlYXQ7CiAgICBpZiAoc2luY2VTY29yZVQgPj0gMSAmJiBoZWF0ID4gMCkgewogICAgICBpZiAoY29vbFRpbWVyIDw9IDApIGNvb2xUaW1lciA9IGNvb2xEZWxheTsgZWxzZSBjb29sVGltZXIgPSBNYXRoLm1heCgwLCBjb29sVGltZXIgLSBkdCk7CiAgICAgIHVpLmNvb2xUeHQudGV4dENvbnRlbnQgPSBgQ29vbGluZyBpbjogJHtjb29sVGltZXIudG9GaXhlZCgxKX1zYDsKICAgICAgaWYgKGNvb2xUaW1lciA8PSAwKXsgaGVhdCA9IE1hdGgubWF4KDAsIGhlYXQgLSAxKTsgb25IZWF0Q2hhbmdlKCk7IGNvb2xUaW1lciA9IGhlYXQ+MCA/IChIRUFUX0NPT0xET1dOX0JBU0UgKyBIRUFUX0NPT0xET1dOX1BFUl9TVEFSICogaGVhdCkgOiAwOyB9CiAgICB9IGVsc2UgeyB1aS5jb29sVHh0LnRleHRDb250ZW50ID0gIiI7IGNvb2xUaW1lciA9IDA7IH0KCiAgICBpZiAoc2luY2VTY29yZVQgPiAwLjMpIGhlYXRDaGFyZ2UgPSBNYXRoLm1heCgwLCBoZWF0Q2hhcmdlIC0gZHQqMC4xMik7CiAgICBpZiAoaGVhdCA8IE1BWF9IRUFUICYmIGhlYXRDaGFyZ2UgPj0gMSl7IGhlYXQrKzsgaGVhdENoYXJnZSAtPSAxOyBvbkhlYXRDaGFuZ2UoKTsgfQoKICAgIHVpLmhlYXRTdGFycy50ZXh0Q29udGVudCA9ICLimIUiLnJlcGVhdChoZWF0KSArICLimIYiLnJlcGVhdChNQVhfSEVBVC1oZWF0KTsKICAgIHVpLmhlYXRCYWRnZS50ZXh0Q29udGVudCA9IGhlYXROYW1lKGhlYXQpOwogIH0KICBmdW5jdGlvbiBvbkhlYXRDaGFuZ2UoKXsgcHVzaFJpbmcoY2hhc3Npc0JvZHkucG9zaXRpb24sIDQgKyBoZWF0KjAuOCk7IHJlY29uY2lsZUJvdHNUb0hlYXQoKTsgaWYgKGhlYXQgPT09IE1BWF9IRUFUKXsgZmxhc2goIkluZmVybm8hIFNjb3JlIE11bHRpcGxpZXIg4oaRIik7IGF1ZGlvLmJsaXAoNzYwLC4xOCwuMjUpO30gfQogIGZ1bmN0aW9uIGluZmVybm9TcGlrZSgpeyByZXR1cm4gaGVhdD09PU1BWF9IRUFUID8gMS4xOCA6IDEuMDsgfQogIGZ1bmN0aW9uIGFpVGFyZ2V0U3BlZWQoKXsgcmV0dXJuICgyNiArIGhlYXQqNykgKiBESUZGW2RpZmZdLnNwZWVkICogaW5mZXJub1NwaWtlKCk7IH0KICBmdW5jdGlvbiBhaVN0ZWVyQ2xhbXAoKXsgcmV0dXJuICgwLjU1ICsgaGVhdCowLjA3ICsgRElGRltkaWZmXS5zdGVlckJvb3N0KTsgfQogIGZ1bmN0aW9uIGFpRW5naW5lQmFzZSgpeyByZXR1cm4gLSAoMzYwMCArIGhlYXQqNTIwKSAqIERJRkZbZGlmZl0uZW5naW5lICogaW5mZXJub1NwaWtlKCk7IH0KICBmdW5jdGlvbiBhaVJlcGF0aEJhc2UoKXsgcmV0dXJuIE1hdGgubWF4KDAuMTgsICgwLjcyIC0gaGVhdCowLjEyKSAqIERJRkZbZGlmZl0ucmVwbGFuTXVsKTsgfQogIGZ1bmN0aW9uIGFpTGVhZEZhY3RvcihkaXN0LCB2KXsgcmV0dXJuIE1hdGgubWluKDEuNiwgZGlzdCAvICh2ICsgMSkpICogKDEgKyAwLjIyKmhlYXQpOyB9CgogIC8qID09PT09PT0gUGlja3VwcyAvIE9yYnMgPT09PT09PSAqLwogIGZ1bmN0aW9uIHNwYXduUGlja3VwcygpewogICAgZm9yIChsZXQgaT0wO2k8MztpKyspIHBpY2t1cHMucHVzaChtYWtlUGlja3VwKCduaXRybycsIHJhbmRvbUVkZ2VQb3MoKSkpOwogICAgcGlja3Vwcy5wdXNoKG1ha2VQaWNrdXAoJ3NoaWVsZCcsIHJhbmRvbUVkZ2VQb3MoKSkpOwogIH0KICBmdW5jdGlvbiBtYWtlUGlja3VwKHR5cGUsIHBvcyl7CiAgICBjb25zdCBnZW8gPSB0eXBlPT09J25pdHJvJyA/IG5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KDAuNiwwLjYsMS4yLDE0KSA6IG5ldyBUSFJFRS5Ub3J1c0dlb21ldHJ5KDEuMCwwLjE1LDEyLDMyKTsKICAgIGNvbnN0IG1hdCA9IG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCh7IGNvbG9yOiB0eXBlPT09J25pdHJvJyA/IDB4MmFmNWE0IDogMHhiOTg3ZmYsIGVtaXNzaXZlOiB0eXBlPT09J25pdHJvJyA/IDB4MGQ1IDogMHgzMjEwNTUsIHJvdWdobmVzczowLjIsIG1ldGFsbmVzczowLjEgfSk7CiAgICBjb25zdCBtID0gbmV3IFRIUkVFLk1lc2goZ2VvLCBtYXQpOyBtLnBvc2l0aW9uLnNldChwb3MueCwgdHlwZT09PSduaXRybyc/MC45OjEuMiwgcG9zLnopOyBtLmNhc3RTaGFkb3c9ZmFsc2U7IHNjZW5lLmFkZChtKTsKICAgIHJldHVybiB7IG1lc2g6IG0sIHR5cGUsIHJlc3Bhd25UOiAwIH07CiAgfQogIGZ1bmN0aW9uIHJhbmRvbUVkZ2VQb3MoKXsgY29uc3QgciA9IEFSRU5BX0hBTEYtNDA7IGNvbnN0IGEgPSBNYXRoLnJhbmRvbSgpKk1hdGguUEkqMjsgY29uc3QgcmFkID0gciAtIDQwKk1hdGgucmFuZG9tKCk7IHJldHVybiBuZXcgVEhSRUUuVmVjdG9yMyhNYXRoLmNvcyhhKSpyYWQsIDAsIE1hdGguc2luKGEpKnJhZCk7IH0KICBmdW5jdGlvbiBzcGF3bk9yYnMobil7CiAgICBmb3IgKGxldCBpPTA7aTxuO2krKyl7CiAgICAgIGNvbnN0IG0gPSBuZXcgVEhSRUUuTWVzaChuZXcgVEhSRUUuU3BoZXJlR2VvbWV0cnkoMC41LDEyLDEyKSwgbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHsgY29sb3I6MHhhZDc2ZmYsIGVtaXNzaXZlOjB4MjIwMDMzLCByb3VnaG5lc3M6MC40IH0pKTsKICAgICAgY29uc3QgcCA9IHJhbmRvbUVkZ2VQb3MoKTsgbS5wb3NpdGlvbi5zZXQocC54LDAuNSxwLnopOyBzY2VuZS5hZGQobSk7IG9yYnMucHVzaChtKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gc3BpblBpY2t1cHMoZHQpeyBmb3IgKGNvbnN0IHAgb2YgcGlja3Vwcyl7IHAubWVzaC5yb3RhdGlvbi55ICs9IGR0KjEuNjsgcC5tZXNoLnZpc2libGUgPSBwLnJlc3Bhd25UPD0wOyBpZiAocC5yZXNwYXduVD4wKSBwLnJlc3Bhd25UIC09IGR0OyB9IH0KICBmdW5jdGlvbiBjaGVja1BpY2t1cHMoKXsKICAgIGZvciAoY29uc3QgcCBvZiBwaWNrdXBzKXsKICAgICAgaWYgKCFwLm1lc2gudmlzaWJsZSkgY29udGludWU7CiAgICAgIGNvbnN0IGR4ID0gcC5tZXNoLnBvc2l0aW9uLnggLSBjaGFzc2lzQm9keS5wb3NpdGlvbi54LCBkeiA9IHAubWVzaC5wb3NpdGlvbi56IC0gY2hhc3Npc0JvZHkucG9zaXRpb24uejsKICAgICAgaWYgKE1hdGguaHlwb3QoZHgsZHopIDwgMi40KXsKICAgICAgICBpZiAocC50eXBlPT09J25pdHJvJyl7IG5pdHJvID0gTWF0aC5taW4oMSwgbml0cm8gKyAwLjYpOyBhZGRTY29yZSgyMDAsICJOaXRybyBjYW4iKTsgYXVkaW8uYmxpcCg2NjAsLjEsLjI1KTsgfQogICAgICAgIGlmIChwLnR5cGU9PT0nc2hpZWxkJyl7IHNoaWVsZFQgPSA2LjA7IGFkZFNjb3JlKDMwMCwgIlNoaWVsZCIpOyBhdWRpby5ibGlwKDQ4MCwuMTUsLjI1KTsgfQogICAgICAgIHAucmVzcGF3blQgPSA4ICsgTWF0aC5yYW5kb20oKSo2OyBwLm1lc2gucG9zaXRpb24uY29weShyYW5kb21FZGdlUG9zKCkpOyBwLm1lc2gudmlzaWJsZT1mYWxzZTsKICAgICAgfQogICAgfQogIH0KICBmdW5jdGlvbiBjaGVja09yYnMoKXsKICAgIGZvciAobGV0IGk9b3Jicy5sZW5ndGgtMTtpPj0wO2ktLSl7CiAgICAgIGNvbnN0IG8gPSBvcmJzW2ldOyBjb25zdCBkeD1vLnBvc2l0aW9uLnggLSBjaGFzc2lzQm9keS5wb3NpdGlvbi54LCBkej1vLnBvc2l0aW9uLnogLSBjaGFzc2lzQm9keS5wb3NpdGlvbi56OwogICAgICBpZiAoTWF0aC5oeXBvdChkeCxkeikgPCAyLjApewogICAgICAgIGFkZFNjb3JlKDEyMCwgIk9yYiIpOyBhdWRpby5ibGlwKDU2MCwuMDcsLjIpOwogICAgICAgIHBhcnRpY2xlcy5yaW5nLnNwYXduKG5ldyBUSFJFRS5WZWN0b3IzKG8ucG9zaXRpb24ueCwxLjAsby5wb3NpdGlvbi56KSwgbmV3IFRIUkVFLlZlY3RvcjMoMCwwLDApLCAwLjM1LCAxLjIsIDAuOSk7CiAgICAgICAgc2NlbmUucmVtb3ZlKG8pOyBvcmJzLnNwbGljZShpLDEpOwogICAgICB9CiAgICB9CiAgICBpZiAob3Jicy5sZW5ndGggPCAxMil7IHNwYXduT3JicygzKTsgfQogIH0KCiAgLyogPT09PT09PSBJbnB1dDogdG91Y2ggKHByaW1hcnkpICsgb3B0aW9uYWwga2V5cyA9PT09PT09ICovCiAgbGV0IGtleXMgPSB7fTsKICBhZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgZSA9PiB7CiAgICBjb25zdCBrPWUua2V5LnRvTG93ZXJDYXNlKCk7IGtleXNba109dHJ1ZTsKICAgIGlmKFsiICIsImFycm93dXAiLCJhcnJvd2Rvd24iLCJhcnJvd2xlZnQiLCJhcnJvd3JpZ2h0Il0uaW5jbHVkZXMoaykpIGUucHJldmVudERlZmF1bHQoKTsKICAgIGlmKGs9PT0iYyIpeyBjYW1lcmFNb2RlID0gKGNhbWVyYU1vZGU9PT0iY2hhc2UiKSA/ICJvcmJpdCIgOiAiY2hhc2UiOyB9CiAgICBpZihrPT09Im0iKXsgbXV0ZWQgPSAhbXV0ZWQ7IH0KICAgIGlmKGs9PT0iciIpeyByZXNldFJvdW5kKCJSZXNldCIpOyB9CiAgICBpZihrPT09ImgiKXsgdWkubWFudWFsLnN0eWxlLmRpc3BsYXkgPSAodWkubWFudWFsLnN0eWxlLmRpc3BsYXk9PT0iZmxleCIgPyAibm9uZSIgOiAiZmxleCIpOyB9CiAgICBpZihrPT09ImIiKXsgdG9nZ2xlQm90cygpOyB9CiAgICBpZihrPT09InQiKXsgc2hhcmVTY29yZSgpOyB9CiAgfSk7CiAgYWRkRXZlbnRMaXN0ZW5lcigia2V5dXAiLCBlID0+IHsga2V5c1tlLmtleS50b0xvd2VyQ2FzZSgpXSA9IGZhbHNlOyB9KTsKICB1aS5idG5IZWxwLm9uY2xpY2sgPSAoKT0+eyB1aS5tYW51YWwuc3R5bGUuZGlzcGxheT0iZmxleCI7IH07CiAgdWkubWFudWFsQ2xvc2Uub25jbGljayA9ICgpPT57IHVpLm1hbnVhbC5zdHlsZS5kaXNwbGF5PSJub25lIjsgfTsKICB1aS5idG5Cb3RzLm9uY2xpY2sgPSAoKT0+IHRvZ2dsZUJvdHMoKTsKICB1aS5idG5EaWZmLm9uY2xpY2sgPSAoKT0+IGN5Y2xlRGlmZigpOwogIHVpLmJ0bk1hcC5vbmNsaWNrICA9ICgpPT4gc2V0TWFwKGN1cnJlbnRNYXArMSk7CiAgJCgiI3Njb3JlIikuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzaGFyZVNjb3JlKTsKCiAgZnVuY3Rpb24gdG9nZ2xlQm90cygpewogICAgYm90c0VuYWJsZWQgPSAhYm90c0VuYWJsZWQ7CiAgICAkKCIjYnRuQm90cyIpLnRleHRDb250ZW50ID0gJ0JvdHM6ICcgKyAoYm90c0VuYWJsZWQgPyAnT04nIDogJ09GRicpOwogICAgaWYgKCFib3RzRW5hYmxlZCl7IHdoaWxlIChhaUNhcnMubGVuZ3RoKSBkZXNwYXduQUkoKTsgfQogICAgZWxzZSB7IHJlY29uY2lsZUJvdHNUb0hlYXQoKTsgfQogIH0KICBmdW5jdGlvbiBjeWNsZURpZmYoKXsKICAgIGRpZmYgPSAoZGlmZiArIDEpICUgRElGRi5sZW5ndGg7CiAgICAkKCIjYnRuRGlmZiIpLnRleHRDb250ZW50ID0gJ0RpZmZpY3VsdHk6ICcgKyBESUZGW2RpZmZdLm5hbWU7CiAgICByZWNvbmNpbGVCb3RzVG9IZWF0KCk7CiAgfQoKICBmdW5jdGlvbiBzaGFyZVNjb3JlKCl7CiAgICBjb25zdCBtc2cgPSBgSSBzY29yZWQgJHtzY29yZS50b0xvY2FsZVN0cmluZygpfSBpbiAke0dBTUVfTkFNRX0gb24gJHtNQVBTW2N1cnJlbnRNYXBdLm5hbWV9IGF0ICR7aGVhdE5hbWUoaGVhdCl9IGhlYXQgKCR7RElGRltkaWZmXS5uYW1lfSkuYDsKICAgIGNvbnN0IHNoYXJlRGF0YSA9IHsgdGl0bGU6IEdBTUVfTkFNRSwgdGV4dDogbXNnLCB1cmw6IGxvY2F0aW9uLmhyZWYgfTsKICAgIGlmIChuYXZpZ2F0b3Iuc2hhcmUpewogICAgICBuYXZpZ2F0b3Iuc2hhcmUoc2hhcmVEYXRhKS5jYXRjaCgoKT0+eyAvKiBpZ25vcmUgKi8gfSk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCB0YT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpOyB0YS52YWx1ZSA9IG1zZyArICIg4oCUICIgKyBsb2NhdGlvbi5ocmVmOwogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRhKTsgdGEuc2VsZWN0KCk7IGRvY3VtZW50LmV4ZWNDb21tYW5kKCdjb3B5Jyk7IGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGEpOwogICAgICBmbGFzaCgiU2NvcmUgY29waWVkISBQYXN0ZSB0byBzaGFyZS4iKTsKICAgIH0KICB9CgogIC8qID09PT09PT0gTW9iaWxlIHRvdWNoIGNvbnRyb2xzID09PT09PT0gKi8KICBsZXQgdG91Y2hBY2NlbD1mYWxzZSwgdG91Y2hCcmFrZT1mYWxzZSwgdG91Y2hEcmlmdD1mYWxzZSwgdG91Y2hOaXRybz1mYWxzZSwgdG91Y2hTdGVlcj0wLCB0b3VjaFJvbGxMPWZhbHNlLCB0b3VjaFJvbGxSPWZhbHNlOwogIGZ1bmN0aW9uIGJpbmRIb2xkKGVsLCBzZXQpewogICAgY29uc3Qgb24gPSAoKT0+IHNldCh0cnVlKSwgb2ZmID0gKCk9PiBzZXQoZmFsc2UpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLCBlPT57IGUucHJldmVudERlZmF1bHQoKTsgb24oKTsgfSk7CiAgICBbJ3BvaW50ZXJ1cCcsJ3BvaW50ZXJsZWF2ZScsJ3BvaW50ZXJjYW5jZWwnXS5mb3JFYWNoKGV2PT4gZWwuYWRkRXZlbnRMaXN0ZW5lcihldiwgb2ZmKSk7CiAgICAvLyBNb3VzZSBzdXBwb3J0IChkZXYpCiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBvbik7IGVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBvZmYpOyBlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgb2ZmKTsKICB9CiAgZnVuY3Rpb24gc2V0dXBNb2JpbGVDb250cm9scygpewogICAgYmluZEhvbGQoJCgiI2J0bkdhcyIpLCB2PT4gdG91Y2hBY2NlbCA9IHYpOwogICAgYmluZEhvbGQoJCgiI2J0bkJyYWtlIiksIHY9PiB0b3VjaEJyYWtlID0gdik7CiAgICBiaW5kSG9sZCgkKCIjYnRuRHJpZnQiKSwgdj0+IHRvdWNoRHJpZnQgPSB2KTsKICAgIGJpbmRIb2xkKCQoIiNidG5OaXRybyIpLCB2PT4gdG91Y2hOaXRybyA9IHYpOwogICAgYmluZEhvbGQoJCgiI2J0blJvbGxMIiksIHY9PiB0b3VjaFJvbGxMID0gdik7CiAgICBiaW5kSG9sZCgkKCIjYnRuUm9sbFIiKSwgdj0+IHRvdWNoUm9sbFIgPSB2KTsKCiAgICBjb25zdCBwYWQgPSAkKCIjc3RlZXJQYWQiKSwga25vYiA9ICQoIiNzdGVlcktub2IiKTsKICAgIGxldCBhY3RpdmU9ZmFsc2UsIHJlY3Q9bnVsbCwgcGlkPW51bGw7CiAgICBsZXQgcmFkaXVzID0gODQ7IC8vIG1hdGNoZXMgYmlnZ2VyIHBhZAogICAgZnVuY3Rpb24gc2V0S25vYihkeCxkeSl7CiAgICAgIGNvbnN0IG1hZyA9IE1hdGguaHlwb3QoZHgsZHkpOwogICAgICBjb25zdCBrID0gbWFnPnJhZGl1cyA/IHJhZGl1cy9tYWcgOiAxOwogICAgICBjb25zdCB4ID0gZHgqaywgeSA9IGR5Kms7CiAgICAgIGtub2Iuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgke3h9cHgsICR7eX1weCkgdHJhbnNsYXRlKC01MCUsLTUwJSlgOwogICAgICB0b3VjaFN0ZWVyID0gTWF0aC5tYXgoLTEsIE1hdGgubWluKDEsIC14L3JhZGl1cykpOyAvLyBsZWZ0PWxlZnQsIHJpZ2h0PXJpZ2h0CiAgICB9CiAgICBwYWQuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLCBlPT57CiAgICAgIGFjdGl2ZSA9IHRydWU7IHBpZCA9IGUucG9pbnRlcklkOyByZWN0ID0gcGFkLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICBwYWQuc2V0UG9pbnRlckNhcHR1cmUocGlkKTsKICAgICAgY29uc3QgY3ggPSByZWN0LmxlZnQgKyByZWN0LndpZHRoLzIsIGN5ID0gcmVjdC50b3AgKyByZWN0LmhlaWdodC8yOwogICAgICBzZXRLbm9iKGUuY2xpZW50WCAtIGN4LCBlLmNsaWVudFkgLSBjeSk7CiAgICB9KTsKICAgIHBhZC5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVybW92ZScsIGU9PnsKICAgICAgaWYoIWFjdGl2ZSB8fCBlLnBvaW50ZXJJZCE9PXBpZCkgcmV0dXJuOwogICAgICBjb25zdCBjeCA9IHJlY3QubGVmdCArIHJlY3Qud2lkdGgvMiwgY3kgPSByZWN0LnRvcCArIHJlY3QuaGVpZ2h0LzI7CiAgICAgIHNldEtub2IoZS5jbGllbnRYIC0gY3gsIGUuY2xpZW50WSAtIGN5KTsKICAgIH0pOwogICAgZnVuY3Rpb24gZW5kUGFkKCl7CiAgICAgIGFjdGl2ZT1mYWxzZTsgdG91Y2hTdGVlcj0wOyBrbm9iLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoLTUwJSwtNTAlKWA7CiAgICAgIGlmIChwaWQhPW51bGwpIHRyeXsgcGFkLnJlbGVhc2VQb2ludGVyQ2FwdHVyZShwaWQpOyB9Y2F0Y2goXyl7fQogICAgICBwaWQ9bnVsbDsKICAgIH0KICAgIHBhZC5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVydXAnLCBlbmRQYWQpOwogICAgcGFkLmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJsZWF2ZScsIGVuZFBhZCk7CiAgICBwYWQuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmNhbmNlbCcsIGVuZFBhZCk7CgogICAgLy8gZ2VzdHVyZXM6IDMtZmluZ2VyIHRhcCA9IHJlc2V0LCAyLWZpbmdlciB0YXAgPSBjYW1lcmEKICAgIGxldCBsYXN0VG91Y2hlcz0wLCBsYXN0VGFwVD0wOwogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCAoZSk9PnsKICAgICAgY29uc3Qgbm93PXBlcmZvcm1hbmNlLm5vdygpOwogICAgICBpZiAobm93IC0gbGFzdFRhcFQgPCAzMDAgJiYgZS50b3VjaGVzLmxlbmd0aD09PTAgJiYgbGFzdFRvdWNoZXM9PT0yKXsgY2FtZXJhTW9kZSA9IChjYW1lcmFNb2RlPT09ImNoYXNlIikgPyAib3JiaXQiIDogImNoYXNlIjsgfQogICAgICBpZiAobm93IC0gbGFzdFRhcFQgPCAzMDAgJiYgZS50b3VjaGVzLmxlbmd0aD09PTAgJiYgbGFzdFRvdWNoZXM9PT0zKXsgcmVzZXRSb3VuZCgiUmVzZXQiKTsgfQogICAgICBsYXN0VG91Y2hlcyA9IGUudG91Y2hlcy5sZW5ndGg7IGxhc3RUYXBUID0gbm93OwogICAgfSwge3Bhc3NpdmU6ZmFsc2V9KTsKCiAgICB1cGRhdGVPcmllbnQoKTsKICB9CiAgZnVuY3Rpb24gdXBkYXRlT3JpZW50KCl7IHVpLm9yaWVudC5zdHlsZS5kaXNwbGF5ID0gKGlubmVyV2lkdGggPCBpbm5lckhlaWdodCkgPyAnZmxleCcgOiAnbm9uZSc7IH0KCiAgLyogPT09PT09PSBQbGF5ZXIgcHJlZGljdGlvbiAoZm9yIEFJKSA9PT09PT09ICovCiAgbGV0IGZ1dHVyZVBhdGg9W10sIHBsYXllclByZXZTcGVlZD0wLCBwbGF5ZXJJc0Jvb3N0aW5nPWZhbHNlLCBwbGF5ZXJTdGF0ZT1udWxsOwogIGZ1bmN0aW9uIHByZXBhcmVQbGF5ZXJQcmVkaWN0aW9uKGR0UmVhbCl7CiAgICBjb25zdCBmPWZvcndhcmRWZWN0b3IoY2hhc3Npc0JvZHkpOwogICAgY29uc3QgeWF3ID0gTWF0aC5hdGFuMihmLngsIGYueik7CiAgICBjb25zdCB2eD1jaGFzc2lzQm9keS52ZWxvY2l0eS54LCB2ej1jaGFzc2lzQm9keS52ZWxvY2l0eS56OwogICAgY29uc3Qgc3BlZWQgPSBNYXRoLmh5cG90KHZ4LCB2eik7CiAgICBjb25zdCBhTG9uZyA9IChzcGVlZCAtIHBsYXllclByZXZTcGVlZCkgLyBNYXRoLm1heCgwLjAwMSwgZHRSZWFsKTsKICAgIGNvbnN0IHlhd1JhdGUgPSBjaGFzc2lzQm9keS5hbmd1bGFyVmVsb2NpdHkueSB8fCAwOwogICAgcGxheWVyU3RhdGUgPSB7IHg6IGNoYXNzaXNCb2R5LnBvc2l0aW9uLngsIHo6IGNoYXNzaXNCb2R5LnBvc2l0aW9uLnosIHlhdywgeWF3UmF0ZSwgc3BlZWQsIGFjY2VsTG9uZzogYUxvbmcqMC43LCBib29zdGluZzogcGxheWVySXNCb29zdGluZyB9OwogICAgcGxheWVyUHJldlNwZWVkID0gc3BlZWQ7CgogICAgZnV0dXJlUGF0aC5sZW5ndGggPSAwOwogICAgbGV0IHg9cGxheWVyU3RhdGUueCwgej1wbGF5ZXJTdGF0ZS56LCB5PXBsYXllclN0YXRlLnlhdywgcz1wbGF5ZXJTdGF0ZS5zcGVlZDsKICAgIGNvbnN0IHcgPSBwbGF5ZXJTdGF0ZS55YXdSYXRlLCBhID0gcGxheWVyU3RhdGUuYWNjZWxMb25nOwogICAgY29uc3Qgc3RlcD0wLjEyLCBob3Jpem9uPTIuMjsKICAgIGZvcihsZXQgdD0wOyB0PD1ob3Jpem9uKzFlLTY7IHQrPXN0ZXApewogICAgICBmdXR1cmVQYXRoLnB1c2goe3QsIHgsIHosIHlhdzp5fSk7CiAgICAgIHMgPSBNYXRoLm1heCgwLCBzICsgYSpzdGVwKTsKICAgICAgeSArPSB3KnN0ZXA7CiAgICAgIHggKz0gTWF0aC5zaW4oeSkqcypzdGVwOwogICAgICB6ICs9IE1hdGguY29zKHkpKnMqc3RlcDsKICAgIH0KICB9CiAgZnVuY3Rpb24gY2hvb3NlSW50ZXJjZXB0KGFpLCBtYXhTKXsKICAgIGNvbnN0IGF4PWFpLmJvZHkucG9zaXRpb24ueCwgYXo9YWkuYm9keS5wb3NpdGlvbi56OwogICAgbGV0IGJlc3QgPSBmdXR1cmVQYXRoW2Z1dHVyZVBhdGgubGVuZ3RoLTFdLCBiZXN0Q29zdD0xZTk7CiAgICBmb3IgKGNvbnN0IHAgb2YgZnV0dXJlUGF0aCl7CiAgICAgIGNvbnN0IGR4PXAueC1heCwgZHo9cC56LWF6LCBkaXN0PU1hdGguaHlwb3QoZHgsZHopOwogICAgICBjb25zdCB0QUkgPSBkaXN0IC8gTWF0aC5tYXgoNSwgbWF4Uyk7CiAgICAgIGNvbnN0IGhlYWRYPU1hdGguc2luKHAueWF3KSwgaGVhZFo9TWF0aC5jb3MocC55YXcpOwogICAgICBjb25zdCBjcm9zcyA9IE1hdGguYWJzKCgtZHopKmhlYWRYICsgZHgqaGVhZFopOwogICAgICBjb25zdCBjb3N0ID0gTWF0aC5hYnModEFJIC0gcC50KSArIDAuMDAyOCpjcm9zcyArIDAuMDAwNSpkaXN0OwogICAgICBpZiAoY29zdCA8IGJlc3RDb3N0KXsgYmVzdENvc3Q9Y29zdDsgYmVzdD1wOyB9CiAgICB9CiAgICBjb25zdCBsZWFkQWhlYWQgPSBNYXRoLm1pbigxNiwgTWF0aC5tYXgoNiwgcGxheWVyU3RhdGUuc3BlZWQqMC4zMiArIGhlYXQqMS4zKSk7CiAgICBjb25zdCB0eCA9IGJlc3QueCArIE1hdGguc2luKGJlc3QueWF3KSpsZWFkQWhlYWQ7CiAgICBjb25zdCB0eiA9IGJlc3QueiArIE1hdGguY29zKGJlc3QueWF3KSpsZWFkQWhlYWQ7CiAgICByZXR1cm4ge3g6dHgsIHo6dHosIGRpc3RUb1ByZWQ6IE1hdGguaHlwb3QoYmVzdC54LWF4LCBiZXN0LnotYXopfTsKICB9CgogIC8qID09PT09PT0gTWFpbiBsb29wID09PT09PT0gKi8KICBsZXQgcmVhcldoZWVsUG9zID0gW25ldyBUSFJFRS5WZWN0b3IzKCksIG5ldyBUSFJFRS5WZWN0b3IzKCldOwogIGZ1bmN0aW9uIGFuaW1hdGUoKXsgY29uc3QgZHQ9TWF0aC5taW4oMC4wMzMsIGNsb2NrLmdldERlbHRhKCkpOyBzdGVwKGR0KTsgcmVuZGVyZXIucmVuZGVyKHNjZW5lLCBjYW1lcmEpOyBtYXAuZHJhdygpOyByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7IH0KCiAgZnVuY3Rpb24gc3RlcChkdFJlYWwpewogICAgY29uc3QgZHQgPSBkdFJlYWwgKiB0aW1lU2NhbGU7CgogICAgLy8g4oCU4oCUIElOUFVUIChtb2JpbGUtZmlyc3QpIOKAlOKAlCAvLwogICAgY29uc3QgYWNjZWxUb3VjaCA9IHRvdWNoQWNjZWwgPyAxIDogKHRvdWNoQnJha2UgPyAtMC43IDogMCk7CiAgICBsZXQgYWNjZWwgPSBhY2NlbFRvdWNoOwogICAgbGV0IHN0ZWVyID0gdG91Y2hTdGVlcjsKICAgIGNvbnN0IGhhbmRicmFrZSA9IHRvdWNoRHJpZnQ7CiAgICBjb25zdCBib29zdEtleSAgPSB0b3VjaE5pdHJvOwoKICAgIC8vIG9wdGlvbmFsIGtleXMgKGlmIGtleWJvYXJkIHByZXNlbnQpCiAgICBpZiAoTWF0aC5hYnMoKGtleXNbInciXXx8a2V5c1siYXJyb3d1cCJdPzE6MCkgLSAoa2V5c1sicyJdfHxrZXlzWyJhcnJvd2Rvd24iXT8wLjc6MCkpID4gTWF0aC5hYnMoYWNjZWwpKSB7CiAgICAgIGFjY2VsID0gKGtleXNbInciXXx8a2V5c1siYXJyb3d1cCJdKSA/IDEgOiAoa2V5c1sicyJdfHxrZXlzWyJhcnJvd2Rvd24iXSkgPyAtMC43IDogYWNjZWw7CiAgICB9CiAgICBjb25zdCBzdGVlcktCID0gKGtleXNbImEiXXx8a2V5c1siYXJyb3dsZWZ0Il0pID8gMSA6IChrZXlzWyJkIl18fGtleXNbImFycm93cmlnaHQiXSkgPyAtMSA6IDA7CiAgICBpZiAoTWF0aC5hYnMoc3RlZXJLQikgPiBNYXRoLmFicyhzdGVlcikpIHN0ZWVyID0gc3RlZXJLQjsKCiAgICAvLyBTdGVlcmluZyAmIGJyYWtlcwogICAgcGxheWVyVmVoaWNsZS5zZXRTdGVlcmluZ1ZhbHVlKHN0ZWVyICogMC41LCAwKTsKICAgIHBsYXllclZlaGljbGUuc2V0U3RlZXJpbmdWYWx1ZShzdGVlciAqIDAuNSwgMSk7CiAgICBmb3IobGV0IGk9MDtpPDQ7aSsrKSBwbGF5ZXJWZWhpY2xlLnNldEJyYWtlKGhhbmRicmFrZSA/IDU1IDogMCwgaSk7CgogICAgLy8gTml0cm8KICAgIGNvbnN0IHYgPSBjaGFzc2lzQm9keS52ZWxvY2l0eTsgY29uc3QgaG9yaXpTcGVlZCA9IE1hdGguc3FydCh2Lngqdi54ICsgdi56KnYueik7CiAgICBpZiAoYm9vc3RLZXkgJiYgbml0cm8+MCl7CiAgICAgIG5pdHJvID0gTWF0aC5tYXgoMCwgbml0cm8gLSAwLjM1KmR0UmVhbCk7CiAgICAgIGNvbnN0IGRpciA9IGZvcndhcmRWZWN0b3IoY2hhc3Npc0JvZHkpOwogICAgICBjaGFzc2lzQm9keS5hcHBseUZvcmNlKG5ldyBDQU5OT04uVmVjMyhkaXIueCoyNTAwLCAwLCBkaXIueioyNTAwKSwgY2hhc3Npc0JvZHkucG9zaXRpb24pOwogICAgICBjb25zdCBiYWNrID0gbmV3IFRIUkVFLlZlY3RvcjMoLWRpci54LCAtZGlyLnksIC1kaXIueik7CiAgICAgIGNvbnN0IHAgPSBuZXcgVEhSRUUuVmVjdG9yMyhjaGFzc2lzQm9keS5wb3NpdGlvbi54ICsgYmFjay54KjIuMiwgY2hhc3Npc0JvZHkucG9zaXRpb24ueSswLjUsIGNoYXNzaXNCb2R5LnBvc2l0aW9uLnogKyBiYWNrLnoqMi4yKTsKICAgICAgcGFydGljbGVzLmZsYW1lLnNwYXduKHAsIGJhY2subXVsdGlwbHlTY2FsYXIoOCksIDAuMTIsIDAuOSk7CiAgICAgIGNhbVNoYWtlID0gTWF0aC5taW4oMC40LCBjYW1TaGFrZSArIDAuMDIpOwogICAgICBwbGF5ZXJJc0Jvb3N0aW5nID0gdHJ1ZTsKICAgIH0gZWxzZSB7IG5pdHJvID0gTWF0aC5taW4oMSwgbml0cm8gKyAwLjEyKmR0UmVhbCk7IHBsYXllcklzQm9vc3RpbmcgPSAodHVyYm9UPjApOyB9CiAgICB1aS5uaXRyb0ZpbGwuc3R5bGUud2lkdGggPSAobml0cm8qMTAwKS50b0ZpeGVkKDEpICsgIiUiOwoKICAgIC8vIEFuaW1hdGVkIGZsb29yIHRleHR1cmUgb2Zmc2V0CiAgICBmbG9vclRleC5vZmZzZXQueSArPSAoaG9yaXpTcGVlZCAqIDAuMDAwMzUpICogZHRSZWFsOwoKICAgIC8vIEVuZ2luZSBmb3JjZSDigJQgdHVyYm8gYm9vc3RzIHBvd2VyIGJyaWVmbHkKICAgIGNvbnN0IHRyYWN0aW9uID0gZ3JvdW5kZWRQcmV2ID8gMS4wIDogMC4yNTsKICAgIGNvbnN0IHR1cmJvTXVsID0gdHVyYm9UPjAgPyAxLjggOiAxLjA7CiAgICBjb25zdCBlbmdpbmUgPSAtYWNjZWwgKiAzMjAwICogdHJhY3Rpb24gKiB0dXJib011bDsKICAgIHBsYXllclZlaGljbGUuYXBwbHlFbmdpbmVGb3JjZShlbmdpbmUsIDIpOwogICAgcGxheWVyVmVoaWNsZS5hcHBseUVuZ2luZUZvcmNlKGVuZ2luZSwgMyk7CgogICAgLy8gQW50aS13aGVlbGllICYgYWVybwogICAgaWYgKGdyb3VuZGVkUHJldiAmJiAoYWNjZWwgPiAwLjQgfHwgdHVyYm9UPjApKXsKICAgICAgY29uc3Qgc3AgPSBNYXRoLnNxcnQodi54KnYueCt2Lnoqdi56KTsKICAgICAgc3RhYmlsaXplUGl0Y2goY2hhc3Npc0JvZHksIDE4MDApOwogICAgICBhcHBseUFlcm8oY2hhc3Npc0JvZHksIHNwLCAwLjI4KTsKICAgIH0KCiAgICBpZiAodHVyYm9UPjApewogICAgICBjb25zdCBkaXIgPSBmb3J3YXJkVmVjdG9yKGNoYXNzaXNCb2R5KTsKICAgICAgY2hhc3Npc0JvZHkuYXBwbHlGb3JjZShuZXcgQ0FOTk9OLlZlYzMoZGlyLngqNDUwLCAwLCBkaXIueio0NTApLCBjaGFzc2lzQm9keS5wb3NpdGlvbik7CiAgICAgIGNvbnN0IHNwID0gTWF0aC5zcXJ0KHYueCp2Lngrdi56KnYueik7CiAgICAgIGFwcGx5QWVybyhjaGFzc2lzQm9keSwgc3AsIDAuNTUpOwogICAgICB0dXJib1QgPSBNYXRoLm1heCgwLCB0dXJib1QgLSBkdFJlYWwpOwogICAgfQoKICAgIC8vIEluLWFpciBiYXJyZWwgcm9sbAogICAgaWYgKCFncm91bmRlZFByZXYgJiYgKHRvdWNoUm9sbEwgfHwgdG91Y2hSb2xsUiB8fCBrZXlzWyJhcnJvd2xlZnQiXSB8fCBrZXlzWyJhcnJvd3JpZ2h0Il0pKXsKICAgICAgY29uc3QgZndkID0gZm9yd2FyZFZlY3RvcihjaGFzc2lzQm9keSk7CiAgICAgIGNvbnN0IHJvbGxUb3JxdWUgPSAodG91Y2hSb2xsTCB8fCBrZXlzWyJhcnJvd2xlZnQiXSkgPyAtMTgwMCA6ICh0b3VjaFJvbGxSIHx8IGtleXNbImFycm93cmlnaHQiXSkgPyAxODAwIDogMDsKICAgICAgY2hhc3Npc0JvZHkudG9ycXVlLnggKz0gZndkLnggKiByb2xsVG9ycXVlOwogICAgICBjaGFzc2lzQm9keS50b3JxdWUueSArPSBmd2QueSAqIHJvbGxUb3JxdWU7CiAgICAgIGNoYXNzaXNCb2R5LnRvcnF1ZS56ICs9IGZ3ZC56ICogcm9sbFRvcnF1ZTsKICAgIH0KCiAgICAvLyBQcmVwYXJlIHByZWRpY3Rpb24gZm9yIGFsbCBBSXMKICAgIHByZXBhcmVQbGF5ZXJQcmVkaWN0aW9uKGR0UmVhbCk7CgogICAgLy8g4oCU4oCUIEFJIHB1cnN1aXQgKG5hdi1ncmFwaCArIHByZWRpY3RpdmUgaW50ZXJjZXB0KSDigJTigJQgLy8KICAgIGNvbnN0IHB2ID0ge3g6Y2hhc3Npc0JvZHkudmVsb2NpdHkueCwgejpjaGFzc2lzQm9keS52ZWxvY2l0eS56fTsKICAgIGlmIChib3RzRW5hYmxlZCl7CiAgICAgIGZvciAobGV0IGk9MDtpPGFpQ2Fycy5sZW5ndGg7aSsrKXsKICAgICAgICBjb25zdCBhaSA9IGFpQ2Fyc1tpXTsKICAgICAgICBjb25zdCB2QSA9IGFpLmJvZHkudmVsb2NpdHk7IGNvbnN0IHNwZCA9IE1hdGguaHlwb3QodkEueCwgdkEueik7CiAgICAgICAgY29uc3QgYXg9YWkuYm9keS5wb3NpdGlvbi54LCBhej1haS5ib2R5LnBvc2l0aW9uLno7CiAgICAgICAgY29uc3QgcHg9Y2hhc3Npc0JvZHkucG9zaXRpb24ueCwgcHo9Y2hhc3Npc0JvZHkucG9zaXRpb24uejsKICAgICAgICBjb25zdCBkaXN0UCA9IE1hdGguaHlwb3QocHgtYXgscHotYXopOwogICAgICAgIGNvbnN0IGFpTWF4ID0gYWlUYXJnZXRTcGVlZCgpOwoKICAgICAgICAvLyBwZXJpb2RpYyBwYXRoIHVwZGF0ZXMgKGNvYXJzZSkKICAgICAgICBhaS5yZXBhdGhUIC09IGR0UmVhbDsKICAgICAgICBpZiAoYWkucmVwYXRoVDw9MCl7CiAgICAgICAgICBhaS5yZXBhdGhUID0gYWlSZXBhdGhCYXNlKCkgKyBNYXRoLnJhbmRvbSgpKjAuMjsKICAgICAgICAgIGNvbnN0IHMgPSBuZWFyZXN0Tm9kZShheCwgYXopLCBnID0gbmVhcmVzdE5vZGUocHggKyBwdi54KjAuOCwgcHogKyBwdi56KjAuOCk7CiAgICAgICAgICBjb25zdCBwYXRoSWR4cyA9IGFTdGFyKHMsZyk7CiAgICAgICAgICBhaS5wYXRoID0gcGF0aElkeHMubWFwKGsgPT4gKHt4Om5hdi5ub2Rlc1trXS54LCB6Om5hdi5ub2Rlc1trXS56fSkpOwogICAgICAgICAgYWkucGF0aElkeCA9IDA7CiAgICAgICAgfQoKICAgICAgICAvLyB0YXJnZXQgY2FsY3VsYXRpb246IHVzZSBwcmVkaWN0aXZlIGludGVyY2VwdCB3aGVuIGNsb3NlOyB1c2UgcGF0aCBhc3Npc3Qgd2hlbiBmYXIKICAgICAgICBjb25zdCB1c2VJbnRlcmNlcHQgPSAoZGlzdFAgPCAxNDApIHx8IChoZWF0Pj0zICYmIGRpc3RQIDwgMjAwKTsKICAgICAgICBsZXQgdGFyZ2V0OwogICAgICAgIGlmICh1c2VJbnRlcmNlcHQpewogICAgICAgICAgdGFyZ2V0ID0gY2hvb3NlSW50ZXJjZXB0KGFpLCBhaU1heCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxldCB0Z3QgPSB7eDpweCArIHB2LngqMC42LCB6OnB6ICsgcHYueiowLjZ9OwogICAgICAgICAgaWYgKGFpLnBhdGgubGVuZ3RoKXsKICAgICAgICAgICAgY29uc3Qgd3AgPSBhaS5wYXRoW01hdGgubWluKGFpLnBhdGhJZHgsIGFpLnBhdGgubGVuZ3RoLTEpXTsKICAgICAgICAgICAgY29uc3QgZHdwID0gTWF0aC5oeXBvdCh3cC54LWF4LCB3cC56LWF6KTsKICAgICAgICAgICAgaWYgKGR3cCA8IDEwICYmIGFpLnBhdGhJZHggPCBhaS5wYXRoLmxlbmd0aC0xKSBhaS5wYXRoSWR4Kys7CiAgICAgICAgICAgIHRndC54ID0gdGd0LngqMC42ICsgd3AueCowLjQ7IHRndC56ID0gdGd0LnoqMC42ICsgd3AueiowLjQ7CiAgICAgICAgICB9CiAgICAgICAgICB0YXJnZXQgPSB7eDp0Z3QueCwgejp0Z3QueiwgZGlzdFRvUHJlZDpkaXN0UH07CiAgICAgICAgfQoKICAgICAgICAvLyBsdW5nZSB3aGVuIGNsb3NlIG9yIGlmIHBsYXllciBpcyBzbG93CiAgICAgICAgaWYgKChkaXN0UCA8IDI0KSB8fCAocGxheWVyU3RhdGUuc3BlZWQ8MS4wICYmIGRpc3RQPDM0KSkgYWkubHVuZ2VUID0gTWF0aC5tYXgoYWkubHVuZ2VULCAwLjkpOwogICAgICAgIGFpLmx1bmdlVCA9IE1hdGgubWF4KDAsIGFpLmx1bmdlVCAtIGR0UmVhbCk7CiAgICAgICAgY29uc3QgbHVuZ2UgPSBhaS5sdW5nZVQgPiAwOwoKICAgICAgICAvLyBzdGVlcmluZwogICAgICAgIGNvbnN0IGYgPSBmb3J3YXJkVmVjdG9yKGFpLmJvZHkpOwogICAgICAgIGNvbnN0IHRvID0geyB4OiB0YXJnZXQueCAtIGF4LCB6OiB0YXJnZXQueiAtIGF6IH07CiAgICAgICAgY29uc3QgZG90ID0gZi54KnRvLnggKyBmLnoqdG8ueiwgY3Jvc3MgPSBmLngqdG8ueiAtIGYueip0by54OwogICAgICAgIGxldCBkZXNpcmVkID0gLU1hdGguYXRhbjIoY3Jvc3MsIGRvdCk7CiAgICAgICAgY29uc3QgYXZvaWQgPSBhaUF2b2lkU3RlZXIoYWkpOwogICAgICAgIGlmICghbHVuZ2UpIGRlc2lyZWQgKz0gYXZvaWQuc3RlZXI7CiAgICAgICAgYWkuc3RlZXJMUCA9IGFpLnN0ZWVyTFAqMC42ICsgZGVzaXJlZCowLjQ7CiAgICAgICAgbGV0IHN0ZWVyQUkgPSBNYXRoLm1heCgtYWlTdGVlckNsYW1wKCksIE1hdGgubWluKGFpU3RlZXJDbGFtcCgpLCBhaS5zdGVlckxQKSk7CiAgICAgICAgYWkudmVoLnNldFN0ZWVyaW5nVmFsdWUoc3RlZXJBSSwgMCk7CiAgICAgICAgYWkudmVoLnNldFN0ZWVyaW5nVmFsdWUoc3RlZXJBSSwgMSk7CiAgICAgICAgZm9yKGxldCB3PTA7dzw0O3crKykgYWkudmVoLnNldEJyYWtlKDAsIHcpOwoKICAgICAgICAvLyB0aHJvdHRsZSAvIGJyYWtlCiAgICAgICAgbGV0IGVuZ2luZUFJID0gYWlFbmdpbmVCYXNlKCk7CiAgICAgICAgY29uc3QgdGFyZ2V0U3BkID0gYWlNYXggKiAobHVuZ2UgPyAxLjA1IDogKGRpc3RQPDU1ID8gMS4xMiA6IDEuMCkpOwogICAgICAgIGlmIChNYXRoLmFicyhzdGVlckFJKT4wLjQ1KSBlbmdpbmVBSSAqPSAwLjYyOyBlbHNlIGlmIChNYXRoLmFicyhzdGVlckFJKT4wLjI1KSBlbmdpbmVBSSAqPSAwLjgyOwogICAgICAgIGlmIChzcGQgPiB0YXJnZXRTcGQpIGVuZ2luZUFJICo9IDAuNTsKICAgICAgICBjb25zdCBmd2QgPSBmb3J3YXJkVmVjdG9yKGFpLmJvZHkpOyBpZiAoZndkLnkgPiAwLjEyKSBlbmdpbmVBSSAqPSAwLjU1OwogICAgICAgIGFpLnZlaC5hcHBseUVuZ2luZUZvcmNlKGVuZ2luZUFJLCAyKTsKICAgICAgICBhaS52ZWguYXBwbHlFbmdpbmVGb3JjZShlbmdpbmVBSSwgMyk7CgogICAgICAgIC8vIGx1bmdlIHNob3ZlICsgbGF0ZXJhbCBjb3JyZWN0aW9uCiAgICAgICAgaWYgKGx1bmdlKXsKICAgICAgICAgIGNvbnN0IGxlbj1NYXRoLmh5cG90KHRvLngsdG8ueil8fDEsIG54PXRvLngvbGVuLCBuej10by56L2xlbjsKICAgICAgICAgIGFpLmJvZHkuYXBwbHlGb3JjZShuZXcgQ0FOTk9OLlZlYzMobngqMTY1MCwgMCwgbnoqMTY1MCksIGFpLmJvZHkucG9zaXRpb24pOwogICAgICAgICAgY29uc3QgcGVycFg9LW56LCBwZXJwWj1ueDsgY29uc3QgbGF0ID0gKHZBLngqcGVycFggKyB2QS56KnBlcnBaKTsKICAgICAgICAgIGlmIChNYXRoLmFicyhsYXQpID4gMS4wKXsKICAgICAgICAgICAgY29uc3QgaiA9IC1NYXRoLnNpZ24obGF0KSAqIE1hdGgubWluKDQ4LCBNYXRoLmFicyhsYXQpKjMwKTsKICAgICAgICAgICAgYWkuYm9keS5hcHBseUltcHVsc2UobmV3IENBTk5PTi5WZWMzKHBlcnBYKmosIDAsIHBlcnBaKmopLCBhaS5ib2R5LnBvc2l0aW9uKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGFudGktZmxpcCAmIHN0dWNrIGhhbmRsaW5nCiAgICAgICAgY29uc3QgdXAgPSB1cFZlY3RvcihhaS5ib2R5KTsKICAgICAgICBpZiAodXAueSA8IDAuMTUpeyBhaS51cHNpZGVUICs9IGR0UmVhbDsgaWYgKGFpLnVwc2lkZVQ+MS4wKXsgdXByaWdodEFJKGFpKTsgYWkudXBzaWRlVD0wOyB9IH0gZWxzZSBhaS51cHNpZGVUID0gTWF0aC5tYXgoMCwgYWkudXBzaWRlVCAtIGR0UmVhbCowLjUpOwogICAgICAgIGlmIChzcGQgPCAwLjkpIGFpLnN0dWNrVCArPSBkdFJlYWw7IGVsc2UgYWkuc3R1Y2tUID0gTWF0aC5tYXgoMCwgYWkuc3R1Y2tUIC0gZHRSZWFsKjAuNyk7CiAgICAgICAgaWYgKGFpLnN0dWNrVD4xLjEgJiYgYWkuc3R1Y2tUPDEuNil7IGFpLnZlaC5hcHBseUVuZ2luZUZvcmNlKDEyMDAsIDIpOyBhaS52ZWguYXBwbHlFbmdpbmVGb3JjZSgxMjAwLCAzKTsgfQogICAgICAgIGlmIChhaS5zdHVja1QgPiAzLjApeyByZXNldEFJKGFpKTsgYWkucmVwYXRoVD0wLjI7IH0KICAgICAgfQogICAgfQoKICAgIC8vIFBoeXNpY3MKICAgIHdvcmxkLnN0ZXAoMS82MCwgZHQsIDMpOwoKICAgIC8vIFN5bmMgdmlzdWFscwogICAgY2hhc3Npc01lc2gucG9zaXRpb24uY29weShjaGFzc2lzQm9keS5wb3NpdGlvbik7CiAgICBjaGFzc2lzTWVzaC5xdWF0ZXJuaW9uLmNvcHkoY2hhc3Npc0JvZHkucXVhdGVybmlvbik7CiAgICBmb3IgKGxldCBpPTA7IGk8cGxheWVyVmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKXsKICAgICAgcGxheWVyVmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgY29uc3QgdCA9IHBsYXllclZlaGljbGUud2hlZWxJbmZvc1tpXS53b3JsZFRyYW5zZm9ybTsKICAgICAgcGxheWVyV2hlZWxNZXNoZXNbaV0ucG9zaXRpb24uc2V0KHQucG9zaXRpb24ueCx0LnBvc2l0aW9uLnksdC5wb3NpdGlvbi56KTsKICAgICAgcGxheWVyV2hlZWxNZXNoZXNbaV0ucXVhdGVybmlvbi5zZXQodC5xdWF0ZXJuaW9uLngsdC5xdWF0ZXJuaW9uLnksdC5xdWF0ZXJuaW9uLnosdC5xdWF0ZXJuaW9uLncpOwogICAgICBpZiAoaT49MikgcmVhcldoZWVsUG9zW2ktMl0uc2V0KHQucG9zaXRpb24ueCx0LnBvc2l0aW9uLnksdC5wb3NpdGlvbi56KTsKICAgIH0KICAgIGZvciAoY29uc3QgYWkgb2YgYWlDYXJzKXsKICAgICAgYWkubWVzaC5wb3NpdGlvbi5jb3B5KGFpLmJvZHkucG9zaXRpb24pOwogICAgICBhaS5tZXNoLnF1YXRlcm5pb24uY29weShhaS5ib2R5LnF1YXRlcm5pb24pOwogICAgICBmb3IgKGxldCBpPTA7aTxhaS52ZWgud2hlZWxJbmZvcy5sZW5ndGg7aSsrKXsKICAgICAgICBhaS52ZWgudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgICAgY29uc3QgdCA9IGFpLnZlaC53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGFpLndoZWVsc1tpXS5wb3NpdGlvbi5zZXQodC5wb3NpdGlvbi54LHQucG9zaXRpb24ueSx0LnBvc2l0aW9uLnopOwogICAgICAgIGFpLndoZWVsc1tpXS5xdWF0ZXJuaW9uLnNldCh0LnF1YXRlcm5pb24ueCx0LnF1YXRlcm5pb24ueSx0LnF1YXRlcm5pb24ueix0LnF1YXRlcm5pb24udyk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBHcm91bmQgY29udGFjdAogICAgY29uc3Qgb25Hcm91bmRQbGF5ZXIgPSBwbGF5ZXJWZWhpY2xlLndoZWVsSW5mb3Muc29tZSh3ID0+IHcucmF5Y2FzdFJlc3VsdCAmJiB3LnJheWNhc3RSZXN1bHQuaGFzSGl0KTsKICAgIGdyb3VuZGVkUHJldiA9IG9uR3JvdW5kUGxheWVyOwoKICAgIC8vIOKAlOKAlCBTQ09SSU5HIOKAlOKAlCAvLwogICAgLy8gRHJpZnQgKyBzbW9rZQogICAgewogICAgICBjb25zdCBmd2QgPSBmb3J3YXJkVmVjdG9yKGNoYXNzaXNCb2R5KTsgY29uc3QgcyA9IE1hdGguc3FydCh2Lngqdi54K3Yueip2LnopOwogICAgICBjb25zdCBkb3QgPSAodi54KmZ3ZC54ICsgdi56KmZ3ZC56KSAvIChNYXRoLm1heCgwLjAwMSxzKSpNYXRoLnNxcnQoZndkLngqZndkLngrZndkLnoqZndkLnopKTsKICAgICAgY29uc3Qgc2xpcCA9IE1hdGguYWNvcyhNYXRoLm1heCgtMSwgTWF0aC5taW4oMSwgZG90KSkpICogMTgwL01hdGguUEk7CiAgICAgIGlmIChvbkdyb3VuZFBsYXllciAmJiBzPjQgJiYgc2xpcD4xOCl7CiAgICAgICAgZHJpZnRUaW1lciArPSBkdDsKICAgICAgICBjb25zdCBkcmlmdFB0cyA9IChzbGlwLzIwKSAqIChzLzYpICogMjAgKiBkdDsgYWRkU2NvcmUoZHJpZnRQdHMsICJEcmlmdCIpOwogICAgICAgIGNvbWJvID0gTWF0aC5taW4oMy4wLCBjb21ibyArIDAuMDE1KTsgdWkuY29tYm8udGV4dENvbnRlbnQgPSBgQ29tYm8geCR7Y29tYm8udG9GaXhlZCgxKX1gOwogICAgICAgIGZvciAoY29uc3QgcnAgb2YgcmVhcldoZWVsUG9zKXsKICAgICAgICAgIHBhcnRpY2xlcy5zbW9rZS5zcGF3bihuZXcgVEhSRUUuVmVjdG9yMyhycC54LHJwLnksIHJwLnopLCBuZXcgVEhSRUUuVmVjdG9yMygoTWF0aC5yYW5kb20oKS0wLjUpKjAuNSwwLjMsKE1hdGgucmFuZG9tKCktMC41KSowLjUpLCAwLjM1LCAwLjYsIDAuOCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgeyBkcmlmdFRpbWVyID0gMDsgfQogICAgfQoKICAgIC8vIEFpcnRpbWUsIGZsaXBzCiAgICBpZiAoIW9uR3JvdW5kUGxheWVyKXsKICAgICAgaWYgKCFhaXJib3JuZSl7IGFpcmJvcm5lPXRydWU7IGFpclRpbWU9MDsgcm90QWNjdW09MDsgbGFzdFF1YXQ9Y2hhc3Npc01lc2gucXVhdGVybmlvbi5jbG9uZSgpOyB9CiAgICAgIGFpclRpbWUgKz0gZHQ7CiAgICAgIGNvbnN0IGRxPWxhc3RRdWF0LmNsb25lKCkuaW52ZXJ0KCkubXVsdGlwbHkoY2hhc3Npc01lc2gucXVhdGVybmlvbi5jbG9uZSgpKTsKICAgICAgY29uc3QgYW5nbGU9MipNYXRoLmFjb3MoTWF0aC5tYXgoLTEsTWF0aC5taW4oMSxkcS53KSkpOwogICAgICByb3RBY2N1bSArPSBhbmdsZTsgbGFzdFF1YXQuY29weShjaGFzc2lzTWVzaC5xdWF0ZXJuaW9uKTsKICAgICAgdWkuYWlyLnRleHRDb250ZW50ID0gYWlyVGltZS50b0ZpeGVkKDEpKyJzIjsKICAgIH0gZWxzZSBpZiAoYWlyYm9ybmUpewogICAgICBjb25zdCBmbGlwcyA9IE1hdGguZmxvb3Iocm90QWNjdW0vKDIqTWF0aC5QSSkpOwogICAgICBsZXQgcHRzID0gTWF0aC5yb3VuZChhaXJUaW1lICogMjYwKTsKICAgICAgaWYgKGZsaXBzPjApeyBwdHMgKz0gZmxpcHMgKiAxMjAwOyBmbGFzaChgRmxpcCB4JHtmbGlwc30hYCk7IGF1ZGlvLmJsaXAoNTIwLC4xMiwuMjUpOyB9CiAgICAgIGFkZFNjb3JlKHB0cywgIkFpcnRpbWUiKTsKICAgICAgaWYgKGFpclRpbWUgPiAwLjYpIHsgY29tYm8gPSBNYXRoLm1pbigzLjAsIGNvbWJvICsgMC4yKigxK2ZsaXBzKSk7IH0KICAgICAgdWkuY29tYm8udGV4dENvbnRlbnQgPSBgQ29tYm8geCR7Y29tYm8udG9GaXhlZCgxKX1gOwogICAgICBpZiAoZmxpcHM+PTIgfHwgYWlyVGltZT4xLjIpeyB0aW1lU2NhbGUgPSAwLjM1OyBzbG93bW9UID0gMC41NTsgdWkuc2xvd21vLnN0eWxlLmRpc3BsYXk9J2Jsb2NrJzsgfQogICAgICBhaXJib3JuZT1mYWxzZTsgYWlyVGltZT0wOyB1aS5haXIudGV4dENvbnRlbnQ9IjAuMHMiOwogICAgfSBlbHNlIHsKICAgICAgY29tYm8gPSBNYXRoLm1heCgxLjAsIGNvbWJvIC0gMC4xMipkdFJlYWwpOwogICAgICB1aS5jb21iby50ZXh0Q29udGVudCA9IGBDb21ibyB4JHtjb21iby50b0ZpeGVkKDEpfWA7CiAgICB9CgogICAgLy8g4oCU4oCUIEJvb3N0IHBhZHMg4oCU4oCUIC8vCiAgICB1cGRhdGVCb29zdFBhZHMoZHRSZWFsKTsKCiAgICAvLyDigJTigJQgUGlja3VwcyAvIE9yYnMgJiBIZWF0IOKAlOKAlCAvLwogICAgc3BpblBpY2t1cHMoZHRSZWFsKTsgY2hlY2tQaWNrdXBzKCk7IGNoZWNrT3JicygpOyB1cGRhdGVIZWF0KGR0UmVhbCk7CgogICAgLy8gUG93ZXIgYmFkZ2UKICAgIHNoaWVsZFQgPSBNYXRoLm1heCgwLCBzaGllbGRUIC0gZHRSZWFsKTsKICAgIHNoaWVsZE1lc2gudmlzaWJsZSA9IHNoaWVsZFQgPiAwOwogICAgY29uc3QgcHR4dCA9IFtdOwogICAgaWYgKHR1cmJvVD4wKSBwdHh0LnB1c2goYFR1cmJvICR7dHVyYm9ULnRvRml4ZWQoMSl9c2ApOwogICAgaWYgKHNoaWVsZFQ+MCkgcHR4dC5wdXNoKGBTaGllbGQgJHtzaGllbGRULnRvRml4ZWQoMSl9c2ApOwogICAgdWkucG93ZXJCYWRnZS50ZXh0Q29udGVudCA9IHB0eHQubGVuZ3RoID8gcHR4dC5qb2luKCIg4oCiICIpIDogIuKAlCI7CgogICAgLy8gSFVEICYgYXVkaW8KICAgIGNvbnN0IG1waCA9IE1hdGguc3FydCh2Lngqdi54K3Yueip2LnopICogMi4yMzc7IHVpLnNwZWVkLnRleHRDb250ZW50ID0gTWF0aC5yb3VuZChtcGgpOwogICAgdWkuZ3JhZGUuc3R5bGUub3BhY2l0eSA9IE1hdGgubWluKDAuNDUsIDAuMTAgKyBoZWF0KjAuMDYgKyBtcGgqMC4wMDEyKTsKICAgIGF1ZGlvLmVuZ2luZShtcGgvMTQwLCAwLjEwICsgKHRvdWNoQWNjZWwgPyAwLjEyIDogMCkpOwoKICAgIC8vIFRhZyAvIHNoaWVsZCBrbm9ja2JhY2sKICAgIGlmIChib3RzRW5hYmxlZCl7CiAgICAgIGZvciAoY29uc3QgYWkgb2YgYWlDYXJzKXsKICAgICAgICBjb25zdCBkeCA9IGFpLmJvZHkucG9zaXRpb24ueCAtIGNoYXNzaXNCb2R5LnBvc2l0aW9uLng7CiAgICAgICAgY29uc3QgZHogPSBhaS5ib2R5LnBvc2l0aW9uLnogLSBjaGFzc2lzQm9keS5wb3NpdGlvbi56OwogICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmh5cG90KGR4LGR6KTsKICAgICAgICBpZiAoZGlzdCA8IENBVENIX1JBRElVUyl7CiAgICAgICAgICBpZiAoc2hpZWxkVD4wKXsKICAgICAgICAgICAgY29uc3QgZGlyID0gbmV3IENBTk5PTi5WZWMzKGR4L2Rpc3QsIDAsIGR6L2Rpc3QpOwogICAgICAgICAgICBhaS5ib2R5LmFwcGx5SW1wdWxzZShuZXcgQ0FOTk9OLlZlYzMoZGlyLngqIC0xMiwgNCwgZGlyLnoqIC0xMiksIGFpLmJvZHkucG9zaXRpb24pOwogICAgICAgICAgICBhZGRTY29yZSgxMjAsICJTaGllbGQgYnVtcCIpOyBjYW1TaGFrZSA9IE1hdGgubWluKDAuNSwgY2FtU2hha2UrMC4yKTsKICAgICAgICAgIH0gZWxzZSB7IHJlc2V0Um91bmQoIlRhZ2dlZCEiKTsgYnJlYWs7IH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvLyBDYW1lcmEKICAgIHVwZGF0ZUNhbWVyYShkdFJlYWwsIG1waCk7CgogICAgLy8gU2xvdy1tbyBkZWNheQogICAgaWYgKHNsb3dtb1Q+MCl7IHNsb3dtb1QgLT0gZHRSZWFsOyBpZiAoc2xvd21vVDw9MCl7IHRpbWVTY2FsZT0xOyB1aS5zbG93bW8uc3R5bGUuZGlzcGxheT0nbm9uZSc7IH0gfQoKICAgIGNhbVNoYWtlID0gTWF0aC5tYXgoMCwgY2FtU2hha2UgLSBkdFJlYWwqMC44KTsKICB9CgogIC8qID09PT09PT0gQm9vc3QgcGFkcyBsb2dpYyA9PT09PT09ICovCiAgZnVuY3Rpb24gdXBkYXRlQm9vc3RQYWRzKGR0KXsKICAgIGZvciAoY29uc3QgcGFkIG9mIGJvb3N0cyl7IHBhZC5jb29sID0gTWF0aC5tYXgoMCwgcGFkLmNvb2wgLSBkdCk7IH0KICAgIGZvciAoY29uc3QgcGFkIG9mIGJvb3N0cyl7CiAgICAgIGlmIChwYWQuY29vbD4wKSBjb250aW51ZTsKICAgICAgY29uc3QgZHggPSBjaGFzc2lzQm9keS5wb3NpdGlvbi54IC0gcGFkLnBvcy54OwogICAgICBjb25zdCBkeiA9IGNoYXNzaXNCb2R5LnBvc2l0aW9uLnogLSBwYWQucG9zLno7CiAgICAgIGNvbnN0IGMgPSBNYXRoLmNvcygtcGFkLnJvdFkpLCBzID0gTWF0aC5zaW4oLXBhZC5yb3RZKTsKICAgICAgY29uc3QgbHggPSBkeCpjIC0gZHoqcywgbHogPSBkeCpzICsgZHoqYzsKICAgICAgaWYgKE1hdGguYWJzKGx4KSA8PSBwYWQuc2l6ZS54LzIgJiYgTWF0aC5hYnMobHopIDw9IHBhZC5zaXplLnkvMil7CiAgICAgICAgY29uc3QgcGxheWVyRiA9IGZvcndhcmRWZWN0b3IoY2hhc3Npc0JvZHkpOwogICAgICAgIGNvbnN0IHBhZEYgPSB7IHg6IE1hdGguc2luKHBhZC5yb3RZKSwgejogTWF0aC5jb3MocGFkLnJvdFkpIH07CiAgICAgICAgY29uc3QgYnggPSBwbGF5ZXJGLngqMC42ICsgcGFkRi54KjAuNCwgYnogPSBwbGF5ZXJGLnoqMC42ICsgcGFkRi56KjAuNDsKICAgICAgICBjb25zdCBsZW4gPSBNYXRoLmh5cG90KGJ4LGJ6KXx8MTsKICAgICAgICBjb25zdCBkaXIgPSB7IHg6IGJ4L2xlbiwgejogYnovbGVuIH07CgogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShuZXcgQ0FOTk9OLlZlYzMoZGlyLngqMjIsIDEuMiwgZGlyLnoqMjIpLCBjaGFzc2lzQm9keS5wb3NpdGlvbik7CiAgICAgICAgbml0cm8gPSBNYXRoLm1pbigxLCBuaXRybyArIDAuNzUpOwogICAgICAgIHR1cmJvVCA9IE1hdGgubWF4KHR1cmJvVCwgMS44KTsKICAgICAgICBwdXNoUmluZyhjaGFzc2lzQm9keS5wb3NpdGlvbiwgMi44KTsKICAgICAgICBwYXJ0aWNsZXMuZmxhbWUuc3Bhd24obmV3IFRIUkVFLlZlY3RvcjMoY2hhc3Npc0JvZHkucG9zaXRpb24ueCAtIGRpci54KjIsIDEuMCwgY2hhc3Npc0JvZHkucG9zaXRpb24ueiAtIGRpci56KjIpLCBuZXcgVEhSRUUuVmVjdG9yMygtZGlyLngqNiwwLC1kaXIueio2KSwgMC4xNCwgMS4wKTsKICAgICAgICBhZGRTY29yZSg0NTAsICJCb29zdCBwYWQiKTsKICAgICAgICBhdWRpby5ibGlwKDgyMCwuMTQsLjI4KTsKICAgICAgICBjYW1TaGFrZSA9IE1hdGgubWluKDAuNiwgY2FtU2hha2UgKyAwLjA4KTsKCiAgICAgICAgcGFkLmNvb2wgPSAxLjI7CiAgICAgIH0KICAgIH0KICB9CgogIC8qID09PT09PT0gTWF0aCBoZWxwZXJzID09PT09PT0gKi8KICBmdW5jdGlvbiBhcHBseUFlcm8oYm9keSwgc3BlZWQsIGs9MC40KXsKICAgIGNvbnN0IGRmID0gayAqIHNwZWVkKnNwZWVkOwogICAgY29uc3QgZndkID0gZm9yd2FyZFZlY3Rvcihib2R5KTsKICAgIGNvbnN0IHBGcm9udCA9IG5ldyBDQU5OT04uVmVjMyhib2R5LnBvc2l0aW9uLnggKyBmd2QueCoxLjYsIGJvZHkucG9zaXRpb24ueSswLjQsIGJvZHkucG9zaXRpb24ueiArIGZ3ZC56KjEuNik7CiAgICBjb25zdCBwUmVhciAgPSBuZXcgQ0FOTk9OLlZlYzMoYm9keS5wb3NpdGlvbi54IC0gZndkLngqMS42LCBib2R5LnBvc2l0aW9uLnkrMC40LCBib2R5LnBvc2l0aW9uLnogLSBmd2QueioxLjYpOwogICAgY29uc3QgRiA9IG5ldyBDQU5OT04uVmVjMygwLCAtZGYsIDApOwogICAgYm9keS5hcHBseUZvcmNlKEYsIHBGcm9udCk7IGJvZHkuYXBwbHlGb3JjZShGLCBwUmVhcik7CiAgfQogIGZ1bmN0aW9uIHN0YWJpbGl6ZVBpdGNoKGJvZHksIGs9MjAwMCl7CiAgICBjb25zdCBmd2QgPSBmb3J3YXJkVmVjdG9yKGJvZHkpOwogICAgY29uc3QgcmlnaHQgPSByaWdodFZlY3Rvcihib2R5KTsKICAgIGNvbnN0IHBpdGNoID0gZndkLnk7CiAgICBib2R5LnRvcnF1ZS54ICs9IHJpZ2h0LnggKiAtcGl0Y2ggKiBrOwogICAgYm9keS50b3JxdWUueSArPSByaWdodC55ICogLXBpdGNoICogazsKICAgIGJvZHkudG9ycXVlLnogKz0gcmlnaHQueiAqIC1waXRjaCAqIGs7CiAgICBib2R5LmFuZ3VsYXJWZWxvY2l0eS54ICo9IDAuOTk1OwogICAgYm9keS5hbmd1bGFyVmVsb2NpdHkueSAqPSAwLjk5NzsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnogKj0gMC45OTU7CiAgfQogIGZ1bmN0aW9uIHVwVmVjdG9yKGJvZHkpeyBjb25zdCBxPW5ldyBUSFJFRS5RdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbi54LGJvZHkucXVhdGVybmlvbi55LGJvZHkucXVhdGVybmlvbi56LGJvZHkucXVhdGVybmlvbi53KTsgY29uc3QgdT1uZXcgVEhSRUUuVmVjdG9yMygwLDEsMCkuYXBwbHlRdWF0ZXJuaW9uKHEpOyByZXR1cm4gdTsgfQogIGZ1bmN0aW9uIHVwcmlnaHRBSShhaSl7CiAgICBjb25zdCBxPW5ldyBUSFJFRS5RdWF0ZXJuaW9uKGFpLmJvZHkucXVhdGVybmlvbi54LGFpLmJvZHkucXVhdGVybmlvbi55LGFpLmJvZHkucXVhdGVybmlvbi56LGFpLmJvZHkucXVhdGVybmlvbi53KTsKICAgIGNvbnN0IGU9bmV3IFRIUkVFLkV1bGVyKCkuc2V0RnJvbVF1YXRlcm5pb24ocSwiWFlaIik7IGFpLmJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoMCxlLnksMCwiWFlaIik7CiAgICBhaS5ib2R5LmFuZ3VsYXJWZWxvY2l0eS5zZXQoMCwwLDApOyBhaS5ib2R5LnZlbG9jaXR5LnkgPSBNYXRoLm1heChhaS5ib2R5LnZlbG9jaXR5LnksIDEuNSk7CiAgfQoKICAvKiA9PT09PT09IENhbWVyYSA9PT09PT09ICovCiAgZnVuY3Rpb24gdXBkYXRlQ2FtZXJhKGR0LCBtcGgpewogICAgaWYgKGNhbWVyYU1vZGU9PT0iY2hhc2UiKXsKICAgICAgY29uc3QgbG9va0FoZWFkID0gMC4wMiAqIE1hdGgubWluKDYwLCBtcGgpOwogICAgICBjb25zdCBmb3J3YXJkID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwwLDEpLmFwcGx5UXVhdGVybmlvbihjaGFzc2lzTWVzaC5xdWF0ZXJuaW9uKTsKICAgICAgY29uc3QgdXAgPSBuZXcgVEhSRUUuVmVjdG9yMygwLDEsMCk7CiAgICAgIGNvbnN0IHRhcmdldCA9IGNoYXNzaXNNZXNoLnBvc2l0aW9uLmNsb25lKCkuYWRkKGZvcndhcmQuY2xvbmUoKS5tdWx0aXBseVNjYWxhcihsb29rQWhlYWQpKTsKICAgICAgbGV0IGRlc2lyZWQgPSBjaGFzc2lzTWVzaC5wb3NpdGlvbi5jbG9uZSgpCiAgICAgICAgLmFkZCh1cC5tdWx0aXBseVNjYWxhcigxLjYgKyBNYXRoLm1pbigyLjIsIG1waC82MCkpKQogICAgICAgIC5hZGQoZm9yd2FyZC5tdWx0aXBseVNjYWxhcigtNy4wIC0gTWF0aC5taW4oMy4wLCBtcGgvNDApKSk7CiAgICAgIGlmIChjYW1TaGFrZT4wKXsKICAgICAgICBkZXNpcmVkLmFkZChuZXcgVEhSRUUuVmVjdG9yMygoTWF0aC5yYW5kb20oKS0wLjUpKmNhbVNoYWtlLChNYXRoLnJhbmRvbSgpLTAuNSkqY2FtU2hha2UqMC41LChNYXRoLnJhbmRvbSgpLTAuNSkqY2FtU2hha2UpKTsKICAgICAgfQogICAgICBjb25zdCBsZXJwID0gMSAtIE1hdGgucG93KDAuMDAxLCBkdCk7CiAgICAgIGNhbWVyYS5wb3NpdGlvbi5sZXJwKGRlc2lyZWQsIGxlcnApOyBjYW1lcmEubG9va0F0KHRhcmdldCk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBmd2QgPSBuZXcgVEhSRUUuVmVjdG9yMygwLDAsMSkuYXBwbHlRdWF0ZXJuaW9uKGNoYXNzaXNNZXNoLnF1YXRlcm5pb24pOwogICAgICBjb25zdCByaWdodCA9IG5ldyBUSFJFRS5WZWN0b3IzKCkuY3Jvc3NWZWN0b3JzKG5ldyBUSFJFRS5WZWN0b3IzKDAsMSwwKSwgZndkKS5ub3JtYWxpemUoKTsKICAgICAgY29uc3QgcG9zID0gY2hhc3Npc01lc2gucG9zaXRpb24uY2xvbmUoKS5hZGQocmlnaHQubXVsdGlwbHlTY2FsYXIoMTApKS5hZGQobmV3IFRIUkVFLlZlY3RvcjMoMCw2LDApKS5hZGQoZndkLmNsb25lKCkubXVsdGlwbHlTY2FsYXIoMTApKTsKICAgICAgY2FtZXJhLnBvc2l0aW9uLmxlcnAocG9zLCAwLjE1KTsgY2FtZXJhLmxvb2tBdChjaGFzc2lzTWVzaC5wb3NpdGlvbik7CiAgICB9CiAgfQoKICAvKiA9PT09PT09IFJlc2V0IChIZWF0IGtlcHQpID09PT09PT0gKi8KICBmdW5jdGlvbiByZXNldEFJKGFpKXsKICAgIGFpLmJvZHkucG9zaXRpb24uc2V0KGFpLnNwYXduLngsIDMsIGFpLnNwYXduLnopOwogICAgYWkuYm9keS52ZWxvY2l0eS5zZXQoMCwwLDApOwogICAgYWkuYm9keS5hbmd1bGFyVmVsb2NpdHkuc2V0KDAsMCwwKTsKICAgIGFpLmJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoMCwwLDApOwogICAgYWkuc3R1Y2tUID0gMDsgYWkucGF0aC5sZW5ndGg9MDsgYWkucGF0aElkeD0wOyBhaS5yZXBhdGhUPTAuMjsgYWkubHVuZ2VUPTA7CiAgfQogIGZ1bmN0aW9uIHJlc2V0UGxheWVyKCl7CiAgICBjb25zdCBzcCA9IE1BUFNbY3VycmVudE1hcF0ucGxheWVyU3Bhd247CiAgICBjaGFzc2lzQm9keS5wb3NpdGlvbi5zZXQoc3AueCwgc3AueSwgc3Aueik7CiAgICBjaGFzc2lzQm9keS52ZWxvY2l0eS5zZXQoMCwwLDApOwogICAgY2hhc3Npc0JvZHkuYW5ndWxhclZlbG9jaXR5LnNldCgwLDAsMCk7CiAgICBjaGFzc2lzQm9keS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcigwLDAsMCk7CiAgICBjaGFzc2lzQm9keS53YWtlVXAoKTsKICAgIGNvbWJvID0gTWF0aC5tYXgoMS4wLCBjb21ibyAqIDAuOCk7IHVpLmNvbWJvLnRleHRDb250ZW50ID0gYENvbWJvIHgke2NvbWJvLnRvRml4ZWQoMSl9YDsKICAgIHJlY29uY2lsZUJvdHNUb0hlYXQoKTsKICB9CiAgZnVuY3Rpb24gcmVzZXRSb3VuZChyZWFzb24peyBpZihyZWFzb24peyBmbGFzaChyZWFzb24pOyB9IHJlc2V0UGxheWVyKCk7IGZvciAoY29uc3QgYWkgb2YgYWlDYXJzKSByZXNldEFJKGFpKTsgfQoKICAvKiA9PT09PT09IEJvb3QgPT09PT09PSAqLwogIGluaXRUaHJlZSgpOwogIGluaXRQaHlzaWNzKCk7CiAgYnVpbGRQbGF5ZXIoKTsKICBwYXJ0aWNsZXMuc21va2UgPSBjcmVhdGVTcHJpdGVQb29sKG1ha2VDaXJjbGVUZXh0dXJlKCdyZ2JhKDE2MCwxNzAsMTkwLDAuOSknLCdyZ2JhKDIwLDMwLDUwLDAuMCknKSwgMTEwLCBUSFJFRS5Ob3JtYWxCbGVuZGluZyk7CiAgcGFydGljbGVzLmZsYW1lID0gY3JlYXRlU3ByaXRlUG9vbChtYWtlQ2lyY2xlVGV4dHVyZSgncmdiYSgyNTUsMjAwLDkwLDAuOTUpJywncmdiYSgyNTUsODAsMCwwLjApJyksIDUwLCBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nKTsKICBwYXJ0aWNsZXMucmluZyAgPSBjcmVhdGVTcHJpdGVQb29sKG1ha2VDaXJjbGVUZXh0dXJlKCdyZ2JhKDI1NSwxNjAsNjAsMC45KScsJ3JnYmEoMjU1LDgwLDAsMC4wKScpLCAxMiwgVEhSRUUuQWRkaXRpdmVCbGVuZGluZyk7CiAgcmVjb25jaWxlQm90c1RvSGVhdCgpOwogICQoIiNidG5EaWZmIikudGV4dENvbnRlbnQgPSAnRGlmZmljdWx0eTogJyArIERJRkZbZGlmZl0ubmFtZTsKICAkKCIjYnRuTWFwIikudGV4dENvbnRlbnQgID0gJ01hcDogJyArIE1BUFNbY3VycmVudE1hcF0ubmFtZTsKICBjbG9jayA9IG5ldyBUSFJFRS5DbG9jaygpOwogIHNldHVwTW9iaWxlQ29udHJvbHMoKTsKICBhbmltYXRlKCk7Cgp9KSgpOwo8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==";
  const PHONE = "data:text/html;base64,PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEsIG1heGltdW0tc2NhbGU9MSwgdXNlci1zY2FsYWJsZT1ubywgdmlld3BvcnQtZml0PWNvdmVyIiAvPgo8dGl0bGU+SW5mZXJubyBEcmlmdDwvdGl0bGU+CjxtZXRhIG5hbWU9InRoZW1lLWNvbG9yIiBjb250ZW50PSIjMGIxMjIwIiAvPgo8bWV0YSBuYW1lPSJhcHBsZS1tb2JpbGUtd2ViLWFwcC1jYXBhYmxlIiBjb250ZW50PSJ5ZXMiIC8+CjxtZXRhIG5hbWU9ImFwcGxlLW1vYmlsZS13ZWItYXBwLXRpdGxlIiBjb250ZW50PSJJbmZlcm5vIERyaWZ0IiAvPgo8bWV0YSBuYW1lPSJhcHBsZS1tb2JpbGUtd2ViLWFwcC1zdGF0dXMtYmFyLXN0eWxlIiBjb250ZW50PSJibGFjay10cmFuc2x1Y2VudCIgLz4KPG1ldGEgbmFtZT0iZm9ybWF0LWRldGVjdGlvbiIgY29udGVudD0idGVsZXBob25lPW5vIiAvPgo8c3R5bGU+CiAgOnJvb3R7CiAgICAtLWluazojZTlmMmZmOyAtLW11dGVkOiNhNmI1Yzg7IC0tYmc6IzBiMTIyMDsgLS1odWQ6IzBmMWEyYTsgLS1saW5lOiMxZjJhNDQ7CiAgICAtLXBSYW1wOiM3YWE3ZmY7IC0tcFBsYXQ6I2IwYmFmZjsgLS1wQmFuazojN2VkMWEyOwogICAgLS1zYWZlVG9wOiBlbnYoc2FmZS1hcmVhLWluc2V0LXRvcCwgMHB4KTsKICAgIC0tc2FmZVJpZ2h0OiBlbnYoc2FmZS1hcmVhLWluc2V0LXJpZ2h0LCAwcHgpOwogICAgLS1zYWZlQm90dG9tOiBlbnYoc2FmZS1hcmVhLWluc2V0LWJvdHRvbSwgMHB4KTsKICAgIC0tc2FmZUxlZnQ6IGVudihzYWZlLWFyZWEtaW5zZXQtbGVmdCwgMHB4KTsKICAgIC0tY3RybFc6IGNsYW1wKDU2cHgsIDE2dncsIDg4cHgpOwogICAgLS1jdHJsSDogY2xhbXAoMzZweCwgMTF2aCwgNTJweCk7CiAgICAtLXBhZFNpemU6IGNsYW1wKDEwNHB4LCAyNHZ3LCAxNDBweCk7CiAgICAtLWtub2JTaXplOiBjbGFtcCgzNHB4LCA2LjV2aCwgNDZweCk7CiAgfQogICp7Ym94LXNpemluZzpib3JkZXItYm94fQogIGh0bWwsYm9keXtoZWlnaHQ6MTAwJX0KICBib2R5ewogICAgbWFyZ2luOjA7IGJhY2tncm91bmQ6IzBiMTIyMDsgY29sb3I6dmFyKC0taW5rKTsgZm9udC1mYW1pbHk6SW50ZXIsc3lzdGVtLXVpLFNlZ29lIFVJLFJvYm90byxBcmlhbDsKICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsgdXNlci1zZWxlY3Q6bm9uZTsgdG91Y2gtYWN0aW9uOm5vbmU7IG92ZXJzY3JvbGwtYmVoYXZpb3I6bm9uZTsgaGVpZ2h0OjEwMHN2aDsKICB9CiAgY2FudmFze2Rpc3BsYXk6YmxvY2t9CgogIC8qIEhVRCAqLwogIC5odWR7cG9zaXRpb246Zml4ZWQ7IGxlZnQ6NTAlOyB0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTsgdG9wOmNhbGMoNnB4ICsgdmFyKC0tc2FmZVRvcCkpOwogICAgICAgZGlzcGxheTpmbGV4OyBnYXA6NnB4OyB6LWluZGV4OjExOyBtYXgtd2lkdGg6OTZ2dzsgZmxleC13cmFwOndyYXA7IGp1c3RpZnktY29udGVudDpjZW50ZXJ9CiAgLmNhcmR7YmFja2dyb3VuZDpsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCMwZjFhMmEsIzBiMTQyMik7IGJvcmRlcjoxcHggc29saWQgdmFyKC0tbGluZSk7IGJvcmRlci1yYWRpdXM6MTJweDsgcGFkZGluZzo2cHggOHB4fQogIC5jYXJkIGgze21hcmdpbjowIDAgMnB4OyBmb250OjcwMCAxMHB4LzEgSW50ZXIsc3lzdGVtLXVpOyBjb2xvcjojYTZiNWM4OyB0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7IGxldHRlci1zcGFjaW5nOi4zcHh9CiAgLmJpZ3tmb250LXdlaWdodDo5MDA7IGZvbnQtc2l6ZToxOHB4fQogIC5jbGlja2FibGV7Y3Vyc29yOnBvaW50ZXJ9CiAgLmJhcntoZWlnaHQ6OXB4OyBiYWNrZ3JvdW5kOiMwYTE0MjA7IGJvcmRlcjoxcHggc29saWQgdmFyKC0tbGluZSk7IGJvcmRlci1yYWRpdXM6OTk5cHg7IG92ZXJmbG93OmhpZGRlbn0KICAuZmlsbHtoZWlnaHQ6MTAwJTsgYmFja2dyb3VuZDpsaW5lYXItZ3JhZGllbnQoOTBkZWcsI2ZmZDE2NiwjZjVhZDNhKTsgd2lkdGg6MCV9CiAgLmJhZGdle2Rpc3BsYXk6aW5saW5lLWJsb2NrOyBwYWRkaW5nOjJweCA4cHg7IGJvcmRlci1yYWRpdXM6OTk5cHg7IGJhY2tncm91bmQ6IzExMjEzYTsgYm9yZGVyOjFweCBzb2xpZCAjMjEzNTVkOyBmb250LXdlaWdodDo4MDA7IGZvbnQtc2l6ZToxMXB4fQogIC5oZWF0U3RhcnN7bGV0dGVyLXNwYWNpbmc6MXB4OyBjb2xvcjojZmZkMTY2fQogIC5jb29sdHh0e2ZvbnQtd2VpZ2h0OjcwMDsgY29sb3I6I2E2YjVjODsgZm9udC1zaXplOjEwcHh9CiAgLm9wdHtkaXNwbGF5Om5vbmV9IEBtZWRpYSAobWluLXdpZHRoOiA4MjBweCl7IC5vcHR7ZGlzcGxheTpibG9ja30gfQoKICAvKiBNZW51ICovCiAgLm1lbnVGYWJ7cG9zaXRpb246Zml4ZWQ7IHRvcDpjYWxjKDZweCArIHZhcigtLXNhZmVUb3ApKTsgcmlnaHQ6Y2FsYyg2cHggKyB2YXIoLS1zYWZlUmlnaHQpKTsKICAgICAgICAgICB3aWR0aDo0MnB4OyBoZWlnaHQ6NDJweDsgYm9yZGVyLXJhZGl1czoxMXB4OyBiYWNrZ3JvdW5kOiMxMDIwMzc7IGNvbG9yOiNjZmUzZmY7CiAgICAgICAgICAgYm9yZGVyOjFweCBzb2xpZCAjMmEzZDYzOyBmb250LXdlaWdodDo5MDA7IGZvbnQtc2l6ZToxOHB4OyB6LWluZGV4OjE1fQogIC5wYW5lbHtwb3NpdGlvbjpmaXhlZDsgdG9wOmNhbGMoNTJweCArIHZhcigtLXNhZmVUb3ApKTsgcmlnaHQ6Y2FsYyg2cHggKyB2YXIoLS1zYWZlUmlnaHQpKTsKICAgICAgICAgYmFja2dyb3VuZDojMGUxNzMwOyBib3JkZXI6MXB4IHNvbGlkICMyYTNiNWE7IGJvcmRlci1yYWRpdXM6MTRweDsgcGFkZGluZzoxMHB4OyBkaXNwbGF5Om5vbmU7IHotaW5kZXg6MTU7IHdpZHRoOm1pbigyNjBweCwgODR2dyl9CiAgLnBhbmVsIC5wYnRue2Rpc3BsYXk6YmxvY2s7IHdpZHRoOjEwMCU7IG1hcmdpbjo2cHggMDsgcGFkZGluZzoxMHB4IDEycHg7IGJvcmRlci1yYWRpdXM6MTBweDsgYm9yZGVyOjFweCBzb2xpZCAjMmEzZDYzOyBiYWNrZ3JvdW5kOiMxMDIwMzc7IGNvbG9yOiNjZmUzZmY7IGZvbnQtd2VpZ2h0OjkwMDsgdGV4dC1hbGlnbjpsZWZ0fQoKICAvKiBNaW5pbWFwICovCiAgI21pbmltYXB7cG9zaXRpb246Zml4ZWQ7IHRvcDpjYWxjKDZweCArIHZhcigtLXNhZmVUb3ApKTsgbGVmdDpjYWxjKDZweCArIHZhcigtLXNhZmVMZWZ0KSk7CiAgICAgICAgICAgd2lkdGg6MTI0cHg7IGhlaWdodDoxMjRweDsgYm9yZGVyOjFweCBzb2xpZCB2YXIoLS1saW5lKTsgYmFja2dyb3VuZDojMGIxNDIyY2M7IGJvcmRlci1yYWRpdXM6MTJweDsgei1pbmRleDo5OyBpbWFnZS1yZW5kZXJpbmc6cGl4ZWxhdGVkOyBwb2ludGVyLWV2ZW50czpub25lfQogIEBtZWRpYSAobWluLXdpZHRoOiA4MjBweCl7ICNtaW5pbWFweyB3aWR0aDoxNzJweDsgaGVpZ2h0OjE3MnB4IH0gfQoKICAvKiBGZWVkICovCiAgI2ZlZWR7cG9zaXRpb246Zml4ZWQ7IHRvcDpjYWxjKDU2cHggKyB2YXIoLS1zYWZlVG9wKSk7IGxlZnQ6NTAlOyB0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTsKICAgICAgICB3aWR0aDptaW4oMzQwcHgsIDg0dncpOyBtYXgtaGVpZ2h0OjI0dmg7IG92ZXJmbG93OmhpZGRlbjsgZGlzcGxheTpmbGV4OyBmbGV4LWRpcmVjdGlvbjpjb2x1bW4tcmV2ZXJzZTsgZ2FwOjZweDsgei1pbmRleDoxMX0KICAuZmVlZEl0ZW17YmFja2dyb3VuZDojMGMxNTI2Y2M7IGJvcmRlcjoxcHggc29saWQgdmFyKC0tbGluZSk7IGJvcmRlci1yYWRpdXM6MTJweDsgcGFkZGluZzo2cHggOHB4OyBmb250LXdlaWdodDo4MDA7IGRpc3BsYXk6ZmxleDsganVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47IHRyYW5zZm9ybTp0cmFuc2xhdGVYKDApOyBvcGFjaXR5OjE7IHRyYW5zaXRpb246b3BhY2l0eSAuNnMsIHRyYW5zZm9ybSAuNnM7IGZvbnQtc2l6ZToxM3B4fQogIC5mZWVkSXRlbS5mYWRle29wYWNpdHk6MDsgdHJhbnNmb3JtOnRyYW5zbGF0ZVgoMTBweCl9CiAgLmZlZWRQdHN7Y29sb3I6I2ZmZDE2Nn0KCiAgLyogT3ZlcmxheXMgKi8KICAudG9hc3R7cG9zaXRpb246Zml4ZWQ7IGxlZnQ6NTAlOyB0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTsgdG9wOmNhbGMoMTZweCArIHZhcigtLXNhZmVUb3ApKTsgYmFja2dyb3VuZDojMGUxYTJjOyBib3JkZXI6MXB4IHNvbGlkIHZhcigtLWxpbmUpOyBib3JkZXItcmFkaXVzOjEycHg7IHBhZGRpbmc6OHB4IDEycHg7IGRpc3BsYXk6bm9uZTsgei1pbmRleDoxMn0KICAuZXJyb3JiYXJ7cG9zaXRpb246Zml4ZWQ7IGxlZnQ6MDsgdG9wOjA7IHBhZGRpbmc6OHB4IDEycHg7IGJhY2tncm91bmQ6IzZiMWExYTsgY29sb3I6I2ZmZjsgZm9udC13ZWlnaHQ6ODAwOyBkaXNwbGF5Om5vbmU7IHotaW5kZXg6MTAwOyBmb250LXNpemU6MTJweH0KICAjc2xvd21ve3Bvc2l0aW9uOmZpeGVkOyBsZWZ0OjUwJTsgdG9wOjUwJTsgdHJhbnNmb3JtOnRyYW5zbGF0ZSgtNTAlLC01MCUpOyBmb250OjkwMCAyNHB4LzEgSW50ZXI7IGxldHRlci1zcGFjaW5nOjFweDsgY29sb3I6I2ZmZDE2NjsgdGV4dC1zaGFkb3c6MCAycHggMTRweCAjMDAwOyBkaXNwbGF5Om5vbmU7IHotaW5kZXg6MjB9CiAgI2dyYWRle3Bvc2l0aW9uOmZpeGVkOyBpbnNldDowOyBwb2ludGVyLWV2ZW50czpub25lOyB6LWluZGV4OjU7IGJhY2tncm91bmQ6cmFkaWFsLWdyYWRpZW50KGVsbGlwc2UgODAlIDYwJSBhdCA1MCUgNjAlLCByZ2JhKDI1NSwxMjAsNDAsMC4xNiksIHJnYmEoMCwwLDAsMCkgNjAlKTsgb3BhY2l0eTouMTA7IHRyYW5zaXRpb246b3BhY2l0eSAuMjVzIGVhc2V9CgogIC8qIE1vYmlsZSBjb250cm9scyAqLwogIC5tb2JpbGVDdHJsc3twb3NpdGlvbjpmaXhlZDsgaW5zZXQ6YXV0byAwIDAgMDsgei1pbmRleDoxNDsgcG9pbnRlci1ldmVudHM6bm9uZTsgcGFkZGluZy1ib3R0b206dmFyKC0tc2FmZUJvdHRvbSl9CiAgLnN0ZWVyUGFke3Bvc2l0aW9uOmFic29sdXRlOyBsZWZ0OmNhbGMoOHB4ICsgdmFyKC0tc2FmZUxlZnQpKTsgYm90dG9tOmNhbGMoOHB4ICsgdmFyKC0tc2FmZUJvdHRvbSkpOwogICAgICAgICAgICB3aWR0aDp2YXIoLS1wYWRTaXplKTsgaGVpZ2h0OnZhcigtLXBhZFNpemUpOyBib3JkZXItcmFkaXVzOjUwJTsgYmFja2dyb3VuZDojMGUxYTJjY2M7IGJvcmRlcjoxcHggc29saWQgIzJhM2I1YTsgYm94LXNoYWRvdzowIDEwcHggMjJweCByZ2JhKDAsMCwwLC40KTsKICAgICAgICAgICAgcG9pbnRlci1ldmVudHM6YXV0bzsgdG91Y2gtYWN0aW9uOm5vbmU7IC13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjogdHJhbnNwYXJlbnQ7fQogICNzdGVlcktub2J7cG9zaXRpb246YWJzb2x1dGU7IGxlZnQ6NTAlOyB0b3A6NTAlOyB3aWR0aDp2YXIoLS1rbm9iU2l6ZSk7IGhlaWdodDp2YXIoLS1rbm9iU2l6ZSk7IHRyYW5zZm9ybTp0cmFuc2xhdGUoLTUwJSwtNTAlKTsgYm9yZGVyLXJhZGl1czo1MCU7IGJhY2tncm91bmQ6IzE3MjY0MjsgYm9yZGVyOjNweCBzb2xpZCAjM2E1ZDliOyBib3gtc2hhZG93OjAgNnB4IDE2cHggcmdiYSgwLDAsMCwuNCl9CiAgLnJpZ2h0QnRuc3twb3NpdGlvbjphYnNvbHV0ZTsgcmlnaHQ6Y2FsYyg4cHggKyB2YXIoLS1zYWZlUmlnaHQpKTsgYm90dG9tOmNhbGMoOHB4ICsgdmFyKC0tc2FmZUJvdHRvbSkpOwogICAgICAgICAgICAgZGlzcGxheTpncmlkOyBnYXA6OHB4OyBwb2ludGVyLWV2ZW50czphdXRvOyBncmlkLXRlbXBsYXRlLWFyZWFzOgogICAgICAgICAgICAgIm5pdHJvIGJyYWtlIiAiZ2FzIGRyaWZ0IiAicm9sbEwgcm9sbFIiOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6dmFyKC0tY3RybFcpIHZhcigtLWN0cmxXKTsgZ3JpZC10ZW1wbGF0ZS1yb3dzOnZhcigtLWN0cmxIKSB2YXIoLS1jdHJsSCkgNDZweH0KICAubUJ0bntiYWNrZ3JvdW5kOiMxMDIwMzc7IGNvbG9yOiNlOWYyZmY7IGJvcmRlcjoxcHggc29saWQgIzJhM2Q2MzsgYm9yZGVyLXJhZGl1czoxMnB4OyBmb250LXdlaWdodDo5MDA7IGZvbnQtc2l6ZToxNXB4OyBib3gtc2hhZG93OjAgMTBweCAyMnB4IHJnYmEoMCwwLDAsLjQpOyB0b3VjaC1hY3Rpb246bm9uZTsgdXNlci1zZWxlY3Q6bm9uZTsgLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yOiB0cmFuc3BhcmVudDt9CiAgI2J0bkdhc3tncmlkLWFyZWE6Z2FzOyBmb250LXNpemU6MTlweH0gI2J0bkRyaWZ0e2dyaWQtYXJlYTpkcmlmdH0gI2J0bk5pdHJve2dyaWQtYXJlYTpuaXRyb30gI2J0bkJyYWtle2dyaWQtYXJlYTpicmFrZX0KICAjYnRuUm9sbEx7Z3JpZC1hcmVhOnJvbGxMOyBmb250LXNpemU6MTNweH0gI2J0blJvbGxSe2dyaWQtYXJlYTpyb2xsUjsgZm9udC1zaXplOjEzcHh9CgogIC8qIE9yaWVudGF0aW9uIGhlbHBlciAqLwogICNvcmllbnR7cG9zaXRpb246Zml4ZWQ7IGluc2V0OjA7IGRpc3BsYXk6bm9uZTsgYWxpZ24taXRlbXM6Y2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOyB6LWluZGV4OjYwOyBiYWNrZ3JvdW5kOnJnYmEoNywxMCwxOCwwLjgyKTsgY29sb3I6I2U5ZjJmZjsgdGV4dC1hbGlnbjpjZW50ZXI7IHBhZGRpbmc6MjBweDsgZm9udDo5MDAgMThweC8xLjQgSW50ZXJ9CgogIC8qIE1hbnVhbCAqLwogICNtYW51YWx7cG9zaXRpb246Zml4ZWQ7IGluc2V0OjA7IHotaW5kZXg6NTA7IGRpc3BsYXk6bm9uZTsgYWxpZ24taXRlbXM6Y2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOyBiYWNrZ3JvdW5kOnJnYmEoNywxMCwxOCwwLjc4KTsgYmFja2Ryb3AtZmlsdGVyOnNhdHVyYXRlKDExMCUpIGJsdXIoNnB4KX0KICAubWFudWFsQm94e3dpZHRoOm1pbig5MjBweCw5MnZ3KTsgbWF4LWhlaWdodDo4MnN2aDsgb3ZlcmZsb3c6YXV0bzsgYmFja2dyb3VuZDojMGUxNzMwOyBib3JkZXI6MXB4IHNvbGlkICMyYTNiNWE7IGJvcmRlci1yYWRpdXM6MTZweDsgcGFkZGluZzoxNnB4IDE4cHg7IGNvbG9yOiNlOWYyZmZ9CiAgLm1hbnVhbEJveCBoMnttYXJnaW46MCAwIDEwcHg7IGZvbnQ6OTAwIDIycHgvMS4yIEludGVyfQogIC5tYW51YWxCb3ggaDN7bWFyZ2luOjE0cHggMCA2cHg7IGZvbnQ6OTAwIDE0cHgvMS4xIEludGVyOyBjb2xvcjojYTZiNWM4OyB0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7IGxldHRlci1zcGFjaW5nOi40cHh9CiAgLm1hbnVhbEJveCBwe21hcmdpbjo2cHggMCA4cHh9CiAgLm1hbnVhbEdyaWR7ZGlzcGxheTpncmlkOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6MWZyIDFmcjsgZ2FwOjEwcHh9CiAgLm1hbnVhbEJveCB1bHttYXJnaW46NnB4IDAgMTBweCAxOHB4fQogIC5tYW51YWxCb3ggbGl7bWFyZ2luOjRweCAwfQogIC5tYW51YWxDbG9zZXtwb3NpdGlvbjpzdGlja3k7IHRvcDowOyBkaXNwbGF5OmZsZXg7IGp1c3RpZnktY29udGVudDpmbGV4LWVuZDsgbWFyZ2luOi02cHggLTZweCAxMHB4IDB9CiAgLnhidG57YmFja2dyb3VuZDojMTUyNDQ0OyBjb2xvcjojY2ZlM2ZmOyBib3JkZXI6MXB4IHNvbGlkICMyOTQwNmI7IGJvcmRlci1yYWRpdXM6MTBweDsgcGFkZGluZzo2cHggMTBweDsgY3Vyc29yOnBvaW50ZXI7IGZvbnQtd2VpZ2h0OjkwMH0KICBAbWVkaWEgKG1heC13aWR0aDogNzIwcHgpeyAubWFudWFsR3JpZHtncmlkLXRlbXBsYXRlLWNvbHVtbnM6MWZyfSB9Cjwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CjwhLS0gSFVEIC0tPgo8ZGl2IGNsYXNzPSJodWQiPgogIDxkaXYgY2xhc3M9ImNhcmQiPjxoMz5TY29yZSAodGFwIHRvIHNoYXJlKTwvaDM+PGRpdiBjbGFzcz0iYmlnIGNsaWNrYWJsZSIgaWQ9InNjb3JlIj4wPC9kaXY+PGRpdiBpZD0iY29tYm8iIHN0eWxlPSJmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjExcHg7Y29sb3I6I2NmZTNmZiI+Q29tYm8geDEuMDwvZGl2PjwvZGl2PgogIDxkaXYgY2xhc3M9ImNhcmQiPjxoMz5OaXRybzwvaDM+PGRpdiBjbGFzcz0iYmFyIiBzdHlsZT0id2lkdGg6MTQwcHgiPjxkaXYgaWQ9Im5pdHJvRmlsbCIgY2xhc3M9ImZpbGwiPjwvZGl2PjwvZGl2PjwvZGl2PgogIDxkaXYgY2xhc3M9ImNhcmQiPjxoMz5IZWF0PC9oMz48ZGl2IGNsYXNzPSJiaWciPjxzcGFuIGlkPSJoZWF0U3RhcnMiIGNsYXNzPSJoZWF0U3RhcnMiPuKYhuKYhuKYhuKYhuKYhjwvc3Bhbj48L2Rpdj48ZGl2IGNsYXNzPSJiYWRnZSIgaWQ9ImhlYXRCYWRnZSI+Q2FsbTwvZGl2PjxkaXYgY2xhc3M9ImNvb2x0eHQiIGlkPSJjb29sVHh0Ij48L2Rpdj48L2Rpdj4KICA8ZGl2IGNsYXNzPSJjYXJkIG9wdCI+PGgzPlNwZWVkPC9oMz48ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGdhcDo2cHg7IGFsaWduLWl0ZW1zOmJhc2VsaW5lIj48c3BhbiBjbGFzcz0iYmlnIiBpZD0ic3BlZWQiPjA8L3NwYW4+PHNwYW4gc3R5bGU9ImNvbG9yOiNhNmI1Yzg7Zm9udC1zaXplOjExcHgiPm1waDwvc3Bhbj48L2Rpdj48L2Rpdj4KICA8ZGl2IGNsYXNzPSJjYXJkIG9wdCI+PGgzPlBvd2VyPC9oMz48ZGl2IGlkPSJwb3dlckJhZGdlIiBjbGFzcz0iYmFkZ2UiPuKAlDwvZGl2PjwvZGl2Pgo8L2Rpdj4KCjwhLS0gTWVudSAtLT4KPGJ1dHRvbiBpZD0iYnRuTWVudSIgY2xhc3M9Im1lbnVGYWIiIGFyaWEtbGFiZWw9Ik1lbnUiPuKYsDwvYnV0dG9uPgo8ZGl2IGlkPSJtZW51UGFuZWwiIGNsYXNzPSJwYW5lbCI+CiAgPGJ1dHRvbiBpZD0iYnRuSGVscCIgY2xhc3M9InBidG4iPkhvdyB0byBQbGF5PC9idXR0b24+CiAgPGJ1dHRvbiBpZD0iYnRuTWFwIiAgY2xhc3M9InBidG4iPk1hcDogU3R1bnQgQXJlbmE8L2J1dHRvbj4KICA8YnV0dG9uIGlkPSJidG5Cb3RzIiBjbGFzcz0icGJ0biI+Qm90czogT048L2J1dHRvbj4KICA8YnV0dG9uIGlkPSJidG5EaWZmIiBjbGFzcz0icGJ0biI+RGlmZmljdWx0eTogTm9ybWFsPC9idXR0b24+CiAgPGJ1dHRvbiBpZD0iYnRuUGVyZiIgY2xhc3M9InBidG4iPlBlcmZvcm1hbmNlOiBBdXRvPC9idXR0b24+CiAgPGJ1dHRvbiBpZD0iYnRuTXV0ZSIgY2xhc3M9InBidG4iPlNvdW5kOiBPTjwvYnV0dG9uPgo8L2Rpdj4KCjwhLS0gTWluaW1hcCAmIGZlZWQgLS0+CjxjYW52YXMgaWQ9Im1pbmltYXAiIHdpZHRoPSIxNzIiIGhlaWdodD0iMTcyIj48L2NhbnZhcz4KPGRpdiBpZD0iZmVlZCI+PC9kaXY+Cgo8IS0tIE1vYmlsZSBjb250cm9scyAtLT4KPGRpdiBjbGFzcz0ibW9iaWxlQ3RybHMiIGlkPSJtb2JpbGVDdHJscyI+CiAgPGRpdiBjbGFzcz0ic3RlZXJQYWQiIGlkPSJzdGVlclBhZCI+PGRpdiBpZD0ic3RlZXJLbm9iIj48L2Rpdj48L2Rpdj4KICA8ZGl2IGNsYXNzPSJyaWdodEJ0bnMiPgogICAgPGJ1dHRvbiBpZD0iYnRuTml0cm8iIGNsYXNzPSJtQnRuIj5OaXRybzwvYnV0dG9uPgogICAgPGJ1dHRvbiBpZD0iYnRuQnJha2UiIGNsYXNzPSJtQnRuIj5CcmFrZTwvYnV0dG9uPgogICAgPGJ1dHRvbiBpZD0iYnRuR2FzIiBjbGFzcz0ibUJ0biI+R2FzPC9idXR0b24+CiAgICA8YnV0dG9uIGlkPSJidG5EcmlmdCIgY2xhc3M9Im1CdG4iPkRyaWZ0PC9idXR0b24+CiAgICA8YnV0dG9uIGlkPSJidG5Sb2xsTCIgY2xhc3M9Im1CdG4iPlJvbGwg4peAPC9idXR0b24+CiAgICA8YnV0dG9uIGlkPSJidG5Sb2xsUiIgY2xhc3M9Im1CdG4iPlJvbGwg4pa2PC9idXR0b24+CiAgPC9kaXY+CjwvZGl2PgoKPGRpdiBpZD0iZ3JhZGUiPjwvZGl2Pgo8ZGl2IGNsYXNzPSJ0b2FzdCIgaWQ9InRvYXN0Ij5OaWNlITwvZGl2Pgo8ZGl2IGlkPSJzbG93bW8iPlNMT1figJFNTyE8L2Rpdj4KPGRpdiBpZD0iZXJyIiBjbGFzcz0iZXJyb3JiYXIiPjwvZGl2Pgo8ZGl2IGlkPSJvcmllbnQiPlJvdGF0ZSB5b3VyIGRldmljZSB0byA8Yj5sYW5kc2NhcGU8L2I+IGZvciB0aGUgYmVzdCBkcml2aW5nIGV4cGVyaWVuY2UuPC9kaXY+Cgo8IS0tIE1hbnVhbCAoRXhwYW5kZWQpIC0tPgo8ZGl2IGlkPSJtYW51YWwiPgogIDxkaXYgY2xhc3M9Im1hbnVhbEJveCI+CiAgICA8ZGl2IGNsYXNzPSJtYW51YWxDbG9zZSI+PGJ1dHRvbiBpZD0ibWFudWFsQ2xvc2UiIGNsYXNzPSJ4YnRuIj5DbG9zZSDinJU8L2J1dHRvbj48L2Rpdj4KICAgIDxoMj5JbmZlcm5vIERyaWZ0IOKAlCBDb21wbGV0ZSBIb3figJFUbzwvaDI+CgogICAgPGRpdiBjbGFzcz0ibWFudWFsR3JpZCI+CiAgICAgIDwhLS0gTEVGVCBDT0xVTU4gLS0+CiAgICAgIDxkaXY+CiAgICAgICAgPGgzPlF1aWNrIFN0YXJ0ICg2MOKAkXNlY29uZCBwcmltZXIpPC9oMz4KICAgICAgICA8b2wgc3R5bGU9Im1hcmdpbjo2cHggMCAxMHB4IDE4cHgiPgogICAgICAgICAgPGxpPkhvbGQgPGI+R2FzPC9iPiwgc3RlZXIgd2l0aCB0aGUgYmlnIDxiPmxlZnQgY2lyY2xlPC9iPi48L2xpPgogICAgICAgICAgPGxpPkhvbGQgPGI+RHJpZnQ8L2I+IHdoaWxlIHN0ZWVyaW5nIHRvIHNsaWRlOyByZWxlYXNlIHRvIHJlZ2FpbiBncmlwLjwvbGk+CiAgICAgICAgICA8bGk+SGl0IDxiPkJvb3N0IFBhZHM8L2I+IChuZW9uIGdyZWVuKSBmb3IgYSBsYXVuY2gsIG5pdHJvIHJlZmlsbCwgYW5kIHR1cmJvLjwvbGk+CiAgICAgICAgICA8bGk+VGFwIDxiPlJvbGwg4peAL+KWtjwvYj4gbWlk4oCRYWlyIGZvciBiYXJyZWwgcm9sbHMgKHBvaW50cyEpLjwvbGk+CiAgICAgICAgICA8bGk+QXZvaWQgYm90cy4gSWYgdGhleSA8Yj50YWc8L2I+IHlvdSwgeW91IHJlc3Bhd27igJRidXQgPGI+SGVhdCBzdGF5czwvYj4uPC9saT4KICAgICAgICA8L29sPgoKICAgICAgICA8aDM+T2JqZWN0aXZlPC9oMz4KICAgICAgICA8cD5SYWNrIHVwIGEgaHVnZSBzY29yZSBieSBjaGFpbmluZyA8Yj5kcmlmdHM8L2I+LCA8Yj5haXJ0aW1lPC9iPiwgPGI+ZmxpcHM8L2I+LCBvciA8Yj5ib29zdOKAkXBhZDwvYj4gaGl0cy4gS2VlcCB5b3VyIDxiPmNvbWJvPC9iPiBhbGl2ZSBhbmQgYnVpbGQgPGI+SGVhdDwvYj4gdG8gbXVsdGlwbHkgcG9pbnRzLiBTdXJ2aXZlIHRoZSBib3RzIGh1bnRpbmcgeW91IHdpdGggcHJlZGljdGl2ZSBpbnRlcmNlcHRzLjwvcD4KCiAgICAgICAgPGgzPk1vYmlsZSBDb250cm9sczwvaDM+CiAgICAgICAgPHVsPgogICAgICAgICAgPGxpPjxiPlN0ZWVyIFBhZDwvYj4gKGxlZnQpOiBkcmFnIHRvd2FyZCB0aGUgZWRnZSB0byBzdGVlciBoYXJkZXIuIE5ldXRyYWwgPSBjZW50ZXIuPC9saT4KICAgICAgICAgIDxsaT48Yj5HYXM8L2I+IC8gPGI+QnJha2U8L2I+IChyaWdodCk6IGdvIC8gc2xvdy48L2xpPgogICAgICAgICAgPGxpPjxiPkRyaWZ0PC9iPjogaG9sZCB3aGlsZSBzdGVlcmluZyB0byBzbGlkZSAoZ3JlYXQgZm9yIHBvaW50cyArIHRpZ2h0IHR1cm5zKS48L2xpPgogICAgICAgICAgPGxpPjxiPk5pdHJvPC9iPjogYnVyc3Qgc3BlZWQgd2hpbGUgeW91IGhhdmUgY2hhcmdlIChiYXIgaW4gSFVEKS48L2xpPgogICAgICAgICAgPGxpPjxiPlJvbGwg4peAL+KWtjwvYj46IGJhcnJlbCByb2xsIHdoaWxlIGFpcmJvcm5lIGZvciBmbGlwIHBvaW50cy48L2xpPgogICAgICAgICAgPGxpPjxiPk1lbnU8L2I+ICjimLAgdG9w4oCRcmlnaHQpOiBIZWxwLCBNYXAsIEJvdHMgb24vb2ZmLCBEaWZmaWN1bHR5LCBQZXJmb3JtYW5jZSwgU291bmQuPC9saT4KICAgICAgICA8L3VsPgoKICAgICAgICA8aDM+RGVza3RvcCBGYWxsYmFjazwvaDM+CiAgICAgICAgPHVsPgogICAgICAgICAgPGxpPjxiPlcvUzwvYj4gPSBnYXMvYnJha2UsIDxiPkEvRDwvYj4gPSBzdGVlci48L2xpPgogICAgICAgICAgPGxpPjxiPkFycm93IOKXgC/ilrY8L2I+IG1pZOKAkWFpciA9IGJhcnJlbCByb2xsLjwvbGk+CiAgICAgICAgICA8bGk+PGI+UjwvYj4gPSByZXNldCB0byBzcGF3biwgPGI+QzwvYj4gPSBjYW1lcmEgbW9kZSwgPGI+TTwvYj4gPSBtdXRlLjwvbGk+CiAgICAgICAgICA8bGk+VGlwOiB5b3UgY2FuIHN0aWxsIGRyaWZ0IGJ5IHRhcHBpbmcgYnJha2UgYW5kIHN0ZWVyaW5n4oCUbW9iaWxlIGhhcyBhIGRlZGljYXRlZCBEcmlmdCBidXR0b24uPC9saT4KICAgICAgICA8L3VsPgoKICAgICAgICA8aDM+U2NvcmluZyAmIENvbWJvczwvaDM+CiAgICAgICAgPHVsPgogICAgICAgICAgPGxpPjxiPkRyaWZ0PC9iPjogZWFybiBwb2ludHMgcGVyIHNlY29uZCBiYXNlZCBvbiBzbGlkZSBhbmdsZSAmYW1wOyBzcGVlZC4gU3Ryb25nZXIgc2xpZGUgPSBtb3JlIHBvaW50cy48L2xpPgogICAgICAgICAgPGxpPjxiPkFpcnRpbWU8L2I+OiB+MjYwIHB0cy9zZWMgaW4gdGhlIGFpci4gTGFuZGluZyBjbGVhbmx5IGtlZXBzIGNvbWJvIGFsaXZlLjwvbGk+CiAgICAgICAgICA8bGk+PGI+RmxpcHM8L2I+OiBlYWNoIGZ1bGwgcm9sbCBhZGRzIGEgYmlnIGJvbnVzIChzdGFja2FibGUpLjwvbGk+CiAgICAgICAgICA8bGk+PGI+Qm9vc3QgUGFkczwvYj46IGF3YXJkIGJvbnVzIHBvaW50cyBhbmQga2VlcCB5b3VyIGZsb3cgZ29pbmcuPC9saT4KICAgICAgICAgIDxsaT48Yj5Db21ibzwvYj46IHN0YXJ0IGF0IHgxLjA7IGdyb3dzIGFzIHlvdSBjb250aW51b3VzbHkgcGVyZm9ybSB0cmlja3MvbGFuZGluZ3MuIERlY2F5cyBpZiB5b3UgY3J1aXNlIHRvbyBsb25nLjwvbGk+CiAgICAgICAgICA8bGk+VGFwIHRoZSA8Yj5TY29yZTwvYj4gbnVtYmVyIHRvIHNoYXJlL2NvcHkgeW91ciBydW4uPC9saT4KICAgICAgICA8L3VsPgoKICAgICAgICA8aDM+SGVhdCAoU3RhciBNZXRlcik8L2gzPgogICAgICAgIDx1bD4KICAgICAgICAgIDxsaT5FYXJuIHBvaW50cyDihpIgZmlsbCBIZWF0LiBNb3JlIEhlYXQgPSA8Yj5oaWdoZXIgc2NvcmUgbXVsdGlwbGllcjwvYj4gYW5kIDxiPnNtYXJ0ZXIvZmFzdGVyIGJvdHM8L2I+LjwvbGk+CiAgICAgICAgICA8bGk+SGVhdCBoYXMgNiB0aWVyczogQ2FsbSDihpIgTm90aWNlZCDihpIgQ2hhc2VkIOKGkiBIb3Qg4oaSIEJsYXppbmcg4oaSIDxiPkluZmVybm88L2I+LjwvbGk+CiAgICAgICAgICA8bGk+SGVhdCA8Yj5wZXJzaXN0czwvYj4gd2hlbiB5b3UgcmVzZXQgb3IgZ2V0IHRhZ2dlZC48L2xpPgogICAgICAgICAgPGxpPlN0b3Agc2NvcmluZyB0b28gbG9uZyBhbmQgSGVhdCB3aWxsIHN0YXJ0IGEgdmlzaWJsZSA8Yj5jb29sZG93bjwvYj4gdGltZXIgYW5kIGRyb3AgYnkgMSB0aWVyLjwvbGk+CiAgICAgICAgPC91bD4KICAgICAgPC9kaXY+CgogICAgICA8IS0tIFJJR0hUIENPTFVNTiAtLT4KICAgICAgPGRpdj4KICAgICAgICA8aDM+V29ybGQsIE1hcHMgJiBMYW5kbWFya3M8L2gzPgogICAgICAgIDx1bD4KICAgICAgICAgIDxsaT48Yj5TdHVudCBBcmVuYTwvYj46IHJhbXBzLCBiYW5rcywgcGxhdGZvcm1zLCBob29wcywgc3RyYXRlZ2ljIGJvb3N0IHBhZHMuPC9saT4KICAgICAgICAgIDxsaT48Yj5BbGzigJFUZXJyYWluIER1bmVzPC9iPjogZmxvd2luZyBiYW5rcyBhbmQgbG9uZyBib29zdOKAkWxpbmUgcm91dGVzLjwvbGk+CiAgICAgICAgICA8bGk+PGI+TWluaW1hcDwvYj4gKHRvcOKAkWxlZnQpOiB5b3UgPSBncmVlbiBjYXI7IGJvdHMgPSByZWQgY2FyczsgcGFkcyA9IGdyZWVuIHNxdWFyZXM7IGhvb3BzID0gb3JhbmdlIHJpbmdzOyBvcmJzID0gcHVycGxlLjwvbGk+CiAgICAgICAgICA8bGk+Q2hhbmdlIG1hcCB2aWEgPGI+TWVudSDihpIgTWFwPC9iPiAoYWxzbyByZXNwYXducyB5b3UgYXQgdGhhdCBtYXDigJlzIHN0YXJ0KS48L2xpPgogICAgICAgIDwvdWw+CgogICAgICAgIDxoMz5Cb29zdCwgTml0cm8gJiBQaWNrdXBzPC9oMz4KICAgICAgICA8dWw+CiAgICAgICAgICA8bGk+PGI+Qm9vc3QgUGFkczwvYj46IGluc3RhbnQgbGF1bmNoICsgPGI+bml0cm8gKyB0dXJibzwvYj4uIFBhZHMgYWxzbyByZWFsaWduIHlvdXIgcHVzaCB0b3dhcmQgdGhlaXIgYXJyb3cgZGlyZWN0aW9uLjwvbGk+CiAgICAgICAgICA8bGk+PGI+Tml0cm8gQ2FuczwvYj46IHJlZmlsbCB0aGUgbml0cm8gYmFyIChIVUQpLjwvbGk+CiAgICAgICAgICA8bGk+PGI+U2hpZWxkIFJpbmdzPC9iPjogdGVtcG9yYXJ5IHNoaWVsZCB0aGF0IGxldHMgeW91IDxiPmJvdW5jZTwvYj4gYm90cyBhbmQga2VlcCByb2xsaW5nLjwvbGk+CiAgICAgICAgICA8bGk+PGI+T3JiczwvYj46IHF1aWNrIHBvaW50IHBpY2t1cHMgc2NhdHRlcmVkIGFyb3VuZCB0aGUgYXJlbmEuPC9saT4KICAgICAgICA8L3VsPgoKICAgICAgICA8aDM+Qm90cyAmIERpZmZpY3VsdHk8L2gzPgogICAgICAgIDx1bD4KICAgICAgICAgIDxsaT5Cb3RzIHJ1biBhIHByZWRpY3RpdmUgaW50ZXJjZXB0ICh0aGV5IHJlYWQgeW91ciBzcGVlZCwgeWF3LCBhbmQgdHVybuKAkXJhdGUpIGFuZCA8Yj5sdW5nZTwvYj4gd2hlbiBjbG9zZS48L2xpPgogICAgICAgICAgPGxpPlVzZSA8Yj5NZW51IOKGkiBCb3RzPC9iPiB0byB0b2dnbGUgT04vT0ZGIChwcmFjdGljZSBtb2RlKS48L2xpPgogICAgICAgICAgPGxpPjxiPkRpZmZpY3VsdHk8L2I+OiBFYXN5IC8gTm9ybWFsIC8gSGFyZCBjaGFuZ2VzIGJvdCBjb3VudCwgc3RlZXJpbmcgYWdncmVzc2lvbiwgYW5kIHBhY2UuPC9saT4KICAgICAgICAgIDxsaT48Yj5JbmZlcm5vIEhlYXQ8L2I+IHN1cGVyY2hhcmdlcyBjaGFzZSBzcGVlZCBhbmQgY3V04oCRb2ZmIGJlaGF2aW9y4oCUZXhwZWN0IGRlY2lzaXZlIHJhbXMuPC9saT4KICAgICAgICA8L3VsPgoKICAgICAgICA8aDM+SFVELCBNZW51ICYgVXRpbGl0aWVzPC9oMz4KICAgICAgICA8dWw+CiAgICAgICAgICA8bGk+PGI+U2NvcmU8L2I+OiB0YXAgdG8gc2hhcmUvY29weS4gPGI+Tml0cm8gYmFyPC9iPjogeWVsbG93IGZpbGwuIDxiPkhlYXQ8L2I+OiBzdGFyIHJvdyArIGJhZGdlLjwvbGk+CiAgICAgICAgICA8bGk+PGI+UGVyZm9ybWFuY2U8L2I+IChBdXRvL0hpZ2gvTGl0ZS9VbHRyYSk6IHRyYWRlIHZpc3VhbHMgdnMuIEZQU+KAlHBob25lIHN0cnVnZ2xpbmc/IFRyeSA8Yj5MaXRlPC9iPiAoZmV3ZXIgZWZmZWN0cykgb3IgPGI+VWx0cmE8L2I+IChzaW1wbGVzdCB2aXN1YWxzKS48L2xpPgogICAgICAgICAgPGxpPjxiPlNvdW5kPC9iPjogdG9nZ2xlIGluIG1lbnUgb3IgcHJlc3MgPGI+TTwvYj4gb24gZGVza3RvcC48L2xpPgogICAgICAgICAgPGxpPjxiPkNhbWVyYTwvYj46IHByZXNzIDxiPkM8L2I+IChkZXNrdG9wKSB0byBzd2l0Y2ggY2hhc2Uvb3JiaXQuPC9saT4KICAgICAgICAgIDxsaT48Yj5SZXNldDwvYj46IGdldHRpbmcgYnVsbGllZD8gR2V0dGluZyB0YWdnZWQgYXV0b+KAkXJlc3Bhd25zLiBEZXNrdG9wIGNhbiBwcmVzcyA8Yj5SPC9iPi4gT24gbW9iaWxlLCBzd2l0Y2hpbmcgPGI+TWFwPC9iPiBhbHNvIHJlc3Bhd25zIGF0IHRoZSBtYXDigJlzIHNwYXduLjwvbGk+CiAgICAgICAgPC91bD4KCiAgICAgICAgPGgzPlBybyBUaXBzPC9oMz4KICAgICAgICA8dWw+CiAgICAgICAgICA8bGk+Q2hhaW4gPGI+ZHJpZnRzIOKGkiBib29zdCBwYWQg4oaSIGp1bXAg4oaSIGZsaXAg4oaSIGRyaWZ0PC9iPiB0byBwdW1wIEhlYXQgZmFzdC48L2xpPgogICAgICAgICAgPGxpPk9uIHBhZHMsIGxpbmUgdXAgc3RyYWlnaHQgdG8ga2VlcCBjb250cm9sOyB1c2UgRHJpZnQgdG8gZmluZeKAkWFpbSBtaWTigJFsYXVuY2guPC9saT4KICAgICAgICAgIDxsaT5Cb3RzIGN1dCB5b3Ugb2Zm4oCUZmVpbnQgb25lIHdheSwgPGI+bGlmdCBkcmlmdDwvYj4sIHRoZW4gc25hcCB0aGUgb3RoZXIgdG8gYnJlYWsgaW50ZXJjZXB0aW9uLjwvbGk+CiAgICAgICAgICA8bGk+QWlyIHJvbGwgZWFybHkgZm9yIGJpZyBmbGlwIGJvbnVzZXM7IGxhdGUgY29ycmVjdGlvbnMgYXJlIHJpc2t5LjwvbGk+CiAgICAgICAgICA8bGk+U2hpZWxkIGxldHMgeW91IGNvdW50ZXLigJFyYW0uIFRpbWUgaXQgbmVhciBwYWRzIHRvIGVzY2FwZSB0aGUgc2NydW0uPC9saT4KICAgICAgICA8L3VsPgoKICAgICAgICA8aDM+VHJvdWJsZXNob290aW5nICYgUGVyZm9ybWFuY2U8L2gzPgogICAgICAgIDx1bD4KICAgICAgICAgIDxsaT5Sb3RhdGUgdG8gPGI+bGFuZHNjYXBlPC9iPiBmb3IgdGhlIGxhcmdlc3QgY29udHJvbHMuPC9saT4KICAgICAgICAgIDxsaT5MYWdneT8gT3BlbiA8Yj5NZW51IOKGkiBQZXJmb3JtYW5jZTwvYj4gYW5kIHRyeSA8Yj5MaXRlPC9iPiBvciA8Yj5VbHRyYTwvYj4uPC9saT4KICAgICAgICAgIDxsaT5QcmFjdGljZSByb3V0ZXMgd2l0aCA8Yj5Cb3RzIE9GRjwvYj4sIHRoZW4gZmxpcCB0aGVtIGJhY2sgb24uPC9saT4KICAgICAgICAgIDxsaT5TdHVjayB1cHNpZGXigJFkb3duIGJvdHMgc2VsZuKAkXJlY292ZXI7IGlmIHlvdSBnZXQgc3R1Y2ssIGNoYW5nZSA8Yj5NYXA8L2I+IHRvIHJlc3Bhd24uPC9saT4KICAgICAgICA8L3VsPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxoMz5DaGVhdCBTaGVldDwvaDM+CiAgICA8dWw+CiAgICAgIDxsaT48Yj5HYXM8L2I+ICsgPGI+RHJpZnQ8L2I+ICsgc3RlZXIgPSBzdHlsZSBwb2ludHMuPC9saT4KICAgICAgPGxpPlRhcCA8Yj5OaXRybzwvYj4gb24gc3RyYWlnaHRzOyBzYXZlIGl0IHRvIGVzY2FwZSBsdW5nZXMuPC9saT4KICAgICAgPGxpPjxiPkhlYXQgcGVyc2lzdHM8L2I+IGFmdGVyIHJlc2V0L3RhZy4gS2VlcCBmaWdodGluZy48L2xpPgogICAgICA8bGk+VGFwIDxiPlNjb3JlPC9iPiB0byBzaGFyZSB5b3VyIGJlc3QgcnVuLjwvbGk+CiAgICA8L3VsPgogIDwvZGl2Pgo8L2Rpdj4KCjwhLS0gTGlicyAtLT4KPHNjcmlwdCBzcmM9Imh0dHBzOi8vdW5wa2cuY29tL3RocmVlQDAuMTU5LjAvYnVpbGQvdGhyZWUubWluLmpzIj48L3NjcmlwdD4KPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vY2Fubm9uQDAuNi4yL2J1aWxkL2Nhbm5vbi5taW4uanMiPjwvc2NyaXB0PgoKPHNjcmlwdD4KKGZ1bmN0aW9uKCl7CiAgY29uc3QgR0FNRV9OQU1FID0gIkluZmVybm8gRHJpZnQiOwoKICAvKiA9PT09PSBIZWxwZXJzICYgZXJyb3IgPT09PT0gKi8KICBjb25zdCAkID0gcyA9PiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHMpOwogIGNvbnN0IGVyciA9ICQoJyNlcnInKTsKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlID0+IHsgZXJyLnRleHRDb250ZW50ID0gJ1NjcmlwdCBlcnJvcjogJyArIGUubWVzc2FnZTsgZXJyLnN0eWxlLmRpc3BsYXk9J2Jsb2NrJzsgfSk7CgogIGNvbnN0IGlzSU9TID0gL2lQaG9uZXxpUGFkfGlQb2QvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpOwogIGNvbnN0IGlzTW9iaWxlID0gKCdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdykgfHwgaXNJT1M7CgogIC8qID09PT09IFBlcmZvcm1hbmNlID09PT09ICovCiAgY29uc3QgUEVSRiA9IHsKICAgIG1vZGU6ICdhdXRvJywKICAgIHByOiBNYXRoLm1pbih3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpb3x8MSwgaXNNb2JpbGUgPyAxLjEgOiAxLjM1KSwKICAgIHByTWluOiAwLjc1LCBwck1heDogaXNNb2JpbGUgPyAxLjI1IDogMS42LAogICAgdGFyZ2V0RlBTOiBpc01vYmlsZSA/IDU1IDogNTgsCiAgICBmcmFtZXM6IDAsIGFjYzogMCwgbGFzdEZQUzogNjAsCiAgICBtaW5pbWFwSHo6IGlzTW9iaWxlID8gMTAgOiAxNCwKICAgIG1pbmltYXBPbjogdHJ1ZSwKICAgIGVmZmVjdHM6IHRydWUsCiAgICBtYXhCb3RzOiBpc01vYmlsZSA/IDQgOiA2CiAgfTsKICBmdW5jdGlvbiBzZXRQZXJmVGV4dCgpeyB1aS5idG5QZXJmLnRleHRDb250ZW50ID0gJ1BlcmZvcm1hbmNlOiAnICsgKFBFUkYubW9kZVswXS50b1VwcGVyQ2FzZSgpK1BFUkYubW9kZS5zbGljZSgxKSk7IH0KICBmdW5jdGlvbiBhcHBseVBlcmYobW9kZSl7CiAgICBQRVJGLm1vZGUgPSBtb2RlOwogICAgaWYgKG1vZGU9PT0ndWx0cmEnKXsKICAgICAgUEVSRi5wciA9IE1hdGgubWF4KFBFUkYucHJNaW4sIDAuODUpOwogICAgICBQRVJGLm1pbmltYXBIeiA9IDA7IFBFUkYubWluaW1hcE9uID0gZmFsc2U7IFBFUkYuZWZmZWN0cyA9IGZhbHNlOyBQRVJGLm1heEJvdHMgPSBpc01vYmlsZT8zOjQ7CiAgICAgIHNjZW5lICYmIChzY2VuZS5mb2cgPSBudWxsKTsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dyYWRlJykuc3R5bGUuZGlzcGxheT0nbm9uZSc7CiAgICB9IGVsc2UgewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3JhZGUnKS5zdHlsZS5kaXNwbGF5PScnOwogICAgICBzY2VuZSAmJiAoc2NlbmUuZm9nID0gbmV3IFRIUkVFLkZvZygweDBiMTIyMCwgMTQwLCA2NTApKTsKICAgICAgUEVSRi5taW5pbWFwT24gPSB0cnVlOyBQRVJGLmVmZmVjdHMgPSAobW9kZSE9PSdsaXRlJyk7IFBFUkYubWluaW1hcEh6ID0gKG1vZGU9PT0naGlnaCcpID8gKGlzTW9iaWxlPzE0OjE2KSA6IChtb2RlPT09J2xpdGUnID8gOCA6IChpc01vYmlsZT8xMDoxNCkpOwogICAgICBQRVJGLm1heEJvdHMgPSAobW9kZT09PSdoaWdoJykgPyAoaXNNb2JpbGU/NTo3KSA6IChtb2RlPT09J2xpdGUnID8gKGlzTW9iaWxlPzM6NCkgOiAoaXNNb2JpbGU/NDo2KSk7CiAgICB9CiAgICBpZiAocmVuZGVyZXIpIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8oUEVSRi5wcik7CiAgICBpZiAobWFwICYmIG1hcC5lbCkgbWFwLmVsLnN0eWxlLmRpc3BsYXkgPSBQRVJGLm1pbmltYXBPbiA/ICdibG9jaycgOiAnbm9uZSc7CiAgICByZWNvbmNpbGVCb3RzVG9IZWF0ICYmIHJlY29uY2lsZUJvdHNUb0hlYXQoKTsKICAgIHNldFBlcmZUZXh0KCk7CiAgfQogIGZ1bmN0aW9uIHBlcmZUaWNrKGR0KXsKICAgIFBFUkYuYWNjICs9IGR0OyBQRVJGLmZyYW1lcysrOwogICAgaWYgKFBFUkYuYWNjID49IDAuNSl7CiAgICAgIFBFUkYubGFzdEZQUyA9IFBFUkYuZnJhbWVzIC8gUEVSRi5hY2M7CiAgICAgIFBFUkYuYWNjID0gMDsgUEVSRi5mcmFtZXMgPSAwOwogICAgICBpZiAoUEVSRi5tb2RlID09PSAnYXV0bycpewogICAgICAgIGlmIChQRVJGLmxhc3RGUFMgPCBQRVJGLnRhcmdldEZQUy02KXsgUEVSRi5wciA9IE1hdGgubWF4KFBFUkYucHJNaW4sIFBFUkYucHIgLSAwLjA3KTsgcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyhQRVJGLnByKTsgUEVSRi5tYXhCb3RzID0gTWF0aC5tYXgoMiwgUEVSRi5tYXhCb3RzLTEpOyBQRVJGLm1pbmltYXBIeiA9IE1hdGgubWF4KDYsIFBFUkYubWluaW1hcEh6LTEpOyByZWNvbmNpbGVCb3RzVG9IZWF0KCk7IH0KICAgICAgICBlbHNlIGlmIChQRVJGLmxhc3RGUFMgPiBQRVJGLnRhcmdldEZQUysyKXsgUEVSRi5wciA9IE1hdGgubWluKFBFUkYucHJNYXgsIFBFUkYucHIgKyAwLjA0KTsgcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyhQRVJGLnByKTsgUEVSRi5tYXhCb3RzID0gTWF0aC5taW4oaXNNb2JpbGU/Njo4LCBQRVJGLm1heEJvdHMrMSk7IFBFUkYubWluaW1hcEh6ID0gTWF0aC5taW4oMTYsIFBFUkYubWluaW1hcEh6KzEpOyByZWNvbmNpbGVCb3RzVG9IZWF0KCk7IH0KICAgICAgfQogICAgfQogIH0KCiAgLyogPT09PT0gVUkgPT09PT0gKi8KICBjb25zdCB1aSA9IHsKICAgIHNjb3JlOiAkKCIjc2NvcmUiKSwgY29tYm86ICQoIiNjb21ibyIpLCBzcGVlZDogJCgiI3NwZWVkIiksIG5pdHJvRmlsbDogJCgiI25pdHJvRmlsbCIpLAogICAgaGVhdFN0YXJzOiAkKCIjaGVhdFN0YXJzIiksIGhlYXRCYWRnZTogJCgiI2hlYXRCYWRnZSIpLCBjb29sVHh0OiAkKCIjY29vbFR4dCIpLCBwb3dlckJhZGdlOiAkKCIjcG93ZXJCYWRnZSIpLAogICAgc2xvd21vOiAkKCIjc2xvd21vIiksIGdyYWRlOiAkKCIjZ3JhZGUiKSwgdG9hc3Q6ICQoIiN0b2FzdCIpLAogICAgYnRuTWVudTogJCgiI2J0bk1lbnUiKSwgcGFuZWw6ICQoIiNtZW51UGFuZWwiKSwgYnRuSGVscDogJCgiI2J0bkhlbHAiKSwKICAgIGJ0bkJvdHM6ICQoIiNidG5Cb3RzIiksIGJ0bkRpZmY6ICQoIiNidG5EaWZmIiksIGJ0bk1hcDogJCgiI2J0bk1hcCIpLAogICAgYnRuUGVyZjogJCgiI2J0blBlcmYiKSwgYnRuTXV0ZTogJCgiI2J0bk11dGUiKSwKICAgIG1hbnVhbDogJCgiI21hbnVhbCIpLCBtYW51YWxDbG9zZTogJCgiI21hbnVhbENsb3NlIiksIG9yaWVudDogJCgiI29yaWVudCIpCiAgfTsKCiAgLyogPT09PT0gQ29sbGlzaW9uIGdyb3VwcyA9PT09PSAqLwogIGNvbnN0IEdST1VQX0dST1VORCA9IDEsIEdST1VQX1NUVU5UID0gMiwgR1JPVVBfUExBWUVSID0gNCwgR1JPVVBfQUkgPSA4OwoKICAvKiA9PT09PSBHbG9iYWxzID09PT09ICovCiAgY29uc3QgQVJFTkFfSEFMRiA9IDM4MCwgQ0FUQ0hfUkFESVVTID0gOC4wOwogIGxldCBzY2VuZSwgY2FtZXJhLCByZW5kZXJlciwgY2xvY2s7CiAgbGV0IHdvcmxkLCBwbGF5ZXJWZWhpY2xlLCBjaGFzc2lzQm9keSwgY2hhc3Npc01lc2gsIHBsYXllcldoZWVsTWVzaGVzPVtdOwogIGxldCBib3RzRW5hYmxlZCA9IHRydWUsIGNhbWVyYU1vZGU9ImNoYXNlIjsKICBsZXQgbml0cm89MS4wLCBtdXRlZD1mYWxzZSwgZ3JvdW5kZWRQcmV2PXRydWU7CiAgbGV0IHRpbWVTY2FsZT0xLjAsIHNsb3dtb1Q9MCwgY2FtU2hha2U9MDsKCiAgLyogPT09PT0gUGxheWVyIHN0YXRlIGZvciBBSSA9PT09PSAqLwogIGxldCBwbGF5ZXJJc0Jvb3N0aW5nPWZhbHNlLCBwbGF5ZXJQcmV2U3BlZWQ9MDsKICBsZXQgcGxheWVyU3RhdGU9bnVsbCwgZnV0dXJlUGF0aD1bXTsKCiAgLyogPT09PT0gU2NvcmUgLyBIZWF0ID09PT09ICovCiAgbGV0IHNjb3JlPTAsIGNvbWJvPTEuMDsKICBsZXQgYWlyYm9ybmU9ZmFsc2UsIGFpclRpbWU9MCwgcm90QWNjdW09MCwgbGFzdFF1YXQ9bnVsbCwgZHJpZnRUaW1lcj0wOwogIGNvbnN0IE1BWF9IRUFUPTU7IGxldCBoZWF0PTAsIGhlYXRDaGFyZ2U9MCwgc2luY2VTY29yZVQ9MCwgY29vbFRpbWVyPTA7CiAgZnVuY3Rpb24gaGVhdE5hbWUoaCl7IHJldHVybiBbIkNhbG0iLCJOb3RpY2VkIiwiQ2hhc2VkIiwiSG90IiwiQmxhemluZyIsIkluZmVybm8iXVtoXXx8IkNhbG0iOyB9CiAgZnVuY3Rpb24gaGVhdFNjb3JlTXVsdCgpeyBsZXQgbT0xKzAuMjUqaGVhdDsgaWYoaGVhdD09PU1BWF9IRUFUKSBtKz0wLjc1OyByZXR1cm4gbTsgfQoKICAvKiA9PT09PSBEaWZmaWN1bHR5ICYgQUkgc2NhbGluZyA9PT09PSAqLwogIGNvbnN0IERJRkYgPSBbCiAgICB7IG5hbWU6IkVhc3kiLCAgIGJvdENvdW50RGVsdGE6LTEsIHNwZWVkOjAuOTgsIGVuZ2luZTowLjk1LCBzdGVlcjowLjg4IH0sCiAgICB7IG5hbWU6Ik5vcm1hbCIsIGJvdENvdW50RGVsdGE6IDAsIHNwZWVkOjEuMDAsIGVuZ2luZToxLjAwLCBzdGVlcjoxLjAwIH0sCiAgICB7IG5hbWU6IkhhcmQiLCAgIGJvdENvdW50RGVsdGE6KzEsIHNwZWVkOjEuMTYsIGVuZ2luZToxLjE4LCBzdGVlcjoxLjE0IH0KICBdOwogIGxldCBkaWZmPTE7CiAgY29uc3QgQkFTRV9BSSA9IDM7CiAgZnVuY3Rpb24gaW5mZXJub1NwaWtlKCl7IHJldHVybiBoZWF0PT09TUFYX0hFQVQgPyAxLjIyIDogMS4wOyB9CiAgZnVuY3Rpb24gYWlNYXhTcGVlZCgpeyByZXR1cm4gKDI4ICsgOCpoZWF0KSAqIERJRkZbZGlmZl0uc3BlZWQgKiBpbmZlcm5vU3Bpa2UoKTsgfQogIGZ1bmN0aW9uIHRhcmdldEFJQ291bnQoKXsgY29uc3Qgd2FudCA9IE1hdGgubWF4KDAsIE1hdGgubWluKEJBU0VfQUkgKyBoZWF0ICsgRElGRltkaWZmXS5ib3RDb3VudERlbHRhLCBhaVNwYXducy5sZW5ndGgpKTsgcmV0dXJuIE1hdGgubWluKHdhbnQsIFBFUkYubWF4Qm90cyk7IH0KCiAgLyogPT09PT0gV29ybGQgJiBjb250ZW50ID09PT09ICovCiAgbGV0IGZsb29yTWVzaCwgZmxvb3JUZXg7CiAgbGV0IGJvb3N0cz1bXSwgaG9vcHM9W10sIG1hcFNoYXBlcz1bXTsKICBsZXQgcGlja3Vwcz1bXSwgb3Jicz1bXTsKICBsZXQgc3RPYmpzPVtdOwogIGNvbnN0IHBhcnRpY2xlcyA9IHsgc21va2U6bnVsbCwgZmxhbWU6bnVsbCwgcmluZzpudWxsIH07CiAgY29uc3QgZmVlZEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZlZWQnKTsKCiAgLyogPT09PT0gTWluaW1hcCA9PT09PSAqLwogIGNvbnN0IG1hcCA9IHsKICAgIGVsOiAkKCIjbWluaW1hcCIpLCBjdHg6ICQoIiNtaW5pbWFwIikuZ2V0Q29udGV4dCgiMmQiKSwgdzogMTcyLCBoOiAxNzIsCiAgICB0b1goeCl7IHJldHVybiAoKHgrQVJFTkFfSEFMRikvKEFSRU5BX0hBTEYqMikpKnRoaXMudzsgfSwgdG9ZKHopeyByZXR1cm4gdGhpcy5oIC0gKCh6K0FSRU5BX0hBTEYpLyhBUkVOQV9IQUxGKjIpKSp0aGlzLmg7IH0sCiAgICBkcmF3Q2FySWNvbih4LHoseWF3LGNvbG9yLGhpPWZhbHNlKXsKICAgICAgY29uc3QgY3R4PXRoaXMuY3R4LCBweD10aGlzLnRvWCh4KSwgcHk9dGhpcy50b1koeiksIEw9MTQsVz04OwogICAgICBjdHguc2F2ZSgpOyBjdHgudHJhbnNsYXRlKHB4LHB5KTsgY3R4LnJvdGF0ZSgteWF3KTsKICAgICAgY3R4LmZpbGxTdHlsZT1jb2xvcjsgY3R4Lmdsb2JhbEFscGhhPS45NTsgY3R4LmZpbGxSZWN0KC1MLzIsLVcvMixMLFcpOwogICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5tb3ZlVG8oTC8yLDApOyBjdHgubGluZVRvKEwvMi00LC1XLzIpOyBjdHgubGluZVRvKEwvMi00LFcvMik7IGN0eC5jbG9zZVBhdGgoKTsgY3R4LmZpbGwoKTsKICAgICAgaWYoaGkpeyBjdHguZ2xvYmFsQWxwaGE9LjY7IGN0eC5zdHJva2VTdHlsZT0iIzdiZDg4ZiI7IGN0eC5saW5lV2lkdGg9MjsgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKDAsMCwoTCs0KS8yLDAsTWF0aC5QSSoyKTsgY3R4LnN0cm9rZSgpOyB9CiAgICAgIGN0eC5yZXN0b3JlKCk7IGN0eC5nbG9iYWxBbHBoYT0xOwogICAgfSwKICAgIGRyYXcoKXsKICAgICAgY29uc3QgY3R4PXRoaXMuY3R4LCB3PXRoaXMudywgaD10aGlzLmg7CiAgICAgIGN0eC5jbGVhclJlY3QoMCwwLHcsaCk7IGN0eC5maWxsU3R5bGU9IiMwYzE1MjYiOyBjdHguZmlsbFJlY3QoMCwwLHcsaCk7CiAgICAgIGN0eC5zdHJva2VTdHlsZT0iIzJhM2I1YSI7IGN0eC5saW5lV2lkdGg9MjsgY3R4LnN0cm9rZVJlY3QoMiwyLHctNCxoLTQpOwogICAgICBjb25zdCBzID0gdy8oQVJFTkFfSEFMRioyKTsKICAgICAgZm9yKGNvbnN0IHIgb2YgbWFwU2hhcGVzKXsKICAgICAgICBjdHguc2F2ZSgpOyBjdHgudHJhbnNsYXRlKHRoaXMudG9YKHIueCksIHRoaXMudG9ZKHIueikpOyBjdHgucm90YXRlKC1yLnlhdyk7CiAgICAgICAgY3R4Lmdsb2JhbEFscGhhPXIuYWxwaGE/PzAuMzU7IGN0eC5maWxsU3R5bGU9ci5jb2xvcnx8IiM2YTgyYzIiOwogICAgICAgIGN0eC5maWxsUmVjdCgtKHIudypzKS8yLCAtKHIuZCpzKS8yLCByLncqcywgci5kKnMpOyBjdHgucmVzdG9yZSgpOwogICAgICB9CiAgICAgIGlmICghUEVSRi5taW5pbWFwT24pIHJldHVybjsKICAgICAgY3R4LmZpbGxTdHlsZT0iIzJhZjVhNCI7IGZvcihjb25zdCBiIG9mIGJvb3N0cyl7IGNvbnN0IHg9dGhpcy50b1goYi5wb3MueCksIHk9dGhpcy50b1koYi5wb3Mueik7IGN0eC5maWxsUmVjdCh4LTMseS0zLDYsNik7IH0KICAgICAgY3R4LmZpbGxTdHlsZT0iI2Y1YWQzYSI7IGZvcihjb25zdCBoMiBvZiBob29wcyl7IGNvbnN0IHg9dGhpcy50b1goaDIucG9zLngpLCB5PXRoaXMudG9ZKGgyLnBvcy56KTsgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKHgseSwzLDAsTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsgfQogICAgICBjdHguZmlsbFN0eWxlPSIjYWQ3NmZmIjsgZm9yKGNvbnN0IG8gb2Ygb3Jicyl7IGNvbnN0IHg9dGhpcy50b1goby5wb3NpdGlvbi54KSwgeT10aGlzLnRvWShvLnBvc2l0aW9uLnopOyBjdHguZmlsbFJlY3QoeC0yLHktMiw0LDQpOyB9CiAgICAgIGNvbnN0IHBmID0gZm9yd2FyZFZlY3RvcihjaGFzc2lzQm9keSk7CiAgICAgIHRoaXMuZHJhd0Nhckljb24oY2hhc3Npc0JvZHkucG9zaXRpb24ueCwgY2hhc3Npc0JvZHkucG9zaXRpb24ueiwgTWF0aC5hdGFuMihwZi54LHBmLnopLCAiIzdiZDg4ZiIsIHRydWUpOwogICAgICBmb3IoY29uc3QgYWkgb2YgYWlDYXJzKXsgY29uc3QgZj1mb3J3YXJkVmVjdG9yKGFpLmJvZHkpOyB0aGlzLmRyYXdDYXJJY29uKGFpLmJvZHkucG9zaXRpb24ueCwgYWkuYm9keS5wb3NpdGlvbi56LCBNYXRoLmF0YW4yKGYueCxmLnopLCAiI2VmNDc2ZiIsIGZhbHNlKTsgfQogICAgfQogIH07CgogIC8qID09PT09IFBhcnRpY2xlcyA9PT09PSAqLwogIGZ1bmN0aW9uIG1ha2VDaXJjbGVUZXh0dXJlKGlubmVyLCBvdXRlcil7CiAgICBjb25zdCBjPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOyBjLndpZHRoPWMuaGVpZ2h0PTY0OwogICAgY29uc3QgZz1jLmdldENvbnRleHQoJzJkJyk7IGNvbnN0IGdyZD1nLmNyZWF0ZVJhZGlhbEdyYWRpZW50KDMyLDMyLDEsMzIsMzIsMzIpOwogICAgZ3JkLmFkZENvbG9yU3RvcCgwLCBpbm5lcik7IGdyZC5hZGRDb2xvclN0b3AoMSwgb3V0ZXIpOyBnLmZpbGxTdHlsZT1ncmQ7IGcuYmVnaW5QYXRoKCk7IGcuYXJjKDMyLDMyLDMyLDAsTWF0aC5QSSoyKTsgZy5maWxsKCk7CiAgICBjb25zdCB0ID0gbmV3IFRIUkVFLkNhbnZhc1RleHR1cmUoYyk7IHQubmVlZHNVcGRhdGU9dHJ1ZTsgcmV0dXJuIHQ7CiAgfQogIGZ1bmN0aW9uIGNyZWF0ZVNwcml0ZVBvb2wodGV4LCBtYXgsIGJsZW5kaW5nKXsKICAgIGNvbnN0IGdyb3VwPW5ldyBUSFJFRS5Hcm91cCgpOyBzY2VuZS5hZGQoZ3JvdXApOwogICAgY29uc3QgcG9vbD1bXSwgYWN0aXZlPVtdOwogICAgZm9yKGxldCBpPTA7aTxtYXg7aSsrKXsgY29uc3QgbT1uZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyBtYXA6dGV4LCB0cmFuc3BhcmVudDp0cnVlLCBkZXB0aFdyaXRlOmZhbHNlLCBibGVuZGluZyB9KTsKICAgICAgY29uc3Qgcz1uZXcgVEhSRUUuU3ByaXRlKG0pOyBzLnZpc2libGU9ZmFsc2U7IHMudXNlckRhdGE9e2xpZmU6MCxtYXhMaWZlOjEsdmVsOm5ldyBUSFJFRS5WZWN0b3IzKCksc2l6ZTA6MX07IGdyb3VwLmFkZChzKTsgcG9vbC5wdXNoKHMpOyB9CiAgICByZXR1cm4gewogICAgICBzcGF3bihwb3MsIHZlbCwgbGlmZSwgc2l6ZSwgb3BhY2l0eT0xKXsKICAgICAgICBpZiAoIVBFUkYuZWZmZWN0cykgcmV0dXJuOwogICAgICAgIGNvbnN0IHM9cG9vbC5wb3AoKTsgaWYoIXMpIHJldHVybjsgcy5wb3NpdGlvbi5jb3B5KHBvcyk7IHMudXNlckRhdGEudmVsLmNvcHkodmVsKTsgcy51c2VyRGF0YS5saWZlPWxpZmU7IHMudXNlckRhdGEubWF4TGlmZT1saWZlOyBzLnVzZXJEYXRhLnNpemUwPXNpemU7IHMuc2NhbGUuc2V0KHNpemUsc2l6ZSwxKTsgcy5tYXRlcmlhbC5vcGFjaXR5PW9wYWNpdHk7IHMudmlzaWJsZT10cnVlOyBhY3RpdmUucHVzaChzKTsKICAgICAgfSwKICAgICAgdXBkYXRlKGR0KXsKICAgICAgICBpZiAoIVBFUkYuZWZmZWN0cykgcmV0dXJuOwogICAgICAgIGZvcihsZXQgaT1hY3RpdmUubGVuZ3RoLTE7aT49MDtpLS0peyBjb25zdCBzPWFjdGl2ZVtpXTsgcy51c2VyRGF0YS5saWZlLT1kdDsgaWYocy51c2VyRGF0YS5saWZlPD0wKXsgcy52aXNpYmxlPWZhbHNlOyBhY3RpdmUuc3BsaWNlKGksMSk7IHBvb2wucHVzaChzKTsgY29udGludWU7IH0gcy5wb3NpdGlvbi5hZGRTY2FsZWRWZWN0b3Iocy51c2VyRGF0YS52ZWwsIGR0KTsgcy51c2VyRGF0YS52ZWwubXVsdGlwbHlTY2FsYXIoMC45OCk7IGNvbnN0IGE9cy51c2VyRGF0YS5saWZlL3MudXNlckRhdGEubWF4TGlmZTsgcy5tYXRlcmlhbC5vcGFjaXR5PU1hdGgubWF4KDAsTWF0aC5taW4oMSxhKSk7IGNvbnN0IHNjPXMudXNlckRhdGEuc2l6ZTAqKDErKDEtYSkqMC42KTsgcy5zY2FsZS5zZXQoc2Msc2MsMSk7fSB9CiAgICB9OwogIH0KCiAgLyogPT09PT0gQXVkaW8gPT09PT0gKi8KICBjb25zdCBhdWRpbyA9ICgoKT0+eyBsZXQgY3R4PW51bGwsb3NjPW51bGwsZ2Fpbj1udWxsLHVubG9ja2VkPWZhbHNlOwogICAgY29uc3QgbWs9KCk9PnsgaWYoIWN0eCkgY3R4PW5ldyAod2luZG93LkF1ZGlvQ29udGV4dHx8d2luZG93LndlYmtpdEF1ZGlvQ29udGV4dCkoKTsgfTsKICAgIGNvbnN0IGVuZ2luZT0ocD0wLHY9MCk9PnsgaWYobXV0ZWQpIHJldHVybjsgbWsoKTsgaWYoIW9zYyl7b3NjPWN0eC5jcmVhdGVPc2NpbGxhdG9yKCk7IGdhaW49Y3R4LmNyZWF0ZUdhaW4oKTsgb3NjLnR5cGU9InNhd3Rvb3RoIjsgZ2Fpbi5nYWluLnZhbHVlPTA7IG9zYy5jb25uZWN0KGdhaW4pLmNvbm5lY3QoY3R4LmRlc3RpbmF0aW9uKTsgdHJ5e29zYy5zdGFydCgpO31jYXRjaChfKXt9IH0gdHJ5e29zYy5mcmVxdWVuY3kudmFsdWU9ODArMzAwKnA7IGdhaW4uZ2Fpbi52YWx1ZT1NYXRoLm1pbigwLjEsdik7fWNhdGNoKF8peyB9IH07CiAgICBjb25zdCBibGlwPShmPTIyMCx0PTAuMDgsdj0wLjIpPT57IGlmKG11dGVkKSByZXR1cm47IG1rKCk7IGNvbnN0IG89Y3R4LmNyZWF0ZU9zY2lsbGF0b3IoKSwgZz1jdHguY3JlYXRlR2FpbigpOyBvLnR5cGU9InRyaWFuZ2xlIjsgby5mcmVxdWVuY3kudmFsdWU9ZjsgZy5nYWluLnZhbHVlPXY7IG8uY29ubmVjdChnKS5jb25uZWN0KGN0eC5kZXN0aW5hdGlvbik7IHRyeXtvLnN0YXJ0KCk7by5zdG9wKGN0eC5jdXJyZW50VGltZSt0KTt9Y2F0Y2goXyl7IH0gfTsKICAgIGNvbnN0IHVubG9jaz0oKT0+eyBpZih1bmxvY2tlZCkgcmV0dXJuOyBtaygpOyBpZighY3R4KSByZXR1cm47IGNvbnN0IGI9Y3R4LmNyZWF0ZUJ1ZmZlcigxLDEsMjIwNTApOyBjb25zdCBzPWN0eC5jcmVhdGVCdWZmZXJTb3VyY2UoKTsgcy5idWZmZXI9Yjsgcy5jb25uZWN0KGN0eC5kZXN0aW5hdGlvbik7IHRyeXtzLnN0YXJ0KDApO31jYXRjaChfKXsgfSBjdHgucmVzdW1lJiZjdHgucmVzdW1lKCk7IHVubG9ja2VkPXRydWU7IH07CiAgICByZXR1cm4ge2VuZ2luZSxibGlwLHVubG9ja307CiAgfSkoKTsKICBjb25zdCB1bmxvY2tPbmNlPSgpPT57IGF1ZGlvLnVubG9jaygpOyBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0Jyx1bmxvY2tPbmNlLHtwYXNzaXZlOnRydWV9KTsgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLHVubG9ja09uY2UpOyB9OwogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLHVubG9ja09uY2Use29uY2U6dHJ1ZSxwYXNzaXZlOnRydWV9KTsKICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVyZG93bicsdW5sb2NrT25jZSx7b25jZTp0cnVlfSk7CgogIC8qID09PT09IFRocmVlIGluaXQgPT09PT0gKi8KICBmdW5jdGlvbiBpbml0VGhyZWUoKXsKICAgIHNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7CiAgICBzY2VuZS5iYWNrZ3JvdW5kID0gbmV3IFRIUkVFLkNvbG9yKDB4MGIxMjIwKTsKICAgIHNjZW5lLmZvZyA9IG5ldyBUSFJFRS5Gb2coMHgwYjEyMjAsIDE0MCwgNjUwKTsKCiAgICBjYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoNjUsIGlubmVyV2lkdGgvaW5uZXJIZWlnaHQsIDAuMSwgMjAwMCk7CiAgICBjYW1lcmEucG9zaXRpb24uc2V0KDAsIDUsIC0xMCk7CgogICAgcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcih7IGFudGlhbGlhczp0cnVlLCBhbHBoYTpmYWxzZSwgcG93ZXJQcmVmZXJlbmNlOiJoaWdoLXBlcmZvcm1hbmNlIiB9KTsKICAgIHJlbmRlcmVyLnNldFNpemUoaW5uZXJXaWR0aCwgaW5uZXJIZWlnaHQpOwogICAgcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyhQRVJGLnByKTsKICAgIHJlbmRlcmVyLnNoYWRvd01hcC5lbmFibGVkID0gZmFsc2U7CiAgICByZW5kZXJlci5vdXRwdXRDb2xvclNwYWNlID0gVEhSRUUuU1JHQkNvbG9yU3BhY2U7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHJlbmRlcmVyLmRvbUVsZW1lbnQpOwoKICAgIHNjZW5lLmFkZChuZXcgVEhSRUUuQW1iaWVudExpZ2h0KDB4OGZiMGZmLCAwLjM1KSk7CiAgICBjb25zdCBzdW4gPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgweGZmZmZmZiwgMC44NSk7IHN1bi5wb3NpdGlvbi5zZXQoODAsMTIwLC00MCk7IHNjZW5lLmFkZChzdW4pOwoKICAgIGNsb2NrID0gbmV3IFRIUkVFLkNsb2NrKCk7CgogICAgY29uc3Qgb25SZXNpemU9KCk9PnsgY2FtZXJhLmFzcGVjdD1pbm5lcldpZHRoL2lubmVySGVpZ2h0OyBjYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOyByZW5kZXJlci5zZXRTaXplKGlubmVyV2lkdGgsaW5uZXJIZWlnaHQpOyB1cGRhdGVPcmllbnQoKTsgfTsKICAgIGFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uUmVzaXplKTsKICAgIGlmICh3aW5kb3cudmlzdWFsVmlld3BvcnQpeyB2aXN1YWxWaWV3cG9ydC5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvblJlc2l6ZSk7IH0KICB9CgogIC8qID09PT09IFBoeXNpY3MgPT09PT0gKi8KICBmdW5jdGlvbiBpbml0UGh5c2ljcygpewogICAgd29ybGQgPSBuZXcgQ0FOTk9OLldvcmxkKCk7IHdvcmxkLmdyYXZpdHkuc2V0KDAsLTkuODIsMCk7CiAgICB3b3JsZC5icm9hZHBoYXNlID0gbmV3IENBTk5PTi5TQVBCcm9hZHBoYXNlKHdvcmxkKTsKICAgIHdvcmxkLmFsbG93U2xlZXAgPSBmYWxzZTsKICAgIHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwuZnJpY3Rpb24gPSAwLjY7CiAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IDg7CiAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlICA9IDAuMDAxNTsKCiAgICBjb25zdCBncm91bmRNYXQ9bmV3IENBTk5PTi5NYXRlcmlhbCgiZ3JvdW5kIiksIHdoZWVsTWF0PW5ldyBDQU5OT04uTWF0ZXJpYWwoIndoZWVsIiksIGNoYXNzaXNNYXQ9bmV3IENBTk5PTi5NYXRlcmlhbCgiY2hhc3NpcyIpOwogICAgd29ybGQuYWRkQ29udGFjdE1hdGVyaWFsKG5ldyBDQU5OT04uQ29udGFjdE1hdGVyaWFsKGdyb3VuZE1hdCx3aGVlbE1hdCx7ZnJpY3Rpb246MS4wLHJlc3RpdHV0aW9uOjAuMH0pKTsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChuZXcgQ0FOTk9OLkNvbnRhY3RNYXRlcmlhbChncm91bmRNYXQsY2hhc3Npc01hdCx7ZnJpY3Rpb246MC4zNSxyZXN0aXR1dGlvbjowLjB9KSk7CgogICAgY29uc3QgZ3JvdW5kID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczowLCBtYXRlcmlhbDpncm91bmRNYXQgfSk7CiAgICBncm91bmQuYWRkU2hhcGUobmV3IENBTk5PTi5QbGFuZSgpKTsgZ3JvdW5kLnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKC1NYXRoLlBJLzIsMCwwKTsKICAgIGdyb3VuZC5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IEdST1VQX0dST1VORDsgZ3JvdW5kLmNvbGxpc2lvbkZpbHRlck1hc2sgPSBHUk9VUF9QTEFZRVIgfCBHUk9VUF9BSSB8IEdST1VQX1NUVU5UOwogICAgd29ybGQuYWRkQm9keShncm91bmQpOwoKICAgIGZsb29yVGV4ID0gZ3JpZFRleHR1cmUoKTsgZmxvb3JUZXgud3JhcFM9Zmxvb3JUZXgud3JhcFQ9VEhSRUUuUmVwZWF0V3JhcHBpbmc7IGZsb29yVGV4LnJlcGVhdC5zZXQoODAsODApOwogICAgZmxvb3JNZXNoID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoQVJFTkFfSEFMRioyLjEsQVJFTkFfSEFMRioyLjEpLCBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBtYXA6Zmxvb3JUZXgsIGNvbG9yOjB4MjQzYTU3IH0pKTsKICAgIGZsb29yTWVzaC5yb3RhdGlvbi54PS1NYXRoLlBJLzI7IHNjZW5lLmFkZChmbG9vck1lc2gpOwoKICAgIC8vIGFyZW5hIHdhbGxzCiAgICBhZGRCb3hTdGF0aWMoQVJFTkFfSEFMRioyLTIwLCAxMiwgNSwgWzAsNiwtQVJFTkFfSEFMRl0sIFswLDAsMF0sIDB4MmIzZjVjLCB7Y29sbGlkZUFJOnRydWUsIGtlZXA6dHJ1ZX0pOwogICAgYWRkQm94U3RhdGljKEFSRU5BX0hBTEYqMi0yMCwgMTIsIDUsIFswLDYsIEFSRU5BX0hBTEZdLCBbMCwwLDBdLCAweDJiM2Y1Yywge2NvbGxpZGVBSTp0cnVlLCBrZWVwOnRydWV9KTsKICAgIGFkZEJveFN0YXRpYyg1LCAxMiwgQVJFTkFfSEFMRioyLTIwLCBbLUFSRU5BX0hBTEYsNiwwXSwgWzAsMCwwXSwgMHgyYjNmNWMsIHtjb2xsaWRlQUk6dHJ1ZSwga2VlcDp0cnVlfSk7CiAgICBhZGRCb3hTdGF0aWMoNSwgMTIsIEFSRU5BX0hBTEYqMi0yMCwgWyBBUkVOQV9IQUxGLDYsMF0sIFswLDAsMF0sIDB4MmIzZjVjLCB7Y29sbGlkZUFJOnRydWUsIGtlZXA6dHJ1ZX0pOwogIH0KICBmdW5jdGlvbiBncmlkVGV4dHVyZSgpewogICAgY29uc3QgYz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsgYy53aWR0aD1jLmhlaWdodD0yNTY7IGNvbnN0IHg9Yy5nZXRDb250ZXh0KCIyZCIpOwogICAgeC5maWxsU3R5bGU9IiMwYzE2MjYiOyB4LmZpbGxSZWN0KDAsMCwyNTYsMjU2KTsKICAgIHguc3Ryb2tlU3R5bGU9IiMyMjMyNGQiOyB4LmxpbmVXaWR0aD0yOyBmb3IobGV0IGk9MDtpPD0xNjtpKyspeyBjb25zdCBwPShpLzE2KSoyNTY7IHguYmVnaW5QYXRoKCk7IHgubW92ZVRvKHAsMCk7IHgubGluZVRvKHAsMjU2KTsgeC5zdHJva2UoKTsgeC5iZWdpblBhdGgoKTsgeC5tb3ZlVG8oMCxwKTsgeC5saW5lVG8oMjU2LHApOyB4LnN0cm9rZSgpOyB9CiAgICB4LnN0cm9rZVN0eWxlPSIjMmU0NDZiIjsgeC5saW5lV2lkdGg9MzsgZm9yKGxldCBpPTA7aTw9NDtpKyspeyBjb25zdCBwPShpLzQpKjI1NjsgeC5iZWdpblBhdGgoKTsgeC5tb3ZlVG8ocCwwKTsgeC5saW5lVG8ocCwyNTYpOyB4LnN0cm9rZSgpOyB4LmJlZ2luUGF0aCgpOyB4Lm1vdmVUbygwLHApOyB4LmxpbmVUbygyNTYscCk7IHguc3Ryb2tlKCk7IH0KICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICB9CiAgZnVuY3Rpb24gYWRkQm94U3RhdGljKHcsaCxkLHBvcyxyb3Q9WzAsMCwwXSxjb2xvcj0weDJiM2Y1YyxvcHRzPXtjb2xsaWRlQUk6ZmFsc2UsIGtlZXA6ZmFsc2UsIHRhZzoic3R1bnQifSl7CiAgICBjb25zdCBib2R5PW5ldyBDQU5OT04uQm9keSh7bWFzczowfSk7IGJvZHkuYWRkU2hhcGUobmV3IENBTk5PTi5Cb3gobmV3IENBTk5PTi5WZWMzKHcvMixoLzIsZC8yKSkpOwogICAgYm9keS5wb3NpdGlvbi5zZXQoLi4ucG9zKTsgYm9keS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlciguLi5yb3QsIlhZWiIpOwogICAgYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IEdST1VQX1NUVU5UOyBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2sgPSBHUk9VUF9QTEFZRVIgfCAob3B0cy5jb2xsaWRlQUk/R1JPVVBfQUk6MCkgfCBHUk9VUF9HUk9VTkQ7CiAgICB3b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgY29uc3QgbWVzaD1uZXcgVEhSRUUuTWVzaChuZXcgVEhSRUUuQm94R2VvbWV0cnkodyxoLGQpLCBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yIH0pKTsKICAgIG1lc2gucG9zaXRpb24uc2V0KC4uLnBvcyk7IG1lc2gucm90YXRpb24uc2V0KC4uLnJvdCk7IHNjZW5lLmFkZChtZXNoKTsKICAgIGlmICghb3B0cy5rZWVwKSBzdE9ianMucHVzaCh7Ym9keSwgbWVzaH0pOwogICAgcmV0dXJuIHtib2R5LCBtZXNofTsKICB9CiAgZnVuY3Rpb24gYWRkQm9vc3RQYWQoc2l6ZVgsc2l6ZVoscG9zLHJvdD1bMCwwLDBdKXsKICAgIGNvbnN0IG09bmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoc2l6ZVgsc2l6ZVopLCBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjoweDJhZjVhNCwgdHJhbnNwYXJlbnQ6dHJ1ZSwgb3BhY2l0eTowLjg4IH0pKTsKICAgIG0ucm90YXRpb24uc2V0KC1NYXRoLlBJLzIrcm90WzBdLCByb3RbMV0sIHJvdFsyXSk7IG0ucG9zaXRpb24uc2V0KC4uLnBvcyk7IG0ucmVuZGVyT3JkZXI9Mjsgc2NlbmUuYWRkKG0pOwogICAgYm9vc3RzLnB1c2goe21lc2g6bSwgcG9zOm5ldyBUSFJFRS5WZWN0b3IzKC4uLnBvcyksIHNpemU6bmV3IFRIUkVFLlZlY3RvcjIoc2l6ZVgsc2l6ZVopLCByb3RZOnJvdFsxXXx8MCwgY29vbDowfSk7CiAgfQogIGZ1bmN0aW9uIGFkZEhvb3AocmFkaXVzLCB0aGlja25lc3MsIHBvcyl7CiAgICBjb25zdCBnZW89bmV3IFRIUkVFLlRvcnVzR2VvbWV0cnkocmFkaXVzLCB0aGlja25lc3MsIDEyLCA0OCk7CiAgICBjb25zdCBtZXNoPW5ldyBUSFJFRS5NZXNoKGdlbywgbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoeyBjb2xvcjoweGZmYjM2NiwgZW1pc3NpdmU6MHgzMzIyMDAgfSkpOwogICAgbWVzaC5wb3NpdGlvbi5zZXQoLi4ucG9zKTsgbWVzaC5yb3RhdGlvbi54PU1hdGguUEkvMjsgc2NlbmUuYWRkKG1lc2gpOwogICAgaG9vcHMucHVzaCh7IHBvczpuZXcgVEhSRUUuVmVjdG9yMyguLi5wb3MpLCByYWRpdXMsIHRoaWNrbmVzcywgbWVzaCB9KTsKICB9CgogIC8qID09PT09IE1hcHMgPT09PT0gKi8KICBsZXQgY3VycmVudE1hcD0wLCBhaVNwYXducz1bXTsKICBjb25zdCBNQVBTID0gWwogICAgeyBpZDoiYXJlbmEiLCBuYW1lOiJTdHVudCBBcmVuYSIsIGJ1aWxkOiBidWlsZFN0dW50QXJlbmEsIHBsYXllclNwYXduOnt4OjAseTozLHo6LTE0MH0sCiAgICAgIGFpU3Bhd25zOlt7eDo5MCx6OjkwfSx7eDotMTMwLHo6ODB9LHt4OjE0MCx6Oi0xMDB9LHt4OjI2MCx6OjIwfSx7eDotMjQwLHo6LTYwfSx7eDo0MCx6OjI2MH0se3g6LTYwLHo6LTI0MH0se3g6MjQwLHo6LTIyMH1dIH0sCiAgICB7IGlkOiJkdW5lcyIsIG5hbWU6IkFsbOKAkVRlcnJhaW4gRHVuZXMiLCBidWlsZDogYnVpbGRBbGxUZXJyYWluLCBwbGF5ZXJTcGF3bjp7eDotNjAseTozLHo6LTE4MH0sCiAgICAgIGFpU3Bhd25zOlt7eDotMjIwLHo6LTIyMH0se3g6MjIwLHo6MjIwfSx7eDotMjIwLHo6MjIwfSx7eDoyMjAsejotMjIwfSx7eDowLHo6MjQwfSx7eDowLHo6LTI0MH1dIH0KICBdOwogIGZ1bmN0aW9uIGNsZWFyTWFwKCl7CiAgICBmb3IoY29uc3QgbyBvZiBzdE9ianMpeyB3b3JsZC5yZW1vdmVCb2R5KG8uYm9keSk7IHNjZW5lLnJlbW92ZShvLm1lc2gpOyB9IHN0T2Jqcy5sZW5ndGg9MDsKICAgIGZvcihjb25zdCBiIG9mIGJvb3N0cyl7IHNjZW5lLnJlbW92ZShiLm1lc2gpOyB9IGJvb3N0cy5sZW5ndGg9MDsKICAgIGZvcihjb25zdCBoIG9mIGhvb3BzKXsgc2NlbmUucmVtb3ZlKGgubWVzaCk7IH0gaG9vcHMubGVuZ3RoPTA7CiAgICBmb3IoY29uc3QgcCBvZiBwaWNrdXBzKXsgc2NlbmUucmVtb3ZlKHAubWVzaCk7IH0gcGlja3Vwcy5sZW5ndGg9MDsKICAgIGZvcihjb25zdCBvIG9mIG9yYnMpeyBzY2VuZS5yZW1vdmUobyk7IH0gb3Jicy5sZW5ndGg9MDsKICAgIG1hcFNoYXBlcy5sZW5ndGg9MDsKICB9CiAgZnVuY3Rpb24gc2V0TWFwKGlkeCl7CiAgICBjdXJyZW50TWFwID0gKGlkeCtNQVBTLmxlbmd0aCklTUFQUy5sZW5ndGg7CiAgICBjbGVhck1hcCgpOyBNQVBTW2N1cnJlbnRNYXBdLmJ1aWxkKCk7CiAgICBzcGF3blBpY2t1cHMoKTsgc3Bhd25PcmJzKDE0KTsKICAgIGFpU3Bhd25zID0gTUFQU1tjdXJyZW50TWFwXS5haVNwYXduczsKICAgIGlmIChjaGFzc2lzQm9keSkgcmVzZXRQbGF5ZXJUb1NwYXduKCk7CiAgICB3aGlsZSAoYWlDYXJzLmxlbmd0aCkgZGVzcGF3bkFJKCk7CiAgICByZWNvbmNpbGVCb3RzVG9IZWF0KCk7CiAgICB1aS5idG5NYXAudGV4dENvbnRlbnQ9J01hcDogJytNQVBTW2N1cnJlbnRNYXBdLm5hbWU7IGZsYXNoKE1BUFNbY3VycmVudE1hcF0ubmFtZSk7CiAgfQoKICBmdW5jdGlvbiBidWlsZFN0dW50QXJlbmEoKXsKICAgIGFkZFN0dW50UmVjdCg0OCwyLjAsOTIsWzAsMSwtNDBdLFtNYXRoLlBJLzE2LDAsMF0sMHgzNjVhODMsInJhbXAiKTsKICAgIGFkZFN0dW50UmVjdCgyOCwyLjAsMzYsWzAsMywtMl0sWzAsMCwwXSwweDMxNDg2MSwicGxhdCIpOwogICAgYWRkU3R1bnRSZWN0KDQ4LDIuMCw5MixbMCwxLDM0XSxbLU1hdGguUEkvMTgsMCwwXSwweDM2NWE4MywicmFtcCIpOwogICAgYWRkSG9vcCgxMCwxLjIsWzAsMTQsMThdKTsKICAgIGFkZFN0dW50UmVjdCg0MiwxLjgsNzAsWzE2MCwxLDMwXSxbTWF0aC5QSS8xNiwwLDBdLDB4M2I1YTg0LCJyYW1wIik7CiAgICBhZGRIb29wKDksMS4xLFsxNjAsMTMsNzhdKTsKICAgIGZvcihsZXQgaT0wO2k8NDtpKyspeyBhZGRTdHVudFJlY3QoMjQsMS41LDE4LFstMTgwK2kqNDAsMC44LDgwXSxbTWF0aC5QSS8xNCwwLDBdLDB4M2E0ZjdkLCJyYW1wIik7IH0KICAgIGFkZFN0dW50UmVjdCg5MCwzLjAsNDAsWy0yNjAsMiwtMjYwXSxbMCwgTWF0aC5QSS80LCAgTWF0aC5QSS84XSwweDMwNWI1MiwiYmFuayIpOwogICAgYWRkU3R1bnRSZWN0KDkwLDMuMCw0MCxbIDI2MCwyLCAyNjBdLFswLC0zKk1hdGguUEkvNCwtTWF0aC5QSS84XSwweDMwNWI1MiwiYmFuayIpOwogICAgYWRkU3R1bnRSZWN0KDE0LDEuNCwyMCxbIDcwLDAuNywxNjBdLFtNYXRoLlBJLzE0LDAsMF0sMHgzYjVhODQsInJhbXAiKTsKICAgIGFkZFN0dW50UmVjdCggNiwxLjAsNjAsWyAgMCw0LjUsMTYwXSxbMCwwLDBdLDB4NWM2ZmUwLCJwbGF0Iik7CiAgICBhZGRTdHVudFJlY3QoMTQsMS40LDIwLFstNzAsMC43LDE2MF0sWy1NYXRoLlBJLzE0LDAsMF0sMHgzYjVhODQsInJhbXAiKTsKICAgIGFkZEhvb3AoOCwxLjAsWzEyMCwxMyw0MF0pOyBhZGRIb29wKDgsMS4wLFstMTIwLDEzLC00MF0pOwogICAgW1swLC02NF0sWzAsMTBdLFswLDcyXSxbMTQwLC00MF0sWzE1Miw4XSxbMTYwLDk2XSxbLTIwMCw1MF0sWy0xNjAsOTBdLFswLDE0MF0sWy0yMzAsLTIxMF0sWzIzMCwyMTBdLFstMTIwLDBdLFsxMjAsMF1dCiAgICAuZm9yRWFjaChwPT4gYWRkQm9vc3RQYWQoMTYsMjIsW3BbMF0sMC4wNixwWzFdXSxbMCwwLDBdKSk7CiAgfQogIGZ1bmN0aW9uIGJ1aWxkQWxsVGVycmFpbigpewogICAgY29uc3QgZHVuZT0oeCx6LHcsZCxoLHJ4KT0+IGFkZFN0dW50UmVjdCh3LGgsZCxbeCxoLzIsel0sW3J4fHxNYXRoLlBJLzE0LDAsMF0sMHgyZjRhNmIsImJhbmsiKTsKICAgIGR1bmUoLTIwMCwtMTIwLDE0MCw5MCwxOCwgTWF0aC5QSS8xMik7IGR1bmUoOTAsNDAsMTYwLDExMCwxNiwgTWF0aC5QSS8xNSk7CiAgICBkdW5lKDE4MCwtMTgwLDEyMCwxMjAsMTQsIE1hdGguUEkvMTgpOyBkdW5lKC0xNTAsMTgwLDE2MCwxMDAsMTQsIE1hdGguUEkvMTYpOyBkdW5lKDAsNDAsMjAwLDExMCwxNiwgTWF0aC5QSS8yMCk7CiAgICBhZGRTdHVudFJlY3QoNjAsMS40LDkwLFstNjAsMC43LC00MF0sW01hdGguUEkvMTYsMCwwXSwweDNiNWE4NCwicmFtcCIpOwogICAgYWRkU3R1bnRSZWN0KDcwLDEuNiw2MCxbMTQwLDAuOCwxMDBdLFtNYXRoLlBJLzE4LDAsMF0sMHgzYjVhODQsInJhbXAiKTsKICAgIFtbLTE4MCwtMTYwXSxbMTYwLDEyMF0sWzIwLC02MF0sWzAsMTgwXV0uZm9yRWFjaChwPT4gYWRkQm9vc3RQYWQoMTgsMjYsW3BbMF0sMC4wNixwWzFdXSkpOwogICAgYWRkSG9vcCg5LDEuMSxbMTEwLDEyLDIwXSk7IGFkZEhvb3AoOSwxLjEsWy0xMjAsMTIsLTEwMF0pOwogIH0KICBmdW5jdGlvbiBhZGRTdHVudFJlY3QodyxoLGQscG9zLHJvdCxjb2xvcix0eXBlKXsKICAgIGFkZEJveFN0YXRpYyh3LGgsZCxwb3Mscm90LGNvbG9yLHtjb2xsaWRlQUk6ZmFsc2UsdGFnOnR5cGV9KTsKICAgIGNvbnN0IHlhdz0ocm90JiZyb3RbMV0pP3JvdFsxXTowOyBjb25zdCBtYXBDb2xvcj0gdHlwZT09PSJyYW1wIj9jc3NWYXIoJy0tcFJhbXAnKTp0eXBlPT09InBsYXQiP2Nzc1ZhcignLS1wUGxhdCcpOnR5cGU9PT0iYmFuayI/Y3NzVmFyKCctLXBCYW5rJyk6IiM2YTgyYzIiOwogICAgbWFwU2hhcGVzLnB1c2goe3g6cG9zWzBdLHo6cG9zWzJdLHcsZCx5YXcsY29sb3I6bWFwQ29sb3IsYWxwaGE6dHlwZT09PSJwbGF0Ij8wLjI1OjAuMzUsdHlwZX0pOwogIH0KICBmdW5jdGlvbiBjc3NWYXIobmFtZSl7IHJldHVybiBnZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuZ2V0UHJvcGVydHlWYWx1ZShuYW1lKS50cmltKCk7IH0KCiAgLyogPT09PT0gUGxheWVyID09PT09ICovCiAgbGV0IHNoaWVsZFQ9MCwgc2hpZWxkTWVzaCwgdHVyYm9UPTA7CiAgZnVuY3Rpb24gYnVpbGRQbGF5ZXIoKXsKICAgIGNoYXNzaXNCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczo1NTAsIG1hdGVyaWFsOm5ldyBDQU5OT04uTWF0ZXJpYWwoImNoYXNzaXMiKSB9KTsKICAgIGNoYXNzaXNCb2R5LmFkZFNoYXBlKG5ldyBDQU5OT04uQm94KG5ldyBDQU5OT04uVmVjMygxLjAsMC4zNSwyLjEpKSwgbmV3IENBTk5PTi5WZWMzKDAsLTAuMjUsMCkpOwogICAgY29uc3Qgc3A9TUFQU1tjdXJyZW50TWFwXS5wbGF5ZXJTcGF3bjsgY2hhc3Npc0JvZHkucG9zaXRpb24uc2V0KHNwLngsc3AueSxzcC56KTsKICAgIGNoYXNzaXNCb2R5LmFuZ3VsYXJEYW1waW5nPTAuNTsgY2hhc3Npc0JvZHkubGluZWFyRGFtcGluZz0wLjAyOyBjaGFzc2lzQm9keS5hbGxvd1NsZWVwPWZhbHNlOwogICAgY2hhc3Npc0JvZHkuY29sbGlzaW9uRmlsdGVyR3JvdXA9R1JPVVBfUExBWUVSOyBjaGFzc2lzQm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrPUdST1VQX0dST1VORHxHUk9VUF9TVFVOVHxHUk9VUF9BSTsKICAgIHdvcmxkLmFkZEJvZHkoY2hhc3Npc0JvZHkpOwoKICAgIGNoYXNzaXNNZXNoID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLkJveEdlb21ldHJ5KDIuMCwwLjcsNC4yKSwgbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoeyBjb2xvcjoweDY2YjNmZiB9KSk7CiAgICBzY2VuZS5hZGQoY2hhc3Npc01lc2gpOwogICAgY29uc3Qgcm9vZiA9IG5ldyBUSFJFRS5NZXNoKG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSgxLjQsMC41LDEuNiksIG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKHsgY29sb3I6MHg5OWQxZmYgfSkpOwogICAgcm9vZi5wb3NpdGlvbi5zZXQoMCwwLjYsLTAuMyk7IGNoYXNzaXNNZXNoLmFkZChyb29mKTsKCiAgICBzaGllbGRNZXNoID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLlRvcnVzR2VvbWV0cnkoMS42LDAuMDYsMTIsNDgpLCBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjoweGI5ODdmZiwgdHJhbnNwYXJlbnQ6dHJ1ZSwgb3BhY2l0eTowLjYgfSkpOwogICAgc2hpZWxkTWVzaC5yb3RhdGlvbi54PU1hdGguUEkvMjsgc2hpZWxkTWVzaC52aXNpYmxlPWZhbHNlOyBjaGFzc2lzTWVzaC5hZGQoc2hpZWxkTWVzaCk7CgogICAgcGxheWVyVmVoaWNsZSA9IG5ldyBDQU5OT04uUmF5Y2FzdFZlaGljbGUoeyBjaGFzc2lzQm9keSwgaW5kZXhSaWdodEF4aXM6MCwgaW5kZXhVcEF4aXM6MSwgaW5kZXhGb3J3YXJkQXhpczoyIH0pOwogICAgY29uc3Qgd2hlZWxPcHRpb25zID0geyByYWRpdXM6MC40NSwgZGlyZWN0aW9uTG9jYWw6bmV3IENBTk5PTi5WZWMzKDAsLTEsMCksIHN1c3BlbnNpb25TdGlmZm5lc3M6NDQsIHN1c3BlbnNpb25SZXN0TGVuZ3RoOjAuMzAsIGZyaWN0aW9uU2xpcDoxMC4yLCBkYW1waW5nUmVsYXhhdGlvbjozLjQsIGRhbXBpbmdDb21wcmVzc2lvbjo1LjgsIG1heFN1c3BlbnNpb25Gb3JjZToxZTUsIHJvbGxJbmZsdWVuY2U6MC4wMTUsIGF4bGVMb2NhbDpuZXcgQ0FOTk9OLlZlYzMoLTEsMCwwKSwgbWF4U3VzcGVuc2lvblRyYXZlbDowLjMwLCBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOi0zMCwgdXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDp0cnVlIH07CiAgICBjb25zdCBheGxlVz0xLjIsIHdoZWVsQmFzZT0xLjg7CiAgICBbbmV3IENBTk5PTi5WZWMzKC1heGxlVywtMC4yNSwgd2hlZWxCYXNlKSwgbmV3IENBTk5PTi5WZWMzKCBheGxlVywtMC4yNSwgd2hlZWxCYXNlKSwKICAgICBuZXcgQ0FOTk9OLlZlYzMoLWF4bGVXLC0wLjI1LC13aGVlbEJhc2UpLCBuZXcgQ0FOTk9OLlZlYzMoIGF4bGVXLC0wLjI1LC13aGVlbEJhc2UpXQogICAgICAuZm9yRWFjaCgocCxpZHgpPT4gcGxheWVyVmVoaWNsZS5hZGRXaGVlbCh7IC4uLndoZWVsT3B0aW9ucywgcm9sbEluZmx1ZW5jZTogaWR4PDI/MC4wMTI6MC4wMTYsIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDpwIH0pKTsKICAgIHBsYXllclZlaGljbGUuYWRkVG9Xb3JsZCh3b3JsZCk7CgogICAgY29uc3Qgd0dlbz1uZXcgVEhSRUUuQ3lsaW5kZXJHZW9tZXRyeSh3aGVlbE9wdGlvbnMucmFkaXVzLHdoZWVsT3B0aW9ucy5yYWRpdXMsMC4yOCwxOCk7IHdHZW8ucm90YXRlWihNYXRoLlBJLzIpOwogICAgY29uc3Qgd01hdD1uZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOjB4MjIzMjQzIH0pOwogICAgZm9yKGxldCBpPTA7aTw0O2krKyl7IGNvbnN0IHc9bmV3IFRIUkVFLk1lc2god0dlbyx3TWF0KTsgc2NlbmUuYWRkKHcpOyBwbGF5ZXJXaGVlbE1lc2hlcy5wdXNoKHcpOyB9CiAgfQoKICAvKiA9PT09PSBBSSBjYXJzID09PT09ICovCiAgY29uc3QgYWlDYXJzPVtdOwogIGZ1bmN0aW9uIGJ1aWxkQUlDYXIoc3Bhd24pewogICAgY29uc3QgYm9keT1uZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOjU0MCwgbGluZWFyRGFtcGluZzowLjAyLCBhbmd1bGFyRGFtcGluZzowLjU4IH0pOwogICAgYm9keS5hZGRTaGFwZShuZXcgQ0FOTk9OLkJveChuZXcgQ0FOTk9OLlZlYzMoMS4wLDAuMzUsMi4xKSksIG5ldyBDQU5OT04uVmVjMygwLC0wLjI2LDApKTsKICAgIGJvZHkucG9zaXRpb24uc2V0KHNwYXduLngsMyxzcGF3bi56KTsgYm9keS5hbGxvd1NsZWVwPWZhbHNlOwogICAgYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cD1HUk9VUF9BSTsgYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrPUdST1VQX0dST1VORHxHUk9VUF9QTEFZRVJ8R1JPVVBfU1RVTlQ7IHdvcmxkLmFkZEJvZHkoYm9keSk7CgogICAgY29uc3QgbWVzaD1uZXcgVEhSRUUuTWVzaChuZXcgVEhSRUUuQm94R2VvbWV0cnkoMi4wLDAuNyw0LjIpLCBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOjB4ZmY3Nzc3IH0pKTsKICAgIHNjZW5lLmFkZChtZXNoKTsKCiAgICBjb25zdCB2ZWg9bmV3IENBTk5PTi5SYXljYXN0VmVoaWNsZSh7IGNoYXNzaXNCb2R5OmJvZHksIGluZGV4UmlnaHRBeGlzOjAsIGluZGV4VXBBeGlzOjEsIGluZGV4Rm9yd2FyZEF4aXM6MiB9KTsKICAgIGNvbnN0IHdoZWVsT3B0aW9ucz17IHJhZGl1czowLjQ1LCBkaXJlY3Rpb25Mb2NhbDpuZXcgQ0FOTk9OLlZlYzMoMCwtMSwwKSwgc3VzcGVuc2lvblN0aWZmbmVzczo0Niwgc3VzcGVuc2lvblJlc3RMZW5ndGg6MC4yOCwgZnJpY3Rpb25TbGlwOjkuOCwgZGFtcGluZ1JlbGF4YXRpb246My40LCBkYW1waW5nQ29tcHJlc3Npb246Ni4yLCBtYXhTdXNwZW5zaW9uRm9yY2U6MWU1LCByb2xsSW5mbHVlbmNlOjAuMDE1LCBheGxlTG9jYWw6bmV3IENBTk5PTi5WZWMzKC0xLDAsMCksIG1heFN1c3BlbnNpb25UcmF2ZWw6MC4yOCwgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDotMzAsIHVzZUN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQ6dHJ1ZSB9OwogICAgY29uc3QgYXhsZVc9MS4yLCB3aGVlbEJhc2U9MS44OwogICAgW25ldyBDQU5OT04uVmVjMygtYXhsZVcsLTAuMjUsIHdoZWVsQmFzZSksIG5ldyBDQU5OT04uVmVjMyggYXhsZVcsLTAuMjUsIHdoZWVsQmFzZSksCiAgICAgbmV3IENBTk5PTi5WZWMzKC1heGxlVywtMC4yNSwtd2hlZWxCYXNlKSwgbmV3IENBTk5PTi5WZWMzKCBheGxlVywtMC4yNSwtd2hlZWxCYXNlKV0KICAgICAgLmZvckVhY2goKHAsaWR4KT0+IHZlaC5hZGRXaGVlbCh7IC4uLndoZWVsT3B0aW9ucywgcm9sbEluZmx1ZW5jZTogaWR4PDI/MC4wMTI6MC4wMTYsIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDpwIH0pKTsKICAgIHZlaC5hZGRUb1dvcmxkKHdvcmxkKTsKCiAgICBjb25zdCB3R2VvPW5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KHdoZWVsT3B0aW9ucy5yYWRpdXMsd2hlZWxPcHRpb25zLnJhZGl1cywwLjI4LDE4KTsgd0dlby5yb3RhdGVaKE1hdGguUEkvMik7CiAgICBjb25zdCB3TWF0PW5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKHsgY29sb3I6MHg1NTIyMjIgfSk7CiAgICBjb25zdCB3aGVlbHM9W107IGZvcihsZXQgaT0wO2k8NDtpKyspeyBjb25zdCB3PW5ldyBUSFJFRS5NZXNoKHdHZW8sd01hdCk7IHNjZW5lLmFkZCh3KTsgd2hlZWxzLnB1c2godyk7IH0KCiAgICByZXR1cm4geyBib2R5LCBtZXNoLCB2ZWgsIHdoZWVscywgc3Bhd24sIHN0dWNrVDowLCB1cHNpZGVUOjAsIHNwYXduS2lja1Q6MC42LCBsdW5nZVQ6MCB9OwogIH0KICBmdW5jdGlvbiBzcGF3bkFJKCl7IGlmKCFib3RzRW5hYmxlZCkgcmV0dXJuOyBjb25zdCBzcD1haVNwYXduc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqYWlTcGF3bnMubGVuZ3RoKV07IGFpQ2Fycy5wdXNoKGJ1aWxkQUlDYXIoc3ApKTsgfQogIGZ1bmN0aW9uIGRlc3Bhd25BSSgpeyBpZighYWlDYXJzLmxlbmd0aCkgcmV0dXJuOyBjb25zdCBhaT1haUNhcnMucG9wKCk7IGFpLnZlaC5yZW1vdmVGcm9tV29ybGQod29ybGQpOyB3b3JsZC5yZW1vdmVCb2R5KGFpLmJvZHkpOyBzY2VuZS5yZW1vdmUoYWkubWVzaCk7IGZvcihjb25zdCB3IG9mIGFpLndoZWVscykgc2NlbmUucmVtb3ZlKHcpOyB9CiAgZnVuY3Rpb24gcmVjb25jaWxlQm90c1RvSGVhdCgpeyBjb25zdCB3YW50PXRhcmdldEFJQ291bnQoKTsgd2hpbGUoYWlDYXJzLmxlbmd0aDx3YW50KSBzcGF3bkFJKCk7IHdoaWxlKGFpQ2Fycy5sZW5ndGg+d2FudCkgZGVzcGF3bkFJKCk7IH0KCiAgLyogPT09PT0gVXRpbGl0aWVzID09PT09ICovCiAgZnVuY3Rpb24gZm9yd2FyZFZlY3Rvcihib2R5KXsgY29uc3QgcT1uZXcgVEhSRUUuUXVhdGVybmlvbihib2R5LnF1YXRlcm5pb24ueCxib2R5LnF1YXRlcm5pb24ueSxib2R5LnF1YXRlcm5pb24ueixib2R5LnF1YXRlcm5pb24udyk7IGNvbnN0IGY9bmV3IFRIUkVFLlZlY3RvcjMoMCwwLDEpLmFwcGx5UXVhdGVybmlvbihxKTsgcmV0dXJuIHt4OmYueCx5OmYueSx6OmYuen07IH0KICBmdW5jdGlvbiB1cFZlY3Rvcihib2R5KXsgY29uc3QgcT1uZXcgVEhSRUUuUXVhdGVybmlvbihib2R5LnF1YXRlcm5pb24ueCxib2R5LnF1YXRlcm5pb24ueSxib2R5LnF1YXRlcm5pb24ueixib2R5LnF1YXRlcm5pb24udyk7IGNvbnN0IHU9bmV3IFRIUkVFLlZlY3RvcjMoMCwxLDApLmFwcGx5UXVhdGVybmlvbihxKTsgcmV0dXJuIHt4OnUueCx5OnUueSx6OnUuen07IH0KICBmdW5jdGlvbiBjbGFtcCh4LGEsYil7IHJldHVybiBNYXRoLm1heChhLCBNYXRoLm1pbihiLCB4KSk7IH0KICBmdW5jdGlvbiBmbGFzaCh0ZXh0KXsgY29uc3QgZWw9dWkudG9hc3Q7IGVsLnRleHRDb250ZW50PXRleHQ7IGVsLnN0eWxlLmRpc3BsYXk9ImJsb2NrIjsgY2xlYXJUaW1lb3V0KGZsYXNoLl90KTsgZmxhc2guX3Q9c2V0VGltZW91dCgoKT0+ZWwuc3R5bGUuZGlzcGxheT0ibm9uZSIsIDEwMDApOyB9CiAgZnVuY3Rpb24gcHVzaEZlZWQobGFiZWwsIHB0cyl7IGNvbnN0IGl0ZW09ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7IGl0ZW0uY2xhc3NOYW1lPSdmZWVkSXRlbSc7IGl0ZW0uaW5uZXJIVE1MPWA8c3Bhbj4ke2xhYmVsfTwvc3Bhbj48c3BhbiBjbGFzcz0iZmVlZFB0cyI+KyR7TWF0aC5yb3VuZChwdHMpfTwvc3Bhbj5gOyBmZWVkRWwuYXBwZW5kQ2hpbGQoaXRlbSk7IHNldFRpbWVvdXQoKCk9Pml0ZW0uY2xhc3NMaXN0LmFkZCgnZmFkZScpLDE0MDApOyBzZXRUaW1lb3V0KCgpPT5pdGVtLnJlbW92ZSgpLDIyMDApOyB9CiAgZnVuY3Rpb24gYWRkU2NvcmUocHRzLGxhYmVsKXsgY29uc3QgZ2Fpbj1NYXRoLnJvdW5kKHB0cypjb21ibypoZWF0U2NvcmVNdWx0KCkpOyBzY29yZSs9Z2FpbjsgdWkuc2NvcmUudGV4dENvbnRlbnQ9c2NvcmUudG9Mb2NhbGVTdHJpbmcoKTsgaWYobGFiZWwpIHB1c2hGZWVkKGxhYmVsLGdhaW4pOyBoZWF0Q2hhcmdlPU1hdGgubWluKDEsaGVhdENoYXJnZStnYWluKjAuMDAwNDUpOyBzaW5jZVNjb3JlVD0wOyB9CgogIC8qID09PT09IFByZWRpY3Rpb24gKGZ1bGwgYWNjZXNzIHRvIHBsYXllciBzdGF0ZSkgPT09PT0gKi8KICBmdW5jdGlvbiBwcmVwYXJlUGxheWVyUHJlZGljdGlvbihkdFJlYWwpewogICAgY29uc3QgZj1mb3J3YXJkVmVjdG9yKGNoYXNzaXNCb2R5KTsKICAgIGNvbnN0IHlhdyA9IE1hdGguYXRhbjIoZi54LCBmLnopOwogICAgY29uc3Qgdng9Y2hhc3Npc0JvZHkudmVsb2NpdHkueCwgdno9Y2hhc3Npc0JvZHkudmVsb2NpdHkuejsKICAgIGNvbnN0IHNwZWVkID0gTWF0aC5oeXBvdCh2eCwgdnopOwogICAgY29uc3QgYUxvbmcgPSAoc3BlZWQgLSBwbGF5ZXJQcmV2U3BlZWQpIC8gTWF0aC5tYXgoMC4wMDEsIGR0UmVhbCk7CiAgICBjb25zdCB5YXdSYXRlID0gY2hhc3Npc0JvZHkuYW5ndWxhclZlbG9jaXR5LnkgfHwgMDsKICAgIHBsYXllclN0YXRlID0gewogICAgICB4OiBjaGFzc2lzQm9keS5wb3NpdGlvbi54LCB6OiBjaGFzc2lzQm9keS5wb3NpdGlvbi56LAogICAgICB5YXcsIHlhd1JhdGUsIHNwZWVkLCBhY2NlbExvbmc6IGFMb25nKjAuNywKICAgICAgYm9vc3Rpbmc6IHBsYXllcklzQm9vc3RpbmcKICAgIH07CiAgICBwbGF5ZXJQcmV2U3BlZWQgPSBzcGVlZDsKCiAgICBmdXR1cmVQYXRoLmxlbmd0aCA9IDA7CiAgICBsZXQgeD1wbGF5ZXJTdGF0ZS54LCB6PXBsYXllclN0YXRlLnosIHk9cGxheWVyU3RhdGUueWF3LCBzPXBsYXllclN0YXRlLnNwZWVkOwogICAgY29uc3QgdyA9IHBsYXllclN0YXRlLnlhd1JhdGUsIGEgPSBwbGF5ZXJTdGF0ZS5hY2NlbExvbmc7CiAgICBjb25zdCBzdGVwPTAuMTIsIGhvcml6b249Mi4yOwogICAgbGV0IHQ9MDsKICAgIGZvcig7IHQ8PWhvcml6b24rMWUtNjsgdCs9c3RlcCl7CiAgICAgIGZ1dHVyZVBhdGgucHVzaCh7dCwgeCwgeiwgeWF3Onl9KTsKICAgICAgcyA9IE1hdGgubWF4KDAsIHMgKyBhKnN0ZXApOwogICAgICB5ICs9IHcqc3RlcDsKICAgICAgeCArPSBNYXRoLnNpbih5KSpzKnN0ZXA7CiAgICAgIHogKz0gTWF0aC5jb3MoeSkqcypzdGVwOwogICAgfQogIH0KCiAgZnVuY3Rpb24gY2hvb3NlSW50ZXJjZXB0KGFpLCBtYXhTKXsKICAgIGNvbnN0IGF4PWFpLmJvZHkucG9zaXRpb24ueCwgYXo9YWkuYm9keS5wb3NpdGlvbi56OwogICAgbGV0IGJlc3QgPSBmdXR1cmVQYXRoW2Z1dHVyZVBhdGgubGVuZ3RoLTFdLCBiZXN0Q29zdD0xZTk7CiAgICBmb3IgKGNvbnN0IHAgb2YgZnV0dXJlUGF0aCl7CiAgICAgIGNvbnN0IGR4PXAueC1heCwgZHo9cC56LWF6LCBkaXN0PU1hdGguaHlwb3QoZHgsZHopOwogICAgICBjb25zdCB0QUkgPSBkaXN0IC8gTWF0aC5tYXgoNSwgbWF4Uyk7CiAgICAgIGNvbnN0IGhlYWRYPU1hdGguc2luKHAueWF3KSwgaGVhZFo9TWF0aC5jb3MocC55YXcpOwogICAgICBjb25zdCBjcm9zcyA9IE1hdGguYWJzKCgtZHopKmhlYWRYICsgZHgqaGVhZFopOwogICAgICBjb25zdCBjb3N0ID0gTWF0aC5hYnModEFJIC0gcC50KSArIDAuMDAyOCpjcm9zcyArIDAuMDAwNSpkaXN0OwogICAgICBpZiAoY29zdCA8IGJlc3RDb3N0KXsgYmVzdENvc3Q9Y29zdDsgYmVzdD1wOyB9CiAgICB9CiAgICBjb25zdCBsZWFkQWhlYWQgPSBNYXRoLm1pbigxNiwgTWF0aC5tYXgoNiwgcGxheWVyU3RhdGUuc3BlZWQqMC4zMiArIGhlYXQqMS4zKSk7CiAgICBjb25zdCB0eCA9IGJlc3QueCArIE1hdGguc2luKGJlc3QueWF3KSpsZWFkQWhlYWQ7CiAgICBjb25zdCB0eiA9IGJlc3QueiArIE1hdGguY29zKGJlc3QueWF3KSpsZWFkQWhlYWQ7CiAgICByZXR1cm4ge3g6dHgsIHo6dHosIGRpc3RUb1ByZWQ6IE1hdGguaHlwb3QoYmVzdC54LWF4LCBiZXN0LnotYXopfTsKICB9CgogIC8qID09PT09IEFJIHVwZGF0ZTogcHJlZGljdGl2ZSBpbnRlcmNlcHQgKyBkZWNpc2l2ZSBsdW5nZSA9PT09PSAqLwogIGZ1bmN0aW9uIGFpQXZvaWRTdGVlcihhaSl7CiAgICBsZXQgc3RlZXJCaWFzPTA7IGNvbnN0IHB4PWFpLmJvZHkucG9zaXRpb24ueCwgcHo9YWkuYm9keS5wb3NpdGlvbi56OwogICAgZm9yKGNvbnN0IHIgb2YgbWFwU2hhcGVzKXsKICAgICAgY29uc3QgYz1NYXRoLmNvcygtci55YXcpLCBzPU1hdGguc2luKC1yLnlhdyksIGR4PXB4LXIueCwgZHo9cHotci56LCBseD1keCpjLWR6KnMsIGx6PWR4KnMrZHoqYzsKICAgICAgY29uc3QgaHc9ci53LzIrOSwgaGQ9ci5kLzIrOTsKICAgICAgaWYgKE1hdGguYWJzKGx4KTxodyAmJiBsej4tNiAmJiBsejxoZCsxNCl7CiAgICAgICAgY29uc3Qgc2lkZSA9IChseD49MD8xOi0xKTsgc3RlZXJCaWFzICs9IHNpZGUqMC40NSooci50eXBlPT09J3JhbXAnPzEuMjowLjgpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBtYXJnaW49MjY7CiAgICBpZihBUkVOQV9IQUxGLU1hdGguYWJzKHB4KSA8IG1hcmdpbiB8fCBBUkVOQV9IQUxGLU1hdGguYWJzKHB6KSA8IG1hcmdpbil7CiAgICAgIGNvbnN0IHZ4PS1weCx2ej0tcHosIGY9Zm9yd2FyZFZlY3RvcihhaS5ib2R5KSwgY3Jvc3M9Zi54KnZ6IC0gZi56KnZ4LCBkb3Q9Zi54KnZ4K2Yueip2eiwgYW5nPU1hdGguYXRhbjIoY3Jvc3MsZG90KTsKICAgICAgc3RlZXJCaWFzICs9IE1hdGgubWF4KC0wLjYsTWF0aC5taW4oMC42LGFuZykpKjAuNjsKICAgIH0KICAgIHJldHVybiBzdGVlckJpYXM7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVBSShhaSwgZHQpewogICAgY29uc3QgdkE9YWkuYm9keS52ZWxvY2l0eSwgc3BkQT1NYXRoLmh5cG90KHZBLngsdkEueik7CiAgICBjb25zdCBtYXhTID0gTWF0aC5tYXgoYWlNYXhTcGVlZCgpLCBwbGF5ZXJTdGF0ZS5zcGVlZCoxLjA1ICsgOCArIGhlYXQqMS4yKTsKCiAgICBpZiAoYWkuc3Bhd25LaWNrVCA+IDApewogICAgICBhaS5zcGF3bktpY2tUIC09IGR0OwogICAgICBhaS52ZWguYXBwbHlFbmdpbmVGb3JjZSgtNDQwMCpESUZGW2RpZmZdLmVuZ2luZSwgMik7CiAgICAgIGFpLnZlaC5hcHBseUVuZ2luZUZvcmNlKC00NDAwKkRJRkZbZGlmZl0uZW5naW5lLCAzKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHRndCA9IGNob29zZUludGVyY2VwdChhaSwgbWF4Uyk7CiAgICBjb25zdCB0b1ggPSB0Z3QueCAtIGFpLmJvZHkucG9zaXRpb24ueCwgdG9aID0gdGd0LnogLSBhaS5ib2R5LnBvc2l0aW9uLno7CiAgICBjb25zdCB0b0xlbiA9IE1hdGguaHlwb3QodG9YLHRvWikgfHwgMTsKICAgIGNvbnN0IHRvTnggPSB0b1gvdG9MZW4sIHRvTnogPSB0b1ovdG9MZW47CgogICAgY29uc3QgcHg9Y2hhc3Npc0JvZHkucG9zaXRpb24ueCwgcHo9Y2hhc3Npc0JvZHkucG9zaXRpb24uejsKICAgIGNvbnN0IGRpc3RQID0gTWF0aC5oeXBvdChweC1haS5ib2R5LnBvc2l0aW9uLngsIHB6LWFpLmJvZHkucG9zaXRpb24ueik7CiAgICBpZiAoKGRpc3RQIDwgMjQpIHx8IChwbGF5ZXJTdGF0ZS5zcGVlZDwxLjAgJiYgZGlzdFA8MzQpKSBhaS5sdW5nZVQgPSBNYXRoLm1heChhaS5sdW5nZVQsIDAuOSk7CiAgICBhaS5sdW5nZVQgPSBNYXRoLm1heCgwLCBhaS5sdW5nZVQgLSBkdCk7CiAgICBjb25zdCBsdW5nZSA9IGFpLmx1bmdlVCA+IDA7CgogICAgY29uc3QgZj1mb3J3YXJkVmVjdG9yKGFpLmJvZHkpOwogICAgY29uc3QgYW5nRXJyID0gTWF0aC5hdGFuMihmLngqdG9OeiAtIGYueip0b054LCBmLngqdG9OeCArIGYueip0b056KTsKICAgIGNvbnN0IHlhd1JhdGUgPSBhaS5ib2R5LmFuZ3VsYXJWZWxvY2l0eS55IHx8IDA7CiAgICBjb25zdCBLcCA9IGx1bmdlID8gMS42IDogMS4wOCwgS2QgPSBsdW5nZSA/IDAuMTggOiAwLjI2OwogICAgbGV0IHN0ZWVyQ21kID0gY2xhbXAoLShLcCphbmdFcnIgKyBLZCp5YXdSYXRlKSwgLTEuMCpESUZGW2RpZmZdLnN0ZWVyLCAxLjAqRElGRltkaWZmXS5zdGVlcik7CiAgICBpZiAoIWx1bmdlKSBzdGVlckNtZCA9IGNsYW1wKHN0ZWVyQ21kICsgYWlBdm9pZFN0ZWVyKGFpKSwgLTEuMCwgMS4wKTsKICAgIGFpLnZlaC5zZXRTdGVlcmluZ1ZhbHVlKHN0ZWVyQ21kLDApOyBhaS52ZWguc2V0U3RlZXJpbmdWYWx1ZShzdGVlckNtZCwxKTsKCiAgICBsZXQgd2FudCA9IG1heFMgKiAobHVuZ2UgPyAwLjk4IDogKDAuNTggKyAwLjQyKk1hdGgubWF4KDAsIGYueCp0b054ICsgZi56KnRvTnopKSk7CiAgICBpZiAodGd0LmRpc3RUb1ByZWQgPiAxMTApIHdhbnQgKj0gMS4xMjsKICAgIGlmIChwbGF5ZXJTdGF0ZS5ib29zdGluZykgd2FudCAqPSAxLjEwOwoKICAgIGxldCBicmFrZSA9IDA7CiAgICBpZiAoIWx1bmdlICYmIHNwZEEgPiB3YW50KzMpIGJyYWtlID0gTWF0aC5taW4oNjAsIChzcGRBIC0gd2FudCkqMy4yKTsKICAgIGZvcihsZXQgdz0wO3c8NDt3KyspIGFpLnZlaC5zZXRCcmFrZShicmFrZSx3KTsKCiAgICBsZXQgZW5naW5lID0gLSgzOTAwICsgaGVhdCo4MDApICogRElGRltkaWZmXS5lbmdpbmU7CiAgICBpZiAocGxheWVyU3RhdGUuYm9vc3RpbmcgfHwgdGd0LmRpc3RUb1ByZWQ+MTIwKSBlbmdpbmUgKj0gMS4xODsKICAgIGlmICghbHVuZ2UgJiYgTWF0aC5hYnMoc3RlZXJDbWQpPjAuNikgZW5naW5lICo9IDAuNzI7CiAgICBpZiAoc3BkQSA+IHdhbnQqMS4xMikgZW5naW5lICo9IDAuNTU7CiAgICBhaS52ZWguYXBwbHlFbmdpbmVGb3JjZShlbmdpbmUsMik7IGFpLnZlaC5hcHBseUVuZ2luZUZvcmNlKGVuZ2luZSwzKTsKCiAgICBpZiAobHVuZ2UpewogICAgICBhaS5ib2R5LmFwcGx5Rm9yY2UobmV3IENBTk5PTi5WZWMzKHRvTngqMTY1MCwgMCwgdG9OeioxNjUwKSwgYWkuYm9keS5wb3NpdGlvbik7CiAgICAgIGNvbnN0IHBlcnBYPS10b056LCBwZXJwWj10b054OyBjb25zdCBsYXQgPSAodkEueCpwZXJwWCArIHZBLnoqcGVycFopOwogICAgICBpZiAoTWF0aC5hYnMobGF0KSA+IDEuMCl7CiAgICAgICAgY29uc3QgaiA9IC1NYXRoLnNpZ24obGF0KSAqIE1hdGgubWluKDQ4LCBNYXRoLmFicyhsYXQpKjMwKTsKICAgICAgICBhaS5ib2R5LmFwcGx5SW1wdWxzZShuZXcgQ0FOTk9OLlZlYzMocGVycFgqaiwgMCwgcGVycFoqaiksIGFpLmJvZHkucG9zaXRpb24pOwogICAgICB9CiAgICAgIGFpLnZlaC53aGVlbEluZm9zWzBdLmZyaWN0aW9uU2xpcCA9IDEzLjI7IGFpLnZlaC53aGVlbEluZm9zWzFdLmZyaWN0aW9uU2xpcCA9IDEzLjI7CiAgICAgIGFpLnZlaC53aGVlbEluZm9zWzJdLmZyaWN0aW9uU2xpcCA9IDEyLjQ7IGFpLnZlaC53aGVlbEluZm9zWzNdLmZyaWN0aW9uU2xpcCA9IDEyLjQ7CiAgICAgIGFpLmJvZHkudG9ycXVlLnkgKz0gY2xhbXAoLShhbmdFcnIgKyAwLjU1Knlhd1JhdGUpLCAtMSwgMSkgKiAxMjAwOwogICAgICBhaS5ib2R5LmFuZ3VsYXJEYW1waW5nID0gMC44MjsKICAgIH0gZWxzZSB7CiAgICAgIGFpLnZlaC53aGVlbEluZm9zWzBdLmZyaWN0aW9uU2xpcCA9IDEwLjg7IGFpLnZlaC53aGVlbEluZm9zWzFdLmZyaWN0aW9uU2xpcCA9IDEwLjg7CiAgICAgIGFpLnZlaC53aGVlbEluZm9zWzJdLmZyaWN0aW9uU2xpcCA9IDEwLjA7IGFpLnZlaC53aGVlbEluZm9zWzNdLmZyaWN0aW9uU2xpcCA9IDEwLjA7CiAgICAgIGFpLmJvZHkuYW5ndWxhckRhbXBpbmcgPSAwLjU4OwogICAgfQoKICAgIGNvbnN0IHVwPXVwVmVjdG9yKGFpLmJvZHkpOwogICAgaWYgKHVwLnkgPCAwLjE1KXsgYWkudXBzaWRlVCArPSBkdDsgaWYgKGFpLnVwc2lkZVQ+MS4wKXsgdXByaWdodEFJKGFpKTsgYWkudXBzaWRlVD0wOyB9IH0KICAgIGVsc2UgYWkudXBzaWRlVCA9IE1hdGgubWF4KDAsIGFpLnVwc2lkZVQgLSBkdCowLjUpOwoKICAgIGlmIChzcGRBIDwgMC45KXsgYWkuc3R1Y2tUICs9IGR0OyBpZiAoYWkuc3R1Y2tUPjIuMCl7IG51ZGdlQUkoYWksIHt4OnRvTngsejp0b056fSk7IGFpLnN0dWNrVD0wLjY7IH0gfQogICAgZWxzZSBhaS5zdHVja1QgPSBNYXRoLm1heCgwLCBhaS5zdHVja1QgLSBkdCowLjcpOwogIH0KCiAgZnVuY3Rpb24gdXByaWdodEFJKGFpKXsKICAgIGNvbnN0IGV1bGVyID0gbmV3IFRIUkVFLkV1bGVyKCkuc2V0RnJvbVF1YXRlcm5pb24obmV3IFRIUkVFLlF1YXRlcm5pb24oYWkuYm9keS5xdWF0ZXJuaW9uLngsYWkuYm9keS5xdWF0ZXJuaW9uLnksYWkuYm9keS5xdWF0ZXJuaW9uLnosYWkuYm9keS5xdWF0ZXJuaW9uLncpLCJYWVoiKTsKICAgIGFpLmJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoMCwgZXVsZXIueSwgMCwgIlhZWiIpOwogICAgYWkuYm9keS5hbmd1bGFyVmVsb2NpdHkuc2V0KDAsMCwwKTsKICAgIGFpLmJvZHkudmVsb2NpdHkueSA9IE1hdGgubWF4KGFpLmJvZHkudmVsb2NpdHkueSwgMS41KTsKICB9CiAgZnVuY3Rpb24gbnVkZ2VBSShhaSwgZGlyKXsKICAgIGZvciAobGV0IHc9MDsgdzw0OyB3KyspIGFpLnZlaC5zZXRCcmFrZSgwLCB3KTsKICAgIGNvbnN0IHB1c2ggPSBuZXcgQ0FOTk9OLlZlYzMoKGRpcj8ueHx8MSkqMzYwLCAwLCAoZGlyPy56fHwwKSozNjApOwogICAgYWkuYm9keS5hcHBseUltcHVsc2UocHVzaCwgYWkuYm9keS5wb3NpdGlvbik7CiAgfQoKICAvKiA9PT09PSBQaWNrdXBzIC8gT3JicyA9PT09PSAqLwogIGZ1bmN0aW9uIHNwYXduUGlja3VwcygpewogICAgcGlja3Vwcy5sZW5ndGggPSAwOwogICAgZm9yKGxldCBpPTA7aTwzO2krKykgcGlja3Vwcy5wdXNoKG1ha2VQaWNrdXAoJ25pdHJvJywgcmFuZG9tRWRnZVBvcygpKSk7CiAgICBwaWNrdXBzLnB1c2gobWFrZVBpY2t1cCgnc2hpZWxkJywgcmFuZG9tRWRnZVBvcygpKSk7CiAgfQogIGZ1bmN0aW9uIG1ha2VQaWNrdXAodHlwZSxwb3MpewogICAgY29uc3QgZ2VvID0gdHlwZT09PSduaXRybyc/IG5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KDAuNiwwLjYsMS4yLDEyKSA6IG5ldyBUSFJFRS5Ub3J1c0dlb21ldHJ5KDEuMCwwLjE1LDEwLDI4KTsKICAgIGNvbnN0IG1hdCA9IG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKHsgY29sb3I6IHR5cGU9PT0nbml0cm8nPzB4MmFmNWE0OjB4Yjk4N2ZmLCBlbWlzc2l2ZTogdHlwZT09PSduaXRybyc/MHgwMDQ0MDA6MHgyMjAwNDQgfSk7CiAgICBjb25zdCBtID0gbmV3IFRIUkVFLk1lc2goZ2VvLCBtYXQpOyBtLnBvc2l0aW9uLnNldChwb3MueCwgdHlwZT09PSduaXRybyc/MC45OjEuMiwgcG9zLnopOyBzY2VuZS5hZGQobSk7CiAgICByZXR1cm4geyBtZXNoOm0sIHR5cGUsIHJlc3Bhd25UOjAgfTsKICB9CiAgZnVuY3Rpb24gcmFuZG9tRWRnZVBvcygpewogICAgY29uc3Qgcj1BUkVOQV9IQUxGLTQwLCBhPU1hdGgucmFuZG9tKCkqTWF0aC5QSSoyLCByYWQ9ci00MCpNYXRoLnJhbmRvbSgpOwogICAgcmV0dXJuIG5ldyBUSFJFRS5WZWN0b3IzKE1hdGguY29zKGEpKnJhZCwwLE1hdGguc2luKGEpKnJhZCk7CiAgfQogIGZ1bmN0aW9uIHNwYXduT3JicyhuKXsKICAgIGZvcihsZXQgaT0wO2k8bjtpKyspewogICAgICBjb25zdCBtPW5ldyBUSFJFRS5NZXNoKG5ldyBUSFJFRS5TcGhlcmVHZW9tZXRyeSgwLjUsMTAsMTApLCBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOjB4YWQ3NmZmLCBlbWlzc2l2ZToweDIyMDAzMyB9KSk7CiAgICAgIGNvbnN0IHA9cmFuZG9tRWRnZVBvcygpOyBtLnBvc2l0aW9uLnNldChwLngsMC41LHAueik7IHNjZW5lLmFkZChtKTsgb3Jicy5wdXNoKG0pOwogICAgfQogIH0KICBmdW5jdGlvbiBzcGluUGlja3VwcyhkdCl7CiAgICBmb3IoY29uc3QgcCBvZiBwaWNrdXBzKXsgcC5tZXNoLnJvdGF0aW9uLnkgKz0gZHQqMS40OyBwLm1lc2gudmlzaWJsZSA9IHAucmVzcGF3blQ8PTA7IGlmKHAucmVzcGF3blQ+MCkgcC5yZXNwYXduVCAtPSBkdDsgfQogIH0KICBmdW5jdGlvbiBjaGVja1BpY2t1cHMoKXsKICAgIGZvcihjb25zdCBwIG9mIHBpY2t1cHMpewogICAgICBpZighcC5tZXNoLnZpc2libGUpIGNvbnRpbnVlOwogICAgICBjb25zdCBkeD1wLm1lc2gucG9zaXRpb24ueC1jaGFzc2lzQm9keS5wb3NpdGlvbi54LCBkej1wLm1lc2gucG9zaXRpb24uei1jaGFzc2lzQm9keS5wb3NpdGlvbi56OwogICAgICBpZihNYXRoLmh5cG90KGR4LGR6KTwyLjQpewogICAgICAgIGlmKHAudHlwZT09PSduaXRybycpeyBuaXRybz1NYXRoLm1pbigxLG5pdHJvKzAuNik7IGFkZFNjb3JlKDIwMCwiTml0cm8gY2FuIik7IGF1ZGlvLmJsaXAoNjYwLC4xLC4yNSk7fQogICAgICAgIGVsc2UgeyBzaGllbGRUPTYuMDsgYWRkU2NvcmUoMzAwLCJTaGllbGQiKTsgYXVkaW8uYmxpcCg0ODAsLjE1LC4yNSk7IH0KICAgICAgICBwLnJlc3Bhd25UPTgrTWF0aC5yYW5kb20oKSo2OwogICAgICAgIHAubWVzaC5wb3NpdGlvbi5jb3B5KHJhbmRvbUVkZ2VQb3MoKSk7CiAgICAgICAgcC5tZXNoLnZpc2libGU9ZmFsc2U7CiAgICAgIH0KICAgIH0KICB9CiAgZnVuY3Rpb24gY2hlY2tPcmJzKCl7CiAgICBmb3IobGV0IGk9b3Jicy5sZW5ndGgtMTtpPj0wO2ktLSl7CiAgICAgIGNvbnN0IG89b3Jic1tpXTsKICAgICAgY29uc3QgZHg9by5wb3NpdGlvbi54LWNoYXNzaXNCb2R5LnBvc2l0aW9uLngsIGR6PW8ucG9zaXRpb24uei1jaGFzc2lzQm9keS5wb3NpdGlvbi56OwogICAgICBpZihNYXRoLmh5cG90KGR4LGR6KTwyLjApewogICAgICAgIGFkZFNjb3JlKDEyMCwiT3JiIik7IGF1ZGlvLmJsaXAoNTYwLC4wNywuMik7CiAgICAgICAgaWYgKFBFUkYuZWZmZWN0cyAmJiBwYXJ0aWNsZXMucmluZykgcGFydGljbGVzLnJpbmcuc3Bhd24obmV3IFRIUkVFLlZlY3RvcjMoby5wb3NpdGlvbi54LDEuMCxvLnBvc2l0aW9uLnopLCBuZXcgVEhSRUUuVmVjdG9yMygpLCAwLjM1LCAxLjIsIDAuOSk7CiAgICAgICAgc2NlbmUucmVtb3ZlKG8pOyBvcmJzLnNwbGljZShpLDEpOwogICAgICB9CiAgICB9CiAgICBpZihvcmJzLmxlbmd0aDwxMCkgc3Bhd25PcmJzKDIpOwogIH0KCiAgLyogPT09PT0gSW5wdXQgJiBtb2JpbGUgPT09PT0gKi8KICBsZXQga2V5cz17fTsKICBhZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgZT0+eyBjb25zdCBrPWUua2V5LnRvTG93ZXJDYXNlKCk7IGtleXNba109dHJ1ZTsgaWYoWyIgIiwiYXJyb3d1cCIsImFycm93ZG93biIsImFycm93bGVmdCIsImFycm93cmlnaHQiXS5pbmNsdWRlcyhrKSkgZS5wcmV2ZW50RGVmYXVsdCgpOyBpZihrPT09ImMiKXsgY2FtZXJhTW9kZT0oY2FtZXJhTW9kZT09PSJjaGFzZSIpPyJvcmJpdCI6ImNoYXNlIjsgfSBpZihrPT09Im0iKXsgbXV0ZWQ9IW11dGVkOyB1aS5idG5NdXRlLnRleHRDb250ZW50PSdTb3VuZDogJysobXV0ZWQ/J09GRic6J09OJyk7IH0gaWYoaz09PSJyIil7IHJlc2V0Um91bmQoIlJlc2V0Iik7IH0gfSwge3Bhc3NpdmU6ZmFsc2V9KTsKICBhZGRFdmVudExpc3RlbmVyKCJrZXl1cCIsIGU9Pnsga2V5c1tlLmtleS50b0xvd2VyQ2FzZSgpXT1mYWxzZTsgfSk7CgogIHVpLmJ0bk1lbnUub25jbGljaz0oKT0+IHVpLnBhbmVsLnN0eWxlLmRpc3BsYXkgPSAodWkucGFuZWwuc3R5bGUuZGlzcGxheT09PSdibG9jaycpPydub25lJzonYmxvY2snOwogIHVpLmJ0bkhlbHAub25jbGljaz0oKT0+eyB1aS5wYW5lbC5zdHlsZS5kaXNwbGF5PSdub25lJzsgdWkubWFudWFsLnN0eWxlLmRpc3BsYXk9ImZsZXgiOyB9OwogIHVpLm1hbnVhbENsb3NlLm9uY2xpY2s9KCk9PnsgdWkubWFudWFsLnN0eWxlLmRpc3BsYXk9Im5vbmUiOyB9OwogIHVpLmJ0bkJvdHMub25jbGljaz0oKT0+eyBib3RzRW5hYmxlZD0hYm90c0VuYWJsZWQ7IHVpLmJ0bkJvdHMudGV4dENvbnRlbnQ9J0JvdHM6ICcrKGJvdHNFbmFibGVkPydPTic6J09GRicpOyBpZighYm90c0VuYWJsZWQpeyB3aGlsZShhaUNhcnMubGVuZ3RoKSBkZXNwYXduQUkoKTsgfSBlbHNlIHsgcmVjb25jaWxlQm90c1RvSGVhdCgpOyB9IH07CiAgdWkuYnRuRGlmZi5vbmNsaWNrPSgpPT57IGRpZmY9KGRpZmYrMSklRElGRi5sZW5ndGg7IHVpLmJ0bkRpZmYudGV4dENvbnRlbnQ9J0RpZmZpY3VsdHk6ICcrRElGRltkaWZmXS5uYW1lOyByZWNvbmNpbGVCb3RzVG9IZWF0KCk7IH07CiAgdWkuYnRuTWFwLm9uY2xpY2s9KCk9PiBzZXRNYXAoY3VycmVudE1hcCsxKTsKICB1aS5idG5QZXJmLm9uY2xpY2s9KCk9PiBhcHBseVBlcmYoUEVSRi5tb2RlPT09J2F1dG8nPydsaXRlJzpQRVJGLm1vZGU9PT0nbGl0ZSc/J3VsdHJhJzonaGlnaCcpOwogIHVpLmJ0bk11dGUub25jbGljaz0oKT0+eyBtdXRlZD0hbXV0ZWQ7IHVpLmJ0bk11dGUudGV4dENvbnRlbnQ9J1NvdW5kOiAnKyhtdXRlZD8nT0ZGJzonT04nKTsgfTsKICAkKCIjc2NvcmUiKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNoYXJlU2NvcmUpOwogIGZ1bmN0aW9uIHNoYXJlU2NvcmUoKXsKICAgIGNvbnN0IG1zZz1gSSBzY29yZWQgJHtzY29yZS50b0xvY2FsZVN0cmluZygpfSBpbiAke0dBTUVfTkFNRX0gb24gJHtNQVBTW2N1cnJlbnRNYXBdLm5hbWV9IGF0ICR7aGVhdE5hbWUoaGVhdCl9IGhlYXQgKCR7RElGRltkaWZmXS5uYW1lfSkuYDsKICAgIGNvbnN0IGRhdGE9e3RpdGxlOkdBTUVfTkFNRSx0ZXh0Om1zZyx1cmw6bG9jYXRpb24uaHJlZn07IGlmKG5hdmlnYXRvci5zaGFyZSl7IG5hdmlnYXRvci5zaGFyZShkYXRhKS5jYXRjaCgoKT0+e30pOyB9IGVsc2UgeyBjb25zdCB0YT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpOyB0YS52YWx1ZT1tc2crIiDigJQgIitsb2NhdGlvbi5ocmVmOyBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRhKTsgdGEuc2VsZWN0KCk7IGRvY3VtZW50LmV4ZWNDb21tYW5kKCdjb3B5Jyk7IGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGEpOyBmbGFzaCgiU2NvcmUgY29waWVkISIpOyB9CiAgfQoKICBsZXQgdG91Y2hBY2NlbD1mYWxzZSx0b3VjaEJyYWtlPWZhbHNlLHRvdWNoRHJpZnQ9ZmFsc2UsdG91Y2hOaXRybz1mYWxzZSx0b3VjaFN0ZWVyPTAsdG91Y2hSb2xsTD1mYWxzZSx0b3VjaFJvbGxSPWZhbHNlOwogIGZ1bmN0aW9uIGJpbmRIb2xkKGVsLHNldCl7IGNvbnN0IG9uPSgpPT5zZXQodHJ1ZSksIG9mZj0oKT0+c2V0KGZhbHNlKTsgZWwuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLGU9PntlLnByZXZlbnREZWZhdWx0KCk7b24oKTt9KTsgWydwb2ludGVydXAnLCdwb2ludGVybGVhdmUnLCdwb2ludGVyY2FuY2VsJ10uZm9yRWFjaCh2PT5lbC5hZGRFdmVudExpc3RlbmVyKHYsb2ZmKSk7IGVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsb24pOyBlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJyxvZmYpOyBlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJyxvZmYpOyB9CiAgZnVuY3Rpb24gc2V0dXBNb2JpbGVDb250cm9scygpewogICAgYmluZEhvbGQoJCgiI2J0bkdhcyIpLHY9PnRvdWNoQWNjZWw9dik7IGJpbmRIb2xkKCQoIiNidG5CcmFrZSIpLHY9PnRvdWNoQnJha2U9dik7IGJpbmRIb2xkKCQoIiNidG5EcmlmdCIpLHY9PnRvdWNoRHJpZnQ9dik7IGJpbmRIb2xkKCQoIiNidG5OaXRybyIpLHY9PnRvdWNoTml0cm89dik7CiAgICBiaW5kSG9sZCgkKCIjYnRuUm9sbEwiKSx2PT50b3VjaFJvbGxMPXYpOyBiaW5kSG9sZCgkKCIjYnRuUm9sbFIiKSx2PT50b3VjaFJvbGxSPXYpOwogICAgY29uc3QgcGFkPSQoIiNzdGVlclBhZCIpLCBrbm9iPSQoIiNzdGVlcktub2IiKTsgbGV0IGFjdGl2ZT1mYWxzZSwgcmVjdD1udWxsLCBwaWQ9bnVsbDsgbGV0IHJhZGl1cz1wYXJzZUZsb2F0KGdldENvbXB1dGVkU3R5bGUocGFkKS53aWR0aCkqMC41LTEwOwogICAgZnVuY3Rpb24gc2V0S25vYihkeCxkeSl7IGNvbnN0IG1hZz1NYXRoLmh5cG90KGR4LGR5KSwgaz1tYWc+cmFkaXVzP3JhZGl1cy9tYWc6MSwgeD1keCprLCB5PWR5Kms7IGtub2Iuc3R5bGUudHJhbnNmb3JtPWB0cmFuc2xhdGUoJHt4fXB4LCAke3l9cHgpIHRyYW5zbGF0ZSgtNTAlLC01MCUpYDsgdG91Y2hTdGVlcj1NYXRoLm1heCgtMSxNYXRoLm1pbigxLC14L3JhZGl1cykpOyB9CiAgICBwYWQuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLGU9PnsgYWN0aXZlPXRydWU7IHBpZD1lLnBvaW50ZXJJZDsgcmVjdD1wYWQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7IHBhZC5zZXRQb2ludGVyQ2FwdHVyZShwaWQpOyBjb25zdCBjeD1yZWN0LmxlZnQrcmVjdC53aWR0aC8yLCBjeT1yZWN0LnRvcCtyZWN0LmhlaWdodC8yOyBzZXRLbm9iKGUuY2xpZW50WC1jeCwgZS5jbGllbnRZLWN5KTsgfSk7CiAgICBwYWQuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcm1vdmUnLGU9PnsgaWYoIWFjdGl2ZXx8ZS5wb2ludGVySWQhPT1waWQpIHJldHVybjsgY29uc3QgY3g9cmVjdC5sZWZ0K3JlY3Qud2lkdGgvMixjeT1yZWN0LnRvcCtyZWN0LmhlaWdodC8yOyBzZXRLbm9iKGUuY2xpZW50WC1jeCxlLmNsaWVudFktY3kpOyB9KTsKICAgIGZ1bmN0aW9uIGVuZFBhZCgpeyBhY3RpdmU9ZmFsc2U7IHRvdWNoU3RlZXI9MDsga25vYi5zdHlsZS50cmFuc2Zvcm09YHRyYW5zbGF0ZSgtNTAlLC01MCUpYDsgaWYocGlkIT1udWxsKSB0cnl7cGFkLnJlbGVhc2VQb2ludGVyQ2FwdHVyZShwaWQpO31jYXRjaChfKXsgfSBwaWQ9bnVsbDsgfQogICAgcGFkLmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJ1cCcsZW5kUGFkKTsgcGFkLmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJsZWF2ZScsZW5kUGFkKTsgcGFkLmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJjYW5jZWwnLGVuZFBhZCk7CiAgICB1cGRhdGVPcmllbnQoKTsKICB9CiAgZnVuY3Rpb24gdXBkYXRlT3JpZW50KCl7IHVpLm9yaWVudC5zdHlsZS5kaXNwbGF5ID0gKGlubmVyV2lkdGggPCBpbm5lckhlaWdodCkgPyAnZmxleCcgOiAnbm9uZSc7IH0KCiAgLyogPT09PT0gTG9vcCA9PT09PSAqLwogIGxldCByZWFyV2hlZWxQb3M9W25ldyBUSFJFRS5WZWN0b3IzKCksIG5ldyBUSFJFRS5WZWN0b3IzKCldLCBtaW5pbWFwQWNjdW09MDsKICBsZXQgYWNjdW11bGF0b3IgPSAwLCBGSVhFRCA9IDEvNjAsIE1BWF9TVEVQUyA9IDU7CiAgbGV0IHN0ZWVyUyA9IDAsIHRocm90dGxlUyA9IDA7CgogIGZ1bmN0aW9uIGFuaW1hdGUoKXsKICAgIGNvbnN0IGR0ID0gTWF0aC5taW4oMC4xLCBjbG9jay5nZXREZWx0YSgpKTsKICAgIGFjY3VtdWxhdG9yICs9IGR0OwogICAgbGV0IHN0ZXBzID0gMDsKICAgIHdoaWxlIChhY2N1bXVsYXRvciA+PSBGSVhFRCAmJiBzdGVwcyA8IE1BWF9TVEVQUyl7CiAgICAgIHN0ZXAoRklYRUQpOwogICAgICBhY2N1bXVsYXRvciAtPSBGSVhFRDsKICAgICAgc3RlcHMrKzsKICAgIH0KICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSxjYW1lcmEpOwogICAgbWluaW1hcEFjY3VtICs9IGR0OyBpZiAobWluaW1hcEFjY3VtID49IDEvTWF0aC5tYXgoNiwgUEVSRi5taW5pbWFwSHopKXsgbWFwLmRyYXcoKTsgbWluaW1hcEFjY3VtID0gMDsgfQogICAgcGVyZlRpY2soZHQpOwogICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogIH0KCiAgZnVuY3Rpb24gc3RlcChkdFJlYWwpewogICAgY29uc3QgZHQ9ZHRSZWFsKnRpbWVTY2FsZTsKCiAgICAvLyBJbnB1dHMKICAgIGNvbnN0IGFjY2VsVG91Y2ggPSAodG91Y2hBY2NlbD8xOjApICsgKHRvdWNoQnJha2U/LTAuNzowKTsKICAgIGxldCByYXdBY2NlbD1hY2NlbFRvdWNoLCByYXdTdGVlcj10b3VjaFN0ZWVyLCBoYW5kYnJha2U9dG91Y2hEcmlmdCwgYm9vc3RLZXk9dG91Y2hOaXRybzsKICAgIGlmIChNYXRoLmFicygoa2V5c1sidyJdfHxrZXlzWyJhcnJvd3VwIl0/MTowKSAtIChrZXlzWyJzIl18fGtleXNbImFycm93ZG93biJdPzAuNzowKSkgPiBNYXRoLmFicyhyYXdBY2NlbCkpeyByYXdBY2NlbD0oa2V5c1sidyJdfHxrZXlzWyJhcnJvd3VwIl0pPzE6KGtleXNbInMiXXx8a2V5c1siYXJyb3dkb3duIl0pPy0wLjc6cmF3QWNjZWw7IH0KICAgIGNvbnN0IHN0ZWVyS0I9KGtleXNbImEiXXx8a2V5c1siYXJyb3dsZWZ0Il0pPzE6KGtleXNbImQiXXx8a2V5c1siYXJyb3dyaWdodCJdKT8tMTowOyBpZiAoTWF0aC5hYnMoc3RlZXJLQik+TWF0aC5hYnMocmF3U3RlZXIpKSByYXdTdGVlcj1zdGVlcktCOwoKICAgIGNvbnN0IGVhc2UgPSAxIC0gTWF0aC5leHAoLWR0KjEyKTsKICAgIHRocm90dGxlUyArPSAocmF3QWNjZWwgLSB0aHJvdHRsZVMpICogZWFzZTsKICAgIHN0ZWVyUyAgICArPSAocmF3U3RlZXIgLSBzdGVlclMpICAgKiBlYXNlOwoKICAgIHBsYXllclZlaGljbGUuc2V0U3RlZXJpbmdWYWx1ZShzdGVlclMqMC41LDApOyBwbGF5ZXJWZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUoc3RlZXJTKjAuNSwxKTsKICAgIGZvcihsZXQgaT0wO2k8NDtpKyspIHBsYXllclZlaGljbGUuc2V0QnJha2UoaGFuZGJyYWtlPzU1OjAsaSk7CgogICAgY29uc3Qgdj1jaGFzc2lzQm9keS52ZWxvY2l0eSwgaG9yaXpTcGVlZD1NYXRoLnNxcnQodi54KnYueCt2Lnoqdi56KTsKICAgIGlmIChib29zdEtleSAmJiBuaXRybz4wKXsKICAgICAgbml0cm89TWF0aC5tYXgoMCxuaXRyby0wLjM1KmR0UmVhbCk7IGNvbnN0IGRpcj1mb3J3YXJkVmVjdG9yKGNoYXNzaXNCb2R5KTsKICAgICAgY2hhc3Npc0JvZHkuYXBwbHlGb3JjZShuZXcgQ0FOTk9OLlZlYzMoZGlyLngqMjUwMCwwLGRpci56KjI1MDApLGNoYXNzaXNCb2R5LnBvc2l0aW9uKTsKICAgICAgY2FtU2hha2U9TWF0aC5taW4oMC4zNSxjYW1TaGFrZSswLjAyKTsgcGxheWVySXNCb29zdGluZz10cnVlOwogICAgICBpZihQRVJGLmVmZmVjdHMgJiYgcGFydGljbGVzLmZsYW1lKXsgY29uc3QgYmFjaz1uZXcgVEhSRUUuVmVjdG9yMygtZGlyLngsLWRpci55LC1kaXIueik7IGNvbnN0IHA9bmV3IFRIUkVFLlZlY3RvcjMoY2hhc3Npc0JvZHkucG9zaXRpb24ueCtiYWNrLngqMi4yLCBjaGFzc2lzQm9keS5wb3NpdGlvbi55KzAuNSwgY2hhc3Npc0JvZHkucG9zaXRpb24ueitiYWNrLnoqMi4yKTsgcGFydGljbGVzLmZsYW1lLnNwYXduKHAsIGJhY2subXVsdGlwbHlTY2FsYXIoOCksIDAuMTIsIDAuOSk7IH0KICAgIH0gZWxzZSB7IG5pdHJvPU1hdGgubWluKDEsbml0cm8rMC4xMipkdFJlYWwpOyBwbGF5ZXJJc0Jvb3N0aW5nID0gdHVyYm9UPjA7IH0KICAgIHVpLm5pdHJvRmlsbC5zdHlsZS53aWR0aD0obml0cm8qMTAwKS50b0ZpeGVkKDEpKyIlIjsKCiAgICBmbG9vclRleC5vZmZzZXQueSArPSAoaG9yaXpTcGVlZCAqIDAuMDAwMzUpICogZHRSZWFsOwoKICAgIGNvbnN0IHRyYWN0aW9uPWdyb3VuZGVkUHJldj8xLjA6MC4yNSwgdHVyYm9NdWw9ICh0dXJib1Q+MCk/MS44OjEuMDsKICAgIGNvbnN0IGVuZ2luZT0tdGhyb3R0bGVTKjMyMDAqdHJhY3Rpb24qdHVyYm9NdWw7CiAgICBwbGF5ZXJWZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UoZW5naW5lLDIpOyBwbGF5ZXJWZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UoZW5naW5lLDMpOwoKICAgIGlmKGdyb3VuZGVkUHJldiAmJiAodGhyb3R0bGVTPjAuNCB8fCB0dXJib1Q+MCkpeyBjb25zdCBzcD1NYXRoLnNxcnQodi54KnYueCt2Lnoqdi56KTsgc3RhYmlsaXplUGl0Y2goY2hhc3Npc0JvZHksMTgwMCk7IHVwcmlnaHRBc3Npc3QoY2hhc3Npc0JvZHksMTYwMCwwLjk1KTsgYXBwbHlBZXJvKGNoYXNzaXNCb2R5LCBzcCwgMC4yOCk7IH0KICAgIGlmKHR1cmJvVD4wKXsgY29uc3QgZGlyPWZvcndhcmRWZWN0b3IoY2hhc3Npc0JvZHkpOyBjaGFzc2lzQm9keS5hcHBseUZvcmNlKG5ldyBDQU5OT04uVmVjMyhkaXIueCo0NTAsMCxkaXIueio0NTApLCBjaGFzc2lzQm9keS5wb3NpdGlvbik7IGNvbnN0IHNwPU1hdGguc3FydCh2Lngqdi54K3Yueip2LnopOyBhcHBseUFlcm8oY2hhc3Npc0JvZHksIHNwLCAwLjU1KTsgdHVyYm9UPU1hdGgubWF4KDAsdHVyYm9ULWR0UmVhbCk7IH0KCiAgICBpZighZ3JvdW5kZWRQcmV2ICYmICh0b3VjaFJvbGxMfHx0b3VjaFJvbGxSfHxrZXlzWyJhcnJvd2xlZnQiXXx8a2V5c1siYXJyb3dyaWdodCJdKSl7CiAgICAgIGNvbnN0IGZ3ZD1mb3J3YXJkVmVjdG9yKGNoYXNzaXNCb2R5KTsgY29uc3QgdG9ycXVlPSh0b3VjaFJvbGxMfHxrZXlzWyJhcnJvd2xlZnQiXSk/LTE4MDA6ICh0b3VjaFJvbGxSfHxrZXlzWyJhcnJvd3JpZ2h0Il0pPzE4MDA6MDsKICAgICAgY2hhc3Npc0JvZHkudG9ycXVlLnggKz0gZndkLngqdG9ycXVlOyBjaGFzc2lzQm9keS50b3JxdWUueSArPSBmd2QueSp0b3JxdWU7IGNoYXNzaXNCb2R5LnRvcnF1ZS56ICs9IGZ3ZC56KnRvcnF1ZTsKICAgIH0KCiAgICAvLyBQcmVwYXJlIHByZWRpY3Rpb24gZm9yIGFsbCBBSXMgdGhpcyBmcmFtZQogICAgcHJlcGFyZVBsYXllclByZWRpY3Rpb24oZHRSZWFsKTsKCiAgICAvLyBBSQogICAgaWYgKGJvdHNFbmFibGVkKXsgZm9yIChjb25zdCBhaSBvZiBhaUNhcnMpeyB1cGRhdGVBSShhaSwgZHRSZWFsKTsgfSB9CgogICAgd29ybGQuc3RlcChGSVhFRCk7CgogICAgLy8gc3luYyB2aXN1YWxzCiAgICBjaGFzc2lzTWVzaC5wb3NpdGlvbi5jb3B5KGNoYXNzaXNCb2R5LnBvc2l0aW9uKTsgY2hhc3Npc01lc2gucXVhdGVybmlvbi5jb3B5KGNoYXNzaXNCb2R5LnF1YXRlcm5pb24pOwogICAgZm9yKGxldCBpPTA7aTxwbGF5ZXJWZWhpY2xlLndoZWVsSW5mb3MubGVuZ3RoO2krKyl7CiAgICAgIHBsYXllclZlaGljbGUudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIGNvbnN0IHQ9cGxheWVyVmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOyBpZighcGxheWVyV2hlZWxNZXNoZXNbaV0pIGNvbnRpbnVlOwogICAgICBwbGF5ZXJXaGVlbE1lc2hlc1tpXS5wb3NpdGlvbi5zZXQodC5wb3NpdGlvbi54LHQucG9zaXRpb24ueSx0LnBvc2l0aW9uLnopOwogICAgICBwbGF5ZXJXaGVlbE1lc2hlc1tpXS5xdWF0ZXJuaW9uLnNldCh0LnF1YXRlcm5pb24ueCx0LnF1YXRlcm5pb24ueSx0LnF1YXRlcm5pb24ueix0LnF1YXRlcm5pb24udyk7CiAgICAgIGlmKGk+PTIpIHJlYXJXaGVlbFBvc1tpLTJdLnNldCh0LnBvc2l0aW9uLngsdC5wb3NpdGlvbi55LHQucG9zaXRpb24ueik7CiAgICB9CiAgICBmb3IoY29uc3QgYWkgb2YgYWlDYXJzKXsKICAgICAgYWkubWVzaC5wb3NpdGlvbi5jb3B5KGFpLmJvZHkucG9zaXRpb24pOyBhaS5tZXNoLnF1YXRlcm5pb24uY29weShhaS5ib2R5LnF1YXRlcm5pb24pOwogICAgICBmb3IobGV0IGk9MDtpPGFpLnZlaC53aGVlbEluZm9zLmxlbmd0aDtpKyspeyBhaS52ZWgudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7IGNvbnN0IHQ9YWkudmVoLndoZWVsSW5mb3NbaV0ud29ybGRUcmFuc2Zvcm07IGFpLndoZWVsc1tpXS5wb3NpdGlvbi5zZXQodC5wb3NpdGlvbi54LHQucG9zaXRpb24ueSx0LnBvc2l0aW9uLnopOyBhaS53aGVlbHNbaV0ucXVhdGVybmlvbi5zZXQodC5xdWF0ZXJuaW9uLngsdC5xdWF0ZXJuaW9uLnksdC5xdWF0ZXJuaW9uLnosdC5xdWF0ZXJuaW9uLncpOyB9CiAgICB9CgogICAgY29uc3Qgb25Hcm91bmRQbGF5ZXIgPSBwbGF5ZXJWZWhpY2xlLndoZWVsSW5mb3Muc29tZSh3ID0+IHcucmF5Y2FzdFJlc3VsdCAmJiB3LnJheWNhc3RSZXN1bHQuaGFzSGl0KTsKICAgIGdyb3VuZGVkUHJldiA9IG9uR3JvdW5kUGxheWVyOwoKICAgIC8vIHNjb3JpbmcgJiBmeAogICAgeyBjb25zdCBmd2Q9Zm9yd2FyZFZlY3RvcihjaGFzc2lzQm9keSk7IGNvbnN0IHM9TWF0aC5zcXJ0KHYueCp2Lngrdi56KnYueik7CiAgICAgIGNvbnN0IGRvdD0odi54KmZ3ZC54K3Yueipmd2QueikvKE1hdGgubWF4KDAuMDAxLHMpKk1hdGguc3FydChmd2QueCpmd2QueCtmd2Queipmd2QueikpOwogICAgICBjb25zdCBzbGlwPU1hdGguYWNvcyhNYXRoLm1heCgtMSxNYXRoLm1pbigxLGRvdCkpKSoxODAvTWF0aC5QSTsKICAgICAgaWYob25Hcm91bmRQbGF5ZXIgJiYgcz40ICYmIHNsaXA+MTgpeyBkcmlmdFRpbWVyKz1kdDsgY29uc3QgZHJpZnRQdHM9KHNsaXAvMjApICogKHMvNikgKiAyMCAqIGR0OyBhZGRTY29yZShkcmlmdFB0cywiRHJpZnQiKTsgY29tYm89TWF0aC5taW4oMy4wLCBjb21ibyswLjAxNSk7IHVpLmNvbWJvLnRleHRDb250ZW50PWBDb21ibyB4JHtjb21iby50b0ZpeGVkKDEpfWA7IGlmKFBFUkYuZWZmZWN0cyAmJiBwYXJ0aWNsZXMuc21va2UpeyBmb3IoY29uc3QgcnAgb2YgcmVhcldoZWVsUG9zKXsgaWYoTWF0aC5yYW5kb20oKTwwLjYpIHBhcnRpY2xlcy5zbW9rZS5zcGF3bihuZXcgVEhSRUUuVmVjdG9yMyhycC54LHJwLnkscnAueiksIG5ldyBUSFJFRS5WZWN0b3IzKChNYXRoLnJhbmRvbSgpLTAuNSkqMC4zLDAuMjUsKE1hdGgucmFuZG9tKCktMC41KSowLjMpLCAwLjI4LCAwLjU1LCAwLjgpOyB9IH0gfQogICAgICBlbHNlIGRyaWZ0VGltZXI9MDsKICAgIH0KCiAgICBpZighb25Hcm91bmRQbGF5ZXIpewogICAgICBpZighYWlyYm9ybmUpeyBhaXJib3JuZT10cnVlOyBhaXJUaW1lPTA7IHJvdEFjY3VtPTA7IGxhc3RRdWF0PWNoYXNzaXNNZXNoLnF1YXRlcm5pb24uY2xvbmUoKTsgfQogICAgICBhaXJUaW1lICs9IGR0OyBjb25zdCBkcT1sYXN0UXVhdC5jbG9uZSgpLmludmVydCgpLm11bHRpcGx5KGNoYXNzaXNNZXNoLnF1YXRlcm5pb24uY2xvbmUoKSk7IGNvbnN0IGFuZ2xlPTIqTWF0aC5hY29zKE1hdGgubWF4KC0xLE1hdGgubWluKDEsZHEudykpKTsgcm90QWNjdW0gKz0gYW5nbGU7IGxhc3RRdWF0LmNvcHkoY2hhc3Npc01lc2gucXVhdGVybmlvbik7CiAgICB9IGVsc2UgaWYoYWlyYm9ybmUpewogICAgICBjb25zdCBmbGlwcz1NYXRoLmZsb29yKHJvdEFjY3VtLygyKk1hdGguUEkpKTsgbGV0IHB0cz1NYXRoLnJvdW5kKGFpclRpbWUqMjYwKTsgaWYoZmxpcHM+MCl7IHB0cyArPSBmbGlwcyoxMjAwOyBmbGFzaChgRmxpcCB4JHtmbGlwc30hYCk7IGF1ZGlvLmJsaXAoNTIwLC4xMiwuMjUpOyB9CiAgICAgIGFkZFNjb3JlKHB0cywiQWlydGltZSIpOyBpZihhaXJUaW1lPjAuNil7IGNvbWJvPU1hdGgubWluKDMuMCwgY29tYm8gKyAwLjIqKDErZmxpcHMpKTsgfSB1aS5jb21iby50ZXh0Q29udGVudD1gQ29tYm8geCR7Y29tYm8udG9GaXhlZCgxKX1gOwogICAgICBpZihmbGlwcz49MiB8fCBhaXJUaW1lPjEuMil7IHRpbWVTY2FsZT0wLjM4OyBzbG93bW9UPTAuNTU7IHVpLnNsb3dtby5zdHlsZS5kaXNwbGF5PSdibG9jayc7IH0KICAgICAgYWlyYm9ybmU9ZmFsc2U7IGFpclRpbWU9MDsKICAgIH0gZWxzZSB7IGNvbWJvPU1hdGgubWF4KDEuMCwgY29tYm8gLSAwLjEyKmR0UmVhbCk7IHVpLmNvbWJvLnRleHRDb250ZW50PWBDb21ibyB4JHtjb21iby50b0ZpeGVkKDEpfWA7IH0KCiAgICB1cGRhdGVCb29zdFBhZHMoZHRSZWFsKTsKICAgIHNwaW5QaWNrdXBzKGR0UmVhbCk7IGNoZWNrUGlja3VwcygpOyBjaGVja09yYnMoKTsgdXBkYXRlSGVhdChkdFJlYWwpOwoKICAgIHNoaWVsZFQ9TWF0aC5tYXgoMCxzaGllbGRULWR0UmVhbCk7IHNoaWVsZE1lc2gudmlzaWJsZSA9IFBFUkYuZWZmZWN0cyAmJiAoc2hpZWxkVD4wKTsKICAgIGNvbnN0IHB0eHQ9W107IGlmKHR1cmJvVD4wKSBwdHh0LnB1c2goYFR1cmJvICR7dHVyYm9ULnRvRml4ZWQoMSl9c2ApOyBpZihzaGllbGRUPjApIHB0eHQucHVzaChgU2hpZWxkICR7c2hpZWxkVC50b0ZpeGVkKDEpfXNgKTsgdWkucG93ZXJCYWRnZS50ZXh0Q29udGVudD1wdHh0Lmxlbmd0aD9wdHh0LmpvaW4oIiDigKIgIik6IuKAlCI7CgogICAgY29uc3QgbXBoPU1hdGguc3FydCh2Lngqdi54K3Yueip2LnopKjIuMjM3OyBpZih1aS5zcGVlZCkgdWkuc3BlZWQudGV4dENvbnRlbnQ9TWF0aC5yb3VuZChtcGgpOwogICAgdWkuZ3JhZGUuc3R5bGUub3BhY2l0eSA9IFBFUkYuZWZmZWN0cyA/IE1hdGgubWluKDAuNDIsIDAuMDggKyBoZWF0KjAuMDYgKyBtcGgqMC4wMDEyKSA6IDAuMDI7CiAgICBhdWRpby5lbmdpbmUobXBoLzE0MCwgMC4wOCArICh0aHJvdHRsZVM+MC4yPzAuMTowKSk7CgogICAgaWYoYm90c0VuYWJsZWQpewogICAgICBmb3IoY29uc3QgYWkgb2YgYWlDYXJzKXsKICAgICAgICBjb25zdCBkeD1haS5ib2R5LnBvc2l0aW9uLngtY2hhc3Npc0JvZHkucG9zaXRpb24ueCwgZHo9YWkuYm9keS5wb3NpdGlvbi56LWNoYXNzaXNCb2R5LnBvc2l0aW9uLnosIGRpc3Q9TWF0aC5oeXBvdChkeCxkeik7CiAgICAgICAgaWYoZGlzdCA8IENBVENIX1JBRElVUyl7CiAgICAgICAgICBpZihzaGllbGRUPjApeyBjb25zdCBkaXI9bmV3IENBTk5PTi5WZWMzKGR4L2Rpc3QsMCxkei9kaXN0KTsgYWkuYm9keS5hcHBseUltcHVsc2UobmV3IENBTk5PTi5WZWMzKGRpci54Ki0xMiw0LGRpci56Ki0xMiksIGFpLmJvZHkucG9zaXRpb24pOyBhZGRTY29yZSgxMjAsIlNoaWVsZCBidW1wIik7IGNhbVNoYWtlPU1hdGgubWluKDAuNSxjYW1TaGFrZSswLjIpOwogICAgICAgICAgfSBlbHNlIHsgcmVzZXRSb3VuZCgiVGFnZ2VkISIpOyBicmVhazsgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUNhbWVyYShkdFJlYWwsIG1waCk7CiAgICBpZihzbG93bW9UPjApeyBzbG93bW9ULT1kdFJlYWw7IGlmKHNsb3dtb1Q8PTApeyB0aW1lU2NhbGU9MTsgdWkuc2xvd21vLnN0eWxlLmRpc3BsYXk9J25vbmUnOyB9IH0KICAgIGNhbVNoYWtlPU1hdGgubWF4KDAsIGNhbVNoYWtlIC0gZHRSZWFsKjAuOCk7CgogICAgaWYgKFBFUkYuZWZmZWN0cyl7IHBhcnRpY2xlcy5zbW9rZS51cGRhdGUoZHRSZWFsKTsgcGFydGljbGVzLmZsYW1lLnVwZGF0ZShkdFJlYWwpOyBwYXJ0aWNsZXMucmluZy51cGRhdGUoZHRSZWFsKTsgfQogIH0KCiAgZnVuY3Rpb24gdXBkYXRlSGVhdChkdCl7CiAgICBzaW5jZVNjb3JlVCArPSBkdDsKICAgIGNvbnN0IGRlbGF5ID0gNyArIDMqaGVhdDsKICAgIGlmIChzaW5jZVNjb3JlVCA+PSAxICYmIGhlYXQgPiAwKXsKICAgICAgaWYgKGNvb2xUaW1lciA8PSAwKSBjb29sVGltZXIgPSBkZWxheTsgZWxzZSBjb29sVGltZXIgPSBNYXRoLm1heCgwLCBjb29sVGltZXIgLSBkdCk7CiAgICAgIHVpLmNvb2xUeHQudGV4dENvbnRlbnQgPSBgQ29vbGluZyBpbjogJHtjb29sVGltZXIudG9GaXhlZCgxKX1zYDsKICAgICAgaWYgKGNvb2xUaW1lciA8PSAwKXsgaGVhdD1NYXRoLm1heCgwLGhlYXQtMSk7IG9uSGVhdENoYW5nZSgpOyBjb29sVGltZXIgPSBoZWF0PjAgPyAoNyszKmhlYXQpIDogMDsgfQogICAgfSBlbHNlIHsgdWkuY29vbFR4dC50ZXh0Q29udGVudD0iIjsgY29vbFRpbWVyPTA7IH0KICAgIGlmIChzaW5jZVNjb3JlVCA+IDAuMykgaGVhdENoYXJnZSA9IE1hdGgubWF4KDAsIGhlYXRDaGFyZ2UgLSBkdCowLjEyKTsKICAgIGlmIChoZWF0IDwgTUFYX0hFQVQgJiYgaGVhdENoYXJnZSA+PSAxKXsgaGVhdCsrOyBoZWF0Q2hhcmdlLT0xOyBvbkhlYXRDaGFuZ2UoKTsgfQogICAgdWkuaGVhdFN0YXJzLnRleHRDb250ZW50PSLimIUiLnJlcGVhdChoZWF0KSsi4piGIi5yZXBlYXQoTUFYX0hFQVQtaGVhdCk7CiAgICB1aS5oZWF0QmFkZ2UudGV4dENvbnRlbnQ9aGVhdE5hbWUoaGVhdCk7CiAgfQogIGZ1bmN0aW9uIG9uSGVhdENoYW5nZSgpeyBpZiAoUEVSRi5lZmZlY3RzICYmIHBhcnRpY2xlcy5yaW5nKSBwYXJ0aWNsZXMucmluZy5zcGF3bihuZXcgVEhSRUUuVmVjdG9yMyhjaGFzc2lzQm9keS5wb3NpdGlvbi54LDEuMCxjaGFzc2lzQm9keS5wb3NpdGlvbi56KSwgbmV3IFRIUkVFLlZlY3RvcjMoKSwgMC42LCAyLjYraGVhdCowLjYsIDAuOSk7IHJlY29uY2lsZUJvdHNUb0hlYXQoKTsgfQoKICBmdW5jdGlvbiB1cGRhdGVCb29zdFBhZHMoZHQpewogICAgZm9yKGNvbnN0IHBhZCBvZiBib29zdHMpIHBhZC5jb29sPU1hdGgubWF4KDAscGFkLmNvb2wtZHQpOwogICAgZm9yKGNvbnN0IHBhZCBvZiBib29zdHMpewogICAgICBpZihwYWQuY29vbD4wKSBjb250aW51ZTsKICAgICAgY29uc3QgZHg9Y2hhc3Npc0JvZHkucG9zaXRpb24ueCAtIHBhZC5wb3MueCwgZHo9Y2hhc3Npc0JvZHkucG9zaXRpb24ueiAtIHBhZC5wb3MueiwgYz1NYXRoLmNvcygtcGFkLnJvdFkpLCBzPU1hdGguc2luKC1wYWQucm90WSk7CiAgICAgIGNvbnN0IGx4PWR4KmMgLSBkeipzLCBsej1keCpzICsgZHoqYzsKICAgICAgaWYoTWF0aC5hYnMobHgpPD1wYWQuc2l6ZS54LzIgJiYgTWF0aC5hYnMobHopPD1wYWQuc2l6ZS55LzIpewogICAgICAgIGNvbnN0IHBsYXllckY9Zm9yd2FyZFZlY3RvcihjaGFzc2lzQm9keSksIHBhZEY9eyB4Ok1hdGguc2luKHBhZC5yb3RZKSwgejpNYXRoLmNvcyhwYWQucm90WSkgfTsKICAgICAgICBjb25zdCBieD1wbGF5ZXJGLngqMC42ICsgcGFkRi54KjAuNCwgYno9cGxheWVyRi56KjAuNiArIHBhZEYueiowLjQsIGxlbj1NYXRoLmh5cG90KGJ4LGJ6KXx8MSwgZGlyPXsgeDpieC9sZW4sIHo6YnovbGVuIH07CiAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKG5ldyBDQU5OT04uVmVjMyhkaXIueCoyMiwxLjIsZGlyLnoqMjIpLCBjaGFzc2lzQm9keS5wb3NpdGlvbik7CiAgICAgICAgbml0cm89TWF0aC5taW4oMSwgbml0cm8rMC43NSk7IHR1cmJvVD1NYXRoLm1heCh0dXJib1QsMS44KTsKICAgICAgICBpZihQRVJGLmVmZmVjdHMgJiYgcGFydGljbGVzLmZsYW1lKXsgcGFydGljbGVzLmZsYW1lLnNwYXduKG5ldyBUSFJFRS5WZWN0b3IzKGNoYXNzaXNCb2R5LnBvc2l0aW9uLnggLSBkaXIueCoyLCAxLjAsIGNoYXNzaXNCb2R5LnBvc2l0aW9uLnogLSBkaXIueioyKSwgbmV3IFRIUkVFLlZlY3RvcjMoLWRpci54KjYsMCwtZGlyLnoqNiksIDAuMTQsIDEuMCk7IH0KICAgICAgICBhZGRTY29yZSg0NTAsIkJvb3N0IHBhZCIpOyBjYW1TaGFrZT1NYXRoLm1pbigwLjYsIGNhbVNoYWtlKzAuMDgpOyBwYWQuY29vbD0xLjI7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGFwcGx5QWVybyhib2R5LCBzcGVlZCwgaz0wLjQpeyBjb25zdCBkZj1rKnNwZWVkKnNwZWVkLCBmd2Q9Zm9yd2FyZFZlY3Rvcihib2R5KTsKICAgIGNvbnN0IHBGPW5ldyBDQU5OT04uVmVjMyhib2R5LnBvc2l0aW9uLnggKyBmd2QueCoxLjYsIGJvZHkucG9zaXRpb24ueSswLjQsIGJvZHkucG9zaXRpb24ueiArIGZ3ZC56KjEuNik7CiAgICBjb25zdCBwUj1uZXcgQ0FOTk9OLlZlYzMoYm9keS5wb3NpdGlvbi54IC0gZndkLngqMS42LCBib2R5LnBvc2l0aW9uLnkrMC40LCBib2R5LnBvc2l0aW9uLnogLSBmd2QueioxLjYpOwogICAgY29uc3QgRj1uZXcgQ0FOTk9OLlZlYzMoMCwtZGYsMCk7IGJvZHkuYXBwbHlGb3JjZShGLHBGKTsgYm9keS5hcHBseUZvcmNlKEYscFIpOyB9CiAgZnVuY3Rpb24gc3RhYmlsaXplUGl0Y2goYm9keSxrPTIwMDApeyBib2R5LmFuZ3VsYXJWZWxvY2l0eS54ICo9IDAuOTk1OyBib2R5LmFuZ3VsYXJWZWxvY2l0eS55ICo9IDAuOTk3OyBib2R5LmFuZ3VsYXJWZWxvY2l0eS56ICo9IDAuOTk1OyB9CiAgZnVuY3Rpb24gdXByaWdodEFzc2lzdChib2R5LHN0cmVuZ3RoPTE2MDAsZGFtcGluZz0wLjk2KXsgY29uc3QgdXA9dXBWZWN0b3IoYm9keSk7IGJvZHkudG9ycXVlLnggKz0gKC11cC56KSpzdHJlbmd0aDsgYm9keS50b3JxdWUueiArPSAodXAueCkqc3RyZW5ndGg7IGJvZHkuYW5ndWxhclZlbG9jaXR5LnggKj0gZGFtcGluZzsgYm9keS5hbmd1bGFyVmVsb2NpdHkueiAqPSBkYW1waW5nOyB9CgogIGZ1bmN0aW9uIHVwZGF0ZUNhbWVyYShkdCxtcGgpewogICAgaWYoY2FtZXJhTW9kZT09PSJjaGFzZSIpewogICAgICBjb25zdCBsb29rQWhlYWQ9MC4wMipNYXRoLm1pbig2MCxtcGgpLCBmb3J3YXJkPW5ldyBUSFJFRS5WZWN0b3IzKDAsMCwxKS5hcHBseVF1YXRlcm5pb24oY2hhc3Npc01lc2gucXVhdGVybmlvbiksIHVwPW5ldyBUSFJFRS5WZWN0b3IzKDAsMSwwKTsKICAgICAgY29uc3QgdGFyZ2V0PWNoYXNzaXNNZXNoLnBvc2l0aW9uLmNsb25lKCkuYWRkKGZvcndhcmQuY2xvbmUoKS5tdWx0aXBseVNjYWxhcihsb29rQWhlYWQpKTsKICAgICAgbGV0IGRlc2lyZWQ9Y2hhc3Npc01lc2gucG9zaXRpb24uY2xvbmUoKS5hZGQodXAubXVsdGlwbHlTY2FsYXIoMS42K01hdGgubWluKDIuMixtcGgvNjApKSkuYWRkKGZvcndhcmQubXVsdGlwbHlTY2FsYXIoLTcuMCAtIE1hdGgubWluKDMuMCxtcGgvNDApKSk7CiAgICAgIGlmKGNhbVNoYWtlPjApIGRlc2lyZWQuYWRkKG5ldyBUSFJFRS5WZWN0b3IzKChNYXRoLnJhbmRvbSgpLTAuNSkqY2FtU2hha2UsKE1hdGgucmFuZG9tKCktMC41KSpjYW1TaGFrZSowLjUsKE1hdGgucmFuZG9tKCktMC41KSpjYW1TaGFrZSkpOwogICAgICBjb25zdCBsZXJwPTEtTWF0aC5wb3coMC4wMDEsZHQpOyBjYW1lcmEucG9zaXRpb24ubGVycChkZXNpcmVkLGxlcnApOyBjYW1lcmEubG9va0F0KHRhcmdldCk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBmd2Q9bmV3IFRIUkVFLlZlY3RvcjMoMCwwLDEpLmFwcGx5UXVhdGVybmlvbihjaGFzc2lzTWVzaC5xdWF0ZXJuaW9uKTsKICAgICAgY29uc3QgcmlnaHQ9bmV3IFRIUkVFLlZlY3RvcjMoKS5jcm9zc1ZlY3RvcnMobmV3IFRIUkVFLlZlY3RvcjMoMCwxLDApLCBmd2QpLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBwb3M9Y2hhc3Npc01lc2gucG9zaXRpb24uY2xvbmUoKS5hZGQocmlnaHQubXVsdGlwbHlTY2FsYXIoMTApKS5hZGQobmV3IFRIUkVFLlZlY3RvcjMoMCw2LDApKS5hZGQoZndkLmNsb25lKCkubXVsdGlwbHlTY2FsYXIoMTApKTsKICAgICAgY2FtZXJhLnBvc2l0aW9uLmxlcnAocG9zLDAuMTUpOyBjYW1lcmEubG9va0F0KGNoYXNzaXNNZXNoLnBvc2l0aW9uKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlc2V0QUkoYWkpeyBhaS5ib2R5LnBvc2l0aW9uLnNldChhaS5zcGF3bi54LDMsYWkuc3Bhd24ueik7IGFpLmJvZHkudmVsb2NpdHkuc2V0KDAsMCwwKTsgYWkuYm9keS5hbmd1bGFyVmVsb2NpdHkuc2V0KDAsMCwwKTsgYWkuYm9keS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcigwLDAsMCk7IGFpLmJvZHkud2FrZVVwKCk7IGFpLnVwc2lkZVQ9MDsgYWkuc3R1Y2tUPTA7IGFpLnNwYXduS2lja1Q9MC42OyBhaS5sdW5nZVQ9MDsgfQogIGZ1bmN0aW9uIHJlc2V0UGxheWVyVG9TcGF3bigpeyBjb25zdCBzcD1NQVBTW2N1cnJlbnRNYXBdLnBsYXllclNwYXduOyBjaGFzc2lzQm9keS5wb3NpdGlvbi5zZXQoc3AueCxzcC55LHNwLnopOyBjaGFzc2lzQm9keS52ZWxvY2l0eS5zZXQoMCwwLDApOyBjaGFzc2lzQm9keS5hbmd1bGFyVmVsb2NpdHkuc2V0KDAsMCwwKTsgY2hhc3Npc0JvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoMCwwLDApOyBjaGFzc2lzQm9keS53YWtlVXAoKTsgfQogIGZ1bmN0aW9uIHJlc2V0UGxheWVyKCl7IHJlc2V0UGxheWVyVG9TcGF3bigpOyBjb21ibz1NYXRoLm1heCgxLjAsIGNvbWJvKjAuOCk7IHVpLmNvbWJvLnRleHRDb250ZW50PWBDb21ibyB4JHtjb21iby50b0ZpeGVkKDEpfWA7IHJlY29uY2lsZUJvdHNUb0hlYXQoKTsgfQogIGZ1bmN0aW9uIHJlc2V0Um91bmQocmVhc29uKXsgaWYocmVhc29uKXsgZmxhc2gocmVhc29uKTsgfSByZXNldFBsYXllcigpOyBmb3IoY29uc3QgYWkgb2YgYWlDYXJzKSByZXNldEFJKGFpKTsgfQoKICAvKiA9PT09PSBCb290ID09PT09ICovCiAgaW5pdFRocmVlKCk7CiAgaW5pdFBoeXNpY3MoKTsKICBidWlsZFBsYXllcigpOwogIHNldFBlcmZUZXh0KCk7CiAgc2V0TWFwKDApOwoKICAvLyBQYXJ0aWNsZXMKICBwYXJ0aWNsZXMuc21va2UgPSBjcmVhdGVTcHJpdGVQb29sKG1ha2VDaXJjbGVUZXh0dXJlKCdyZ2JhKDE2MCwxNzAsMTkwLDAuOSknLCdyZ2JhKDIwLDMwLDUwLDAuMCknKSwgaXNNb2JpbGU/NTA6MTEwLCBUSFJFRS5Ob3JtYWxCbGVuZGluZyk7CiAgcGFydGljbGVzLmZsYW1lID0gY3JlYXRlU3ByaXRlUG9vbChtYWtlQ2lyY2xlVGV4dHVyZSgncmdiYSgyNTUsMjAwLDkwLDAuOTUpJywncmdiYSgyNTUsODAsMCwwLjApJyksIGlzTW9iaWxlPzI0OjUwLCBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nKTsKICBwYXJ0aWNsZXMucmluZyAgPSBjcmVhdGVTcHJpdGVQb29sKG1ha2VDaXJjbGVUZXh0dXJlKCdyZ2JhKDI1NSwxNjAsNjAsMC45KScsJ3JnYmEoMjU1LDgwLDAsMC4wKScpLCBpc01vYmlsZT84OjEyLCBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nKTsKCiAgJCgiI2J0bkRpZmYiKS50ZXh0Q29udGVudD0nRGlmZmljdWx0eTogJytESUZGW2RpZmZdLm5hbWU7CiAgJCgiI2J0bk1hcCIpLnRleHRDb250ZW50PSdNYXA6ICcrTUFQU1tjdXJyZW50TWFwXS5uYW1lOwogIGFwcGx5UGVyZignYXV0bycpOwogIHNldHVwTW9iaWxlQ29udHJvbHMoKTsKCiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLCAoZSk9PnsgaWYgKHVpLnBhbmVsLnN0eWxlLmRpc3BsYXk9PT0nYmxvY2snICYmICF1aS5wYW5lbC5jb250YWlucyhlLnRhcmdldCkgJiYgZS50YXJnZXQhPT11aS5idG5NZW51KXsgdWkucGFuZWwuc3R5bGUuZGlzcGxheT0nbm9uZSc7IH0gfSk7CgogIGNsb2NrID0gbmV3IFRIUkVFLkNsb2NrKCk7CiAgYW5pbWF0ZSgpOwoKfSkoKTsKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPgo=";

  const home = document.getElementById('home');
  const stage = document.getElementById('stage');
  const frame = document.getElementById('game');
  const homeBtn = document.getElementById('homeBtn');

  function launch(url){
  frame.src = url;
  stage.style.display = 'block';
  home.style.display = 'none';

  // Make iframe focusable + focus it so desktop keys work immediately
  frame.setAttribute('tabindex','-1');
  const focusIframe = () => { try { frame.contentWindow && frame.contentWindow.focus(); frame.focus(); } catch(e){} };

  // After the game document loads: focus it and wire ESC to Home even while focused inside the iframe
  frame.addEventListener('load', () => {
    focusIframe();
    try {
      frame.contentWindow.addEventListener('keydown', (ev) => {
        if (ev.key === 'Escape') { ev.preventDefault(); goHome(); }
      });
    } catch (e) {}
  }, { once:true });

  // Initial attempt (in case load fires very fast)
  focusIframe();
}
  function goHome(){
    stage.style.display = 'none';
    home.style.display = 'grid';
    try { frame.src = 'about:blank'; } catch (e) {}
  }

  document.getElementById('launchDesktop').addEventListener('click', () => launch(DESK));
  document.getElementById('launchIPad').addEventListener('click',    () => launch(IPAD));
  document.getElementById('launchPhone').addEventListener('click',   () => launch(PHONE));
  homeBtn.addEventListener('click', goHome);

  // Fullscreen helper
  document.getElementById('goFull').addEventListener('click', () => {
    if (!document.fullscreenElement) document.documentElement.requestFullscreen().catch(()=>{});
    else document.exitFullscreen();
  });

  // Escape key to go home (works if focus is on parent document)
  window.addEventListener('keydown', (e) => { if (e.key === 'Escape' && stage.style.display === 'block') goHome(); });
})();
</script>
</body>
</html>
